archetype (adl_version=1.4)
    openEHR-EHR-OBSERVATION.sleep_architecture.v0

concept
	[at0000]	-- Sleep Architecture

language
    original_language = <[ISO_639-1::en]>

description
    original_author = <
        ["name"] = <"Ricardo Lourenco dos Santos">
        ["organisation"] = <"Faculty of Medicine, University of Porto (FMUP)">
        ["email"] = <"ricardolourencosantos@gmail.com">
        ["date"] = <"2025-11-25">
    >
    lifecycle_state = <"in_development">
    details = <
        ["en"] = <
            language = <[ISO_639-1::en]>
            purpose = <"To record sleep architecture data from wearable devices including sleep stages, sleep quality scores, and related metrics for lifestyle medicine sleep pillar interventions.">
            use = <"Use to record nightly sleep data from consumer wearables (Oura, Fitbit, Apple Watch, Garmin, Whoop). Supports lifestyle medicine's sleep pillar. Includes sleep stages (wake, light, deep, REM), sleep quality scores, and related metrics like HRV during sleep. Compatible with vendor APIs and aggregation platforms.">
            keywords = <"sleep", "sleep stages", "REM", "deep sleep", "sleep quality", "insomnia", "wearable", "Oura", "Fitbit", "lifestyle medicine", "circadian">
            misuse = <"Not for clinical polysomnography (PSG) data which requires specialized archetypes with EEG/EMG details. Not for sleep apnea diagnosis.">
            copyright = <"CC BY-SA 4.0">
        >
    >
    other_details = <
        ["licence"] = <"Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)">
        ["custodian_organisation"] = <"FMUP - Faculty of Medicine, University of Porto">
        ["links"] = <"https://linktr.ee/ricardolsantos">
    >

definition
    OBSERVATION[at0000] matches {    -- Sleep architecture
        data matches {
            HISTORY[at0001] matches {
                events cardinality matches {1..*; unordered} matches {
                    EVENT[at0002] occurrences matches {0..*} matches {    -- Any event
                        data matches {
                            ITEM_TREE[at0003] matches {
                                items cardinality matches {0..*; unordered} matches {
                                    -- TIMING
                                    ELEMENT[at0009] occurrences matches {0..1} matches {    -- Bedtime
                                        value matches {
                                            DV_TIME
                                        }
                                    }
                                    ELEMENT[at0010] occurrences matches {0..1} matches {    -- Wake time
                                        value matches {
                                            DV_TIME
                                        }
                                    }
                                    ELEMENT[at0011] occurrences matches {0..1} matches {    -- Time in bed
                                        value matches {
                                            DV_DURATION matches {
                                                value matches {PTHM/|PT0M..PT24H|}
                                            }
                                        }
                                    }
                                    ELEMENT[at0012] occurrences matches {0..1} matches {    -- Total sleep time
                                        value matches {
                                            DV_DURATION matches {
                                                value matches {PTHM/|PT0M..PT24H|}
                                            }
                                        }
                                    }
                                    ELEMENT[at0013] occurrences matches {0..1} matches {    -- Sleep onset latency
                                        value matches {
                                            DV_DURATION matches {
                                                value matches {PTHM/|PT0M..PT4H|}
                                            }
                                        }
                                    }
                                    -- SLEEP STAGES
                                    CLUSTER[at0019] occurrences matches {0..1} matches {    -- Sleep stages
                                        items cardinality matches {1..*; unordered} matches {
                                            ELEMENT[at0020] occurrences matches {0..1} matches {    -- Awake duration
                                                value matches {
                                                    DV_DURATION matches {
                                                        value matches {PTHM/|PT0M..PT8H|}
                                                    }
                                                }
                                            }
                                            ELEMENT[at0021] occurrences matches {0..1} matches {    -- Light sleep duration
                                                value matches {
                                                    DV_DURATION matches {
                                                        value matches {PTHM/|PT0M..PT12H|}
                                                    }
                                                }
                                            }
                                            ELEMENT[at0022] occurrences matches {0..1} matches {    -- Deep sleep duration
                                                value matches {
                                                    DV_DURATION matches {
                                                        value matches {PTHM/|PT0M..PT6H|}
                                                    }
                                                }
                                            }
                                            ELEMENT[at0023] occurrences matches {0..1} matches {    -- REM sleep duration
                                                value matches {
                                                    DV_DURATION matches {
                                                        value matches {PTHM/|PT0M..PT6H|}
                                                    }
                                                }
                                            }
                                            ELEMENT[at0024] occurrences matches {0..1} matches {    -- Deep sleep percentage
                                                value matches {
                                                    DV_PROPORTION matches {
                                                        numerator matches {|0.0..100.0|}
                                                        type matches {2}
                                                    }
                                                }
                                            }
                                            ELEMENT[at0025] occurrences matches {0..1} matches {    -- REM sleep percentage
                                                value matches {
                                                    DV_PROPORTION matches {
                                                        numerator matches {|0.0..100.0|}
                                                        type matches {2}
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    -- EFFICIENCY METRICS
                                    ELEMENT[at0029] occurrences matches {0..1} matches {    -- Sleep efficiency
                                        value matches {
                                            DV_PROPORTION matches {
                                                numerator matches {|0.0..100.0|}
                                                type matches {2}
                                            }
                                        }
                                    }
                                    ELEMENT[at0030] occurrences matches {0..1} matches {    -- Number of awakenings
                                        value matches {
                                            DV_COUNT matches {
                                                magnitude matches {|0..100|}
                                            }
                                        }
                                    }
                                    ELEMENT[at0031] occurrences matches {0..1} matches {    -- Wake after sleep onset (WASO)
                                        value matches {
                                            DV_DURATION matches {
                                                value matches {PTHM/|PT0M..PT8H|}
                                            }
                                        }
                                    }
                                    -- QUALITY SCORES
                                    ELEMENT[at0039] occurrences matches {0..1} matches {    -- Sleep score
                                        value matches {
                                            DV_COUNT matches {
                                                magnitude matches {|0..100|}
                                            }
                                        }
                                    }
                                    ELEMENT[at0040] occurrences matches {0..1} matches {    -- Restfulness score
                                        value matches {
                                            DV_COUNT matches {
                                                magnitude matches {|0..100|}
                                            }
                                        }
                                    }
                                    ELEMENT[at0041] occurrences matches {0..1} matches {    -- Readiness score
                                        value matches {
                                            DV_COUNT matches {
                                                magnitude matches {|0..100|}
                                            }
                                        }
                                    }
                                    -- PHYSIOLOGICAL METRICS DURING SLEEP
                                    CLUSTER[at0049] occurrences matches {0..1} matches {    -- Sleep physiology
                                        items cardinality matches {1..*; unordered} matches {
                                            ELEMENT[at0050] occurrences matches {0..1} matches {    -- Average heart rate
                                                value matches {
                                                    DV_QUANTITY matches {
                                                        property matches {[openehr::382]}
                                                        units matches {"/min"}
                                                        magnitude matches {|30.0..150.0|}
                                                    }
                                                }
                                            }
                                            ELEMENT[at0051] occurrences matches {0..1} matches {    -- Lowest heart rate
                                                value matches {
                                                    DV_QUANTITY matches {
                                                        property matches {[openehr::382]}
                                                        units matches {"/min"}
                                                        magnitude matches {|30.0..150.0|}
                                                    }
                                                }
                                            }
                                            ELEMENT[at0052] occurrences matches {0..1} matches {    -- Average HRV (RMSSD)
                                                value matches {
                                                    DV_QUANTITY matches {
                                                        property matches {[openehr::128]}
                                                        units matches {"ms"}
                                                        magnitude matches {|0.0..200.0|}
                                                    }
                                                }
                                            }
                                            ELEMENT[at0053] occurrences matches {0..1} matches {    -- Average SpO2
                                                value matches {
                                                    DV_PROPORTION matches {
                                                        numerator matches {|80.0..100.0|}
                                                        type matches {2}
                                                    }
                                                }
                                            }
                                            ELEMENT[at0054] occurrences matches {0..1} matches {    -- Respiratory rate
                                                value matches {
                                                    DV_QUANTITY matches {
                                                        property matches {[openehr::382]}
                                                        units matches {"/min"}
                                                        magnitude matches {|4.0..30.0|}
                                                    }
                                                }
                                            }
                                            ELEMENT[at0055] occurrences matches {0..1} matches {    -- Skin temperature deviation
                                                value matches {
                                                    DV_QUANTITY matches {
                                                        property matches {[openehr::127]}    -- Temperature
                                                        units matches {"Cel"}
                                                        magnitude matches {|-3.0..3.0|}
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    -- CIRCADIAN
                                    ELEMENT[at0059] occurrences matches {0..1} matches {    -- Sleep midpoint
                                        value matches {
                                            DV_TIME
                                        }
                                    }
                                    ELEMENT[at0060] occurrences matches {0..1} matches {    -- Circadian alignment
                                        value matches {
                                            DV_CODED_TEXT matches {
                                                defining_code matches {
                                                    [local::
                                                    at70,    -- Optimal
                                                    at71,    -- Slightly early
                                                    at72,    -- Slightly late
                                                    at73,    -- Early
                                                    at74,    -- Late
                                                    at75]    -- Irregular
                                                }
                                            }
                                        }
                                    }
                                    -- DISTURBANCES
                                    ELEMENT[at0064] occurrences matches {0..1} matches {    -- Snoring duration
                                        value matches {
                                            DV_DURATION matches {
                                                value matches {PTHM/|PT0M..PT8H|}
                                            }
                                        }
                                    }
                                    ELEMENT[at0065] occurrences matches {0..1} matches {    -- Movement count
                                        value matches {
                                            DV_COUNT matches {
                                                magnitude matches {|0..1000|}
                                            }
                                        }
                                    }
                                    ELEMENT[at0069] occurrences matches {0..1} matches {    -- Comment
                                        value matches {
                                            DV_TEXT
                                        }
                                    }
                                }
                            }
                        }
                    }
                    INTERVAL_EVENT[at0079] occurrences matches {0..1} matches {    -- Nightly sleep
                        math_function matches {
                            DV_CODED_TEXT matches {
                                defining_code matches {[openehr::148]}
                            }
                        }
                        width matches {
                            DV_DURATION matches {
                                value matches {PT12H}
                            }
                        }
                    }
                }
            }
        }
        protocol matches {
            ITEM_TREE[at0089] matches {
                items cardinality matches {0..*; unordered} matches {
                    ELEMENT[at0090] occurrences matches {0..1} matches {    -- Sleep detection algorithm
                        value matches {
                            DV_CODED_TEXT matches {
                                defining_code matches {
                                    [local::
                                    at80,    -- Actigraphy-based
                                    at81,    -- HR + movement
                                    at82,    -- PPG-based
                                    at83,    -- Multi-sensor fusion
                                    at84]    -- Unknown
                                }
                            }
                        }
                    }
                    allow_archetype CLUSTER[at0091] occurrences matches {0..*} matches {    -- Wearable device
                        include
                            archetype_id/value matches {/openEHR-EHR-CLUSTER\.wearable_device\.v.*/}
                    }
                }
            }
        }
    }

terminology
    term_definitions = <
        ["en"] = <
            items = <
                ["at0000"] = <text = <"Sleep architecture">; description = <"Sleep staging and quality metrics from wearable devices.">>
                ["at0002"] = <text = <"Any event">; description = <"Default event.">>
                ["at0009"] = <text = <"Bedtime">; description = <"Time went to bed.">>
                ["at0010"] = <text = <"Wake time">; description = <"Time of final awakening.">>
                ["at0011"] = <text = <"Time in bed">; description = <"Total time spent in bed.">>
                ["at0012"] = <text = <"Total sleep time">; description = <"Actual time asleep (excluding awakenings).">>
                ["at0013"] = <text = <"Sleep onset latency">; description = <"Time to fall asleep after going to bed.">>
                ["at0019"] = <text = <"Sleep stages">; description = <"Duration of each sleep stage.">>
                ["at0020"] = <text = <"Awake duration">; description = <"Time spent awake during sleep period.">>
                ["at0021"] = <text = <"Light sleep duration">; description = <"Time in N1+N2 light sleep stages.">>
                ["at0022"] = <text = <"Deep sleep duration">; description = <"Time in N3 slow-wave sleep (SWS).">>
                ["at0023"] = <text = <"REM sleep duration">; description = <"Time in REM (rapid eye movement) sleep.">>
                ["at0024"] = <text = <"Deep sleep percentage">; description = <"Percentage of total sleep in deep sleep.">>
                ["at0025"] = <text = <"REM sleep percentage">; description = <"Percentage of total sleep in REM.">>
                ["at0029"] = <text = <"Sleep efficiency">; description = <"Total sleep time / Time in bed x 100.">>
                ["at0030"] = <text = <"Number of awakenings">; description = <"Count of awakenings during sleep.">>
                ["at0031"] = <text = <"Wake after sleep onset (WASO)">; description = <"Total time awake after initially falling asleep.">>
                ["at0039"] = <text = <"Sleep score">; description = <"Vendor-calculated composite sleep quality score (0-100).">>
                ["at0040"] = <text = <"Restfulness score">; description = <"Score for sleep restfulness/disturbances.">>
                ["at0041"] = <text = <"Readiness score">; description = <"Next-day readiness based on sleep quality.">>
                ["at0049"] = <text = <"Sleep physiology">; description = <"Physiological metrics during sleep.">>
                ["at0050"] = <text = <"Average heart rate">; description = <"Mean HR during sleep.">>
                ["at0051"] = <text = <"Lowest heart rate">; description = <"Minimum HR reached during sleep.">>
                ["at0052"] = <text = <"Average HRV (RMSSD)">; description = <"Mean RMSSD during sleep (higher = better recovery).">>
                ["at0053"] = <text = <"Average SpO2">; description = <"Mean blood oxygen saturation during sleep.">>
                ["at0054"] = <text = <"Respiratory rate">; description = <"Average breaths per minute during sleep.">>
                ["at0055"] = <text = <"Skin temperature deviation">; description = <"Deviation from personal baseline skin temperature.">>
                ["at0059"] = <text = <"Sleep midpoint">; description = <"Midpoint time of sleep period (circadian marker).">>
                ["at0060"] = <text = <"Circadian alignment">; description = <"Assessment of sleep timing relative to circadian rhythm.">>
                ["at0064"] = <text = <"Snoring duration">; description = <"Total time snoring detected.">>
                ["at0065"] = <text = <"Movement count">; description = <"Number of significant movements during sleep.">>
                ["at0069"] = <text = <"Comment">; description = <"Additional notes about the sleep session.">>
                ["at0079"] = <text = <"Nightly sleep">; description = <"Single night sleep session.">>
                ["at0090"] = <text = <"Sleep detection algorithm">; description = <"Method used by device to detect sleep stages.">>
                ["at0091"] = <text = <"Wearable device">; description = <"Details of the device used.">>
                ["at70"] = <text = <"Optimal">; description = <"Sleep timing well aligned with circadian rhythm.">>
                ["at71"] = <text = <"Slightly early">; description = <"Sleep timing slightly earlier than optimal.">>
                ["at72"] = <text = <"Slightly late">; description = <"Sleep timing slightly later than optimal.">>
                ["at73"] = <text = <"Early">; description = <"Sleep timing significantly early.">>
                ["at74"] = <text = <"Late">; description = <"Sleep timing significantly late.">>
                ["at75"] = <text = <"Irregular">; description = <"Inconsistent sleep timing pattern.">>
                ["at80"] = <text = <"Actigraphy-based">; description = <"Movement-only sleep detection.">>
                ["at81"] = <text = <"HR + movement">; description = <"Heart rate and movement combined.">>
                ["at82"] = <text = <"PPG-based">; description = <"Optical PPG signal analysis.">>
                ["at83"] = <text = <"Multi-sensor fusion">; description = <"Multiple sensors (HR, movement, SpO2, temp).">>
                ["at84"] = <text = <"Unknown">; description = <"Algorithm not specified.">>
            >
        >
    >
