<?xml version="1.0" encoding="UTF-8"?>

<ConceptMap xmlns="http://hl7.org/fhir">
  <id value="ConceptMapFHIRToOpenEHR"/>
  <text>
    <status value="generated"/><div xmlns="http://www.w3.org/1999/xhtml"><p class="res-header-id"><b>Narrativa gerada: ConceptMap ConceptMapFHIRToOpenEHR</b></p><a name="ConceptMapFHIRToOpenEHR"> </a><a name="hcConceptMapFHIRToOpenEHR"> </a><p>Mapeamento de (não especificado) para (não especificado)</p><br/><p><b>Grupo 1 </b>Mapeamento de <a href="http://hl7.org/fhir/R4/observation.html">Observation</a> to <code>openEHR-EHR-OBSERVATION.heart_rate_variability.v0</code></p><table class="grid"><tr><td><b>Código fonte</b></td><td><b>Relacionamento</b></td><td><b>Código de destino</b></td><td><b>Comentário</b></td></tr><tr><td>Observation.component:sdnn (SDNN component with LOINC 80404-7)</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id5 (SDNN - Standard deviation of NN intervals)</td><td>Map from Observation.component with code LOINC 80404-7. Unit: ms</td></tr><tr><td>Observation.component:rmssd (RMSSD component with HeartRateVariabilityCS#hrv-rmssd)</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id6 (RMSSD - Root mean square of successive differences)</td><td>Map from component with HeartRateVariabilityCS#hrv-rmssd. No LOINC code. Unit: ms</td></tr><tr><td>Observation.component:pnn50 (pNN50 component with HeartRateVariabilityCS#hrv-pnn50)</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id7 (pNN50 - Percentage of NN intervals &gt;50ms)</td><td>Map from component with HeartRateVariabilityCS#hrv-pnn50. Unit: %</td></tr><tr><td>Observation.component:lf-hf-ratio (LF/HF ratio component)</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id13 (LF/HF Ratio)</td><td>Map from component with HeartRateVariabilityCS#hrv-lf-hf-ratio. Dimensionless ratio</td></tr><tr><td>Observation.effectivePeriod (Observation.effectivePeriod (start/end))</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#relatedto" title="relatedto">is related to</a></td><td>id32 (Recording duration)</td><td>Calculate duration from effectivePeriod.end - effectivePeriod.start</td></tr><tr><td>Observation.component:state (Physiological state component)</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id41 (Physiological state)</td><td>Map resting/active/sleep states from component</td></tr><tr><td>Observation.device (Observation.device reference)</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#relatedto" title="relatedto">is related to</a></td><td>id51 (Device type)</td><td>Resolve Device reference and map to CLUSTER.wearable_device</td></tr></table><hr/><p><b>Grupo 2 </b>Mapeamento de <a href="http://hl7.org/fhir/R4/observation.html">Observation</a> to <code>openEHR-EHR-OBSERVATION.physical_activity_detailed.v0</code></p><table class="grid"><tr><td><b>Código fonte</b></td><td><b>Relacionamento</b></td><td><b>Código de destino</b></td><td><b>Comentário</b></td></tr><tr><td>Observation.valueQuantity (Observation.valueQuantity (steps))</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id10 (Step count)</td><td>When Observation.code is LOINC 55423-8 (Number of steps). Unit: steps</td></tr><tr><td>Observation.component:distance (Distance component with LOINC 55430-3)</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id11 (Distance)</td><td>Map from component with LOINC 55430-3. Unit: km or m</td></tr><tr><td>Observation.component:active-calories (Active calories component with LOINC 41979-6)</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id20 (Active calories)</td><td>Map from component with LOINC 41979-6. Unit: kcal</td></tr><tr><td>Observation.component:moderate-minutes (Moderate activity minutes with LOINC 77592-4)</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id32 (Moderately active minutes)</td><td>Map from component with LOINC 77592-4. Unit: min</td></tr><tr><td>Observation.component:vigorous-minutes (Vigorous activity minutes with LOINC 77593-2)</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id33 (Vigorously active minutes)</td><td>Map from component with LOINC 77593-2. Unit: min</td></tr></table><hr/><p><b>Grupo 3 </b>Mapeamento de <a href="http://hl7.org/fhir/R4/observation.html">Observation</a> to <code>openEHR-EHR-OBSERVATION.sleep_architecture.v0</code></p><table class="grid"><tr><td><b>Código fonte</b></td><td><b>Relacionamento</b></td><td><b>Código de destino</b></td><td><b>Comentário</b></td></tr><tr><td>Observation.valueQuantity (Observation.valueQuantity (sleep duration))</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id13 (Total sleep time)</td><td>When Observation.code is LOINC 93832-4 (Sleep duration). Unit: h or min</td></tr><tr><td>Observation.component:deep-sleep (Deep sleep duration component)</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id23 (Deep sleep duration)</td><td>N3/SWS stage duration. Custom code - no LOINC</td></tr><tr><td>Observation.component:rem-sleep (REM sleep duration component)</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id24 (REM sleep duration)</td><td>REM stage duration. Custom code - no LOINC</td></tr><tr><td>Observation.component:efficiency (Sleep efficiency component)</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id30 (Sleep efficiency)</td><td>TST/TIB ratio as percentage. Custom code - no LOINC</td></tr><tr><td>Observation.component:score (Sleep score component)</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id40 (Sleep score)</td><td>Vendor-specific composite score (0-100). Proprietary algorithm</td></tr><tr><td>Observation.component:sleep-hrv (Average HRV during sleep component)</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id53 (Average HRV (RMSSD) during sleep)</td><td>Use HeartRateVariabilityCS#hrv-rmssd with context. Unit: ms</td></tr></table><hr/><p><b>Grupo 4 </b>Mapeamento de <a href="http://hl7.org/fhir/R4/device.html">Device</a> to <code>openEHR-EHR-CLUSTER.wearable_device.v0</code></p><table class="grid"><tr><td><b>Código fonte</b></td><td><b>Relacionamento</b></td><td><b>Código de destino</b></td><td><b>Comentário</b></td></tr><tr><td>Device.manufacturer</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id2 (Device platform)</td><td>Map manufacturer string to vendor code (Apple, Fitbit, Garmin, etc.)</td></tr><tr><td>Device.modelNumber</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id3 (Device model)</td><td>Specific model name</td></tr><tr><td>Device.type</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id4 (Device category)</td><td>Map from SNOMED CT device type codes where available</td></tr><tr><td>Device.serialNumber</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id23 (Serial number)</td><td/></tr><tr><td>Device.version:firmware (Device.version[firmware])</td><td><a href="http://hl7.org/fhir/R5/codesystem-concept-map-relationship.html#equivalent" title="equivalent">is equivalent to</a></td><td>id20 (Firmware version)</td><td>Filter by version.type = firmware</td></tr></table></div>
  </text>
  <url value="https://2rdoc.pt/ig/ios-lifestyle-medicine/ConceptMap/ConceptMapFHIRToOpenEHR"/>
  <version value="0.1.0"/>
  <name value="ConceptMapFHIRToOpenEHR"/>
  <title value="FHIR Resource to openEHR Archetype Mapping"/>
  <status value="active"/>
  <experimental value="false"/>
  <date value="2025-11-25"/>
  <publisher value="Ricardo Lourenço dos Santos"/>
  <contact>
    <name value="Ricardo Lourenço dos Santos"/>
    <telecom>
      <system value="url"/>
      <value value="https://linktr.ee/ricardolsantos"/>
    </telecom>
  </contact>
  <description value="Reverse mapping from FHIR R4 resources to custom openEHR archetypes for wearable lifestyle medicine data.&#xA;&#xA;Supported FHIR → openEHR mappings:&#xA;- Observation (HRV profile) → OBSERVATION.heart_rate_variability.v0&#xA;- Observation (activity profile) → OBSERVATION.physical_activity_detailed.v0&#xA;- Observation (sleep profile) → OBSERVATION.sleep_architecture.v0&#xA;- Device → CLUSTER.wearable_device.v0&#xA;&#xA;Architecture:&#xA;- Complements ConceptMapOpenEHRToFHIR for bidirectional transformation&#xA;- Compatible with NUM-FHIR-Bridge Apache Camel routes&#xA;- Supports EHRbase CDR as target system"/>
  <jurisdiction>
    <coding>
      <system value="http://unstats.un.org/unsd/methods/m49/m49.htm"/>
      <code value="150"/>
      <display value="Europe"/>
    </coding>
  </jurisdiction>
  <jurisdiction>
    <coding>
      <system value="http://unstats.un.org/unsd/methods/m49/m49.htm"/>
      <code value="021"/>
      <display value="Northern America a/"/>
    </coding>
  </jurisdiction>
  <jurisdiction>
    <coding>
      <system value="http://unstats.un.org/unsd/methods/m49/m49.htm"/>
      <code value="005"/>
      <display value="South America"/>
    </coding>
  </jurisdiction>
  <jurisdiction>
    <coding>
      <system value="urn:iso:std:iso:3166"/>
      <code value="PT"/>
      <display value="Portugal"/>
    </coding>
  </jurisdiction>
  <jurisdiction>
    <coding>
      <system value="urn:iso:std:iso:3166"/>
      <code value="US"/>
      <display value="United States of America"/>
    </coding>
  </jurisdiction>
  <jurisdiction>
    <coding>
      <system value="urn:iso:std:iso:3166"/>
      <code value="BR"/>
      <display value="Brazil"/>
    </coding>
  </jurisdiction>
  <purpose value="Enable data transformation from FHIR servers to openEHR Clinical Data Repositories (CDRs) for wearable health data in Learning Health Systems."/>
  <group>
    <source value="http://hl7.org/fhir/StructureDefinition/Observation"/>
    <target value="openEHR-EHR-OBSERVATION.heart_rate_variability.v0"/>
    <element>
      <code value="Observation.component:sdnn"/>
      <display value="SDNN component with LOINC 80404-7"/>
      <target>
        <code value="id5"/>
        <display value="SDNN - Standard deviation of NN intervals"/>
        <equivalence value="equivalent"/>
        <comment value="Map from Observation.component with code LOINC 80404-7. Unit: ms"/>
      </target>
    </element>
    <element>
      <code value="Observation.component:rmssd"/>
      <display value="RMSSD component with HeartRateVariabilityCS#hrv-rmssd"/>
      <target>
        <code value="id6"/>
        <display value="RMSSD - Root mean square of successive differences"/>
        <equivalence value="equivalent"/>
        <comment value="Map from component with HeartRateVariabilityCS#hrv-rmssd. No LOINC code. Unit: ms"/>
      </target>
    </element>
    <element>
      <code value="Observation.component:pnn50"/>
      <display value="pNN50 component with HeartRateVariabilityCS#hrv-pnn50"/>
      <target>
        <code value="id7"/>
        <display value="pNN50 - Percentage of NN intervals &gt;50ms"/>
        <equivalence value="equivalent"/>
        <comment value="Map from component with HeartRateVariabilityCS#hrv-pnn50. Unit: %"/>
      </target>
    </element>
    <element>
      <code value="Observation.component:lf-hf-ratio"/>
      <display value="LF/HF ratio component"/>
      <target>
        <code value="id13"/>
        <display value="LF/HF Ratio"/>
        <equivalence value="equivalent"/>
        <comment value="Map from component with HeartRateVariabilityCS#hrv-lf-hf-ratio. Dimensionless ratio"/>
      </target>
    </element>
    <element>
      <code value="Observation.effectivePeriod"/>
      <display value="Observation.effectivePeriod (start/end)"/>
      <target>
        <code value="id32"/>
        <display value="Recording duration"/>
        <equivalence value="relatedto"/>
        <comment value="Calculate duration from effectivePeriod.end - effectivePeriod.start"/>
      </target>
    </element>
    <element>
      <code value="Observation.component:state"/>
      <display value="Physiological state component"/>
      <target>
        <code value="id41"/>
        <display value="Physiological state"/>
        <equivalence value="equivalent"/>
        <comment value="Map resting/active/sleep states from component"/>
      </target>
    </element>
    <element>
      <code value="Observation.device"/>
      <display value="Observation.device reference"/>
      <target>
        <code value="id51"/>
        <display value="Device type"/>
        <equivalence value="relatedto"/>
        <comment value="Resolve Device reference and map to CLUSTER.wearable_device"/>
      </target>
    </element>
    <unmapped>
      <mode value="fixed"/>
      <code value="other"/>
      <display value="Unmapped FHIR HRV element"/>
    </unmapped>
  </group>
  <group>
    <source value="http://hl7.org/fhir/StructureDefinition/Observation"/>
    <target value="openEHR-EHR-OBSERVATION.physical_activity_detailed.v0"/>
    <element>
      <code value="Observation.valueQuantity"/>
      <display value="Observation.valueQuantity (steps)"/>
      <target>
        <code value="id10"/>
        <display value="Step count"/>
        <equivalence value="equivalent"/>
        <comment value="When Observation.code is LOINC 55423-8 (Number of steps). Unit: steps"/>
      </target>
    </element>
    <element>
      <code value="Observation.component:distance"/>
      <display value="Distance component with LOINC 55430-3"/>
      <target>
        <code value="id11"/>
        <display value="Distance"/>
        <equivalence value="equivalent"/>
        <comment value="Map from component with LOINC 55430-3. Unit: km or m"/>
      </target>
    </element>
    <element>
      <code value="Observation.component:active-calories"/>
      <display value="Active calories component with LOINC 41979-6"/>
      <target>
        <code value="id20"/>
        <display value="Active calories"/>
        <equivalence value="equivalent"/>
        <comment value="Map from component with LOINC 41979-6. Unit: kcal"/>
      </target>
    </element>
    <element>
      <code value="Observation.component:moderate-minutes"/>
      <display value="Moderate activity minutes with LOINC 77592-4"/>
      <target>
        <code value="id32"/>
        <display value="Moderately active minutes"/>
        <equivalence value="equivalent"/>
        <comment value="Map from component with LOINC 77592-4. Unit: min"/>
      </target>
    </element>
    <element>
      <code value="Observation.component:vigorous-minutes"/>
      <display value="Vigorous activity minutes with LOINC 77593-2"/>
      <target>
        <code value="id33"/>
        <display value="Vigorously active minutes"/>
        <equivalence value="equivalent"/>
        <comment value="Map from component with LOINC 77593-2. Unit: min"/>
      </target>
    </element>
  </group>
  <group>
    <source value="http://hl7.org/fhir/StructureDefinition/Observation"/>
    <target value="openEHR-EHR-OBSERVATION.sleep_architecture.v0"/>
    <element>
      <code value="Observation.valueQuantity"/>
      <display value="Observation.valueQuantity (sleep duration)"/>
      <target>
        <code value="id13"/>
        <display value="Total sleep time"/>
        <equivalence value="equivalent"/>
        <comment value="When Observation.code is LOINC 93832-4 (Sleep duration). Unit: h or min"/>
      </target>
    </element>
    <element>
      <code value="Observation.component:deep-sleep"/>
      <display value="Deep sleep duration component"/>
      <target>
        <code value="id23"/>
        <display value="Deep sleep duration"/>
        <equivalence value="equivalent"/>
        <comment value="N3/SWS stage duration. Custom code - no LOINC"/>
      </target>
    </element>
    <element>
      <code value="Observation.component:rem-sleep"/>
      <display value="REM sleep duration component"/>
      <target>
        <code value="id24"/>
        <display value="REM sleep duration"/>
        <equivalence value="equivalent"/>
        <comment value="REM stage duration. Custom code - no LOINC"/>
      </target>
    </element>
    <element>
      <code value="Observation.component:efficiency"/>
      <display value="Sleep efficiency component"/>
      <target>
        <code value="id30"/>
        <display value="Sleep efficiency"/>
        <equivalence value="equivalent"/>
        <comment value="TST/TIB ratio as percentage. Custom code - no LOINC"/>
      </target>
    </element>
    <element>
      <code value="Observation.component:score"/>
      <display value="Sleep score component"/>
      <target>
        <code value="id40"/>
        <display value="Sleep score"/>
        <equivalence value="equivalent"/>
        <comment value="Vendor-specific composite score (0-100). Proprietary algorithm"/>
      </target>
    </element>
    <element>
      <code value="Observation.component:sleep-hrv"/>
      <display value="Average HRV during sleep component"/>
      <target>
        <code value="id53"/>
        <display value="Average HRV (RMSSD) during sleep"/>
        <equivalence value="equivalent"/>
        <comment value="Use HeartRateVariabilityCS#hrv-rmssd with context. Unit: ms"/>
      </target>
    </element>
  </group>
  <group>
    <source value="http://hl7.org/fhir/StructureDefinition/Device"/>
    <target value="openEHR-EHR-CLUSTER.wearable_device.v0"/>
    <element>
      <code value="Device.manufacturer"/>
      <display value="Device.manufacturer"/>
      <target>
        <code value="id2"/>
        <display value="Device platform"/>
        <equivalence value="equivalent"/>
        <comment value="Map manufacturer string to vendor code (Apple, Fitbit, Garmin, etc.)"/>
      </target>
    </element>
    <element>
      <code value="Device.modelNumber"/>
      <display value="Device.modelNumber"/>
      <target>
        <code value="id3"/>
        <display value="Device model"/>
        <equivalence value="equivalent"/>
        <comment value="Specific model name"/>
      </target>
    </element>
    <element>
      <code value="Device.type"/>
      <display value="Device.type"/>
      <target>
        <code value="id4"/>
        <display value="Device category"/>
        <equivalence value="equivalent"/>
        <comment value="Map from SNOMED CT device type codes where available"/>
      </target>
    </element>
    <element>
      <code value="Device.serialNumber"/>
      <display value="Device.serialNumber"/>
      <target>
        <code value="id23"/>
        <display value="Serial number"/>
        <equivalence value="equivalent"/>
      </target>
    </element>
    <element>
      <code value="Device.version:firmware"/>
      <display value="Device.version[firmware]"/>
      <target>
        <code value="id20"/>
        <display value="Firmware version"/>
        <equivalence value="equivalent"/>
        <comment value="Filter by version.type = firmware"/>
      </target>
    </element>
  </group>
</ConceptMap>