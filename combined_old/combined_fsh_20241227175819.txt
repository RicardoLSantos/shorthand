
// ===== Conteúdo de: MindfulnessCapabilities.fsh =====

Instance: MindfulnessCapabilityStatement
InstanceOf: CapabilityStatement
Usage: #definition
Title: "Mindfulness Module Capabilities"
Description: "Capabilities supported by the mindfulness module implementation"

* status = #draft
* date = "2024-03-19"
* kind = #requirements
* fhirVersion = #4.0.1
* format[0] = #json
* format[1] = #xml

* rest[0]
  * mode = #server
  * documentation = "RESTful server capabilities for mindfulness data"
  
  * resource[0]
    * type = #Observation
    * documentation = "Supports mindfulness session observations"
    * profile = "https://example.org/StructureDefinition/mindfulness-observation"
    * interaction[0]
      * code = #read
    * interaction[1]
      * code = #create
    * interaction[2]
      * code = #update
    * interaction[3]
      * code = #search-type
    * searchParam[0]
      * name = "patient"
      * type = #reference
      * documentation = "Search by patient reference"
    * searchParam[1]
      * name = "date"
      * type = #date
      * documentation = "Search by session date"
    * searchParam[2]
      * name = "code"
      * type = #token
      * documentation = "Search by observation type"
      
  * resource[1]
    * type = #Questionnaire
    * documentation = "Supports mindfulness questionnaires"
    * profile = "https://example.org/StructureDefinition/mindfulness-questionnaire"
    * interaction[0]
      * code = #read
    * interaction[1]
      * code = #search-type
    * searchParam[0]
      * name = "title"
      * type = #string
      * documentation = "Search by questionnaire title"
      
  * resource[2]
    * type = #QuestionnaireResponse
    * documentation = "Supports mindfulness questionnaire responses"
    * profile = "https://example.org/StructureDefinition/mindfulness-questionnaire-response"
    * interaction[0]
      * code = #create
    * interaction[1]
      * code = #read
    * interaction[2]
      * code = #search-type
    * searchParam[0]
      * name = "patient"
      * type = #reference
      * documentation = "Search by patient reference"
    * searchParam[1]
      * name = "authored"
      * type = #date
      * documentation = "Search by response date"



// ===== Conteúdo de: MindfulnessQuestionnaires.fsh =====

Instance: DailyMindfulnessQuestionnaire
InstanceOf: Questionnaire
Usage: #definition
Title: "Daily Mindfulness Questionnaire"
Description: "Questionnaire for capturing daily mindfulness practice and associated effects"

* url = "http://example.org/Questionnaire/daily-mindfulness"
* status = #active
* title = "Daily Mindfulness Practice"
* subjectType = #Patient
* version = "1.0.0"
* name = "DailyMindfulnessQuestionnaire"
* date = "2024-03-19"

* item[0]
  * linkId = "mindful_session"
  * text = "Mindfulness Session"
  * type = #group
  * repeats = false

  * item[0]
    * linkId = "session_duration"
    * text = "Session duration (minutes)"
    * type = #integer
    * required = true
    * extension[0].url = "http://hl7.org/fhir/StructureDefinition/minValue"
    * extension[0].valueInteger = 1

  * item[1]
    * linkId = "practice_type"
    * text = "Practice type"
    * type = #choice
    * required = true
    * answerOption[0].valueString = "Meditation"
    * answerOption[1].valueString = "Breathing exercise"
    * answerOption[2].valueString = "Body scan"
    * answerOption[3].valueString = "Mindful walking"

* item[1]
  * linkId = "mood_assessment"
  * text = "Mood Assessment"
  * type = #group

  * item[0]
    * linkId = "current_mood"
    * text = "How is your mood now?"
    * type = #choice
    * required = true
    * answerValueSet = "https://example.org/fhir/ValueSet/mood-vs"

  * item[1]
    * linkId = "mood_intensity"
    * text = "Mood intensity (1-5)"
    * type = #integer
    * required = true

* item[2]
  * linkId = "stress_assessment"
  * text = "Stress Assessment"
  * type = #group

  * item[0]
    * linkId = "stress_level"
    * text = "Stress level (0-10)"
    * type = #integer
    * required = true

  * item[1]
    * linkId = "stress_symptoms"
    * text = "Stress symptoms"
    * type = #choice
    * repeats = true
    * answerOption[0].valueString = "Muscle tension"
    * answerOption[1].valueString = "Anxiety"
    * answerOption[2].valueString = "Headache"
    * answerOption[3].valueString = "Fatigue"

* item[3]
  * linkId = "relaxation"
  * text = "Relaxation"
  * type = #group

  * item[0]
    * linkId = "relaxation_duration"
    * text = "Relaxation time (minutes)"
    * type = #integer
    * required = true

  * item[1]
    * linkId = "relaxation_technique"
    * text = "Technique used"
    * type = #choice
    * required = true
    * answerOption[0].valueString = "Deep breathing"
    * answerOption[1].valueString = "Progressive relaxation"
    * answerOption[2].valueString = "Visualization"
    * answerOption[3].valueString = "Mindful awareness"



// ===== Conteúdo de: SymptomQuestionnaire.fsh =====

Profile: SymptomQuestionnaire
Parent: Questionnaire
Id: symptom-questionnaire
Title: "Symptom Assessment Questionnaire"
Description: "Questionnaire template for symptom assessments"

* status MS
* title MS
* item MS

* item ^slicing.discriminator.type = #pattern
* item ^slicing.discriminator.path = "linkId"
* item ^slicing.rules = #open

* item contains
    symptomType 1..1 MS and
    location 0..1 MS and
    onset 0..1 MS and
    description 0..1 MS

* item[symptomType].linkId = "symptom-type"
* item[symptomType].text = "Type of Symptom"
* item[symptomType].type = #choice
* item[symptomType].required = true

* item[location].linkId = "location"
* item[location].text = "Location"
* item[location].type = #string

* item[onset].linkId = "onset"
* item[onset].text = "When did it start?"
* item[onset].type = #dateTime

* item[description].linkId = "description"
* item[description].text = "Description"
* item[description].type = #text



// ===== Conteúdo de: NutritionQuestionnaires.fsh =====

Instance: DailyNutritionQuestionnaire
InstanceOf: Questionnaire
Usage: #definition
Title: "Daily Nutrition Intake Questionnaire"
Description: "Questionnaire for daily nutrition intake tracking"

* url = "https://github.com/RicardoLSantos/shorthand/Questionnaire/daily-nutrition"
* version = "0.1.0"
* name = "DailyNutritionQuestionnaire"
* title = "Daily Nutrition Intake"
* status = #active
* experimental = false
* date = "2024-12-14"
* publisher = "Ricardo Lourenço dos Santos"

* item[0]
  * linkId = "water_intake"
  * text = "How much water did you drink today?"
  * type = #quantity
  * required = true
  * repeats = false
  * initial.valueQuantity = 0 'mL'

* item[1]
  * linkId = "meal_record"
  * text = "Meal Records"
  * type = #group
  * repeats = true

  * item[0]
    * linkId = "meal_time"
    * text = "Meal Time"
    * type = #dateTime
    * required = true

  * item[1]
    * linkId = "meal_type"
    * text = "Meal Type"
    * type = #choice
    * required = true
    * answerOption[0].valueString = "Breakfast"
    * answerOption[1].valueString = "Lunch"
    * answerOption[2].valueString = "Dinner"
    * answerOption[3].valueString = "Snack"

  * item[2]
    * linkId = "calories"
    * text = "Estimated Calories"
    * type = #integer
    * required = true

  * item[3]
    * linkId = "macronutrients"
    * text = "Macronutrients"
    * type = #group

    * item[0]
      * linkId = "carbs"
      * text = "Carbohydrates (g)"
      * type = #decimal
      * required = true

    * item[1]
      * linkId = "protein"
      * text = "Proteins (g)"
      * type = #decimal
      * required = true

    * item[2]
      * linkId = "fat"
      * text = "Fats (g)"
      * type = #decimal
      * required = true

* item[2]
  * linkId = "caffeine"
  * text = "Caffeine Intake"
  * type = #group

  * item[0]
    * linkId = "caffeine_amount"
    * text = "Caffeine amount (mg)"
    * type = #integer
    * required = false

  * item[1]
    * linkId = "caffeine_source"
    * text = "Caffeine source"
    * type = #choice
    * repeats = true
    * answerOption[0].valueString = "Coffee"
    * answerOption[1].valueString = "Tea"
    * answerOption[2].valueString = "Soft Drink"
    * answerOption[3].valueString = "Energy Drink"



// ===== Conteúdo de: ReproductiveQuestionnaire.fsh =====

Instance: ReproductiveHealthQuestionnaire
InstanceOf: Questionnaire
Usage: #definition
Title: "Reproductive Health Tracking Questionnaire"
Description: "Daily questionnaire for reproductive health tracking"
 
* status = #active
* url = "http://example.org/Questionnaire/reproductive-health"
* name = "ReproductiveHealthQuestionnaire"
* title = "Reproductive Health Monitoring"
* date = "2024-03-19"
 
* item[0]
  * linkId = "menstrual_cycle"
  * text = "Menstrual Cycle"
  * type = #group
 
  * item[0]
    * linkId = "cycle_start"
    * text = "Cycle started today?"
    * type = #boolean
 
  * item[1]
    * linkId = "flow_intensity"
    * text = "Flow intensity"
    * type = #choice
    * enableWhen
      * question = "cycle_start"
      * operator = #=
      * answerBoolean = true
    * answerOption[0].valueString = "Light"
    * answerOption[1].valueString = "Moderate"
    * answerOption[2].valueString = "Heavy"
 
* item[1]
  * linkId = "symptoms"
  * text = "Symptoms"
  * type = #group
  * repeats = true
 
  * item[0]
    * linkId = "symptom_type"
    * text = "Symptom type"
    * type = #choice
    * answerValueSet = "http://example.org/ValueSet/reproductive-symptoms"
 
  * item[1]
    * linkId = "symptom_severity"
    * text = "Intensity (0-10)"
    * type = #integer
    * extension[0]
      * url = "http://hl7.org/fhir/StructureDefinition/minValue"
      * valueInteger = 0
    * extension[1]
      * url = "http://hl7.org/fhir/StructureDefinition/maxValue"
      * valueInteger = 10
 
* item[2]
  * linkId = "mood_changes"
  * text = "Mood Changes"
  * type = #group

  * item[0]
    * linkId = "mood_type"
    * text = "Current mood"
    * type = #choice
    * answerValueSet = "http://example.org/ValueSet/mood-types"

  * item[1]
    * linkId = "mood_severity"
    * text = "Intensity (0-10)"
    * type = #integer
    * extension[0]
      * url = "http://hl7.org/fhir/StructureDefinition/minValue"
      * valueInteger = 0
    * extension[1]
      * url = "http://hl7.org/fhir/StructureDefinition/maxValue"
      * valueInteger = 10



// ===== Conteúdo de: aliases.fsh =====

Alias: SCT = http://snomed.info/sct
Alias: LOINC = http://loinc.org
Alias: UCUM = http://unitsofmeasure.org



// ===== Conteúdo de: MindfulnessTerminology.fsh =====

CodeSystem: MindfulnessOutcomeCS
Id: mindfulness-outcome-cs
Title: "Mindfulness Outcomes"
Description: "Outcomes and effects of mindfulness practice"

* ^experimental = false
* ^caseSensitive = true
* #increasedAwareness "Increased Awareness" "Greater awareness of thoughts and sensations"
* #improvedFocus "Improved Focus" "Enhanced ability to concentrate"
* #stressReduction "Stress Reduction" "Decreased levels of stress and tension"
* #emotionalBalance "Emotional Balance" "Better emotional regulation"
* #improvedSleep "Improved Sleep" "Enhanced sleep quality"

ValueSet: MindfulnessOutcomeVS
Id: mindfulness-outcome-vs
Title: "Mindfulness Outcomes Value Set"
Description: "Value set for mindfulness practice outcomes"

* ^experimental = false
* include codes from system MindfulnessOutcomeCS
* include $SCT#365949003 "Finding of level of stress"
* include $SCT#373931001 "Mood finding"

CodeSystem: MindfulnessQualifierCS
Id: mindfulness-qualifier-cs
Title: "Mindfulness Practice Qualifiers"
Description: "Qualifiers for mindfulness practice characteristics"

* ^experimental = false
* ^caseSensitive = true
* #guided "Guided Practice" "Practice with guidance or instruction"
* #selfDirected "Self-Directed" "Independent practice"
* #group "Group Practice" "Practice in group setting"
* #individual "Individual Practice" "Solo practice session"

ValueSet: MindfulnessQualifierVS
Id: mindfulness-qualifier-vs
Title: "Mindfulness Practice Qualifiers Value Set"
Description: "Value set for mindfulness practice qualifiers"

* ^experimental = false
* include codes from system MindfulnessQualifierCS
* include $SCT#410534003 "Guided meditation"
* include $SCT#225386006 "Exercise therapy"

* ^copyright = "This value set includes content from SNOMED CT, which is copyright © 2002+ International Health Terminology Standards Development Organisation (IHTSDO)"



// ===== Conteúdo de: MindfulnessConfig.fsh =====

Extension: MindfulnessSessionDuration
Id: mindfulness-session-duration
Title: "Mindfulness Session Duration"
Description: "Default duration for mindfulness sessions in minutes"
* value[x] only integer

Extension: MindfulnessReminderTime
Id: mindfulness-reminder-time
Title: "Mindfulness Reminder Time"
Description: "Default time for daily reminders"
* value[x] only time

Extension: MindfulnessPreferredGuide
Id: mindfulness-preferred-guide
Title: "Mindfulness Preferred Guide"
Description: "Preferred guide for mindfulness sessions"
* value[x] only string

Extension: MindfulnessNotificationEnabled
Id: mindfulness-notification-enabled
Title: "Mindfulness Notification Enabled"
Description: "Whether notifications are enabled for mindfulness sessions"
* value[x] only boolean

Profile: MindfulnessConfiguration
Parent: Basic
Id: mindfulness-configuration
Title: "Mindfulness Configuration"
Description: "Configuration settings for mindfulness sessions"

* code 1..1 MS
* code = http://example.org/CodeSystem/mindfulness-config-type#settings "Mindfulness Settings"

* extension contains
    MindfulnessSessionDuration named sessionDuration 1..1 MS and
    MindfulnessReminderTime named reminderTime 1..1 MS and
    MindfulnessPreferredGuide named preferredGuide 0..1 MS and
    MindfulnessNotificationEnabled named notificationEnabled 1..1 MS

Instance: DefaultMindfulnessConfig
InstanceOf: MindfulnessConfiguration
Title: "Default Mindfulness Configuration"
Description: "Default configuration settings for mindfulness sessions"

* code = http://example.org/CodeSystem/mindfulness-config-type#settings "Mindfulness Settings"
* extension[sessionDuration].valueInteger = 15
* extension[reminderTime].valueTime = "08:00:00"
* extension[preferredGuide].valueString = "Jane Smith"
* extension[notificationEnabled].valueBoolean = true



// ===== Conteúdo de: MindfulnessAuditConfig.fsh =====

Extension: MindfulnessAuditLevel
Id: mindfulness-audit-level
Title: "Mindfulness Audit Level"
Description: "Level of detail for audit records"
* value[x] only code
* valueCode from http://example.org/fhir/ValueSet/audit-levels (required)

Extension: MindfulnessAuditRetention
Id: mindfulness-audit-retention
Title: "Mindfulness Audit Retention"
Description: "Period to retain audit records"
* value[x] only Duration

Extension: MindfulnessAuditFormat
Id: mindfulness-audit-format
Title: "Mindfulness Audit Format"
Description: "Format for audit records"
* value[x] only code
* valueCode from http://example.org/fhir/ValueSet/audit-formats (required)

Profile: MindfulnessAuditConfig
Parent: Basic
Id: mindfulness-audit-config
Title: "Mindfulness Audit Configuration"
Description: "Configuration for mindfulness session auditing"

* code 1..1 MS
* code = http://example.org/CodeSystem/mindfulness-config-type#audit "Audit Configuration"

* extension contains
    MindfulnessAuditLevel named auditLevel 1..1 MS and
    MindfulnessAuditRetention named auditRetention 1..1 MS and
    MindfulnessAuditFormat named auditFormat 1..1 MS

Instance: DefaultAuditConfig
InstanceOf: MindfulnessAuditConfig
Title: "Default Audit Configuration"
Description: "Default configuration for mindfulness session auditing"

* code = http://example.org/CodeSystem/mindfulness-config-type#audit "Audit Configuration"
* extension[auditLevel].valueCode = #detailed
* extension[auditRetention].valueDuration = 90 'days'
* extension[auditFormat].valueCode = #fhir



// ===== Conteúdo de: MindfulnessSecurity.fsh =====

Instance: MindfulnessSecurityDefinition
InstanceOf: Consent
Usage: #definition
Title: "Mindfulness Data Security Policy"

* status = #active
* scope = http://terminology.hl7.org/CodeSystem/consentscope#patient-privacy
* category = http://loinc.org#59284-0 "Consent Document"

* policy[0]
  * authority = "http://example.org/privacy-policy"
  * uri = "http://example.org/mindfulness-privacy"

* provision
  * type = #permit
  * period
    * start = "2024-03-19"
  * actor[0]
    * role = http://terminology.hl7.org/CodeSystem/v3-ParticipationType#PRCP
    * reference
      * identifier.system = "http://example.org/practitioners"
      * identifier.value = "mindfulness-practitioners"

RuleSet: SecurityRequirements
* meta.security from http://terminology.hl7.org/ValueSet/v3-SecurityPolicy (required)
* meta.tag from http://terminology.hl7.org/ValueSet/v3-Confidentiality (required)

* extension contains
    http://hl7.org/fhir/StructureDefinition/resource-security-category named securityCategory 0..1 MS and
    http://hl7.org/fhir/StructureDefinition/patient-confidentiality named confidentiality 0..1 MS

Instance: MindfulnessAccessPolicy
InstanceOf: Consent
Usage: #definition
Title: "Mindfulness Data Access Policy"

* status = #active
* scope = http://terminology.hl7.org/CodeSystem/consentscope#patient-privacy
* category = http://loinc.org#59284-0 "Consent Document"

* policy[0]
  * authority = "http://example.org/access-policy"
  * uri = "http://example.org/mindfulness-access"

* provision
  * type = #permit
  * period
    * start = "2024-03-19"
  * actor[0]
    * role = http://terminology.hl7.org/CodeSystem/v3-ParticipationType#PRCP
    * reference
      * identifier.system = "http://example.org/practitioners"
      * identifier.value = "mindfulness-practitioners"
  * action = http://terminology.hl7.org/CodeSystem/consentaction#access "Access"



// ===== Conteúdo de: MindfulnessResources.fsh =====

CodeSystem: MindfulnessTypeCS
Id: mindfulness-type-cs
Title: "Mindfulness Practice Types"
Description: "Types of mindfulness practices and techniques"
* ^experimental = false
* ^caseSensitive = true
* #meditation "Meditation" "Focused meditation practice"
* #breathing "Breathing Exercise" "Conscious breathing techniques"
* #bodyScan "Body Scan" "Progressive body awareness practice"
* #walking "Mindful Walking" "Walking meditation practice"
* #movement "Mindful Movement" "Conscious movement practice"

CodeSystem: EnvironmentTypeCS
Id: environment-type-cs
Title: "Practice Environment Types"
Description: "Types of environments for mindfulness practice"
* ^experimental = false
* ^caseSensitive = true
* #indoor "Indoor" "Indoor environment"
* #outdoor "Outdoor" "Outdoor environment"
* #quiet "Quiet Space" "Quiet or silent environment"
* #group "Group Setting" "Group practice environment"

ValueSet: MindfulnessTypeVS
Id: mindfulness-type-vs
Title: "Mindfulness Practice Types Value Set"
Description: "Value set of mindfulness practice types"
* ^experimental = false
* include codes from system MindfulnessTypeCS

ValueSet: EnvironmentTypeVS
Id: environment-type-vs
Title: "Practice Environment Types Value Set"
Description: "Value set of practice environment types"
* ^experimental = false
* include codes from system EnvironmentTypeCS

Instance: MindfulnessSettingCS
InstanceOf: CodeSystem
Usage: #definition
* url = "http://example.org/CodeSystem/mindfulness-setting"
* version = "1.0.0"
* name = "MindfulnessSettingCS"
* title = "Mindfulness Setting CodeSystem"
* status = #active
* experimental = false
* caseSensitive = true
* content = #complete
* count = 5
* concept[+].code = #home
* concept[=].display = "Home Practice"
* concept[+].code = #clinic
* concept[=].display = "Clinical Setting"
* concept[+].code = #group
* concept[=].display = "Group Setting"
* concept[+].code = #retreat
* concept[=].display = "Retreat Setting"
* concept[+].code = #workplace
* concept[=].display = "Workplace Setting"



// ===== Conteúdo de: MindfulnessNarrative.fsh =====

RuleSet: MindfulnessObservationNarrative
* text.status = #generated
* text.div = "<div xmlns=\"http://www.w3.org/1999/xhtml\">
    <p><b>Generated Narrative</b></p>
    <p><b>Session Type:</b> Mindfulness Practice Session</p>
    <p><b>Date:</b> {effectiveDateTime}</p>
    <p><b>Duration:</b> {component[sessionDuration].value} minutes</p>
    <p><b>Stress Level:</b> {component[stressLevel].value} / 10</p>
    <p><b>Mood:</b> {component[moodState].value}</p>
    <p><b>Technique:</b> {component[relaxationResponse].value}</p>
    <p><b>Location:</b> {extension[mindfulness-context].extension[location].value}</p>
  </div>"

RuleSet: MindfulnessQuestionnaireNarrative
* text.status = #generated
* text.div = "<div xmlns=\"http://www.w3.org/1999/xhtml\">
    <p><b>Generated Narrative</b></p>
    <p><b>Title:</b> {title}</p>
    <p><b>Status:</b> {status}</p>
    <h3>Sections</h3>
    <ul>
      <li>Mindfulness Session</li>
      <li>Mood Assessment</li>
      <li>Stress Assessment</li>
      <li>Relaxation</li>
    </ul>
  </div>"

RuleSet: MindfulnessResponseNarrative
* text.status = #generated
* text.div = "<div xmlns=\"http://www.w3.org/1999/xhtml\">
    <p><b>Generated Narrative</b></p>
    <p><b>Date:</b> {authored}</p>
    <p><b>Session Duration:</b> {item[session_duration].answer.value} minutes</p>
    <p><b>Practice Type:</b> {item[practice_type].answer.value}</p>
    <p><b>Mood:</b> {item[current_mood].answer.value}</p>
    <p><b>Stress Level:</b> {item[stress_level].answer.value} / 10</p>
    <p><b>Relaxation Technique:</b> {item[relaxation_technique].answer.value}</p>
  </div>"

RuleSet: MindfulnessConfigNarrative
* text.status = #generated
* text.div = "<div xmlns=\"http://www.w3.org/1999/xhtml\">
    <p><b>Generated Narrative</b></p>
    <p><b>Default Duration:</b> {extension[defaultDuration].value} minutes</p>
    <p><b>Reminders:</b> {extension[reminderSettings].value}</p>
    <p><b>Data Sync:</b> {extension[dataSync].value}</p>
  </div>"



// ===== Conteúdo de: MindfulnessInvariants.fsh =====

Invariant: mindfulness-session-duration
Description: "Mindfulness session duration must be between 1 and 180 minutes"
Expression: "component.where(code.coding.system='http://snomed.info/sct' and code.coding.code='118682006').value.ofType(Quantity).value.exists() implies (component.where(code.coding.system='http://snomed.info/sct' and code.coding.code='118682006').value.ofType(Quantity).value >= 1 and component.where(code.coding.system='http://snomed.info/sct' and code.coding.code='118682006').value.ofType(Quantity).value <= 180)"
Severity: #error

Invariant: mindfulness-stress-level
Description: "Stress level must be between 0 and 10"
Expression: "component.where(code.coding.system='http://snomed.info/sct' and code.coding.code='725854004').value.ofType(Integer).exists() implies (component.where(code.coding.system='http://snomed.info/sct' and code.coding.code='725854004').value.ofType(Integer) >= 0 and component.where(code.coding.system='http://snomed.info/sct' and code.coding.code='725854004').value.ofType(Integer) <= 10)"
Severity: #error

Invariant: mindfulness-mood-required
Description: "Mood assessment must include a mood state and intensity"
Expression: "component.where(code.coding.system='http://snomed.info/sct' and code.coding.code='373931001').exists() implies component.where(code.coding.system='http://snomed.info/sct' and code.coding.code='373931001').value.exists()"
Severity: #warning

Invariant: mindfulness-context-complete
Description: "Mindfulness context should include location and environment"
Expression: "extension.where(url='https://example.org/StructureDefinition/mindfulness-context').exists() implies (extension.where(url='https://example.org/StructureDefinition/mindfulness-context').extension.where(url='location').exists() and extension.where(url='https://example.org/StructureDefinition/mindfulness-context').extension.where(url='environment').exists())"
Severity: #warning

Invariant: sequential-measurements
Description: "Sequential measurements must have increasing effectiveDateTime"
Expression: "component.where(code.coding.system='http://snomed.info/sct' and code.coding.code='118682006').exists() implies (effectiveDateTime > previous().effectiveDateTime)"
Severity: #warning



// ===== Conteúdo de: MindfulnessOperations.fsh =====

Profile: MindfulnessOperation
Parent: OperationDefinition 
Id: mindfulness-operation
Title: "Mindfulness Operation"
Description: "Base definition for mindfulness operations"

* status 1..1
* kind 1..1
* name 1..1
* code 1..1
* resource 1..1
* system 1..1
* type 1..1
* instance 1..1
* parameter 0..*
* parameter.name 1..1

Instance: StartSessionOperation
InstanceOf: MindfulnessOperation
Title: "Start Session Operation"
Description: "Operation to start a new mindfulness session"

* status = #active
* kind = #operation
* name = "start-session"
* code = #start
* resource = #Observation
* system = false
* type = true
* instance = false
* parameter[+]
  * name = #duration
  * use = #in
  * min = 1
  * max = "1" 
  * type = #integer
  * documentation = "Duration in minutes"

Instance: EndSessionOperation
InstanceOf: MindfulnessOperation
Title: "End Session Operation"
Description: "Operation to end an ongoing mindfulness session"

* status = #active
* kind = #operation
* name = "end-session"
* code = #end
* resource = #Observation
* system = false
* type = true
* instance = true
* parameter[+]
  * name = #session
  * use = #in
  * min = 1
  * max = "1"
  * type = #string
  * documentation = "ID of the session to end"



// ===== Conteúdo de: VitalSignsExtensions.fsh =====

Extension: MeasurementContext
Id: measurement-context
Title: "Measurement Context Extension"
Description: "Additional context about the vital sign measurement"
* value[x] only CodeableConcept
* valueCodeableConcept from MeasurementContextVS (required)

ValueSet: MeasurementContextVitalSigns
Id: measurement-context-vital-signs
Title: "Measurement Context Value Set"
* $SCT#255214003 "At rest"
* $SCT#309604004 "During exercise"
* $SCT#309605003 "Post exercise"
* $SCT#248626006 "During sleep"



// ===== Conteúdo de: NutritionExtensions.fsh =====

Extension: NutritionDataSource
Id: nutrition-data-source
Title: "Nutrition Data Source Extension"
Description: "Indicates the source of nutrition data"

* ^version = "0.1.0"
* ^status = #draft
* ^experimental = false
* ^date = "2024-12-14"
* ^publisher = "Ricardo Lourenço dos Santos"
* ^context[0].type = #element
* ^context[0].expression = "Observation"

* value[x] only CodeableConcept
* valueCodeableConcept from NutritionDataSourceVS (required)

ValueSet: NutritionDataSourceVS
Id: nutrition-data-source-vs
Title: "Nutrition Data Source Value Set"
Description: "Value set for nutrition data sources"

* ^version = "0.1.0"
* ^status = #draft
* ^experimental = false
* ^date = "2024-12-14"
* ^publisher = "Ricardo Lourenço dos Santos"

* codes from system NutritionDataSourceCS

CodeSystem: NutritionDataSourceCS
Id: nutrition-data-source-cs
Title: "Nutrition Data Source Code System"
Description: "Code system for nutrition data sources"

* ^version = "0.1.0"
* ^status = #draft
* ^experimental = false
* ^date = "2024-12-14"
* ^publisher = "Ricardo Lourenço dos Santos"
* ^caseSensitive = true

* #manual "Manual Entry" "Data entered manually by user"
* #app "App Integration" "Data from integrated third-party apps"
* #device "Connected Device" "Data from connected nutrition tracking devices"
* #questionnaire "Questionnaire Response" "Data collected through questionnaires"



// ===== Conteúdo de: MeasurementQualityExtension.fsh =====

Extension: MeasurementQuality
Id: measurement-quality
Title: "Measurement Quality Extension"
Description: "Indicator of the quality and reliability of measurement data"

* ^version = "0.1.0"
* ^status = #draft
* ^contact.name = "System Administrator"
* ^context[0].type = #element
* ^context[0].expression = "Observation"

* value[x] only CodeableConcept
* valueCodeableConcept from http://example.org/fhir/ValueSet/measurement-quality (required)

ValueSet: MeasurementQualityVS
Id: measurement-quality-vs
Title: "Measurement Quality Value Set"
Description: "Quality indicators for measurements"

* ^experimental = true
* codes from system MeasurementQualityCS

CodeSystem: MeasurementQualityCS
Id: measurement-quality-cs
Title: "Measurement Quality Code System"
Description: "Code system for measurement quality indicators"

* ^experimental = true
* ^caseSensitive = true

* #excellent "Excellent Quality" "High quality measurement with minimal noise"
* #good "Good Quality" "Good quality measurement with acceptable noise"
* #fair "Fair Quality" "Fair quality measurement with some interference"
* #poor "Poor Quality" "Poor quality measurement with significant interference"
* #unreliable "Unreliable" "Unreliable measurement requiring verification"

Instance: ExampleMeasurementQuality
InstanceOf: Observation
Usage: #example
Title: "Example Measurement Quality"
Description: "Example showing use of measurement quality extension"

* status = #final
* code = $LOINC#8310-5 "Body temperature"
* effectiveDateTime = "2024-03-19"
* extension[measurement-quality].url = "http://example.org/fhir/StructureDefinition/measurement-quality"
* extension[measurement-quality].valueCodeableConcept = MeasurementQualityCS#good "Good Quality"



// ===== Conteúdo de: AdvancedVitalSignsExtensions.fsh =====

Alias: $UCUM = http://unitsofmeasure.org

Extension: PhysiologicalStressIndex
Id: physiological-stress-index
Title: "Physiological Stress Index Extension"
Description: "Index representing overall physiological stress based on multiple parameters"

* ^version = "0.1.0"
* ^status = #draft
* ^context[+].type = #element
* ^context[=].expression = "Observation"

* value[x] only Quantity
* valueQuantity.system = $UCUM
* valueQuantity.code = #{index}
* valueQuantity ^short = "Physiological stress index value"
* valueQuantity ^definition = "Normalized index value representing overall physiological stress"

Extension: HomeostasisIndex
Id: homeostasis-index
Title: "Homeostasis Index Extension"
Description: "Composite measure of physiological balance and adaptation"

* ^version = "0.1.0"
* ^status = #draft
* ^context[+].type = #element
* ^context[=].expression = "Observation"

* value[x] only Quantity
* valueQuantity.system = $UCUM
* valueQuantity.code = #{ratio}
* valueQuantity ^short = "Homeostasis index value"
* valueQuantity ^definition = "Normalized ratio representing physiological balance"

Extension: RecoveryEfficiency
Id: recovery-efficiency
Title: "Recovery Efficiency Extension"
Description: "Measure of how efficiently the body recovers from stress or exertion"

* ^version = "0.1.0"
* ^status = #draft
* ^context[+].type = #element
* ^context[=].expression = "Observation"

* value[x] only Quantity
* valueQuantity.system = $UCUM
* valueQuantity.code = #%
* valueQuantity ^short = "Recovery efficiency percentage"
* valueQuantity ^definition = "Percentage indicating recovery efficiency"

Extension: AllostaticLoad
Id: allostatic-load
Title: "Allostatic Load Extension"
Description: "Measure of cumulative physiological burden over time"

* ^version = "0.1.0"
* ^status = #draft
* ^context[+].type = #element
* ^context[=].expression = "Observation"

* value[x] only Quantity
* valueQuantity.system = $UCUM
* valueQuantity.code = #{score}
* valueQuantity ^short = "Allostatic load score"
* valueQuantity ^definition = "Score representing cumulative physiological burden"

Extension: CircadianPhase
Id: circadian-phase
Title: "Circadian Phase Extension"
Description: "Indicator of position in circadian rhythm cycle"

* ^version = "0.1.0"
* ^status = #draft
* ^context[+].type = #element
* ^context[=].expression = "Observation"

* value[x] only CodeableConcept
* valueCodeableConcept from CircadianPhaseVS (required)

ValueSet: CircadianPhaseVS
Id: circadian-phase-vs
Title: "Circadian Phase Value Set"
Description: "Value set for circadian rhythm phases"

* ^experimental = true
* codes from system CircadianPhaseCS

CodeSystem: CircadianPhaseCS
Id: circadian-phase-cs
Title: "Circadian Phase Code System"
Description: "Code system for circadian rhythm phases"

* ^experimental = true
* ^caseSensitive = true

* #early-morning "Early Morning Phase" "Period shortly after awakening"
* #mid-morning "Mid Morning Phase" "Mid-morning period"
* #afternoon "Afternoon Phase" "Afternoon period"
* #evening "Evening Phase" "Evening period"
* #night "Night Phase" "Nighttime period"
* #deep-night "Deep Night Phase" "Deep night period"

Extension: MeasurementQuality
Id: measurement-quality
Title: "Measurement Quality Extension"
Description: "Indicator of the quality and reliability of the measurement"

* ^version = "0.1.0"
* ^status = #draft
* ^context[+].type = #element
* ^context[=].expression = "Observation"

* value[x] only CodeableConcept
* valueCodeableConcept from MeasurementQualityVS (required)

ValueSet: MeasurementQualityVS
Id: measurement-quality-vs
Title: "Measurement Quality Value Set"
Description: "Value set for measurement quality indicators"

* ^experimental = true
* codes from system MeasurementQualityCS

CodeSystem: MeasurementQualityCS
Id: measurement-quality-cs
Title: "Measurement Quality Code System"
Description: "Code system for measurement quality indicators"

* ^experimental = true
* ^caseSensitive = true

* #excellent "Excellent Quality" "High quality measurement with minimal noise"
* #good "Good Quality" "Good quality measurement with acceptable noise"
* #fair "Fair Quality" "Fair quality measurement with some interference"
* #poor "Poor Quality" "Poor quality measurement with significant interference"
* #unreliable "Unreliable" "Unreliable measurement requiring verification"



// ===== Conteúdo de: EnvironmentalExtensions.fsh =====

Extension: ExposureLocation
Id: exposure-location
Title: "Exposure Location Extension"
Description: "Extension for recording location of environmental exposure measurement"

* ^version = "0.1.0"
* ^status = #draft
* ^context[+].type = #element
* ^context[=].expression = "Observation"

* value[x] only CodeableConcept
* valueCodeableConcept from ExposureLocationVS (required)
* valueCodeableConcept ^short = "Location type of exposure"
* valueCodeableConcept ^definition = "Categorizes the type of location where environmental exposure occurred"

Extension: ExposureConditions
Id: exposure-conditions
Title: "Exposure Conditions Extension"
Description: "Additional conditions during environmental exposure measurement"

* ^version = "0.1.0"
* ^status = #draft
* ^context[+].type = #element
* ^context[=].expression = "Observation"

* value[x] only CodeableConcept
* valueCodeableConcept from ExposureConditionsVS (required)
* valueCodeableConcept ^short = "Conditions during exposure"

ValueSet: ExposureLocationVS
Id: exposure-location-vs
Title: "Exposure Location Value Set"
Description: "Value set for environmental exposure locations"

* ^version = "0.1.0"
* ^status = #draft
* ^experimental = true
* codes from system ExposureLocationCS

ValueSet: ExposureConditionsVS
Id: exposure-conditions-vs
Title: "Exposure Conditions Value Set"
Description: "Value set for environmental exposure conditions"

* ^version = "0.1.0"
* ^status = #draft
* ^experimental = true
* codes from system ExposureConditionsCS

CodeSystem: ExposureLocationCS
Id: exposure-location-cs
Title: "Exposure Location Code System"
Description: "Code system for environmental exposure locations"

* ^version = "0.1.0"
* ^status = #draft
* ^caseSensitive = true
* ^experimental = true

* #indoor "Indoor environment" "Environment within buildings or enclosed spaces"
* #outdoor "Outdoor environment" "Open-air environment"
* #workplace "Workplace" "Professional or occupational environment"
* #transit "In transit" "While in transportation or commuting"
* #recreational "Recreational area" "Leisure or sports facilities"
* #urban "Urban area" "City or densely populated area"
* #rural "Rural area" "Countryside or sparsely populated area"

CodeSystem: ExposureConditionsCS
Id: exposure-conditions-cs
Title: "Exposure Conditions Code System"
Description: "Code system for conditions during environmental exposure"

* ^version = "0.1.0"
* ^status = #draft
* ^caseSensitive = true
* ^experimental = true

* #normal "Normal conditions" "Standard environmental conditions"
* #extreme "Extreme conditions" "Unusual or severe environmental conditions"
* #controlled "Controlled environment" "Environment with controlled conditions"
* #variable "Variable conditions" "Changing environmental conditions"



// ===== Conteúdo de: BodyMetricsExtensions.fsh =====

Alias: $SCT = http://snomed.info/sct

Extension: MeasurementConditions
Id: measurement-conditions
Title: "Measurement Conditions Extension"
Description: "Records the conditions under which body measurements were taken"

* ^version = "0.1.0"
* ^status = #draft
* ^context[0].type = #element
* ^context[0].expression = "Observation"

* value[x] only CodeableConcept
* valueCodeableConcept from MeasurementConditionsVS (required)

Extension: MeasurementDevice
Id: measurement-device-type
Title: "Measurement Device Type Extension"
Description: "Specifies the type of device used for body measurements"

* ^version = "0.1.0"
* ^status = #draft
* ^context[0].type = #element
* ^context[0].expression = "Observation"

* value[x] only CodeableConcept
* valueCodeableConcept from MeasurementDeviceTypeVS (required)

ValueSet: MeasurementConditionsVS
Id: measurement-conditions-vs
Title: "Measurement Conditions Value Set"
Description: "Standard conditions under which measurements are taken"

* ^version = "0.1.0"
* ^status = #draft

* $SCT#307818003 "Pre-breakfast"
* $SCT#307819006 "Post-exercise"
* $SCT#307820000 "Wearing light clothing"
* $SCT#255203001 "First thing in morning"
* $SCT#255214005 "After void"
* $SCT#309604004 "During rest"

ValueSet: MeasurementDeviceTypeVS
Id: measurement-device-type-vs
Title: "Measurement Device Type Value Set"
Description: "Types of devices used for health and body measurements"

* ^version = "0.1.0"
* ^status = #draft

* $SCT#469576000 "Smart watch"
* $SCT#706767009 "Body composition analyzer"
* $SCT#131009002 "Height measuring device"
* $SCT#706889009 "Blood pressure monitor"
* $SCT#444699000 "Tape measure"
* $SCT#44056008  "Digital scale"

Instance: WeightWithConditions
InstanceOf: WeightObservation
Usage: #example
Title: "Weight Measurement with Conditions Example"

* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#vital-signs
* code = $LOINC#29463-7 "Body weight"
* subject = Reference(Patient/example)
* effectiveDateTime = "2024-03-19T08:00:00Z"
* valueQuantity = 70.5 'kg'

* extension[measurement-conditions].url = "https://github.com/RicardoLSantos/shorthand/StructureDefinition/measurement-conditions"
* extension[measurement-conditions].valueCodeableConcept = $SCT#307818003 "Pre-breakfast"

* extension[measurement-device-type].url = "https://github.com/RicardoLSantos/shorthand/StructureDefinition/measurement-device-type"
* extension[measurement-device-type].valueCodeableConcept = $SCT#469576000 "Smart scale device"



// ===== Conteúdo de: SleepQuality.fsh =====

Extension: SleepQuality
Id: sleep-quality
Title: "Sleep Quality Extension"
Description: "Extension for recording subjective sleep quality"
* value[x] only CodeableConcept
* valueCodeableConcept from SleepQualityExtendedVS (required)
 
ValueSet: SleepQualityExtendedVS
Id: sleep-quality-extended-vs
Title: "Sleep Quality Value Set"
* $SCT#248220008 "Very good quality sleep"
* $SCT#248221007 "Good quality sleep"
* $SCT#248222000 "Poor quality sleep"
* $SCT#248223005 "Very poor quality sleep"



// ===== Conteúdo de: MindfulnessExtensions.fsh =====

Extension: MindfulnessContext
Id: mindfulness-context
Title: "Mindfulness Session Context"
Description: "Additional context about the mindfulness practice session"

* ^url = "https://example.org/StructureDefinition/mindfulness-context"
* ^version = "1.0.0"
* ^status = #draft
* ^date = "2024-03-19"
* ^publisher = "Example Organization"

* extension contains
    location 0..1 and
    environment 0..1 and
    guidance 0..1

* extension[location].value[x] only string
* extension[location].valueString 1..1
* extension[location] ^short = "Physical location of practice"
* extension[location] ^definition = "The physical location where the mindfulness practice took place"

* extension[environment].value[x] only CodeableConcept
* extension[environment].valueCodeableConcept from http://example.org/ValueSet/environment-type (required)
* extension[environment] ^short = "Environmental conditions"
* extension[environment] ^definition = "The environmental conditions during the practice session"

* extension[guidance].value[x] only boolean
* extension[guidance].valueBoolean 1..1
* extension[guidance] ^short = "Whether guidance was used"
* extension[guidance] ^definition = "Indicates if the session was guided or self-directed"



// ===== Conteúdo de: SleepExtensions.fsh =====




// ===== Conteúdo de: MobilityExtensions.fsh =====

Extension: MobilityAlertLevel
Id: mobility-alert-level
Title: "Mobility Alert Level Extension"
Description: "Extension for mobility measurements alert levels to indicate the severity or concern level of mobility changes detected by the device"
* ^status = #active
* ^context[0].type = #element
* ^context[0].expression = "Observation"
* . ^short = "Mobility alert level indicator"
* . ^definition = "Indicates the severity level of mobility changes or concerns based on device measurements"
* value[x] only CodeableConcept
* valueCodeableConcept from MobilityAlertLevelVS (required)
* valueCodeableConcept ^short = "Alert level code"
* valueCodeableConcept ^definition = "The specific alert level code indicating the severity of mobility changes"

ValueSet: MobilityAlertLevelVS
Id: mobility-alert-level-vs
Title: "Mobility Alert Level Value Set"
Description: "Value set for mobility measurement alert levels used to categorize the severity of mobility changes or concerns"
* ^status = #active
* ^experimental = false
* ^purpose = "To provide standardized alert levels for mobility measurements"
* codes from system MobilityAlertLevelCS

CodeSystem: MobilityAlertLevelCS
Id: mobility-alert-level-cs
Title: "Mobility Alert Level Code System"
Description: "Code system defining alert levels for mobility measurements, indicating the severity of changes in mobility patterns"
* ^status = #active
* ^experimental = false
* ^caseSensitive = true
* ^content = #complete
* #green "Normal - No concern" "Mobility measurements are within normal range and show no concerning patterns"
* #yellow "Caution - Monitor closely" "Mobility measurements show slight deviations that warrant closer monitoring"
* #red "Alert - Significant change" "Mobility measurements indicate significant changes that require immediate attention"
* ^property[0].code = #status
* ^property[0].type = #code
* ^property[0].description = "The status of the alert level"
* ^property[1].code = #severity
* ^property[1].type = #integer
* ^property[1].description = "Numeric value indicating severity (1=low, 3=high)"



// ===== Conteúdo de: ActivityExtensions.fsh =====




// ===== Conteúdo de: SymptomValueSets.fsh =====

CodeSystem: SymptomSeverityCS
Id: symptom-severity-cs
Title: "Symptom Severity Code System"
Description: "Severity levels for symptoms"

* #1-3 "Light" "Symptom barely noticeable"
* #4-6 "Mild" "Symptom noticeable but not interfering with daily activities"
* #7-8 "Intense" "Symptom interfering with daily activities"
* #9-10 "Severe" "Symptom preventing daily activities"

ValueSet: BodyLocationsVS
Id: body-locations-vs
Title: "Body Locations Value Set"
Description: "Anatomical locations for symptom recording"
* $SCT#12738006 "Brain"
* $SCT#69536005 "Head"
* $SCT#45048000 "Neck"
* $SCT#51185008 "Chest"
* $SCT#62413002 "Abdomen"
* $SCT#32849002 "Back"
* $SCT#53120007 "Upper limb"
* $SCT#61685007 "Lower limb"

ValueSet: DurationUnitsVS
Id: duration-units-vs
Title: "Duration Units Value Set"
Description: "Time units for symptom duration"
* $UCUM#min "Minutes"
* $UCUM#h "Hours"
* $UCUM#d "Days"
* $UCUM#wk "Weeks"
* $UCUM#mo "Months"

CodeSystem: SymptomFrequencyCS
Id: symptom-frequency-cs
Title: "Symptom Frequency Code System"
Description: "Frequency patterns for symptoms"
* #rare "Rare" "Less than once per month"
* #occasional "Occasional" "Several times per month"
* #frequent "Frequent" "Several times per week"
* #daily "Daily" "Once or more per day"
* #constant "Constant" "Present most of the time"

ValueSet: SymptomFrequencyVS
Id: symptom-frequency-vs
Title: "Symptom Frequency Value Set"
Description: "Frequency patterns for symptoms"
* codes from system SymptomFrequencyCS

CodeSystem: SymptomImpactCS
Id: symptom-impact-cs
Title: "Symptom Impact Code System"
Description: "Impact levels of symptoms on daily activities"
* #none "No impact"
* #mild "Mild impact"
* #moderate "Moderate impact"
* #severe "Severe impact"
* #complete "Complete impact"

ValueSet: SymptomImpactVS
Id: symptom-impact-vs
Title: "Symptom Impact Value Set"
Description: "Impact levels for symptoms"
* codes from system SymptomImpactCS

ValueSet: SymptomProgressionVS
Id: symptom-progression-vs
Title: "Symptom Progression Value Set"
Description: "Progression patterns for symptoms"
* $SCT#385633008 "Improving"
* $SCT#58158008 "Stable"
* $SCT#230993007 "Worsening"
* $SCT#255314001 "Fluctuating"

ValueSet: TimeOfDayVS
Id: time-of-day-vs
Title: "Time of Day Value Set"
Description: "Times of day for symptom occurrence"
* $SCT#73775008 "Morning"
* $SCT#255253008 "Afternoon"
* $SCT#2546009 "Evening"
* $SCT#73768005 "Night"

Instance: ExampleSymptomSeverity
InstanceOf: Observation
Usage: #example
Title: "Example Symptom Severity"

* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#survey
* code = $SCT#246604007 "Symptom severity"
* effectiveDateTime = "2024-03-19T10:30:00Z"
* valueCodeableConcept = http://example.org/fhir/CodeSystem/symptom-severity-cs#4-6 "Moderado"



// ===== Conteúdo de: ReproductiveValueSets.fsh =====

ValueSet: ReproductiveGoalVS
Id: reproductive-goal-vs
Title: "Reproductive Health Goals Value Set"
Description: "Goals related to reproductive health tracking and planning"

* ^status = #active
* ^experimental = false
* ^date = "2024-03-19"

* $LOINC#8708-0 "Menstrual cycle length"
* $LOINC#55284-4 "Blood pressure"
* $LOINC#8310-5 "Body temperature"
* $LOINC#8302-2 "Body height"
* $LOINC#29463-7 "Body weight"
* $SCT#364311006 "Menstrual cycle monitoring"
* $SCT#289530006 "Reproductive health finding"

ValueSet: ReproductiveActivityVS
Id: reproductive-activity-vs
Title: "Reproductive Health Activities Value Set"
Description: "Activities related to reproductive health monitoring"

* ^status = #active
* ^experimental = false
* ^date = "2024-03-19"

* codes from system ReproductiveActivityCS

CodeSystem: ReproductiveActivityCS
Id: reproductive-activity-cs
Title: "Reproductive Health Activities Code System"
Description: "Code system for reproductive health monitoring activities"

* ^status = #active
* ^experimental = false
* ^caseSensitive = true

* #cycle-tracking "Cycle Tracking" "Track menstrual cycle dates and characteristics"
* #temp-monitoring "Temperature Monitoring" "Monitor basal body temperature"
* #symptom-tracking "Symptom Tracking" "Track reproductive health symptoms"
* #vitals-monitoring "Vitals Monitoring" "Monitor vital signs related to reproductive health"
* #fertility-signs "Fertility Signs" "Monitor fertility signs and indicators"
* #mood-tracking "Mood Tracking" "Track mood changes related to reproductive cycle"
* #medication-log "Medication Log" "Log reproductive health medications"
* #exercise-tracking "Exercise Tracking" "Track physical activity during cycle"

Instance: ExampleReproductiveActivity
InstanceOf: CarePlan
Usage: #example
Title: "Example Reproductive Activity"
Description: "Example showing use of reproductive activity value set"

* status = #active
* intent = #plan
* subject = Reference(Patient/example)
* activity.detail.kind = #observation
* activity.detail.code = ReproductiveActivityCS#cycle-tracking
* activity.detail.status = #scheduled



// ===== Conteúdo de: MeasurementContextVS.fsh =====

ValueSet: MeasurementContextVS
Id: measurement-context-vs
Title: "Measurement Context Value Set"
Description: "Contexts in which measurements can be taken, including temporal and location-based contexts"
* ^status = #active
* ^experimental = false
* $SCT#272125009 "Assessment context value (qualifier value)"
* $SCT#307818003 "Before food"
* $SCT#307819006 "After food"
* $SCT#255214003 "After exercise"
* $SCT#264362003 "Time of day"



// ===== Conteúdo de: EnvironmentalContextVS.fsh =====

ValueSet: EnvironmentalContextVS
Id: environmental-context-vs
Title: "Environmental Context Value Set"
Description: "Valid contexts for environmental measurements"

* ^status = #active
* ^experimental = false
* ^date = "2024-03-19"

* codes from system EnvironmentalContextCS

CodeSystem: EnvironmentalContextCS
Id: environmental-context-cs
Title: "Environmental Context Code System"
Description: "Code system for environmental measurement contexts"

* ^status = #active
* ^experimental = false
* ^caseSensitive = true

* #indoor "Indoor" "Measurement taken indoors"
* #outdoor "Outdoor" "Measurement taken outdoors"
* #home "Home" "Measurement taken at home"
* #work "Work" "Measurement taken at workplace"
* #urban "Urban Area" "Measurement taken in urban environment"
* #rural "Rural Area" "Measurement taken in rural environment"
* #transit "In Transit" "Measurement taken while in transit"
* #exercise "During Exercise" "Measurement taken during physical activity"
* #rest "At Rest" "Measurement taken during rest"
* #sleep "During Sleep" "Measurement taken during sleep"

Instance: ExampleEnvironmentalContext
InstanceOf: Observation
Usage: #example
Title: "Example Environmental Context"
Description: "Example showing use of environmental context"

* status = #final
* code = $LOINC#89020-2 "Environmental noise average"
* effectiveDateTime = "2024-03-19"
* extension[environmental-context].url = "http://example.org/fhir/StructureDefinition/environmental-context"
* extension[environmental-context].valueCodeableConcept = EnvironmentalContextCS#indoor "Indoor"



// ===== Conteúdo de: ActivityTypeVS.fsh =====

ValueSet: PhysicalActivityTypeVS
Id: physical-activity-type-vs
Title: "Physical Activity Types Value Set"
Description: "Types of physical activities from iOS Health App"

* ^status = #active

* $SNOMED#255604002 "Physical activity (observable entity)"
* $SNOMED#228557008 "Walking"
* $SNOMED#229058003 "Running"
* $SNOMED#266938001 "Swimming"
* $SNOMED#266940006 "Cycling"
* $SNOMED#32147004 "Regular exercise"



// ===== Conteúdo de: MindfulnessValueSets.fsh =====

ValueSet: MoodValueSet
Id: mood-vs
Title: "Mood Value Set"
Description: "Codes representing different mood states"
* ^experimental = false
* $SCT#285854004 "Mood elevation"  
* $SCT#130987000 "Anxious mood"
* $SCT#130988005 "Depressed mood"
* $SCT#130989002 "Irritable mood" 
* $SCT#130990006 "Labile mood"
* $SCT#130991005 "Neutral mood"



// ===== Conteúdo de: SleepQualityVS.fsh =====

ValueSet: SleepQualityVS
Id: sleep-quality-vs
Title: "Sleep Quality Value Set"
Description: "Qualitative assessments of sleep quality including subjective measures"
* ^status = #active
* ^experimental = false
* $SCT#248254009 "Quality of sleep (observable entity)"
* $SCT#248255005 "Sleeping well"
* $SCT#248256006 "Difficulty sleeping"
* $SCT#301345002 "Poor sleep pattern"
* $SCT#301346001 "Good sleep pattern"




// ===== Conteúdo de: MindfulnessSearchParameters.fsh =====

Instance: MindfulnessType
InstanceOf: SearchParameter
Usage: #definition
Title: "Search by mindfulness practice type"

* status = #active
* code = #mindfulness-type
* name = "MindfulnessType"
* description = "Search for mindfulness observations by practice type"
* base = #Observation
* type = #token
* expression = "Observation.component.where(code.coding.where(system='http://snomed.info/sct' and code='711020003')).value.ofType(CodeableConcept)"
* xpath = "f:Observation/f:component[f:code/f:coding/f:system/@value='http://snomed.info/sct' and f:code/f:coding/f:code/@value='711020003']/f:valueCodeableConcept"
* xpathUsage = #normal

Instance: StressLevel
InstanceOf: SearchParameter
Usage: #definition
Title: "Search by stress level"

* status = #active
* code = #stress-level
* name = "StressLevel"
* description = "Search for mindfulness observations by stress level"
* base = #Observation
* type = #number
* expression = "Observation.component.where(code.coding.where(system='http://snomed.info/sct' and code='725854004')).value.ofType(integer)"
* xpath = "f:Observation/f:component[f:code/f:coding/f:system/@value='http://snomed.info/sct' and f:code/f:coding/f:code/@value='725854004']/f:valueInteger"
* xpathUsage = #normal

Instance: SessionDuration
InstanceOf: SearchParameter
Usage: #definition
Title: "Search by session duration"

* status = #active
* code = #session-duration
* name = "SessionDuration"
* description = "Search for mindfulness observations by session duration"
* base = #Observation
* type = #quantity
* expression = "Observation.component.where(code.coding.where(system='http://snomed.info/sct' and code='118682006')).value.ofType(Quantity)"
* xpath = "f:Observation/f:component[f:code/f:coding/f:system/@value='http://snomed.info/sct' and f:code/f:coding/f:code/@value='118682006']/f:valueQuantity"
* xpathUsage = #normal



// ===== Conteúdo de: MindfulnessAlerts.fsh =====

Extension: AlertTiming
Id: alert-timing
Title: "Alert Timing Extension"
Description: "Defines when alerts should be triggered"
* value[x] only Timing
* valueTiming.repeat 1..1 MS
* valueTiming.repeat.frequency MS
* valueTiming.repeat.period MS
* valueTiming.repeat.periodUnit MS

Extension: AlertMessage
Id: alert-message
Title: "Alert Message Extension"
Description: "Defines the alert message content"
* value[x] only string

Profile: MindfulnessAlert
Parent: Basic
Id: mindfulness-alert
Title: "Mindfulness Alert"
Description: "Alert configuration for mindfulness sessions"

* code 1..1 MS
* code = http://example.org/CodeSystem/mindfulness-alert-type#reminder "Mindfulness Reminder"

* extension contains
    alert-timing named alertTiming 0..1 MS and
    alert-message named alertMessage 1..1 MS

Instance: DailyMindfulnessAlert
InstanceOf: MindfulnessAlert
Title: "Daily Mindfulness Alert" 
Description: "Example of a daily mindfulness alert configuration"

* code = http://example.org/CodeSystem/mindfulness-alert-type#reminder "Mindfulness Reminder"
* extension[alertTiming].valueTiming.repeat
  * frequency = 1
  * period = 1
  * periodUnit = #d
* extension[alertMessage].valueString = "Time for your daily mindfulness practice"



// ===== Conteúdo de: MindfulnessTransforms.fsh =====

Instance: MindfulnessHealthKitTransform
InstanceOf: StructureMap
Usage: #definition
Title: "HealthKit to FHIR Mindfulness Transform"

* status = #draft
* name = "MindfulnessHealthKitTransform"
* structure[0]
  * url = "http://example.org/StructureDefinition/healthkit-mindfulness"
  * mode = #source
  * documentation = "HealthKit mindfulness session structure"

* structure[1]
  * url = "http://hl7.org/fhir/StructureDefinition/Observation"
  * mode = #target
  * documentation = "FHIR Observation resource"

* group[0]
  * name = "MindfulnessSessionToObservation"
  * typeMode = #none
  * input[0]
    * name = "source"
    * type = "HealthKitMindfulness"
    * mode = #source
  * input[1]
    * name = "target"
    * type = "Observation"
    * mode = #target
  * rule[0]
    * name = "Session"
    * source[0]
      * context = "source"
      * element = "startDate"
    * target[0]
      * context = "target"
      * element = "effectiveDateTime"
  * rule[1]
    * name = "Duration"
    * source[0]
      * context = "source"
      * element = "duration"
    * target[0]
      * context = "target"
      * element = "component.where(code.coding.code='118682006').valueQuantity"

Instance: MindfulnessCSVTransform
InstanceOf: StructureMap
Usage: #definition
Title: "CSV to FHIR Mindfulness Transform"

* status = #draft
* name = "MindfulnessCSVTransform"
* structure[0]
  * url = "http://example.org/StructureDefinition/csv-mindfulness"
  * mode = #source
  * documentation = "CSV mindfulness data structure"

* group[0]
  * name = "CSVToMindfulnessObservation"
  * typeMode = #none
  * input[0]
    * name = "source"
    * type = "CSVMindfulness"
    * mode = #source
  * input[1]
    * name = "target"
    * type = "Observation"
    * mode = #target
  * rule[0]
    * name = "MapDatetime"
    * source[0]
      * context = "source"
      * element = "date,time"
    * target[0]
      * context = "target"
      * element = "effectiveDateTime"
      * transform = #append

RuleSet: TransformValidationRules
* rule[+]
  * name = "ValidateStatus"
  * source[0]
    * context = "target"
    * element = "status"
  * assert[0]
    * description = "Status must be final"
    * expression = "%status = 'final'"

* rule[+]
  * name = "ValidateCode"
  * source[0]
    * context = "target"
    * element = "code"
  * assert[0]
    * description = "Must use SNOMED CT code"
    * expression = "%code.system = 'http://snomed.info/sct'"



// ===== Conteúdo de: MindfulnessAudit.fsh =====

Extension: AuditLevelExtension
Id: audit-level
Title: "Audit Level Extension"
Description: "Level of detail for audit records"
* value[x] only code
* valueCode from http://example.org/fhir/ValueSet/audit-levels (required)

Extension: AuditRetentionExtension
Id: audit-retention
Title: "Audit Retention Extension" 
Description: "Period to retain audit records"
* value[x] only Duration

Extension: AuditFormatExtension
Id: audit-format
Title: "Audit Format Extension"
Description: "Format for audit records"
* value[x] only code
* valueCode from http://example.org/fhir/ValueSet/audit-formats (required)

Profile: MindfulnessAudit
Parent: Basic
Id: mindfulness-audit
Title: "Mindfulness Audit"
Description: "Audit record for mindfulness sessions"

* code 1..1 MS
* code = http://example.org/CodeSystem/mindfulness-audit-type#session "Session Audit"
* created 1..1 MS

* extension contains
    audit-level named auditLevel 1..1 MS and
    audit-retention named auditRetention 1..1 MS and
    audit-format named auditFormat 1..1 MS

Instance: MindfulnessAuditExample
InstanceOf: MindfulnessAudit
Title: "Example Mindfulness Audit"
Description: "Example of a mindfulness session audit record"

* code = http://example.org/CodeSystem/mindfulness-audit-type#session "Session Audit"
* created = "2024-03-15"
* extension[auditLevel].valueCode = #detailed
* extension[auditRetention].valueDuration = 90 'days'
* extension[auditFormat].valueCode = #fhir



// ===== Conteúdo de: EnvironmentalExamples.fsh =====

Instance: NoiseExposureExample
InstanceOf: NoiseExposureObservation
Usage: #example
Title: "Noise Exposure Measurement Example"
Description: "Example of noise exposure measurement from iOS Health App"

* meta.security = http://terminology.hl7.org/CodeSystem/v3-Confidentiality#N
* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#environment
* code = $LOINC#28573-7 "Noise exposure time"
* subject = Reference(Patient/example)
* effectiveDateTime = "2024-03-19T15:30:00Z"
* device = Reference(Device/iphone-example)
* method = http://snomed.info/sct#37016008 "Automatic measurement"

* component[level]
  * code.coding[0] = $LOINC#89020-2 "Environmental noise average"
  * valueQuantity = 85 'dB'
  * interpretation = http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation#H "High"

* component[duration]
  * code.coding[0] = $LOINC#89021-0 "Environmental noise duration"
  * valueQuantity = 120 'min'

* component[peakLevel]
  * code.coding[0] = $LOINC#89024-4 "Peak sound level"
  * valueQuantity = 95 'dB'

* component[backgroundNoise]
  * code.coding[0] = $LOINC#89025-1 "Background noise level"
  * valueQuantity = 45 'dB'

* note.text = "Measurement taken during urban commute"

Instance: UVExposureExample
InstanceOf: UVExposureObservation
Usage: #example
Title: "UV Exposure Measurement Example"
Description: "Example of UV exposure measurement from iOS Health App"

* meta.security = http://terminology.hl7.org/CodeSystem/v3-Confidentiality#N
* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#environment
* code = $LOINC#28574-5 "UV exposure"
* subject = Reference(Patient/example)
* effectiveDateTime = "2024-03-19T12:00:00Z"
* device = Reference(Device/iphone-example)
* method = http://snomed.info/sct#37016008 "Automatic measurement"

* component[index]
  * code.coding[0] = $LOINC#89022-8 "UV index"
  * valueQuantity = 8 '{index}'
  * interpretation = http://terminology.hl7.org/CodeSystem/v3-ObservationInterpretation#H "High"

* component[duration]
  * code.coding[0] = $LOINC#89023-6 "UV exposure duration"
  * valueQuantity = 45 'min'

* component[timeOfDay]
  * code.coding[0] = $LOINC#89026-9 "Time of exposure"
  * valueDateTime = "2024-03-19T12:00:00Z"

* component[intensity]
  * code.coding[0] = $LOINC#89027-7 "UV intensity"
  * valueQuantity = 0.3 'W/m2'

* note.text = "Measurement taken during outdoor activity"

Instance: EnvironmentalDeviceExample
InstanceOf: Device
Usage: #example
Title: "Environmental Monitoring Device"
Description: "Example of iOS device used for environmental monitoring"

* identifier.system = "http://example.org/devices"
* identifier.value = "iPhone-ENV-001"
* manufacturer = "Apple Inc."
* modelNumber = "iPhone 15 Pro"
* type = $SCT#706689003 "Environmental monitoring device"
* status = #active



// ===== Conteúdo de: NutritionExamples.fsh =====

Instance: NutritionQuestionnaireResponseExample
InstanceOf: QuestionnaireResponse
Usage: #example
Title: "Daily Nutrition Questionnaire Response Example"

* questionnaire = "https://github.com/RicardoLSantos/shorthand/Questionnaire/daily-nutrition"
* status = #completed
* subject = Reference(Patient/PatientExample)
* authored = "2024-12-14T20:00:00Z"

* item[0]
  * linkId = "water_intake"
  * answer.valueQuantity = 2000 'mL'

* item[1]
  * linkId = "meal_record"

  * item[0]
    * linkId = "meal_time"
    * answer.valueDateTime = "2024-12-14T12:00:00Z"

  * item[1]
    * linkId = "meal_type"
    * answer.valueString = "Lunch"

  * item[2]
    * linkId = "calories"
    * answer.valueInteger = 650

  * item[3]
    * linkId = "macronutrients"
   
    * item[0]
      * linkId = "carbs"
      * answer.valueDecimal = 75
   
    * item[1]
      * linkId = "protein"
      * answer.valueDecimal = 30
   
    * item[2]
      * linkId = "fat"
      * answer.valueDecimal = 25

* item[2]
  * linkId = "caffeine"

  * item[0]
    * linkId = "caffeine_amount"
    * answer.valueInteger = 80

  * item[1]
    * linkId = "caffeine_source"
    * answer.valueString = "Coffee"



// ===== Conteúdo de: SleepExamples.fsh =====

Instance: SleepObservationExample1
InstanceOf: SleepObservation
Usage: #example
Title: "Example of Sleep Record"
Description: "Example of nightly sleep data from iOS Health App"
 
* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#sleep
* code = $LOINC#93832-4 "Sleep pattern panel"
* subject = Reference(PatientExample)
* effectiveDateTime = "2024-03-19T22:00:00Z"
* effectivePeriod.start = "2024-03-19T22:00:00Z"
* effectivePeriod.end = "2024-03-20T06:30:00Z"
* device = Reference(DeviceSleepMonitor)
 
* component[timeInBed].code = $LOINC#93831-6 "Time in bed"
* component[timeInBed].valueQuantity = 510 'min' "minute"
* component[timeInBed].valueQuantity.system = $UCUM
* component[timeInBed].valueQuantity.unit = "minute"
 
* component[totalSleepTime].code = $LOINC#93833-2 "Sleep duration"
* component[totalSleepTime].valueQuantity = 472 'min' "minute"
* component[totalSleepTime].valueQuantity.system = $UCUM
* component[totalSleepTime].valueQuantity.unit = "minute"
 
* component[deepSleep].code = $LOINC#93834-0 "Deep sleep duration"
* component[deepSleep].valueQuantity = 95 'min' "minute"
* component[deepSleep].valueQuantity.system = $UCUM
* component[deepSleep].valueQuantity.unit = "minute"
 
* component[remSleep].code = $LOINC#93835-7 "REM sleep duration"
* component[remSleep].valueQuantity = 118 'min' "minute"
* component[remSleep].valueQuantity.system = $UCUM
* component[remSleep].valueQuantity.unit = "minute"
 
* component[lightSleep].code = $LOINC#93836-5 "Light sleep duration"
* component[lightSleep].valueQuantity = 259 'min' "minute"
* component[lightSleep].valueQuantity.system = $UCUM
* component[lightSleep].valueQuantity.unit = "minute"
 
* component[respiratoryRate].code = $LOINC#9279-1 "Respiratory rate"
* component[respiratoryRate].valueQuantity = 14 '/min' "per minute"
* component[respiratoryRate].valueQuantity.system = $UCUM
* component[respiratoryRate].valueQuantity.unit = "per minute"
 
* component[heartRateVariability].code = $LOINC#80404-7 "R-R interval.standard deviation (Heart rate variability)"
* component[heartRateVariability].valueQuantity = 45 'ms' "millisecond"
* component[heartRateVariability].valueQuantity.system = $UCUM
* component[heartRateVariability].valueQuantity.unit = "millisecond"
 
* component[interruptions].code = $LOINC#93837-3 "Number of awakenings during sleep"
* component[interruptions].valueQuantity = 3 '{count}' "count"
* component[interruptions].valueQuantity.system = $UCUM
* component[interruptions].valueQuantity.unit = "count"

Instance: DeviceSleepMonitor
InstanceOf: Device
Usage: #example
Title: "Sleep Monitoring Device"
* deviceName.name = "Sleep Quality Monitor"
* deviceName.type = #user-friendly-name
* manufacturer = "HealthTech Devices"
* modelNumber = "SQM-2024"
* type = $SCT#706172001 "Sleep monitor"



// ===== Conteúdo de: PatientExample.fsh =====

Instance: PatientExample
InstanceOf: Patient
Usage: #example
Title: "Example Patient"
Description: "Example patient for lifestyle medicine measurements"
* identifier.use = #usual
* identifier.system = "urn:oid:2.16.840.1.113883.2.4.6.3"
* identifier.value = "123456789"
* active = true
* name.text = "Example Patient"
* name.family = "Patient"
* name.given = "Example"
* gender = #male
* birthDate = "1990-01-01"



// ===== Conteúdo de: MobilityExamples.fsh =====

Profile: WalkingSteadinessObservation
Parent: MobilityProfile
Id: walking-steadiness-observation
Title: "Walking Steadiness Observation Profile"
Description: "Profile for walking steadiness measurements from iPhone Motion Sensors"

* code = $LOINC#LA32-8 "Balance"
* component contains
    balanceScore 0..1 MS and
    balanceStatus 0..1 MS

* component[balanceScore]
  * code = $LOINC#LA32-8 "Balance score"
  * valueQuantity.system = $UCUM
  * valueQuantity.code = #%

* component[balanceStatus]
  * code = $LOINC#LA32-9 "Balance status"
  * valueCodeableConcept from http://example.org/fhir/ValueSet/balance-status (required)

Profile: WalkingSpeedObservation
Parent: MobilityProfile
Id: walking-speed-observation
Title: "Walking Speed Observation Profile"
Description: "Profile for walking speed measurements from iPhone Motion Sensors"

* code = $LOINC#LA29042-4 "Walking speed"
* component contains
    speed 0..1 MS and
    distance 0..1 MS

* component[speed]
  * code = $LOINC#LA29042-4 "Walking speed measurement"
  * valueQuantity.system = $UCUM
  * valueQuantity.code = #m/s

* component[distance]
  * code = $LOINC#LA29043-2 "Walking distance"
  * valueQuantity.system = $UCUM
  * valueQuantity.code = #m

Instance: WalkingSteadinessExample
InstanceOf: WalkingSteadinessObservation
Usage: #example
Title: "Walking Steadiness Measurement Example"
Description: "Example of walking steadiness measurement from iPhone Motion Sensors"

* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#activity
* code = $LOINC#LA32-8 "Balance"
* subject = Reference(Patient/example)
* effectiveDateTime = "2024-03-19T15:30:00Z"
* valueQuantity = 85 '1' "score"
* device = Reference(Device/iphone-example)

* component[balanceScore].valueQuantity = 85 '%' "percent"
* component[balanceStatus].valueCodeableConcept = $LOINC#LA32-10 "OK"

Instance: WalkingSpeedExample
InstanceOf: WalkingSpeedObservation
Usage: #example
Title: "Walking Speed Measurement Example"
Description: "Example of walking speed measurement from iPhone Motion Sensors"

* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#activity
* code = $LOINC#LA29042-4 "Walking speed"
* subject = Reference(Patient/example)
* effectiveDateTime = "2024-03-19T15:30:00Z"
* valueQuantity = 1.2 'm/s' "meters per second"
* device = Reference(Device/iphone-example)

* component[speed].valueQuantity = 1.2 'm/s' "meters per second"
* component[distance].valueQuantity = 10 'm' "meters"



// ===== Conteúdo de: PhysicalActivityExamples.fsh =====

Instance: PhysicalActivityExample1
InstanceOf: PhysicalActivityObservation
Usage: #example
Title: "Example of Walking Activity"
Description: "Example of walking activity data from iOS Health App"
* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#activity
* code = $SNOMED#228557008 "Walking"
* subject = Reference(PatientExample)
* effectiveDateTime = "2024-03-19T15:30:00Z"
* device = Reference(DeviceActivityTracker)
* component[steps].code = $LOINC#55423-8 "Number of steps in 24 hour Measured"
* component[steps].valueQuantity = 8546 '1' "count"
* component[steps].valueQuantity.system = $UCUM
* component[steps].valueQuantity.unit = "count"
* component[distance].code = $LOINC#55430-3 "Distance walked"
* component[distance].valueQuantity = 6.2 'km' "kilometer"
* component[distance].valueQuantity.system = $UCUM
* component[distance].valueQuantity.unit = "kilometer"
* component[duration].code = $LOINC#55411-3 "Exercise duration"
* component[duration].valueQuantity = 72 'min' "minute"
* component[duration].valueQuantity.system = $UCUM
* component[duration].valueQuantity.unit = "minute"
* component[energy].code = $LOINC#55424-6 "Energy expenditure"
* component[energy].valueQuantity = 320 'kcal' "kilocalorie"
* component[energy].valueQuantity.system = $UCUM
* component[energy].valueQuantity.unit = "kilocalorie"

Instance: DeviceActivityTracker
InstanceOf: Device
Usage: #example
Title: "Activity Tracking Device"
* deviceName.name = "Health Activity Tracker"
* deviceName.type = #user-friendly-name
* manufacturer = "HealthTech Devices"
* modelNumber = "HAT-2024"
* type = $SCT#258158006 "Activity monitor"



// ===== Conteúdo de: BodyMetricsExamples.fsh =====

Instance: WeightExample
InstanceOf: WeightObservation
Usage: #example
Title: "Weight Measurement Example"
Description: "Example of a weight measurement from a smart scale"
* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#vital-signs
* code = $LOINC#29463-7 "Body weight"
* subject = Reference(PatientExample)
* effectiveDateTime = "2024-03-19T08:00:00Z"
* valueQuantity = 70.5 'kg' "kilogram"
* valueQuantity.system = $UCUM
* valueQuantity.unit = "kilogram"
* device = Reference(SmartScale)

Instance: HeightExample
InstanceOf: HeightObservation
Usage: #example
Title: "Height Measurement Example"
Description: "Example of a height measurement"
* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#vital-signs
* code = $LOINC#8302-2 "Body height"
* subject = Reference(PatientExample)
* effectiveDateTime = "2024-03-19T08:00:00Z"
* valueQuantity = 175 'cm' "centimeter"
* valueQuantity.system = $UCUM
* valueQuantity.unit = "centimeter"

Instance: BMIExample
InstanceOf: BMIObservation
Usage: #example
Title: "BMI Calculation Example"
Description: "Example of a BMI calculation based on weight and height measurements"
* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#vital-signs
* code = $LOINC#39156-5 "Body mass index (BMI)"
* subject = Reference(PatientExample)
* effectiveDateTime = "2024-03-19T08:00:00Z"
* valueQuantity = 23.0 'kg/m2' "kilogram per square meter"
* valueQuantity.system = $UCUM
* valueQuantity.unit = "kilogram per square meter"
* derivedFrom[0] = Reference(Observation/WeightExample)
* derivedFrom[1] = Reference(Observation/HeightExample)

Instance: BodyCompositionExample
InstanceOf: BodyCompositionObservation
Usage: #example
Title: "Body Composition Measurement Example" 
Description: "Example of comprehensive body composition measurements from a bioimpedance device"
* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#vital-signs
* code = $LOINC#88365-2 "Body composition panel"
* subject = Reference(PatientExample)
* effectiveDateTime = "2024-03-19T08:00:00Z"
* device = Reference(BioimpedanceAnalyzer)
* component[bodyFat].code = $LOINC#41982-0 "Percentage body fat"
* component[bodyFat].valueQuantity = 22.5 '%' "percent"
* component[bodyFat].valueQuantity.system = $UCUM
* component[bodyFat].valueQuantity.unit = "percent"
* component[leanMass].code = $LOINC#291-7 "Lean body mass"
* component[leanMass].valueQuantity = 54.6 'kg' "kilogram"
* component[leanMass].valueQuantity.system = $UCUM
* component[leanMass].valueQuantity.unit = "kilogram"
* component[bodyWater].code = $LOINC#73708-0 "Total body water"
* component[bodyWater].valueQuantity = 39.2 'L' "liter"
* component[bodyWater].valueQuantity.system = $UCUM
* component[bodyWater].valueQuantity.unit = "liter"
* component[muscleMass].code = $LOINC#73713-0 "Muscle mass"
* component[muscleMass].valueQuantity = 51.8 'kg' "kilogram"
* component[muscleMass].valueQuantity.system = $UCUM
* component[muscleMass].valueQuantity.unit = "kilogram"
* component[boneMass].code = $LOINC#73711-4 "Bone mass"
* component[boneMass].valueQuantity = 2.8 'kg' "kilogram"
* component[boneMass].valueQuantity.system = $UCUM
* component[boneMass].valueQuantity.unit = "kilogram"

Instance: SmartScale
InstanceOf: Device
Usage: #example
Title: "Smart Scale Device"
* deviceName.name = "Smart Body Analyzer"
* deviceName.type = #user-friendly-name
* manufacturer = "HealthTech Devices"
* modelNumber = "SBA-2024"
* type = $SCT#469576000 "Digital scale device"

Instance: BioimpedanceAnalyzer  
InstanceOf: Device
Usage: #example
Title: "Bioimpedance Analyzer Device"
* deviceName.name = "Professional Body Composition Analyzer"
* deviceName.type = #user-friendly-name
* manufacturer = "MedTech Solutions"
* modelNumber = "BCA-Pro"
* type = $SCT#706767009 "Body composition analyzer"



// ===== Conteúdo de: SymptomExamples.fsh =====

Profile: SymptomObservation
Parent: Observation
Id: symptom-observation
Title: "Symptom Observation Profile"
Description: "Profile for recording symptoms and their characteristics"

* status MS
* category 1..1 MS
* category = http://terminology.hl7.org/CodeSystem/observation-category#survey
* code 1..1 MS
* subject 1..1 MS
* effectiveDateTime MS

* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component ^slicing.rules = #open

* component contains
    severity 0..1 MS and
    duration 0..1 MS and
    frequency 0..1 MS

* component[severity].code = $LOINC#72514-3 "Pain severity score"
* component[severity].valueInteger only integer

* component[duration].code = $LOINC#103332-8 "Duration"
* component[duration].valueQuantity.system = $UCUM
* component[duration].valueQuantity.code = #d

* component[frequency].code = $LOINC#103334-4 "Frequency"
* component[frequency].valueString only string

Instance: ChronicSymptomExample
InstanceOf: SymptomObservation
Usage: #example
Title: "Chronic Symptom Example"

* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#survey
* code = $SCT#267036007 "Fatigue"
* subject = Reference(Patient/example)
* effectiveDateTime = "2024-03-19T14:00:00Z"

* component[severity].valueInteger = 7
* component[duration].valueQuantity = 30 'd'
* component[frequency].valueString = "Daily occurrence"

Instance: SymptomQuestionnaireResponseExample
InstanceOf: QuestionnaireResponse
Usage: #example
Title: "Symptom Questionnaire Response Example"

* questionnaire = "http://example.org/Questionnaire/symptom-tracking"
* status = #completed
* subject = Reference(Patient/example)
* authored = "2024-03-19T15:30:00Z"

* item[0]
  * linkId = "symptom"
  * answer.valueCoding = $SCT#25064002 "Headache"

* item[1]
  * linkId = "location"
  * answer.valueCoding = $SCT#69536005 "Head"

* item[2]
  * linkId = "severity"
  * answer.valueInteger = 6

* item[3]
  * linkId = "duration"
  * item[0]
    * linkId = "duration_value"
    * answer.valueDecimal = 2
  * item[1]
    * linkId = "duration_unit"
    * answer.valueString = "hours"

Instance: SymptomAssessmentExample
InstanceOf: ClinicalImpression
Usage: #example
Title: "Clinical Assessment of Symptoms Example"

* status = #completed
* subject = Reference(Patient/example)
* effectiveDateTime = "2024-03-19T16:00:00Z"
* code = $SCT#410515003 "Clinical assessment"

* finding[0]
  * itemCodeableConcept = $SCT#272141005 "Severity"
  * itemReference = Reference(Observation/SymptomExample)

Instance: SymptomFollowUpExample
InstanceOf: SymptomObservation
Usage: #example
Title: "Symptom Follow-up Example"

* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#survey
* code = $SCT#25064002 "Headache"
* subject = Reference(Patient/example)
* effectiveDateTime = "2024-03-26T10:00:00Z"
* basedOn = Reference(CarePlan/example)

* component[severity].valueInteger = 4
* component[duration].valueQuantity = 45 'min'
* component[frequency].valueString = "Once per week"

Instance: SymptomWithContextExample
InstanceOf: SymptomObservation
Usage: #example
Title: "Symptom with Context Example"

* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#survey
* code = $SCT#25064002 "Headache"
* subject = Reference(Patient/example)
* effectiveDateTime = "2024-03-19T15:30:00Z"

* component[severity].valueInteger = 8
* component[duration].valueQuantity = 180 'min'
* component[frequency].valueString = "3 times per week"

* note.text = "Symptoms worsen with physical activity and bright lights"



// ===== Conteúdo de: VitalSignsExamples.fsh =====

Instance: HeartRateExample
InstanceOf: HeartRateObservation
Usage: #example
Title: "Heart Rate Measurement Example"
* status = #final
* code = $LOINC#8867-4 "Heart rate"
* subject = Reference(PatientExample)
* effectiveDateTime = "2024-03-19T15:30:00Z"
* valueQuantity = 72 '/min' "per minute"
* valueQuantity.system = $UCUM
* valueQuantity.unit = "per minute"
* device = Reference(DeviceHeartRateMonitor)
* component[heartRateVariability].code = $LOINC#80404-7 "R-R interval.standard deviation (Heart rate variability)"
* component[heartRateVariability].valueQuantity = 45 'ms' "millisecond"
* component[heartRateVariability].valueQuantity.system = $UCUM
* component[heartRateVariability].valueQuantity.unit = "millisecond"

Instance: BloodPressureExample
InstanceOf: BloodPressureObservation
Usage: #example
Title: "Blood Pressure Measurement Example"
* status = #final
* code = $LOINC#85354-9 "Blood pressure panel with all children optional"
* subject = Reference(PatientExample)
* effectiveDateTime = "2024-03-19T15:30:00Z"
* device = Reference(DeviceBloodPressureMonitor)
* component[systolic].code = $LOINC#8480-6 "Systolic blood pressure"
* component[systolic].valueQuantity = 120 'mm[Hg]' "millimeter of mercury"
* component[systolic].valueQuantity.system = $UCUM
* component[systolic].valueQuantity.unit = "millimeter of mercury"
* component[diastolic].code = $LOINC#8462-4 "Diastolic blood pressure"
* component[diastolic].valueQuantity = 80 'mm[Hg]' "millimeter of mercury"
* component[diastolic].valueQuantity.system = $UCUM
* component[diastolic].valueQuantity.unit = "millimeter of mercury"

Instance: DeviceHeartRateMonitor
InstanceOf: Device
Usage: #example
Title: "Heart Rate Monitor Device"
* deviceName.name = "Continuous Heart Rate Monitor"
* deviceName.type = #user-friendly-name
* manufacturer = "HealthTech Devices"
* modelNumber = "HRM-2024"
* type = $SCT#720737000 "Pulse rate monitoring device"

Instance: DeviceBloodPressureMonitor
InstanceOf: Device
Usage: #example
Title: "Blood Pressure Monitor Device"
* deviceName.name = "Digital Blood Pressure Monitor"
* deviceName.type = #user-friendly-name
* manufacturer = "HealthTech Devices"
* modelNumber = "BPM-2024"
* type = $SCT#43770009 "Blood pressure monitor"



// ===== Conteúdo de: MindfulnessCompleteExamples.fsh =====

Instance: CompleteMindfulnessSession
InstanceOf: MindfulnessObservation
Usage: #example
Title: "Complete Mindfulness Session Example"

* status = #final
* code = $SCT#711020003 "Meditation"
* subject = Reference(Patient/PatientExample)
* effectiveDateTime = "2024-03-19T08:00:00Z"
* performer = Reference(Practitioner/example)

* component[sessionDuration].code = $SCT#118682006 "Duration"
* component[sessionDuration].valueQuantity = 20 'min'

* component[stressLevel].code = $SCT#725854004 "Assessment of stress level"
* component[stressLevel].valueInteger = 3

* component[moodState].code = $SCT#373931001 "Mood finding"
* component[moodState].valueCodeableConcept = $SCT#130991005 "Neutral mood"

* component[relaxationResponse].code = $SCT#276241001 "Relaxation technique"
* component[relaxationResponse].valueString = "Deep breathing exercises with progressive relaxation"

* component[mindfulnessType].code = $SCT#711020003 "Meditation"
* component[mindfulnessType].valueCodeableConcept = $SCT#711020003 "Meditation"

* extension[mindfulness-context].extension[location].valueString = "Home meditation room"
* extension[mindfulness-context].extension[environment].valueCodeableConcept = #quiet "Quiet Space"
* extension[mindfulness-context].extension[guidance].valueBoolean = true

Instance: CompleteMindfulnessResponse
InstanceOf: QuestionnaireResponse
Usage: #example
Title: "Complete Mindfulness Session Response"

* questionnaire = "http://example.org/Questionnaire/daily-mindfulness"
* status = #completed
* subject = Reference(Patient/PatientExample)
* authored = "2024-03-19T08:30:00Z"

* item[0]
  * linkId = "mindful_session"
  * item[0]
    * linkId = "session_duration"
    * answer.valueInteger = 20
  * item[1]
    * linkId = "practice_type"
    * answer.valueString = "Meditation"

* item[1]
  * linkId = "mood_assessment"
  * item[0]
    * linkId = "current_mood"
    * answer.valueCoding = $SCT#130991005 "Neutral mood"
  * item[1]
    * linkId = "mood_intensity"
    * answer.valueInteger = 3

* item[2]
  * linkId = "stress_assessment"
  * item[0]
    * linkId = "stress_level"
    * answer.valueInteger = 3
  * item[1]
    * linkId = "stress_symptoms"
    * answer[0].valueString = "Slight tension"

* item[3]
  * linkId = "relaxation"
  * item[0]
    * linkId = "relaxation_duration"
    * answer.valueInteger = 15
  * item[1]
    * linkId = "relaxation_technique"
    * answer.valueString = "Deep breathing"



// ===== Conteúdo de: MindfulnessExamples.fsh =====

Instance: MindfulnessObservationExample
InstanceOf: MindfulnessObservation
Usage: #example
Title: "Example of Mindfulness Session Observation"

* status = #final
* code = $SCT#711020003 "Meditation"
* subject = Reference(Patient/PatientExample)
* effectiveDateTime = "2024-03-19T09:30:00Z"
* performer = Reference(Practitioner/example)

* component[sessionDuration].code = $SCT#118682006 "Duration"
* component[sessionDuration].valueQuantity = 20 'min'

* component[stressLevel].code = $SCT#725854004 "Assessment of stress level"
* component[stressLevel].valueInteger = 4

* component[moodState].code = $SCT#373931001 "Mood finding"
* component[moodState].valueCodeableConcept = $SCT#130991005 "Neutral mood"

* component[relaxationResponse].code = $SCT#276241001 "Relaxation technique"
* component[relaxationResponse].valueString = "Deep breathing exercises helped reduce tension"

* component[mindfulnessType].code = $SCT#711020003 "Meditation"
* component[mindfulnessType].valueCodeableConcept = $SCT#711020003 "Meditation"

// New example for MindfulnessQuestionnaire
Instance: MindfulnessQuestionnaireExample
InstanceOf: Questionnaire
Usage: #example
Title: "Example of Mindfulness Questionnaire"

* url = "http://example.org/Questionnaire/mindfulness-example"
* status = #active
* title = "Daily Mindfulness Assessment"
* version = "1.0"
* name = "MindfulnessQuestionnaireExample"
* date = "2024-03-19"
* publisher = "Example Organization"
* description = "Example questionnaire for daily mindfulness practice assessment"

* item[0]
  * linkId = "session_details"
  * text = "Session Details"
  * type = #group
  
  * item[0]
    * linkId = "duration"
    * text = "Duration (minutes)"
    * type = #integer
    * required = true
    
  * item[1]
    * linkId = "technique"
    * text = "Technique Used"
    * type = #choice
    * required = true
    * answerOption[0].valueString = "Mindful Breathing"
    * answerOption[1].valueString = "Body Scan"
    * answerOption[2].valueString = "Walking Meditation"



// ===== Conteúdo de: ReproductiveExamples.fsh =====

Profile: BasalTemperatureObservation
Parent: ReproductiveObservation
Id: basal-temperature-observation
Title: "Basal Temperature Observation Profile"
Description: "Profile for basal body temperature measurements"

* code = $LOINC#8310-5 "Body temperature"
* valueQuantity only Quantity
* valueQuantity.system = $UCUM
* valueQuantity.code = #Cel

Instance: BasalTemperatureExample
InstanceOf: BasalTemperatureObservation
Usage: #example
Title: "Basal Temperature Record Example"

* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#reproductive
* code = $LOINC#8310-5 "Body temperature"
* subject = Reference(Patient/example)
* effectiveDateTime = "2024-03-19T06:30:00Z"
* valueQuantity = 36.7 'Cel'

Instance: FertilitySignsExample
InstanceOf: FertilityObservation
Usage: #example
Title: "Fertility Signs Example"

* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#reproductive
* code = $LOINC#8669-4 "Ovulation status"
* subject = Reference(Patient/example)
* effectiveDateTime = "2024-03-19T08:00:00Z"

* component[cervicalMucus].valueCodeableConcept = http://example.org/fhir/CodeSystem/cervical-mucus-cs#eggwhite
* component[ovulationTest].valueCodeableConcept = http://example.org/fhir/CodeSystem/ovulation-test-cs#positive

Instance: ReproductiveSymptomsExample
InstanceOf: ReproductiveSymptomObservation
Usage: #example
Title: "Reproductive Symptoms Example"

* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#reproductive
* code = $SCT#55300003 "Menstrual cramp"
* subject = Reference(Patient/example)
* effectiveDateTime = "2024-03-19T10:00:00Z"

* component[severity].valueInteger = 6
* component[duration].valueQuantity = 4 'h'

Instance: ReproductiveCyclePlanExample
InstanceOf: ReproductiveCyclePlan
Usage: #example
Title: "Reproductive Cycle Plan Example"

* status = #active
* intent = #plan
* subject = Reference(Patient/example)
* period.start = "2024-03-19"
* period.end = "2024-04-19"

* activity[0].detail.kind = #observation
* activity[0].detail.code = $SCT#364311006 "Menstrual cycle monitoring"
* activity[0].detail.status = #scheduled
* activity[0].detail.scheduledTiming.repeat.frequency = 1
* activity[0].detail.scheduledTiming.repeat.period = 1
* activity[0].detail.scheduledTiming.repeat.periodUnit = #d

Instance: ReproductiveGoalExample
InstanceOf: ReproductiveGoal
Usage: #example
Title: "Reproductive Goal Example"

* lifecycleStatus = #active
* category = http://terminology.hl7.org/CodeSystem/goal-category#reproductive
* description.text = "Track regular menstrual cycles"
* subject = Reference(Patient/example)
* startDate = "2024-03-19"

* target.measure = $LOINC#8708-0 "Menstrual cycle duration"
* target.detailRange
  * low = 26
  * high = 30
  * unit = "days"
* target.dueDate = "2024-06-19"

Instance: CompleteCycleExample
InstanceOf: MenstrualCycleObservation
Usage: #example
Title: "Complete Menstrual Cycle Example with All Components"

* status = #final
* category = http://terminology.hl7.org/CodeSystem/observation-category#reproductive
* code = $LOINC#49033-4 "Menstrual cycle finding"
* subject = Reference(Patient/example)
* effectiveDateTime = "2024-03-19T06:00:00Z"

* component[cycleLength].valueQuantity = 28 'd'
* component[flowDuration].valueQuantity = 5 'd'
* component[flowIntensity].valueCodeableConcept = http://example.org/fhir/CodeSystem/flow-intensity-cs#moderate

* note.text = "Regular cycle with normal characteristics"



// ===== Conteúdo de: MindfulnessWorkflow.fsh =====

Profile: MindfulnessSchedule
Parent: Basic
Id: mindfulness-schedule
Title: "Mindfulness Schedule"
Description: "Schedule configuration for mindfulness sessions"

* code 1..1 MS
* code = http://example.org/CodeSystem/mindfulness-schedule-type#recurring "Recurring Schedule"

Extension: MindfulnessScheduleTiming
Id: mindfulness-schedule-timing
Title: "Mindfulness Schedule Timing"
Description: "Timing configuration for mindfulness sessions"
* value[x] only Timing

Instance: WeeklyMindfulnessSchedule
InstanceOf: MindfulnessSchedule
Title: "Weekly Mindfulness Schedule"
Description: "Example of a weekly mindfulness schedule"

* code = http://example.org/CodeSystem/mindfulness-schedule-type#recurring "Recurring Schedule"
* extension[mindfulness-schedule-timing].valueTiming.repeat.frequency = 1
* extension[mindfulness-schedule-timing].valueTiming.repeat.period = 1
* extension[mindfulness-schedule-timing].valueTiming.repeat.periodUnit = #wk
* extension[mindfulness-schedule-timing].valueTiming.repeat.dayOfWeek = #mon
* extension[mindfulness-schedule-timing].valueTiming.repeat.dayOfWeek[+] = #wed
* extension[mindfulness-schedule-timing].valueTiming.repeat.dayOfWeek[+] = #fri



// ===== Conteúdo de: MindfulnessRules.fsh =====

RuleSet: MindfulnessValidation
* ^extension[0].url = "http://hl7.org/fhir/StructureDefinition/elementdefinition-bestpractice"
* ^extension[0].valueBoolean = true

* status MS
* code MS
* subject MS
* effective[x] MS
* value[x] MS
* component MS

* status from http://hl7.org/fhir/ValueSet/observation-status
* code from http://snomed.info/sct?fhir_vs=isa/711020003
* subject only Reference(Patient)
* effective[x] only dateTime

* obeys mindfulness-session-duration
* obeys mindfulness-stress-level
* obeys mindfulness-mood-required
* obeys mindfulness-context-complete
* obeys sequential-measurements

RuleSet: MindfulnessQuestionnaireValidation
* status MS
* title MS
* item MS

* status = #active
* subjectType = #Patient
* item ^slicing.discriminator.type = #pattern
* item ^slicing.discriminator.path = "linkId"
* item ^slicing.rules = #open
* item contains 
    session 0..1 MS and
    mood 0..1 MS and
    stress 0..1 MS and
    relaxation 0..1 MS

* item[session]
  * linkId = "mindful_session"
  * text = "Mindfulness Session"
  * type = #group
  * required = true
  * repeats = false

* item[mood]
  * linkId = "mood_assessment"
  * text = "Mood Assessment"
  * type = #group
  * required = true
  * repeats = false

* item[stress]
  * linkId = "stress_assessment"
  * text = "Stress Assessment"
  * type = #group
  * required = true
  * repeats = false

* item[relaxation]
  * linkId = "relaxation"
  * text = "Relaxation"
  * type = #group
  * required = true
  * repeats = false

RuleSet: MindfulnessResponseValidation
* status MS
* subject MS
* authored MS
* item MS

* status = #completed
* subject only Reference(Patient)
* authored 1..1
* item ^slicing.discriminator.type = #pattern
* item ^slicing.discriminator.path = "linkId"
* item ^slicing.rules = #open



// ===== Conteúdo de: MindfulnessMappings.fsh =====

Mapping: MindfulnessToHealthKit
Id: mindfulness-to-healthkit
Title: "Mapping to Apple HealthKit"
Source: MindfulnessObservation
Target: "http://developer.apple.com/documentation/healthkit"

* -> "HKCategoryTypeIdentifierMindfulSession" "Root mapping"
* effectiveDateTime -> "startDate and endDate" "Session timing"
* component[sessionDuration].valueQuantity -> "duration" "Session duration"

Mapping: MindfulnessToLOINC
Id: mindfulness-to-loinc
Title: "Mapping to LOINC codes"
Source: MindfulnessObservation
Target: "http://loinc.org"

* -> "89555-7" "Mindfulness safety questionnaire"
* component[stressLevel] -> "89556-5" "Stress level score"
* component[sessionDuration] -> "89557-3" "Duration of mindfulness practice"
* component[moodState] -> "89558-1" "Mood pattern"

Mapping: MindfulnessToSNOMED
Id: mindfulness-to-snomed
Title: "Mapping to SNOMED CT"
Source: MindfulnessObservation
Target: "http://snomed.info/sct"

* -> "711020003" "Meditation"
* component[stressLevel] -> "725854004" "Assessment of stress level"
* component[moodState] -> "373931001" "Mood finding"
* component[relaxationResponse] -> "276241001" "Relaxation technique"

Extension: MindfulnessImportMap
Id: mindfulness-import-map
Title: "Mindfulness Import Mapping"
Description: "Mapping instructions for importing mindfulness data"

* ^url = "https://example.org/StructureDefinition/mindfulness-import-map"
* ^version = "1.0.0"
* ^status = #draft

* extension contains
    source 1..1 MS and
    target 1..1 MS and
    mapping 1..1 MS

* extension[source].value[x] only string
* extension[target].value[x] only string
* extension[mapping].value[x] only string

Instance: HealthKitMappingConfig
InstanceOf: MindfulnessImportMap
Usage: #inline

* extension[source].valueString = "HKCategoryTypeIdentifierMindfulSession"
* extension[target].valueString = "Observation"
* extension[mapping].valueString = "duration->component[sessionDuration].valueQuantity"



// ===== Conteúdo de: MindfulnessDiagnosticMappings.fsh =====

Instance: MindfulnessDiagnosticMap
InstanceOf: ConceptMap
Usage: #definition
Title: "Mindfulness Diagnostic Mappings"
Description: "Mapping of mindfulness outcomes to diagnostic codes"

* status = #draft
* experimental = false
* purpose = "Map mindfulness outcomes to standard diagnostic codes"
* sourceUri = "https://example.org/ValueSet/mindfulness-outcome-vs"
* targetUri = "http://snomed.info/sct"

* group[0].source = "https://example.org/CodeSystem/mindfulness-outcome-cs"
* group[0].target = "http://snomed.info/sct"
* group[0].element[0]
  * code = #stressReduction
  * target[0]
    * code = #73595000
    * display = "Stress"
    * equivalence = #narrower
    * comment = "Indicates reduction in stress levels"

* group[0].element[1]
  * code = #improvedSleep
  * target[0]
    * code = #248234008
    * display = "Sleep pattern"
    * equivalence = #narrower
    * comment = "Indicates improvement in sleep quality"

* group[0].element[2]
  * code = #emotionalBalance
  * target[0]
    * code = #285854004
    * display = "Emotional state"
    * equivalence = #equivalent
    * comment = "Maps to emotional state finding"

* group[0].element[3]
  * code = #increasedAwareness
  * target[0]
    * code = #736253002
    * display = "Mental state, behavior and/or psychosocial functioning"
    * equivalence = #relatedto
    * comment = "General improvement in mental state"

RuleSet: MindfulnessDiagnosticRules
* status MS
* code MS
* subject MS
* effective[x] MS
* value[x] MS
* method MS

* method from http://example.org/ValueSet/mindfulness-diagnostic-method-vs (required)
* code from http://example.org/ValueSet/mindfulness-diagnostic-code-vs (required)

* extension contains 
    diagnosticCertainty 0..1 MS and
    diagnosticTiming 0..1 MS



// ===== Conteúdo de: BodyMetricsProfiles.fsh =====

Alias: $SCT = http://snomed.info/sct
Alias: $LOINC = http://loinc.org
Alias: $UCUM = http://unitsofmeasure.org

Profile: BodyMetricsObservation
Parent: Observation
Id: body-metrics-observation
Title: "Body Metrics Observation Profile"
Description: "Profile for body measurements from iOS Health App"

* ^version = "0.1.0"
* ^status = #draft
* ^publisher = "Open Health Manager"

* status MS
* category 1..1 MS
* category = http://terminology.hl7.org/CodeSystem/observation-category#vital-signs
* subject 1..1 MS
* effectiveDateTime 1..1 MS
* device 0..1 MS

Profile: WeightObservation
Parent: BodyMetricsObservation
Id: weight-observation  
Title: "Weight Measurement Profile"
Description: "Profile for body weight measurements"

* ^version = "0.1.0"
* ^status = #draft

* code = $LOINC#29463-7 "Body weight"
* valueQuantity only Quantity
* valueQuantity.system = $UCUM
* valueQuantity.code = #kg

Profile: HeightObservation
Parent: BodyMetricsObservation
Id: height-observation
Title: "Height Measurement Profile" 
Description: "Profile for body height measurements"

* ^version = "0.1.0"
* ^status = #draft

* code = $LOINC#8302-2 "Body height"
* valueQuantity only Quantity
* valueQuantity.system = $UCUM
* valueQuantity.code = #cm

Profile: BMIObservation
Parent: BodyMetricsObservation
Id: bmi-observation
Title: "BMI Measurement Profile"
Description: "Profile for Body Mass Index calculations"

* ^version = "0.1.0"
* ^status = #draft

* code = $LOINC#39156-5 "Body mass index (BMI)"
* valueQuantity only Quantity
* valueQuantity.system = $UCUM
* valueQuantity.code = #kg/m2

Profile: BodyCompositionObservation
Parent: BodyMetricsObservation
Id: body-composition-observation
Title: "Body Composition Profile"
Description: "Profile for body composition measurements including fat, lean mass, and other metrics"

* ^version = "0.1.0"
* ^status = #draft

* code = $LOINC#88365-2 "Body composition panel"
* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component ^slicing.rules = #open

* component contains
    bodyFat 0..1 MS and
    leanMass 0..1 MS and
    bodyWater 0..1 MS and
    muscleMass 0..1 MS and
    boneMass 0..1 MS

* component[bodyFat].code = $LOINC#41982-0 "Percentage body fat"
* component[bodyFat].valueQuantity.system = $UCUM
* component[bodyFat].valueQuantity.code = #%

* component[leanMass].code = $LOINC#291-7 "Lean body mass"
* component[leanMass].valueQuantity.system = $UCUM
* component[leanMass].valueQuantity.code = #kg

* component[bodyWater].code = $LOINC#73708-0 "Total body water"
* component[bodyWater].valueQuantity.system = $UCUM  
* component[bodyWater].valueQuantity.code = #L

* component[muscleMass].code = $LOINC#73713-0 "Muscle mass"
* component[muscleMass].valueQuantity.system = $UCUM
* component[muscleMass].valueQuantity.code = #kg

* component[boneMass].code = $LOINC#73711-4 "Bone mass" 
* component[boneMass].valueQuantity.system = $UCUM
* component[boneMass].valueQuantity.code = #kg



// ===== Conteúdo de: AdvancedVitalSignsProfiles.fsh =====

Alias: $SCT = http://snomed.info/sct
Alias: $LOINC = http://loinc.org
Alias: $UCUM = http://unitsofmeasure.org

Profile: AdvancedVitalSigns
Parent: Observation
Id: advanced-vital-signs
Title: "Advanced Vital Signs Profile"
Description: "Profile for advanced vital signs data from iOS Health App"

* ^version = "0.1.0"
* ^status = #draft
* ^publisher = "HL7 International"
* ^contact.name = "Advanced Vital Signs Working Group"

* status MS
* category 1..1 MS
* category = http://terminology.hl7.org/CodeSystem/observation-category#vital-signs
* code 1..1 MS
* subject 1..1 MS
* effectiveDateTime 1..1 MS
* device 0..1 MS
* method 0..1 MS
* note 0..* MS

* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component ^slicing.rules = #open
* component ^short = "Advanced vital signs components"
* component ^definition = "Components of advanced vital sign measurements"

* component contains
    hrvSpectral 0..1 MS and
    hrvEntropy 0..1 MS and
    meanArterialPressure 0..1 MS and
    pulseWaveAnalysis 0..1 MS and
    respiratoryVariability 0..1 MS and
    oxygenationIndex 0..1 MS and
    stressIndex 0..1 MS and
    thermalGradient 0..1 MS and
    autonomicBalance 0..1 MS and
    recoveryRate 0..1 MS and
    allostaticLoad 0..1 MS

* component[hrvSpectral].code = $LOINC#87834-8 "Heart rate variability [Frequency band]"
* component[hrvSpectral].valueQuantity.system = $UCUM
* component[hrvSpectral].valueQuantity.code = #ms
* component[hrvSpectral] ^short = "Spectral analysis of heart rate variability"

* component[hrvEntropy].code = $LOINC#87835-5 "Heart rate variability entropy"
* component[hrvEntropy].valueQuantity.system = $UCUM
* component[hrvEntropy].valueQuantity.code = #{entropy}
* component[hrvEntropy] ^short = "Sample entropy of heart rate variability"

* component[meanArterialPressure].code = $LOINC#8478-0 "Mean blood pressure"
* component[meanArterialPressure].valueQuantity.system = $UCUM
* component[meanArterialPressure].valueQuantity.code = #mmHg
* component[meanArterialPressure] ^short = "Mean arterial blood pressure"

* component[pulseWaveAnalysis].code = $LOINC#87836-3 "Pulse wave analysis"
* component[pulseWaveAnalysis].valueQuantity.system = $UCUM
* component[pulseWaveAnalysis].valueQuantity.code = #{index}
* component[pulseWaveAnalysis] ^short = "Analysis of arterial pulse wave"

* component[respiratoryVariability].code = $LOINC#87837-1 "Respiratory rate variability"
* component[respiratoryVariability].valueQuantity.system = $UCUM
* component[respiratoryVariability].valueQuantity.code = #{coefficient}
* component[respiratoryVariability] ^short = "Variability in respiratory rate"

* component[oxygenationIndex].code = $LOINC#87838-9 "Oxygenation index"
* component[oxygenationIndex].valueQuantity.system = $UCUM
* component[oxygenationIndex].valueQuantity.code = #{ratio}
* component[oxygenationIndex] ^short = "Index of blood oxygenation"

* component[stressIndex].code = $LOINC#87839-7 "Physiological stress index"
* component[stressIndex].valueQuantity.system = $UCUM
* component[stressIndex].valueQuantity.code = #{index}
* component[stressIndex] ^short = "Index of physiological stress"

* component[thermalGradient].code = $LOINC#87840-5 "Temperature gradient"
* component[thermalGradient].valueQuantity.system = $UCUM
* component[thermalGradient].valueQuantity.code = #Cel
* component[thermalGradient] ^short = "Gradient of body temperature"

* component[autonomicBalance].code = $LOINC#87841-3 "Autonomic balance index"
* component[autonomicBalance].valueQuantity.system = $UCUM
* component[autonomicBalance].valueQuantity.code = #{ratio}
* component[autonomicBalance] ^short = "Balance of autonomic nervous system"

* component[recoveryRate].code = $LOINC#87842-1 "Recovery rate index"
* component[recoveryRate].valueQuantity.system = $UCUM
* component[recoveryRate].valueQuantity.code = #{rate}
* component[recoveryRate] ^short = "Rate of physiological recovery"

* component[allostaticLoad].code = $LOINC#87843-9 "Allostatic load index"
* component[allostaticLoad].valueQuantity.system = $UCUM
* component[allostaticLoad].valueQuantity.code = #{score}
* component[allostaticLoad] ^short = "Measure of cumulative physiological burden"

Extension: AdvancedVitalSignsContext
Id: advanced-vital-signs-context
Title: "Advanced Vital Signs Context Extension"
Description: "Additional context about advanced vital sign measurements"

* value[x] only CodeableConcept
* valueCodeableConcept from AdvancedVitalSignsContextVS (required)

ValueSet: AdvancedVitalSignsContextVS
Id: advanced-vital-signs-context-vs
Title: "Advanced Vital Signs Context Value Set"
Description: "Context codes for advanced vital sign measurements"

* ^experimental = true
* codes from system AdvancedVitalSignsContextCS

CodeSystem: AdvancedVitalSignsContextCS
Id: advanced-vital-signs-context-cs
Title: "Advanced Vital Signs Context Code System"
Description: "Codes for advanced vital signs measurement context"

* ^experimental = true
* ^caseSensitive = true

* #resting "Resting state" "Measurement taken during rest"
* #active "Active state" "Measurement taken during activity"
* #recovery "Recovery state" "Measurement taken during recovery"
* #sleep "Sleep state" "Measurement taken during sleep"
* #stress "Stress state" "Measurement taken during stress"



// ===== Conteúdo de: MobilityProfiles.fsh =====

Profile: MobilityProfile
Parent: Observation
Id: mobility-profile
Title: "Mobility Profile"
Description: "Profile for mobility data from iOS Health App"

* status MS
* category 1..1 MS
* category = http://terminology.hl7.org/CodeSystem/observation-category#activity
* code 1..1 MS
* subject 1..1 MS
* effectiveDateTime 1..1 MS
* device 0..1 MS

* component MS
  * code MS
  * value[x] MS

Profile: MobilityRiskAssessment
Parent: RiskAssessment
Id: mobility-risk-assessment
Title: "Mobility Risk Assessment Profile"
Description: "Profile for assessing mobility-related risks"

* status MS
* subject 1..1 MS
* occurrence[x] MS
* prediction MS
  * outcome MS
  * probability[x] MS
  * qualitativeRisk MS

* method MS
  * coding 1..* MS
  * coding ^slicing.discriminator.type = #pattern
  * coding ^slicing.discriminator.path = "$this"
  * coding ^slicing.rules = #open
  * coding contains
      mobilityAssessment 1..1 MS



// ===== Conteúdo de: VitalSignsProfiles.fsh =====

Alias: $SCT = http://snomed.info/sct
Alias: $LOINC = http://loinc.org
Alias: $UCUM = http://unitsofmeasure.org
Alias: $vitalsigns = http://hl7.org/fhir/StructureDefinition/vitalsigns

Profile: LifestyleVitalSigns
Parent: $vitalsigns
Id: lifestyle-vital-signs
Title: "Lifestyle Medicine Vital Signs Profile"
Description: "Profile for vital signs data from iOS Health App"

* status MS
* category 1..* MS
* subject 1..1 MS
* effectiveDateTime 1..1 MS
* code 1..1 MS
* value[x] 0..1 MS
* device 0..1 MS

Profile: HeartRateObservation
Parent: LifestyleVitalSigns
Id: heart-rate-observation
Title: "Heart Rate Observation Profile"
Description: "Profile for heart rate measurements from iOS Health App"

* code = $LOINC#8867-4 "Heart rate"
* valueQuantity only Quantity
* valueQuantity.system = $UCUM
* valueQuantity.code = #/min
* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component ^slicing.rules = #open

* component contains
    restingHeartRate 0..1 MS and
    exerciseHeartRate 0..1 MS and
    recoveryHeartRate 0..1 MS and
    heartRateVariability 0..1 MS

* component[heartRateVariability].code = $LOINC#80404-7 "R-R interval.standard deviation (Heart rate variability)"
* component[heartRateVariability].valueQuantity.system = $UCUM
* component[heartRateVariability].valueQuantity.code = #ms

Profile: BloodPressureObservation
Parent: LifestyleVitalSigns
Id: blood-pressure-observation
Title: "Blood Pressure Observation Profile"
Description: "Profile for blood pressure measurements from iOS Health App"

* code = $LOINC#85354-9 "Blood pressure panel with all children optional"
* component 2..2 MS
* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component ^slicing.rules = #closed

* component contains
    systolic 1..1 MS and
    diastolic 1..1 MS

* component[systolic].code = $LOINC#8480-6 "Systolic blood pressure"
* component[systolic].valueQuantity only Quantity
* component[systolic].valueQuantity.system = $UCUM
* component[systolic].valueQuantity.code = #mm[Hg]

* component[diastolic].code = $LOINC#8462-4 "Diastolic blood pressure"
* component[diastolic].valueQuantity only Quantity
* component[diastolic].valueQuantity.system = $UCUM
* component[diastolic].valueQuantity.code = #mm[Hg]

Profile: OxygenSaturationObservation
Parent: LifestyleVitalSigns
Id: oxygen-saturation-observation
Title: "Oxygen Saturation Observation Profile"
Description: "Profile for SpO2 measurements from iOS Health App"

* code = $LOINC#2708-6 "Oxygen saturation in Arterial blood"
* valueQuantity.system = $UCUM
* valueQuantity.code = #%



// ===== Conteúdo de: PhysicalActivityProfile.fsh =====

Alias: $LOINC = http://loinc.org
Alias: $SNOMED = http://snomed.info/sct
Alias: $UCUM = http://unitsofmeasure.org
Alias: $ActivityCodes = http://example.org/activity-codes

Profile: PhysicalActivityObservation
Parent: Observation
Id: physical-activity-observation
Title: "Physical Activity Observation Profile"
Description: "Profile for recording physical activity data from iOS Health App"

* status MS
* category 1..1 MS
* category = http://terminology.hl7.org/CodeSystem/observation-category#activity
* code 1..1 MS
* code from PhysicalActivityTypeVS (required)
* subject 1..1 MS
* subject only Reference(Patient)
* effectiveDateTime 1..1 MS
* device 0..1 MS
* value[x] only Quantity
* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component ^slicing.rules = #open

* component contains
    steps 0..1 MS and
    distance 0..1 MS and
    duration 0..1 MS and
    energy 0..1 MS

* component[steps].code = $LOINC#55423-8 "Number of steps in 24 hour Measured"
* component[steps].valueQuantity only Quantity
* component[steps].valueQuantity.system = $UCUM
* component[steps].valueQuantity.code = #1 "count"

* component[distance].code = $LOINC#55430-3 "Distance walked"
* component[distance].valueQuantity only Quantity
* component[distance].valueQuantity.system = $UCUM
* component[distance].valueQuantity.code = #km "kilometer"

* component[duration].code = $LOINC#55411-3 "Exercise duration"
* component[duration].valueQuantity only Quantity
* component[duration].valueQuantity.system = $UCUM
* component[duration].valueQuantity.code = #min "minute"

* component[energy].code = $LOINC#55424-6 "Energy expenditure"
* component[energy].valueQuantity only Quantity
* component[energy].valueQuantity.system = $UCUM
* component[energy].valueQuantity.code = #kcal "kilocalorie"



// ===== Conteúdo de: ReproductiveObservation.fsh =====

Profile: ReproductiveObservation
Parent: Observation
Id: reproductive-observation
Title: "Reproductive Health Base Profile"
Description: "Base profile for reproductive health observations"

* ^version = "1.0.0"
* ^status = #active
* ^date = "2024-03-19"
* ^publisher = "Health Level Seven International"

* status MS
* category 1..1 MS
* category = http://terminology.hl7.org/CodeSystem/observation-category#reproductive
* code 1..1 MS
* subject 1..1 MS
* subject only Reference(Patient)
* effectiveDateTime 1..1 MS
* value[x] MS

* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component ^slicing.rules = #open

* component contains
    severity 0..1 MS and
    duration 0..1 MS and
    frequency 0..1 MS and
    pattern 0..1 MS

* component[severity]
  * code = $LOINC#72514-3 "Pain severity score"
  * value[x] only integer
  * valueInteger ^minValue = 0
  * valueInteger ^maxValue = 10

* component[duration]
  * code = $LOINC#103332-8 "Duration"
  * value[x] only Quantity
  * valueQuantity from DurationUnitsVS (required)

* component[frequency]
  * code = $LOINC#103334-4 "Frequency"
  * value[x] only CodeableConcept
  * valueCodeableConcept from SymptomFrequencyVS (required)

* component[pattern]
  * code = $LOINC#103335-1 "Pattern"
  * value[x] only CodeableConcept
  * valueCodeableConcept from SymptomProgressionVS (required)

* note MS



// ===== Conteúdo de: SymptomProfiles.fsh =====

Profile: SymptomQuestionnaire
Parent: Questionnaire
Id: symptom-questionnaire
Title: "Symptom Assessment Questionnaire"
Description: "Questionnaire template for symptom assessments"

* status MS
* title MS
* item MS

* item ^slicing.discriminator.type = #pattern
* item ^slicing.discriminator.path = "linkId"
* item ^slicing.rules = #open

* item contains
    symptomType 1..1 MS and
    location 0..1 MS and
    onset 0..1 MS and
    description 0..1 MS

* item[symptomType]
  * linkId = "symptom-type"
  * text = "Type of Symptom"
  * type = #choice
  * required = true

* item[location]
  * linkId = "location"
  * text = "Location of Symptom"
  * type = #string

* item[onset]
  * linkId = "onset"
  * text = "Onset Date"
  * type = #dateTime

* item[description]
  * linkId = "description"
  * text = "Symptom Description"
  * type = #text

Profile: SymptomAssessment
Parent: ClinicalImpression
Id: symptom-assessment
Title: "Symptom Clinical Assessment"
Description: "Clinical assessment of reported symptoms"

* status MS
* subject 1..1 MS
* effectiveDateTime 1..1 MS
* finding MS

* finding ^slicing.discriminator.type = #pattern
* finding ^slicing.discriminator.path = "itemCodeableConcept"
* finding ^slicing.rules = #open

* finding contains
    severity 0..1 MS and
    pattern 0..1 MS and
    impact 0..1 MS

* finding[severity].itemCodeableConcept = $SCT#272141005 "Severity"
* finding[pattern].itemCodeableConcept = $SCT#410515003 "Pattern"
* finding[impact].itemCodeableConcept = $SCT#272127003 "Impact"

Invariant: symptom-severity-range
Description: "Severity score must be between 0 and 10"
Severity: #error
Expression: "component.where(code = %severity).value.as(Integer) >= 0 and component.where(code = %severity).value.as(Integer) <= 10"

Invariant: symptom-duration-valid
Description: "Duration must be a positive value"
Severity: #error
Expression: "component.where(code = %duration).value.as(Quantity) > 0"



// ===== Conteúdo de: ReproductiveProfiles.fsh =====

Profile: ReproductiveObservation
Parent: Observation
Id: reproductive-observation
Title: "Reproductive Health Base Profile"
Description: "Base profile for reproductive health observations"

* status MS
* category 1..1 MS
* category = http://terminology.hl7.org/CodeSystem/observation-category#reproductive
* subject 1..1 MS
* effectiveDateTime 1..1 MS
* value[x] MS

Profile: FertilityObservation
Parent: ReproductiveObservation
Id: fertility-observation
Title: "Fertility Observation Profile"
Description: "Profile for fertility signs and symptoms"

* code = $LOINC#8669-4 "Ovulation status"
* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component ^slicing.rules = #open

* component contains
    cervicalMucus 0..1 MS and
    ovulationTest 0..1 MS and
    fertilityStatus 0..1 MS

* component[cervicalMucus].code = $LOINC#8669-4 "Cervical mucus observation"
* component[cervicalMucus].valueCodeableConcept from CervicalMucusVS (required)

* component[ovulationTest].code = $LOINC#8670-2 "Ovulation test"
* component[ovulationTest].valueCodeableConcept from OvulationTestVS (required)

* component[fertilityStatus].code = $LOINC#8671-0 "Fertility status"
* component[fertilityStatus].valueCodeableConcept from FertilityStatusVS (required)

Profile: ReproductiveSymptomObservation
Parent: ReproductiveObservation
Id: reproductive-symptom-observation
Title: "Reproductive Symptom Observation Profile"
Description: "Profile for reproductive health symptoms"

* code from ReproductiveSymptomVS (required)
* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component ^slicing.rules = #open

* component contains
    severity 0..1 MS and
    duration 0..1 MS and
    impact 0..1 MS

* component[severity].code = $LOINC#72514-3 "Pain severity score"
* component[severity].valueInteger only integer
* component[severity].valueInteger ^minValue = 0
* component[severity].valueInteger ^maxValue = 10

* component[duration].code = $LOINC#103332-8 "Duration"
* component[duration].valueQuantity.system = $UCUM
* component[duration].valueQuantity.code = #h

Profile: MenstrualCycleObservation
Parent: ReproductiveObservation
Id: menstrual-cycle-observation
Title: "Menstrual Cycle Observation Profile"
Description: "Profile for menstrual cycle tracking"

* code = $LOINC#49033-4 "Menstrual cycle finding"
* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component ^slicing.rules = #open

* component contains
    cycleLength 0..1 MS and
    flowDuration 0..1 MS and
    flowIntensity 0..1 MS

* component[cycleLength].code = $LOINC#8708-0 "Menstrual cycle length"
* component[cycleLength].valueQuantity.system = $UCUM
* component[cycleLength].valueQuantity.code = #d

* component[flowDuration].code = $LOINC#49030-0 "Menstruation duration"
* component[flowDuration].valueQuantity.system = $UCUM
* component[flowDuration].valueQuantity.code = #d

* component[flowIntensity].code = FlowIntensityCS#moderate "Flow intensity"
* component[flowIntensity].valueCodeableConcept from FlowIntensityVS (required)

Profile: ReproductiveGoal
Parent: Goal
Id: reproductive-goal
Title: "Reproductive Health Goal Profile"
Description: "Profile for reproductive health goals and planning"

* lifecycleStatus MS
* category = http://terminology.hl7.org/CodeSystem/goal-category#reproductive
* description MS
* subject 1..1 MS
* target MS

* target.measure from http://example.org/fhir/ValueSet/reproductive-goal-measures (required)
* target.detail[x] only Quantity or CodeableConcept
* target.due[x] only date or Duration

Profile: ReproductiveCyclePlan
Parent: CarePlan
Id: reproductive-cycle-plan
Title: "Reproductive Cycle Plan Profile"
Description: "Profile for reproductive cycle planning and tracking"

* status MS
* intent MS
* subject 1..1 MS
* period MS
* activity MS

* activity.detail.kind = #observation
* activity.detail.code from http://example.org/fhir/ValueSet/reproductive-activity (required)
* activity.detail.status MS
* activity.detail.scheduledTiming MS



// ===== Conteúdo de: MindfulnessProfiles.fsh =====

Profile: MindfulnessObservation
Parent: Observation
Id: mindfulness-observation
Title: "Mindfulness Session Observation"
Description: "Profile for recording mindfulness practice sessions and outcomes"

* status MS
* code MS
* subject MS
* effectiveDateTime MS
* performer MS
* value[x] MS
* component MS

* status = #final
* code = $SCT#711020003 "Meditation"
* subject only Reference(Patient)
* effectiveDateTime 1..1
* performer only Reference(Practitioner or PractitionerRole)

* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component ^slicing.rules = #open

* component contains
    sessionDuration 0..1 and
    stressLevel 0..1 and
    moodState 0..1 and
    relaxationResponse 0..1 and
    mindfulnessType 0..1

* component[sessionDuration]
  * code = $SCT#118682006 "Duration"
  * value[x] only Quantity
  * valueQuantity
    * value 1..1
    * unit = "min"
    * system = "http://unitsofmeasure.org"
    * code = #min

* component[stressLevel]
  * code = $SCT#725854004 "Assessment of stress level"
  * value[x] only integer
  * valueInteger
    * ^extension[0].url = "http://hl7.org/fhir/StructureDefinition/elementdefinition-minValueInteger"
    * ^extension[0].valueInteger = 0
    * ^extension[1].url = "http://hl7.org/fhir/StructureDefinition/elementdefinition-maxValueInteger"
    * ^extension[1].valueInteger = 10

* component[moodState]
  * code = $SCT#373931001 "Mood finding"
  * value[x] only CodeableConcept
  * valueCodeableConcept from MoodValueSet (required)

* component[relaxationResponse]
  * code = $SCT#276241001 "Relaxation technique"
  * value[x] only string

* component[mindfulnessType]
  * code = $SCT#711020003 "Meditation"
  * value[x] only CodeableConcept
  * valueCodeableConcept from http://example.org/ValueSet/mindfulness-type (required)



// ===== Conteúdo de: SleepProfile.fsh =====

Alias: $SCT = http://snomed.info/sct
Alias: $LOINC = http://loinc.org
Alias: $UCUM = http://unitsofmeasure.org
 
Profile: SleepObservation
Parent: Observation
Id: sleep-observation
Title: "Sleep Observation Profile"
Description: "Profile for recording sleep data from iOS Health App"
 
* status MS
* category 1..1 MS
* category = http://terminology.hl7.org/CodeSystem/observation-category#sleep
* code 1..1 MS
* code = $LOINC#93832-4 "Sleep pattern panel"
* subject 1..1 MS
* subject only Reference(Patient)
* effectiveDateTime 0..1 MS
* effectivePeriod 0..1 MS
* device 0..1 MS
 
* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component ^slicing.rules = #open
 
* component contains
    timeInBed 1..1 MS and
    totalSleepTime 1..1 MS and
    deepSleep 0..1 MS and
    remSleep 0..1 MS and
    lightSleep 0..1 MS and
    respiratoryRate 0..1 MS and
    heartRateVariability 0..1 MS and
    interruptions 0..1 MS
 
* component[timeInBed].code = $LOINC#93831-6 "Time in bed"
* component[timeInBed].valueQuantity only Quantity
* component[timeInBed].valueQuantity.system = $UCUM
* component[timeInBed].valueQuantity.code = #min
 
* component[totalSleepTime].code = $LOINC#93833-2 "Sleep duration"
* component[totalSleepTime].valueQuantity only Quantity
* component[totalSleepTime].valueQuantity.system = $UCUM
* component[totalSleepTime].valueQuantity.code = #min
 
* component[deepSleep].code = $LOINC#93834-0 "Deep sleep duration"
* component[deepSleep].valueQuantity only Quantity
* component[deepSleep].valueQuantity.system = $UCUM
* component[deepSleep].valueQuantity.code = #min
 
* component[remSleep].code = $LOINC#93835-7 "REM sleep duration"
* component[remSleep].valueQuantity only Quantity
* component[remSleep].valueQuantity.system = $UCUM
* component[remSleep].valueQuantity.code = #min
 
* component[lightSleep].code = $LOINC#93836-5 "Light sleep duration"
* component[lightSleep].valueQuantity only Quantity
* component[lightSleep].valueQuantity.system = $UCUM
* component[lightSleep].valueQuantity.code = #min
 
* component[respiratoryRate].code = $LOINC#9279-1 "Respiratory rate"
* component[respiratoryRate].valueQuantity only Quantity
* component[respiratoryRate].valueQuantity.system = $UCUM
* component[respiratoryRate].valueQuantity.code = #/min
 
* component[heartRateVariability].code = $LOINC#80404-7 "R-R interval.standard deviation (Heart rate variability)"
* component[heartRateVariability].valueQuantity only Quantity
* component[heartRateVariability].valueQuantity.system = $UCUM
* component[heartRateVariability].valueQuantity.code = #ms
 
* component[interruptions].code = $LOINC#93837-3 "Number of awakenings during sleep"
* component[interruptions].valueQuantity only Quantity
* component[interruptions].valueQuantity.system = $UCUM
* component[interruptions].valueQuantity.code = #{count}
* extension contains SleepQuality named quality 0..1



// ===== Conteúdo de: MobilityRiskAssessment.fsh =====

Profile: MobilityRiskAssessment
Parent: RiskAssessment
Id: mobility-risk-assessment
Title: "Mobility Risk Assessment Profile"
Description: "Profile for assessing mobility-related risks"

* status MS
* subject 1..1 MS
* occurrence[x] MS
* prediction MS
  * outcome MS
  * probability[x] MS
  * qualitativeRisk MS

* method MS
  * coding ^slicing.discriminator.type = #pattern
  * coding ^slicing.discriminator.path = "$this"
  * coding ^slicing.rules = #open
  * coding contains
      mobilityAssessment 1..1 MS

* method.coding[mobilityAssessment] = http://example.org/CodeSystem/mobility-assessment-method#standardized "Standardized Mobility Assessment"

* prediction ^slicing.discriminator.type = #pattern
* prediction ^slicing.discriminator.path = "outcome"
* prediction ^slicing.rules = #open

* prediction contains
    fallRisk 0..1 MS and
    mobilityDecline 0..1 MS and
    assistanceNeeded 0..1 MS

* prediction[fallRisk].outcome from http://example.org/ValueSet/fall-risk-outcomes
* prediction[fallRisk].probabilityDecimal 0..1 MS
* prediction[fallRisk].qualitativeRisk from http://example.org/ValueSet/risk-level

* prediction[mobilityDecline].outcome from http://example.org/ValueSet/mobility-decline-outcomes
* prediction[mobilityDecline].probabilityDecimal 0..1 MS
* prediction[mobilityDecline].qualitativeRisk from http://example.org/ValueSet/risk-level

* prediction[assistanceNeeded].outcome from http://example.org/ValueSet/assistance-level-outcomes
* prediction[assistanceNeeded].probabilityDecimal 0..1 MS
* prediction[assistanceNeeded].qualitativeRisk from http://example.org/ValueSet/risk-level

* basis only Reference(MobilityProfile or Observation or QuestionnaireResponse)
* basis MS

* note MS



// ===== Conteúdo de: EnvironmentalProfiles.fsh =====

Alias: $SCT = http://snomed.info/sct
Alias: $LOINC = http://loinc.org
Alias: $UCUM = http://unitsofmeasure.org

Profile: EnvironmentalObservation
Parent: Observation
Id: environmental-observation
Title: "Environmental Observation Profile"
Description: "Base profile for environmental measurements from iOS Health App"

* ^version = "0.1.0"
* ^status = #draft
* ^publisher = "HL7 International"
* ^contact.name = "Environmental Health Working Group"

* status MS
* category 1..1 MS
* category = http://terminology.hl7.org/CodeSystem/observation-category#environment
* subject 1..1 MS
* effectiveDateTime 1..1 MS
* device 0..1 MS
* method 0..1 MS
* note 0..* MS

Profile: NoiseExposureObservation
Parent: EnvironmentalObservation
Id: noise-exposure-observation
Title: "Noise Exposure Observation Profile"
Description: "Profile for noise exposure measurements from iOS Health App"

* code = $LOINC#28573-7 "Noise exposure time"
* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component ^slicing.rules = #open
* component ^short = "Noise exposure components"
* component ^definition = "Components of noise exposure measurement"

* component contains
    level 1..1 MS and
    duration 1..1 MS and
    peakLevel 0..1 MS and
    backgroundNoise 0..1 MS

* component[level].code = $LOINC#89020-2 "Environmental noise average"
* component[level].valueQuantity.system = $UCUM
* component[level].valueQuantity.code = #dB
* component[level].valueQuantity ^short = "Noise level in decibels"

* component[duration].code = $LOINC#89021-0 "Environmental noise duration"
* component[duration].valueQuantity.system = $UCUM
* component[duration].valueQuantity.code = #min
* component[duration].valueQuantity ^short = "Duration of exposure"

* component[peakLevel].code = $LOINC#89024-4 "Peak sound level"
* component[peakLevel].valueQuantity.system = $UCUM
* component[peakLevel].valueQuantity.code = #dB
* component[peakLevel].valueQuantity ^short = "Peak noise level"

* component[backgroundNoise].code = $LOINC#89025-1 "Background noise level"
* component[backgroundNoise].valueQuantity.system = $UCUM
* component[backgroundNoise].valueQuantity.code = #dB
* component[backgroundNoise].valueQuantity ^short = "Background noise level"

Profile: UVExposureObservation
Parent: EnvironmentalObservation
Id: uv-exposure-observation
Title: "UV Exposure Observation Profile"
Description: "Profile for UV exposure measurements from iOS Health App"

* code = $LOINC#28574-5 "UV exposure"
* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component ^slicing.rules = #open
* component ^short = "UV exposure components"
* component ^definition = "Components of UV exposure measurement"

* component contains
    index 1..1 MS and
    duration 1..1 MS and
    timeOfDay 0..1 MS and
    intensity 0..1 MS

* component[index].code = $LOINC#89022-8 "UV index"
* component[index].valueQuantity.system = $UCUM
* component[index].valueQuantity.code = #{index}
* component[index].valueQuantity ^short = "UV index value"

* component[duration].code = $LOINC#89023-6 "UV exposure duration"
* component[duration].valueQuantity.system = $UCUM
* component[duration].valueQuantity.code = #min
* component[duration].valueQuantity ^short = "Duration of UV exposure"

* component[timeOfDay].code = $LOINC#89026-9 "Time of exposure"
* component[timeOfDay].valueDateTime 1..1
* component[timeOfDay].valueDateTime ^short = "Time of UV exposure"

* component[intensity].code = $LOINC#89027-7 "UV intensity"
* component[intensity].valueQuantity.system = $UCUM
* component[intensity].valueQuantity.code = #W/m2
* component[intensity].valueQuantity ^short = "UV radiation intensity"

Extension: EnvironmentalContext
Id: environmental-context
Title: "Environmental Context Extension"
Description: "Additional context about environmental measurements"

* value[x] only CodeableConcept
* valueCodeableConcept from http://example.org/fhir/ValueSet/environmental-context (required)



// ===== Conteúdo de: NutritionProfiles.fsh =====

Alias: $SCT = http://snomed.info/sct
Alias: $LOINC = http://loinc.org
Alias: $UCUM = http://unitsofmeasure.org

Profile: NutritionIntakeObservation
Parent: Observation
Id: nutrition-intake-observation
Title: "Nutrition Intake Observation Profile"
Description: "Profile for nutrition intake data from iOS Health App and user input"

* ^version = "0.1.0"
* ^status = #draft
* ^publisher = "Ricardo Lourenço dos Santos"

* status MS
* category 1..1 MS
* category = http://terminology.hl7.org/CodeSystem/observation-category#nutrition
* subject 1..1 MS
* effectiveDateTime 1..1 MS
* code 1..1 MS
* method 0..1 MS

Profile: WaterIntakeObservation
Parent: NutritionIntakeObservation 
Id: water-intake-observation
Title: "Water Intake Observation Profile"
Description: "Profile for water intake measurements"

* ^version = "0.1.0"
* ^status = #draft
* ^publisher = "Ricardo Lourenço dos Santos"

* code = $LOINC#77111-4 "Water intake"
* valueQuantity only Quantity
* valueQuantity.system = $UCUM
* valueQuantity.code = #mL
* valueQuantity.unit = "milliliter"

Profile: CalorieIntakeObservation
Parent: NutritionIntakeObservation
Id: calorie-intake-observation
Title: "Calorie Intake Observation Profile"
Description: "Profile for caloric intake measurements"

* ^version = "0.1.0"
* ^status = #draft
* ^publisher = "Ricardo Lourenço dos Santos"

* code = $LOINC#9051-4 "Caloric intake total"
* valueQuantity only Quantity
* valueQuantity.system = $UCUM
* valueQuantity.code = #kcal
* valueQuantity.unit = "kilocalorie"

Profile: MacronutrientsObservation
Parent: NutritionIntakeObservation
Id: macronutrients-observation
Title: "Macronutrients Observation Profile"
Description: "Profile for macronutrient intake measurements"

* ^version = "0.1.0"
* ^status = #draft
* ^publisher = "Ricardo Lourenço dos Santos"

* code = $LOINC#LP199119-9 "Macronutrients panel"
* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component ^slicing.rules = #open

* component contains
    carbohydrates 0..1 MS and
    proteins 0..1 MS and
    fats 0..1 MS

* component[carbohydrates].code = $LOINC#LP35925-4 "Carbohydrates"
* component[carbohydrates].valueQuantity.system = $UCUM
* component[carbohydrates].valueQuantity.code = #g
* component[carbohydrates].valueQuantity.unit = "gram"

* component[proteins].code = $LOINC#LP35921-3 "Proteins" 
* component[proteins].valueQuantity.system = $UCUM
* component[proteins].valueQuantity.code = #g
* component[proteins].valueQuantity.unit = "gram"

* component[fats].code = $LOINC#LP35922-1 "Fats"
* component[fats].valueQuantity.system = $UCUM
* component[fats].valueQuantity.code = #g
* component[fats].valueQuantity.unit = "gram"



// ===== Conteúdo de: MindfulnessMessaging.fsh =====

Alias: $MsgEvents = http://example.org/fhir/CodeSystem/mindfulness-message-events
Alias: $MsgTypes = http://terminology.hl7.org/CodeSystem/message-type

Profile: MindfulnessMessageDefinition
Parent: MessageDefinition
Id: mindfulness-message-definition
Title: "Mindfulness Message Definition" 
Description: "Definition for mindfulness session messages"

* url 1..1 MS
* date 1..1 MS
* status 1..1 MS
* event[x] 1..1 MS
* category 0..1 MS
* focus 1..* MS
* focus.min 1..1

Instance: StartSessionMessage
InstanceOf: MindfulnessMessageDefinition
Title: "Start Session Message"
Description: "Message definition for starting a mindfulness session"

* url = "http://example.org/fhir/MessageDefinition/start-session"
* date = "2024-03-19"
* status = #active
* eventCoding = $MsgEvents#session-start "Session Start"
* category = #notification
* focus.code = #Observation
* focus.min = 1
* focus.profile = "http://example.org/fhir/StructureDefinition/mindfulness-session"

Instance: EndSessionMessage  
InstanceOf: MindfulnessMessageDefinition
Title: "End Session Message"
Description: "Message definition for ending a mindfulness session"

* url = "http://example.org/fhir/MessageDefinition/end-session"
* date = "2024-03-19"
* status = #active
* eventCoding = $MsgEvents#session-end "Session End"
* category = #notification
* focus.code = #Observation
* focus.min = 1
* focus.profile = "http://example.org/fhir/StructureDefinition/mindfulness-session"



// ===== Conteúdo de: MindfulnessReports.fsh =====

Instance: MindfulnessProgressReport
InstanceOf: Measure
Usage: #definition
Title: "Mindfulness Practice Progress Report"

* status = #active
* experimental = false
* date = "2024-03-19"
* publisher = "Example Organization"
* description = "Measures progress in mindfulness practice over time"

* scoring = #continuous-variable
* type = #process
* riskAdjustment = "none"
* rateAggregation = "Average values over time period"

* group[0]
  * code = #practice-frequency
  * description = "Frequency of mindfulness practice"
  * population[0]
    * code = #denominator
    * criteria.language = #text/fhirpath
    * criteria.expression = "Observation.where(code.coding.code='711020003')"
  * stratifier[0]
    * code = #weekly
    * criteria.language = #text/fhirpath
    * criteria.expression = "Observation.effective.as(DateTime).truncate(@T).truncate(@W)"

* group[1]
  * code = #stress-reduction
  * description = "Stress level changes over time"
  * population[0]
    * code = #denominator
    * criteria.language = #text/fhirpath
    * criteria.expression = "Observation.where(component.code.coding.code='725854004')"
  * stratifier[0]
    * code = #trend
    * criteria.language = #text/fhirpath
    * criteria.expression = "component.where(code.coding.code='725854004').value.value"

RuleSet: ReportingMetrics
* group[+]
  * code = #session-duration
  * description = "Duration of practice sessions"
  * population[0]
    * code = #denominator
    * criteria.language = #text/fhirpath
    * criteria.expression = "Observation.component.where(code.coding.code='118682006')"
  * stratifier[0]
    * code = #average
    * criteria.language = #text/fhirpath
    * criteria.expression = "component.where(code.coding.code='118682006').value.value"

* group[+]
  * code = #mood-changes
  * description = "Mood state changes"
  * population[0]
    * code = #denominator
    * criteria.language = #text/fhirpath
    * criteria.expression = "Observation.component.where(code.coding.code='373931001')"


