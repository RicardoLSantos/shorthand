
// ===== Conteúdo de: sop-privacy-security.md =====

# SOP-003: Políticas de Privacidade e Segurança de Dados em Saúde
**Standard Operating Procedure para Conformidade com LGPD, GDPR e HIPAA em Implementation Guides FHIR**

## 1. INTRODUÇÃO

### 1.1 Objetivo
Este documento estabelece as diretrizes e procedimentos para garantir a conformidade com as principais regulamentações de proteção de dados em saúde ao desenvolver Implementation Guides FHIR, incluindo LGPD (Brasil), GDPR (União Europeia) e HIPAA (Estados Unidos).

### 1.2 Escopo
Aplica-se a todos os aspectos de privacidade, segurança e proteção de dados em projetos de interoperabilidade FHIR, incluindo design, implementação, testes e operação.

### 1.3 Regulamentações Base
- **LGPD**: Lei Geral de Proteção de Dados (Lei nº 13.709/2018)¹
- **GDPR**: General Data Protection Regulation (EU 2016/679)²
- **HIPAA**: Health Insurance Portability and Accountability Act³
- **ISO/IEC 27001**: Information Security Management⁴
- **ISO/IEC 27799**: Health informatics security management⁵

## 2. PRINCÍPIOS FUNDAMENTAIS

### 2.1 Princípios Comuns às Três Regulamentações

#### 2.1.1 Minimização de Dados
Coletar apenas dados necessários para finalidade específica:

```fsh
Profile: MinimalPatientProfile
Parent: Patient
Description: "Perfil com dados mínimos necessários"
* identifier 1..1 MS  // Apenas identificador obrigatório
* name.given 0..1 MS  // Nome opcional
* name.family 1..1 MS
* birthDate 0..1 MS
* gender 0..1
// Elementos sensíveis marcados como proibidos
* maritalStatus 0..0
* photo 0..0
* contact 0..0
```

#### 2.1.2 Finalidade e Transparência
Documentar claramente o propósito do processamento:

```fsh
Extension: DataProcessingPurpose
Id: data-processing-purpose
Title: "Finalidade do Processamento"
Description: "Documenta a finalidade legal do processamento de dados"
* value[x] only CodeableConcept
* valueCodeableConcept from DataPurposeVS (required)

ValueSet: DataPurposeVS
* #treatment "Tratamento médico"
* #research "Pesquisa científica"
* #public-health "Saúde pública"
* #billing "Faturamento"
```

#### 2.1.3 Segurança por Design (Security by Design)
```fsh
Profile: SecureObservation
Parent: Observation
* meta.security 1..* MS
* meta.security from SecurityLabelsVS (required)
* text 0..0  // Proibir narrativa para evitar vazamento
* note 0..0  // Proibir anotações livres
```

## 3. LGPD - LEI GERAL DE PROTEÇÃO DE DADOS (BRASIL)

### 3.1 Requisitos Específicos LGPD⁶

#### 3.1.1 Bases Legais para Tratamento
```fsh
Extension: LGPDLegalBasis
Id: lgpd-legal-basis
Title: "Base Legal LGPD"
Context: Consent, Contract
* extension contains
    basis 1..1 MS and
    article 0..1 MS
* extension[basis].value[x] only code
* extension[basis].valueCode from LGPDLegalBasisVS (required)
* extension[article].value[x] only string

ValueSet: LGPDLegalBasisVS
* #consent "Consentimento do titular (Art. 7º, I)"
* #vital-interest "Proteção da vida (Art. 7º, II)"
* #legal-obligation "Obrigação legal (Art. 7º, II)"
* #public-health "Tutela da saúde (Art. 7º, VIII)"
* #legitimate-interest "Interesse legítimo (Art. 7º, IX)"
* #research "Pesquisa (Art. 7º, IV)"
```

#### 3.1.2 Dados Sensíveis de Saúde
```fsh
Profile: LGPDSensitiveData
Parent: Basic
* code = #sensitive-health-data
* extension contains
    DataCategory named category 1..1 MS and
    SpecialProtection named protection 0..* MS
* extension[category].valueCode from SensitiveDataCategoryVS
* extension[protection].valueString 1..1

ValueSet: SensitiveDataCategoryVS
* #genetic "Dados genéticos"
* #biometric "Dados biométricos"  
* #health "Dados de saúde"
* #sexual "Vida sexual"
* #religious "Convicção religiosa"
* #racial "Origem racial ou étnica"
```

#### 3.1.3 Direitos do Titular⁷
```fsh
CapabilityStatement: LGPDDataSubjectRights
* rest.resource[0].type = #Patient
* rest.resource[0].interaction[0].code = #read  // Acesso
* rest.resource[0].interaction[1].code = #update  // Correção
* rest.resource[0].interaction[2].code = #delete  // Eliminação
* rest.resource[0].operation[0].name = "portability"
* rest.resource[0].operation[0].definition = "OperationDefinition/data-portability"
* rest.resource[0].operation[1].name = "anonymize"
* rest.resource[0].operation[1].definition = "OperationDefinition/anonymize"
```

#### 3.1.4 Relatório de Impacto (RIPD)⁸
```yaml
# Template RIPD para IG FHIR
ripd:
  projeto: "Implementation Guide XYZ"
  controlador: "Organização ABC"
  encarregado_dpo: "nome@organizacao.com"
  
  dados_tratados:
    - tipo: "Dados de identificação"
      categoria: "Pessoais"
      volume_estimado: "10000 registros/mês"
    - tipo: "Dados clínicos"
      categoria: "Sensíveis"
      volume_estimado: "50000 registros/mês"
      
  finalidades:
    - "Continuidade do cuidado"
    - "Gestão hospitalar"
    
  medidas_seguranca:
    - "Criptografia AES-256"
    - "Controle de acesso baseado em papéis"
    - "Auditoria completa"
    
  riscos_identificados:
    - risco: "Vazamento de dados"
      probabilidade: "Baixa"
      impacto: "Alto"
      mitigacao: "Criptografia e monitoramento"
```

### 3.2 Implementação LGPD em FHIR

#### 3.2.1 Consentimento LGPD
```fsh
Profile: LGPDConsent
Parent: Consent
* status = #active
* scope = http://terminology.hl7.org/CodeSystem/consentscope#patient-privacy
* category = http://loinc.org#59284-0 "Consent Document"
* patient 1..1 MS
* dateTime 1..1 MS
* policy.uri 1..1 MS  // Link para política de privacidade
* provision.type 1..1
* provision.period 1..1  // Período de validade
* provision.data.meaning 1..1
* provision.data.reference 1..1  // Recursos cobertos
* sourceReference 1..1  // Documento de consentimento
```

## 4. GDPR - GENERAL DATA PROTECTION REGULATION (EU)

### 4.1 Requisitos Específicos GDPR⁹

#### 4.1.1 Lawful Basis (Base Legal)
```fsh
Extension: GDPRLawfulBasis
Id: gdpr-lawful-basis
Title: "Base Legal GDPR"
* value[x] only CodeableConcept
* valueCodeableConcept from GDPRLawfulBasisVS (required)

ValueSet: GDPRLawfulBasisVS
* #consent "Consent (Article 6(1)(a))"
* #contract "Contract (Article 6(1)(b))"
* #legal-obligation "Legal obligation (Article 6(1)(c))"
* #vital-interests "Vital interests (Article 6(1)(d))"
* #public-task "Public task (Article 6(1)(e))"
* #legitimate-interests "Legitimate interests (Article 6(1)(f))"
* #special-category "Special category - health (Article 9)"
```

#### 4.1.2 Data Protection by Design¹⁰
```fsh
Profile: GDPRCompliantResource
Abstract: true
* meta.security 1..* MS
* meta.security contains
    confidentiality 1..1 MS and
    dataController 0..1 MS and
    dataProcessor 0..* MS
* meta.tag contains
    pseudonymized 0..1 MS and
    encrypted 0..1 MS
    
// Aplicar a todos os recursos
Profile: GDPRPatient
Parent: Patient
Mixins: GDPRCompliantResource
```

#### 4.1.3 Right to Erasure (Direito ao Esquecimento)¹¹
```fsh
OperationDefinition: ErasePersonalData
* url = "http://example.org/fhir/OperationDefinition/erase"
* name = "ErasePersonalData"
* title = "GDPR Right to Erasure"
* status = #active
* kind = #operation
* code = #erase
* resource = #Patient
* system = false
* type = false
* instance = true
* parameter[0].name = #confirmation
* parameter[0].use = #in
* parameter[0].min = 1
* parameter[0].max = "1"
* parameter[0].type = #string
* parameter[1].name = #result
* parameter[1].use = #out
* parameter[1].min = 1
* parameter[1].max = "1"
* parameter[1].type = #OperationOutcome
```

#### 4.1.4 Data Portability¹²
```fsh
OperationDefinition: ExportPersonalData
* url = "http://example.org/fhir/OperationDefinition/export-personal-data"
* name = "ExportPersonalData"
* title = "GDPR Data Portability"
* status = #active
* kind = #operation
* code = #export
* resource = #Patient
* parameter[0].name = #format
* parameter[0].use = #in
* parameter[0].type = #code
* parameter[0].binding.strength = #required
* parameter[0].binding.valueSet = "http://hl7.org/fhir/ValueSet/mimetypes"
```

### 4.2 Privacy by Default¹³
```fsh
Profile: PrivacyByDefaultPatient
Parent: Patient
* name.use = #anonymous  // Default para anônimo
* birthDate.extension contains DataAccuracy named accuracy 0..1
* address.use = #temp  // Endereço temporário por padrão
* telecom 0..0  // Sem contato por padrão
* photo 0..0  // Sem foto por padrão
```

## 5. HIPAA - HEALTH INSURANCE PORTABILITY AND ACCOUNTABILITY ACT (USA)

### 5.1 Requisitos HIPAA¹⁴

#### 5.1.1 Protected Health Information (PHI)
```fsh
Profile: HIPAAProtectedResource
Abstract: true
* meta.security contains
    phi 1..1 MS and
    accessControl 1..* MS
* meta.security[phi] = http://terminology.hl7.org/CodeSystem/v3-Confidentiality#R "Restricted"
* meta.tag contains
    hipaaCovered 1..1 MS

CodeSystem: PHIIdentifiers
* #name "Names"
* #geographic "Geographic identifiers"
* #dates "Dates related to individual"
* #phone "Phone numbers"
* #fax "Fax numbers"
* #email "Email addresses"
* #ssn "Social Security numbers"
* #mrn "Medical record numbers"
* #health-plan "Health plan numbers"
* #account "Account numbers"
* #license "License numbers"
* #vehicle "Vehicle identifiers"
* #device "Device identifiers"
* #url "URLs"
* #ip "IP addresses"
* #biometric "Biometric identifiers"
* #photo "Photos"
* #other "Other identifying information"
```

#### 5.1.2 Minimum Necessary Standard¹⁵
```fsh
Profile: MinimumNecessaryBundle
Parent: Bundle
* type = #collection
* entry.resource obeys minimum-necessary-rule
* entry.search.mode = #match
* entry.search.score 0..0  // Remover scores desnecessários

Invariant: minimum-necessary-rule
Description: "Only include necessary data elements"
Expression: "resource.meta.tag.where(system='http://hipaa.org/minimum-necessary').exists()"
Severity: #error
```

#### 5.1.3 De-identification Safe Harbor¹⁶
```fsh
OperationDefinition: DeIdentifySafeHarbor
* url = "http://example.org/fhir/OperationDefinition/deidentify"
* name = "DeIdentify"
* title = "HIPAA Safe Harbor De-identification"
* parameter[0].name = #method
* parameter[0].use = #in
* parameter[0].type = #code
* parameter[0].binding.valueSet = "http://example.org/ValueSet/deidentification-methods"

ValueSet: DeidentificationMethods
* #safe-harbor "Safe Harbor (Remove 18 identifiers)"
* #expert-determination "Expert Determination"
* #limited-dataset "Limited Data Set"
```

### 5.2 Security Rule Requirements¹⁷

#### 5.2.1 Access Controls
```fsh
CapabilityStatement: HIPAAAccessControl
* rest.security.service = http://terminology.hl7.org/CodeSystem/restful-security-service#OAuth
* rest.security.description = "OAuth2 with SMART on FHIR"
* rest.resource.interaction.extension contains
    AccessControl named access 1..1 MS
    
Extension: AccessControl
* value[x] only CodeableConcept
* valueCodeableConcept from HIPAAAccessLevelVS

ValueSet: HIPAAAccessLevelVS
* #provider "Healthcare Provider"
* #payer "Insurance Payer"
* #patient "Patient Access"
* #emergency "Emergency Access"
* #admin "Administrative"
```

#### 5.2.2 Audit Logging¹⁸
```fsh
Profile: HIAAAAuditEvent
Parent: AuditEvent
* type 1..1 MS
* subtype 1..* MS
* action 1..1 MS
* period 1..1 MS
* outcome 1..1 MS
* outcomeDesc 0..1 MS
* agent 1..* MS
* agent.who 1..1 MS
* agent.requestor 1..1 MS
* source 1..1 MS
* entity 1..* MS
* entity.what 1..1 MS
* entity.role 1..1 MS
```

## 6. IMPLEMENTAÇÃO TÉCNICA DE SEGURANÇA

### 6.1 Criptografia¹⁹

#### 6.1.1 Em Trânsito
```yaml
# Configuração TLS mínima
security:
  tls:
    minimum_version: "1.2"
    preferred_version: "1.3"
    cipher_suites:
      - "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
      - "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"
    certificate:
      type: "X.509"
      key_size: 2048
```

#### 6.1.2 Em Repouso
```fsh
Extension: EncryptionMethod
Id: encryption-method
* value[x] only CodeableConcept
* valueCodeableConcept from EncryptionMethodVS

ValueSet: EncryptionMethodVS
* #AES256 "AES 256-bit"
* #AES128 "AES 128-bit"
* #RSA2048 "RSA 2048-bit"
* #RSA4096 "RSA 4096-bit"
```

### 6.2 Controle de Acesso (RBAC/ABAC)²⁰

#### 6.2.1 Role-Based Access Control
```fsh
CodeSystem: SecurityRoles
* #physician "Physician"
* #nurse "Nurse"
* #admin "Administrator"
* #patient "Patient"
* #emergency "Emergency Personnel"

Profile: RBACPractitioner
Parent: Practitioner
* extension contains SecurityRole named role 1..* MS
* extension[role].valueCodeableConcept from SecurityRolesVS
```

#### 6.2.2 Attribute-Based Access Control
```fsh
Extension: ABACPolicy
* extension contains
    resource 1..1 MS and
    action 1..* MS and
    condition 0..* MS and
    obligation 0..* MS
* extension[resource].value[x] only Reference
* extension[action].value[x] only code
* extension[condition].value[x] only Expression
```

### 6.3 Anonimização e Pseudonimização²¹

#### 6.3.1 Técnicas de Anonimização
```javascript
// Função de anonimização
function anonymizePatient(patient) {
  return {
    ...patient,
    identifier: generatePseudonym(patient.identifier),
    name: [{use: "anonymous"}],
    birthDate: generalizeDate(patient.birthDate),
    address: generalizeAddress(patient.address),
    telecom: [],
    photo: [],
    contact: []
  };
}

// Generalização de data
function generalizeDate(date) {
  const year = new Date(date).getFullYear();
  return `${year}-01-01`; // Apenas ano
}

// Generalização de endereço
function generalizeAddress(address) {
  return address.map(addr => ({
    ...addr,
    line: [],
    text: undefined,
    postalCode: addr.postalCode?.substring(0, 3) + "00"
  }));
}
```

#### 6.3.2 Pseudonimização Reversível
```fsh
Profile: PseudonymizedPatient
Parent: Patient
* identifier.system = "http://example.org/pseudonym"
* identifier.value 1..1 MS
* identifier.extension contains
    PseudonymMapping named mapping 0..1 MS
* name.given 0..0
* name.family = "PSEUDONYMIZED"
* birthDate.extension contains
    DatePrecision named precision 0..1 MS

Extension: PseudonymMapping
Id: pseudonym-mapping
* value[x] only Identifier
* valueIdentifier.system = "http://example.org/mapping-key"
```

### 6.4 Auditoria e Monitoramento²²

#### 6.4.1 Padrão de Auditoria FHIR
```fsh
Profile: ComprehensiveAuditEvent
Parent: AuditEvent
* type from http://terminology.hl7.org/ValueSet/audit-event-type (required)
* subtype 1..* MS
* action 1..1 MS
* period.start 1..1 MS
* period.end 1..1 MS
* outcome 1..1 MS
* agent ^slicing.discriminator.type = #pattern
* agent ^slicing.discriminator.path = "type"
* agent contains
    user 1..1 MS and
    system 0..1 MS
* agent[user].who.identifier 1..1 MS
* agent[user].requestor = true
* agent[system].who.identifier 1..1 MS
* agent[system].requestor = false
* source.observer 1..1 MS
* entity 1..* MS
* entity.what 1..1 MS
* entity.securityLabel 0..* MS
```

#### 6.4.2 Eventos de Auditoria Obrigatórios
```fsh
ValueSet: MandatoryAuditEvents
* #C "Create"
* #R "Read/View"
* #U "Update"
* #D "Delete"
* #E "Execute"
* http://dicom.nema.org/resources/ontology/DCM#110100 "Application Activity"
* http://dicom.nema.org/resources/ontology/DCM#110101 "Audit Log Used"
* http://dicom.nema.org/resources/ontology/DCM#110102 "Begin Transferring DICOM Instances"
* http://dicom.nema.org/resources/ontology/DCM#110103 "DICOM Instances Accessed"
* http://dicom.nema.org/resources/ontology/DCM#110104 "DICOM Instances Transferred"
* http://dicom.nema.org/resources/ontology/DCM#110105 "DICOM Study Deleted"
* http://dicom.nema.org/resources/ontology/DCM#110106 "Export"
* http://dicom.nema.org/resources/ontology/DCM#110107 "Import"
* http://dicom.nema.org/resources/ontology/DCM#110108 "Network Entry"
* http://dicom.nema.org/resources/ontology/DCM#110109 "Order Record"
* http://dicom.nema.org/resources/ontology/DCM#110110 "Patient Record"
* http://dicom.nema.org/resources/ontology/DCM#110111 "Procedure Record"
* http://dicom.nema.org/resources/ontology/DCM#110112 "Query"
* http://dicom.nema.org/resources/ontology/DCM#110113 "Security Alert"
* http://dicom.nema.org/resources/ontology/DCM#110114 "User Authentication"
```

## 7. CONSENTIMENTO E GESTÃO DE PREFERÊNCIAS

### 7.1 Modelo Unificado de Consentimento²³
```fsh
Profile: UnifiedConsent
Parent: Consent
* status 1..1 MS
* scope 1..1 MS
* category 1..* MS
* patient 1..1 MS
* dateTime 1..1 MS
* performer 1..1 MS
* organization 1..* MS
* source[x] 1..1 MS
* policy 1..* MS
* policy.authority 0..1 MS
* policy.uri 1..1 MS
* verification 0..* MS
* provision 1..1 MS
* provision.type 1..1 MS
* provision.period 0..1 MS
* provision.actor 0..* MS
* provision.action 0..* MS
* provision.securityLabel 0..* MS
* provision.purpose 0..* MS
* provision.class 0..* MS
* provision.code 0..* MS
* provision.dataPeriod 0..1 MS
* provision.data 0..* MS
* provision.provision 0..* MS

// Extensões para regulamentações específicas
* extension contains
    LGPDCompliance named lgpd 0..1 MS and
    GDPRCompliance named gdpr 0..1 MS and
    HIPAACompliance named hipaa 0..1 MS
```

### 7.2 Granularidade de Consentimento²⁴
```fsh
ValueSet: ConsentGranularity
* #all "Todos os dados"
* #category "Por categoria"
* #resource "Por tipo de recurso"
* #instance "Por instância específica"
* #element "Por elemento de dado"

Profile: GranularConsent
Parent: Consent
* provision.data ^slicing.discriminator.type = #pattern
* provision.data ^slicing.discriminator.path = "meaning"
* provision.data contains
    included 0..* MS and
    excluded 0..* MS
* provision.data[included].meaning = #authorizes
* provision.data[excluded].meaning = #denies
```

## 8. GESTÃO DE INCIDENTES E VIOLAÇÕES

### 8.1 Detecção de Violações²⁵
```fsh
Profile: DataBreachIncident
Parent: DetectedIssue
* status = #final
* code from DataBreachTypeVS (required)
* severity 1..1 MS
* patient 0..* MS  // Pacientes afetados
* identified[x] 1..1 MS
* author 1..1 MS
* implicated 1..* MS  // Recursos comprometidos
* detail 1..1 MS
* mitigation 0..* MS

ValueSet: DataBreachTypeVS
* #unauthorized-access "Acesso não autorizado"
* #data-loss "Perda de dados"
* #data-theft "Roubo de dados"
* #malware "Infecção por malware"
* #phishing "Ataque de phishing"
* #insider-threat "Ameaça interna"
* #physical-breach "Violação física"
```

### 8.2 Processo de Notificação²⁶
```fsh
Task: BreachNotificationTask
* status = #requested
* intent = #order
* priority = #urgent
* code = #breach-notification
* description = "Notificar autoridades e afetados sobre violação de dados"
* for 1..* MS  // Pacientes afetados
* authoredOn 1..1 MS
* requester 1..1 MS
* owner 1..1 MS  // DPO ou responsável
* restriction.period.end 1..1 MS  // Prazo legal (72h GDPR, 2 dias LGPD)
* input contains
    breachDetails 1..1 MS and
    affectedCount 1..1 MS and
    riskAssessment 1..1 MS
```

## 9. TRANSFERÊNCIA INTERNACIONAL DE DADOS

### 9.1 Mecanismos de Transferência²⁷
```fsh
Extension: InternationalTransfer
Id: international-transfer
* extension contains
    destination 1..1 MS and
    mechanism 1..1 MS and
    safeguards 0..* MS
* extension[destination].value[x] only CodeableConcept
* extension[destination].valueCodeableConcept from CountryCodeVS
* extension[mechanism].value[x] only CodeableConcept
* extension[mechanism].valueCodeableConcept from TransferMechanismVS
* extension[safeguards].value[x] only string

ValueSet: TransferMechanismVS
* #adequacy "Decisão de adequação"
* #scc "Cláusulas contratuais padrão"
* #bcr "Binding Corporate Rules"
* #consent "Consentimento explícito"
* #legitimate-interest "Interesse legítimo"
```

### 9.2 Adequação e Garantias²⁸
```fsh
Profile: CrossBorderDataTransfer
Parent: Contract
* type = #data-transfer-agreement
* subject 1..* MS  // Dados transferidos
* authority 0..* MS  // Autoridade supervisora
* domain 1..* MS  // Jurisdições envolvidas
* term.offer.party 1..* MS  // Exportador de dados
* term.offer.answer 1..1 MS
* term.asset 1..* MS  // Categorias de dados
* term.action 1..* MS  // Obrigações de proteção
* legal 0..* MS  // Base legal
* rule 0..* MS  // Salvaguardas aplicáveis
```

## 10. PRIVACIDADE DIFERENCIAL E TÉCNICAS AVANÇADAS

### 10.1 Privacidade Diferencial²⁹
```javascript
// Implementação de ruído Laplaciano
function addLaplacianNoise(value, sensitivity, epsilon) {
  const scale = sensitivity / epsilon;
  const u = Math.random() - 0.5;
  const noise = -scale * Math.sign(u) * Math.log(1 - 2 * Math.abs(u));
  return value + noise;
}

// Aplicar a contagens agregadas
function differentiallyPrivateCount(realCount, epsilon = 1.0) {
  const sensitivity = 1; // Sensibilidade para contagem
  return Math.round(addLaplacianNoise(realCount, sensitivity, epsilon));
}
```

### 10.2 K-Anonimato³⁰
```fsh
Profile: KAnonymousDataset
Parent: Bundle
* type = #collection
* entry.resource obeys k-anonymity-rule

Invariant: k-anonymity-rule
Description: "Cada combinação de quasi-identificadores deve aparecer em pelo menos k registros"
Expression: "entry.resource.where(
  birthDate = %resource.birthDate and 
  address.postalCode = %resource.address.postalCode
).count() >= 5"
Severity: #error
```

### 10.3 Homomorphic Encryption³¹
```fsh
Extension: HomomorphicEncryption
Id: homomorphic-encryption
* extension contains
    algorithm 1..1 MS and
    publicKey 1..1 MS and
    operations 0..* MS
* extension[algorithm].value[x] only code
* extension[algorithm].valueCode from HomomorphicAlgorithmVS
* extension[publicKey].value[x] only base64Binary
* extension[operations].value[x] only code

ValueSet: HomomorphicAlgorithmVS
* #paillier "Paillier cryptosystem"
* #gentry "Gentry's scheme"
* #bgv "Brakerski-Gentry-Vaikuntanathan"
* #ckks "Cheon-Kim-Kim-Song"
```

## 11. MONITORAMENTO E MÉTRICAS DE CONFORMIDADE

### 11.1 KPIs de Privacidade³²
```fsh
Measure: PrivacyComplianceMetrics
* status = #active
* subjectCodeableConcept = #Location
* date = "2024-01-01"
* publisher = "Organization"
* group contains
    consentRate 1..1 MS and
    breachCount 1..1 MS and
    dataMinimization 1..1 MS and
    encryptionCoverage 1..1 MS
* group[consentRate].code = #consent-rate
* group[consentRate].population.code = #initial-population
* group[breachCount].code = #breach-incidents
* group[dataMinimization].code = #data-minimization-score
* group[encryptionCoverage].code = #encryption-percentage
```

### 11.2 Dashboard de Conformidade
```yaml
privacy_dashboard:
  metrics:
    - id: consent_coverage
      name: "Cobertura de Consentimento"
      target: 100%
      current: 98.5%
      
    - id: encryption_status
      name: "Dados Criptografados"
      target: 100%
      current: 99.9%
      
    - id: audit_completeness
      name: "Completude de Auditoria"
      target: 100%
      current: 100%
      
    - id: incident_response_time
      name: "Tempo de Resposta a Incidentes"
      target: "<24h"
      current: "18h"
      
    - id: data_retention_compliance
      name: "Conformidade de Retenção"
      target: 100%
      current: 97%
```

## 12. TEMPLATES E CHECKLISTS

### 12.1 Checklist de Conformidade LGPD/GDPR/HIPAA
```markdown
## Checklist de Conformidade

### LGPD
- [ ] Base legal definida para cada tratamento
- [ ] Consentimento documentado quando aplicável
- [ ] RIPD elaborado para operações de alto risco
- [ ] DPO/Encarregado designado
- [ ] Canal de comunicação com titulares
- [ ] Procedimento para atender direitos dos titulares
- [ ] Notificação de incidentes à ANPD

### GDPR
- [ ] Lawful basis identificada
- [ ] DPIA conduzida quando necessário
- [ ] Privacy by Design implementado
- [ ] Privacy by Default configurado
- [ ] Registro de atividades de tratamento
- [ ] Acordos com processadores
- [ ] Mecanismos para transferência internacional

### HIPAA
- [ ] PHI identificada e classificada
- [ ] Minimum necessary implementado
- [ ] De-identification aplicada quando apropriado
- [ ] BAA com business associates
- [ ] Security Rule safeguards implementados
- [ ] Breach notification procedures
- [ ] Training documentation
```

### 12.2 Template de Privacy Notice
```markdown
# Aviso de Privacidade / Privacy Notice

## Controlador de Dados / Data Controller
[Nome da Organização]
[Endereço]
[Contato do DPO]

## Dados Coletados / Data Collected
- Identificação pessoal
- Dados de saúde
- [Outras categorias]

## Finalidade do Tratamento / Purpose of Processing
- Prestação de cuidados de saúde
- Pesquisa médica (com consentimento)
- [Outras finalidades]

## Base Legal / Legal Basis
- LGPD Art. 7º, VIII (tutela da saúde)
- GDPR Art. 9(2)(h) (healthcare)
- HIPAA covered entity obligations

## Compartilhamento / Data Sharing
[Descrever com quem os dados são compartilhados]

## Direitos do Titular / Data Subject Rights
- Acesso / Access
- Correção / Rectification
- Exclusão / Erasure
- Portabilidade / Portability
- Oposição / Objection

## Retenção / Retention
[Período de retenção e critérios]

## Contato / Contact
[E-mail e telefone para exercício de direitos]
```

## 13. REFERÊNCIAS

1. Brasil. Lei nº 13.709/2018 - Lei Geral de Proteção de Dados Pessoais (LGPD). Disponível em: http://www.planalto.gov.br/ccivil_03/_ato2015-2018/2018/lei/l13709.htm
2. European Union. Regulation (EU) 2016/679 - General Data Protection Regulation (GDPR). Disponível em: https://eur-lex.europa.eu/eli/reg/2016/679/oj
3. U.S. Department of Health & Human Services. HIPAA Administrative Simplification. Disponível em: https://www.hhs.gov/hipaa/index.html
4. ISO/IEC 27001:2022. Information security management systems. ISO.
5. ISO 27799:2016. Health informatics — Information security management in health. ISO.
6. ANPD. Guia Orientativo para Definições dos Agentes de Tratamento. Disponível em: https://www.gov.br/anpd/
7. ANPD. Direitos do Titular. Disponível em: https://www.gov.br/anpd/pt-br/assuntos/direitos-do-titular
8. ANPD. Guia de Boas Práticas para Relatório de Impacto. 2023.
9. European Data Protection Board. Guidelines on consent under Regulation 2016/679. 2020.
10. ENISA. Privacy by Design. Disponível em: https://www.enisa.europa.eu/
11. Article 29 Working Party. Guidelines on the right to data portability. 2017.
12. EDPB. Guidelines 01/2022 on data subject rights - Right of access. 2022.
13. ICO. Privacy by design. Disponível em: https://ico.org.uk/
14. HHS. Summary of the HIPAA Privacy Rule. Disponível em: https://www.hhs.gov/hipaa/for-professionals/privacy/
15. HHS. Minimum Necessary Requirement. Disponível em: https://www.hhs.gov/hipaa/for-professionals/privacy/guidance/minimum-necessary-requirement/
16. HHS. Methods for De-identification of PHI. Disponível em: https://www.hhs.gov/hipaa/for-professionals/privacy/special-topics/de-identification/
17. HHS. HIPAA Security Rule. Disponível em: https://www.hhs.gov/hipaa/for-professionals/security/
18. HHS. Audit Controls. 45 CFR 164.312(b).
19. NIST. SP 800-175B - Guideline for Using Cryptographic Standards. 2020.
20. NIST. SP 800-162 - Guide to Attribute Based Access Control. 2014.
21. ISO/IEC 20889:2018. Privacy enhancing data de-identification terminology and classification of techniques.
22. HL7. FHIR Security and Privacy Module. Disponível em: http://hl7.org/fhir/security.html
23. HL7. Consent Resource. Disponível em: http://hl7.org/fhir/consent.html
24. Kantara Initiative. Consent Receipt Specification. 2018.
25. ENISA. Recommendations for a methodology of the assessment of severity of personal data breaches. 2013.
26. GDPR Art. 33 & 34. Personal data breach notification.
27. EDPB. Recommendations 01/2020 on measures that supplement transfer tools. 2020.
28. European Commission. Standard Contractual Clauses. 2021.
29. Dwork, C. Differential Privacy. ICALP 2006.
30. Sweeney, L. k-anonymity: a model for protecting privacy. 2002.
31. Gentry, C. Fully homomorphic encryption using ideal lattices. STOC 2009.
32. ISO/IEC 27701:2019. Privacy information management. ISO.

---
**Documento aprovado por:** [Comitê de Privacidade e Segurança]  
**Data de vigência:** 2024-2025  
**Próxima revisão:** Janeiro 2026


// ===== Conteúdo de: sop-terminologies.md =====

# SOP-002: Terminologias e Vocabulários em FHIR
**Standard Operating Procedure para Gestão de Terminologias em Implementation Guides**

## 1. INTRODUÇÃO

### 1.1 Objetivo
Este SOP estabelece os procedimentos para implementação, mapeamento e gestão de terminologias em Implementation Guides FHIR, garantindo interoperabilidade semântica entre sistemas de saúde.

### 1.2 Escopo
Aplica-se a todos os aspectos de terminologia incluindo CodeSystems, ValueSets, ConceptMaps e NamingSystems em projetos FHIR.

### 1.3 Referências Fundamentais
- HL7 Terminology (THO)¹: https://terminology.hl7.org/
- FHIR Terminology Service²: http://hl7.org/fhir/R5/terminology-service.html
- Using Codes in FHIR³: http://hl7.org/fhir/R5/terminologies.html
- ISO TR 21300:2014⁴: Principles of Mapping Between Terminological Systems

## 2. TERMINOLOGIAS PADRÃO INTERNACIONAIS

### 2.1 SNOMED CT
**Systematized Nomenclature of Medicine Clinical Terms**

#### 2.1.1 Identificação
- **URI**: `http://snomed.info/sct`
- **OID**: `2.16.840.1.113883.6.96`
- **Versão**: Especificar sempre (ex: `http://snomed.info/sct|http://snomed.info/sct/900000000000207008/version/20230901`)

#### 2.1.2 Uso em FHIR⁵
```fsh
// Alias para SNOMED CT
Alias: $SCT = http://snomed.info/sct

// Uso em ValueSet
ValueSet: ConditionsVS
* $SCT#38341003 "Hypertensive disorder"
* $SCT#73211009 "Diabetes mellitus"

// Uso em Binding
* code from http://hl7.org/fhir/ValueSet/condition-code (extensible)
* code.coding ^slicing.discriminator.type = #pattern
* code.coding ^slicing.discriminator.path = "system"
* code.coding contains snomed 1..1 MS
* code.coding[snomed].system = $SCT
```

#### 2.1.3 SNOMED CT IPS Free Set⁶
Subconjunto gratuito para International Patient Summary:
- URI: `http://hl7.org/fhir/uv/ips/ValueSet/snomed-intl-ips`
- Não requer licença nacional SNOMED

### 2.2 LOINC
**Logical Observation Identifiers Names and Codes**

#### 2.2.1 Identificação⁷
- **URI**: `http://loinc.org`
- **OID**: `2.16.840.1.113883.6.1`

#### 2.2.2 Estrutura de Códigos LOINC
```
[Componente]:[Propriedade]:[Tempo]:[Sistema]:[Escala]:[Método]
Exemplo: 8867-4 = Heart rate:NRat:Pt:XXX:Qn
```

#### 2.2.3 Implementação em FHIR
```fsh
Profile: LabResult
Parent: Observation
* code from http://hl7.org/fhir/ValueSet/observation-codes (preferred)
* code.coding ^slicing.discriminator.type = #pattern
* code.coding ^slicing.discriminator.path = "system"
* code.coding contains loinc 1..1 MS
* code.coding[loinc].system = "http://loinc.org"

// Exemplo de uso
Instance: lab-glucose
InstanceOf: LabResult
* code.coding[loinc] = http://loinc.org#15074-8 "Glucose [Mass/volume] in Blood"
* valueQuantity = 95 'mg/dL'
```

### 2.3 ICD-10 e ICD-11
**International Classification of Diseases**

#### 2.3.1 ICD-10-CM/PCS⁸
```fsh
// ICD-10-CM (Clinical Modification)
Alias: $ICD10CM = http://hl7.org/fhir/sid/icd-10-cm

// ICD-10-PCS (Procedure Coding System)  
Alias: $ICD10PCS = http://www.cms.gov/Medicare/Coding/ICD10

// Uso em ValueSet
ValueSet: DiabetesConditions
* $ICD10CM#E11 "Type 2 diabetes mellitus"
* $ICD10CM#E11.9 "Type 2 diabetes mellitus without complications"
* $ICD10CM#E11.65 "Type 2 diabetes mellitus with hyperglycemia"
```

#### 2.3.2 ICD-11⁹
```fsh
// ICD-11 MMS (Mortality and Morbidity Statistics)
Alias: $ICD11 = http://id.who.int/icd11/mms

// Exemplo de uso
* code = $ICD11#5A11 "Type 2 diabetes mellitus"
```

### 2.4 Terminologias de Medicamentos

#### 2.4.1 RxNorm¹⁰
```fsh
Alias: $RXNORM = http://www.nlm.nih.gov/research/umls/rxnorm

ValueSet: CommonMedications
* $RXNORM#314076 "lisinopril 10 MG Oral Tablet"
* $RXNORM#860975 "metformin hydrochloride 500 MG Oral Tablet"
```

#### 2.4.2 ATC (Anatomical Therapeutic Chemical)¹¹
```fsh
Alias: $ATC = http://www.whocc.no/atc

* medication.code = $ATC#C09AA03 "lisinopril"
```

## 3. COMPONENTES DE TERMINOLOGIA EM FHIR

### 3.1 CodeSystem
Define um sistema de códigos completo ou suplemento¹².

#### 3.1.1 Estrutura FSH
```fsh
CodeSystem: CustomConditionStatus
Id: custom-condition-status
Title: "Status de Condições Customizado"
Description: "Estados específicos para condições clínicas"
* #preliminary "Preliminar" "Diagnóstico preliminar, aguardando confirmação"
* #confirmed "Confirmado" "Diagnóstico confirmado por exames"
* #ruled-out "Descartado" "Condição descartada após investigação"
* #in-remission "Em remissão" "Condição em remissão"
```

#### 3.1.2 Hierarquia em CodeSystem
```fsh
CodeSystem: BodySites
* #head "Cabeça"
  * #face "Face"
    * #eye "Olho"
      * #left-eye "Olho esquerdo"
      * #right-eye "Olho direito"
  * #scalp "Couro cabeludo"
```

### 3.2 ValueSet
Define subconjunto de códigos para uso específico¹³.

#### 3.2.1 ValueSet Extensional
Lista explícita de códigos:
```fsh
ValueSet: EmergencyConditions
Id: emergency-conditions
Title: "Condições de Emergência"
* $SCT#410429000 "Cardiac arrest"
* $SCT#230690007 "Stroke"
* $ICD10CM#I21 "Acute myocardial infarction"
```

#### 3.2.2 ValueSet Intensional
Definido por regras:
```fsh
ValueSet: AllDiabetesConditions
* include codes from system $SCT where concept is-a #73211009 "Diabetes mellitus"
* include codes from system $ICD10CM where code regex "^E1[0-4].*"
```

#### 3.2.3 ValueSet com Filtros Complexos
```fsh
ValueSet: ActiveMedicationStatus
* include codes from system http://hl7.org/fhir/CodeSystem/medication-statement-status
  where concept is-a #active
* exclude http://hl7.org/fhir/CodeSystem/medication-statement-status#entered-in-error
```

### 3.3 ConceptMap
Mapeia conceitos entre sistemas diferentes¹⁴.

#### 3.3.1 Estrutura de ConceptMap
```fsh
ConceptMap: ConditionSeverityMap
Id: condition-severity-map
Source: LocalSeverityVS
Target: http://hl7.org/fhir/ValueSet/condition-severity
* group[0].source = "http://example.org/severity"
* group[0].target = $SCT
* group[0].element[0].code = #mild
* group[0].element[0].target[0].code = #255604002
* group[0].element[0].target[0].equivalence = #equivalent
* group[0].element[1].code = #moderate  
* group[0].element[1].target[0].code = #6736007
* group[0].element[1].target[0].equivalence = #equivalent
```

#### 3.3.2 Tipos de Equivalência¹⁵
- **equivalent**: Conceitos são equivalentes
- **wider**: Target é mais amplo
- **narrower**: Target é mais específico
- **inexact**: Mapeamento aproximado
- **unmatched**: Sem correspondência

### 3.4 NamingSystem
Define identificadores únicos para sistemas¹⁶.

```fsh
Instance: cpf-naming-system
InstanceOf: NamingSystem
* name = "CPF"
* status = #active
* kind = #identifier
* description = "Cadastro de Pessoas Físicas brasileiro"
* uniqueId[0].type = #uri
* uniqueId[0].value = "http://rnds.saude.gov.br/fhir/r4/NamingSystem/cpf"
* uniqueId[1].type = #oid
* uniqueId[1].value = "2.16.840.1.113883.13.18"
```

## 4. BINDING DE TERMINOLOGIAS

### 4.1 Tipos de Binding¹⁷

#### 4.1.1 Required
Deve usar código do ValueSet:
```fsh
* status from http://hl7.org/fhir/ValueSet/observation-status (required)
```

#### 4.1.2 Extensible
Deve usar se aplicável, pode estender:
```fsh
* code from http://hl7.org/fhir/ValueSet/observation-codes (extensible)
```

#### 4.1.3 Preferred
Recomendado, mas opcional:
```fsh
* bodySite from http://hl7.org/fhir/ValueSet/body-site (preferred)
```

#### 4.1.4 Example
Apenas sugestão:
```fsh
* category from http://hl7.org/fhir/ValueSet/observation-category (example)
```

## 5. MAPEAMENTO DE TERMINOLOGIAS

### 5.1 Estratégias de Mapeamento¹⁸

#### 5.1.1 Mapeamento Direto
```javascript
// Função de mapeamento
function mapLocalToSNOMED(localCode) {
  const mappings = {
    "HT": "38341003",  // Hypertension
    "DM": "73211009",  // Diabetes
    "CHF": "42343007"  // Congestive heart failure
  };
  return mappings[localCode];
}
```

#### 5.1.2 Mapeamento com ConceptMap
```fsh
// Uso do ConceptMap via operação $translate
GET [base]/ConceptMap/$translate?system=http://local&code=HT&target=http://snomed.info/sct
```

### 5.2 Qualidade de Mapeamento¹⁹

#### 5.2.1 Critérios de Avaliação
- **Completude**: Todos os conceitos origem mapeados
- **Precisão**: Correspondência semântica correta
- **Consistência**: Mapeamentos uniformes
- **Manutenibilidade**: Facilidade de atualização

#### 5.2.2 Validação de Mapeamentos
```bash
# Validar mapeamentos usando FHIR Validator
java -jar validator_cli.jar -ig [ig-package] -profile http://hl7.org/fhir/StructureDefinition/ConceptMap [conceptmap.json]
```

## 6. TRADUÇÃO E LOCALIZAÇÃO

### 6.1 Designations (Traduções)²⁰
```fsh
CodeSystem: LocalConditions
* #hypertension "Hypertension"
* #hypertension ^designation[0].language = #pt-BR
* #hypertension ^designation[0].value = "Hipertensão"
* #hypertension ^designation[1].language = #es
* #hypertension ^designation[1].value = "Hipertensión"
```

### 6.2 Preferred Display
```fsh
ValueSet: ConditionsVS
* $SCT#38341003 "Hypertensive disorder"
* $SCT#38341003 ^designation[0].language = #pt-BR
* $SCT#38341003 ^designation[0].use = http://terminology.hl7.org/CodeSystem/designation-usage#display
* $SCT#38341003 ^designation[0].value = "Transtorno hipertensivo"
```

## 7. SERVIDOR DE TERMINOLOGIA

### 7.1 Operações de Terminologia²¹

#### 7.1.1 $expand
Expande ValueSet para lista de códigos:
```http
GET [base]/ValueSet/[id]/$expand?filter=diabetes
```

#### 7.1.2 $validate-code
Valida se código pertence ao ValueSet:
```http
GET [base]/ValueSet/[id]/$validate-code?system=http://snomed.info/sct&code=73211009
```

#### 7.1.3 $lookup
Obtém detalhes de um código:
```http
GET [base]/CodeSystem/$lookup?system=http://loinc.org&code=15074-8
```

#### 7.1.4 $translate
Traduz código entre sistemas:
```http
GET [base]/ConceptMap/[id]/$translate?system=http://local&code=DM
```

### 7.2 Configuração de Servidor Tx²²
```yaml
# hapi-fhir-server config
hapi:
  fhir:
    terminology:
      validation:
        enabled: true
      servers:
        - url: https://r4.ontoserver.csiro.au/fhir
        - url: https://tx.fhir.org/r4
```

## 8. BOAS PRÁTICAS

### 8.1 Reutilização de Terminologias²³
1. **Verificar existência**: Sempre procurar ValueSets existentes antes de criar novos
2. **Usar THO**: Terminology.hl7.org para terminologias HL7
3. **VSAC**: Value Set Authority Center para US-specific
4. **Simplifier**: Para IGs publicados

### 8.2 Documentação de Terminologias
```markdown
### Terminologias Utilizadas

| Sistema | URI | Versão | Licença |
|---------|-----|--------|---------|
| SNOMED CT | http://snomed.info/sct | 2023-09-01 | Requer licença nacional |
| LOINC | http://loinc.org | 2.74 | Gratuito com registro |
| ICD-10-CM | http://hl7.org/fhir/sid/icd-10-cm | 2024 | Domínio público |
```

### 8.3 Versionamento de Terminologias²⁴
```fsh
// Especificar versão quando crítico
ValueSet: CriticalConditions
* $SCT|http://snomed.info/sct/900000000000207008/version/20230901#410429000
```

## 9. INTEGRAÇÃO COM TERMINOLOGIAS NACIONAIS

### 9.1 Brasil
#### 9.1.1 TUSS (Terminologia Unificada da Saúde Suplementar)²⁵
```fsh
Alias: $TUSS = http://www.ans.gov.br/tuss

ValueSet: ProcedimentosTUSS
* $TUSS#30101018 "Consulta médica em pronto socorro"
* $TUSS#40301354 "Hemograma completo"
```

#### 9.1.2 CBHPM (Classificação Brasileira Hierarquizada de Procedimentos Médicos)
```fsh
Alias: $CBHPM = http://amb.org.br/cbhpm

* procedure.code = $CBHPM#1.01.01.01-2 "Consulta em consultório"
```

#### 9.1.3 Tabela SUS (SIGTAP)²⁶
```fsh
Alias: $SIGTAP = http://sigtap.datasus.gov.br

ValueSet: ProcedimentosSUS
* $SIGTAP#0301010072 "Consulta médica em atenção básica"
* $SIGTAP#0202010503 "Hemograma completo"
```

### 9.2 Mapeamento Internacional para Nacional
```fsh
ConceptMap: LOINCtoSIGTAP
* group[0].source = "http://loinc.org"
* group[0].target = "http://sigtap.datasus.gov.br"
* group[0].element[0].code = #58410-2  // CBC panel
* group[0].element[0].target[0].code = #0202010503
* group[0].element[0].target[0].equivalence = #equivalent
```

## 10. GESTÃO DE MUDANÇAS EM TERMINOLOGIAS

### 10.1 Monitoramento de Atualizações²⁷
- **SNOMED CT**: Releases semestrais (Janeiro/Julho)
- **LOINC**: Releases semestrais (Junho/Dezembro)
- **ICD-10-CM**: Atualizações anuais (Outubro)
- **RxNorm**: Atualizações mensais

### 10.2 Processo de Atualização
```bash
# 1. Baixar nova versão
wget https://download.loinc.org/loinc-2.74.zip

# 2. Validar compatibilidade
java -jar validator_cli.jar -version 2.74 -ig [seu-ig]

# 3. Testar mapeamentos
npm run test-terminology

# 4. Atualizar documentação
echo "LOINC atualizado para versão 2.74" >> CHANGELOG.md
```

### 10.3 Deprecação de Códigos²⁸
```fsh
ValueSet: ActiveConditions
* $SCT#73211009 "Diabetes mellitus"
// Código deprecated - usar conceito mais específico
* exclude $SCT#46635009 "Diabetes mellitus type 1" 
* ^compose.inactive = false  // Excluir códigos inativos
```

## 11. TESTES E VALIDAÇÃO

### 11.1 Testes de Terminologia
```javascript
// Teste unitário para ValueSet
describe('Emergency Conditions ValueSet', () => {
  test('should contain cardiac arrest', async () => {
    const expanded = await expandValueSet('emergency-conditions');
    expect(expanded.contains).toContainEqual(
      expect.objectContaining({
        system: 'http://snomed.info/sct',
        code: '410429000'
      })
    );
  });
});
```

### 11.2 Validação de Bindings²⁹
```bash
# Validar todas as bindings do IG
java -jar validator_cli.jar -ig [ig-package] -txLog tx.log

# Verificar log de terminologia
grep "ERROR" tx.log
```

### 11.3 Cobertura de Terminologia
```sql
-- Query para verificar cobertura
SELECT 
  vs.url as valueset,
  COUNT(DISTINCT c.code) as total_codes,
  COUNT(DISTINCT CASE WHEN c.display IS NOT NULL THEN c.code END) as with_display,
  COUNT(DISTINCT CASE WHEN c.definition IS NOT NULL THEN c.code END) as with_definition
FROM valuesets vs
JOIN codes c ON vs.id = c.valueset_id
GROUP BY vs.url;
```

## 12. PERFORMANCE E OTIMIZAÇÃO

### 12.1 Cache de Terminologias³⁰
```yaml
# Configuração de cache
terminology:
  cache:
    enabled: true
    ttl: 86400  # 24 horas
    max-entries: 10000
```

### 12.2 Pré-expansão de ValueSets
```fsh
// Marcar para pré-expansão
ValueSet: CommonConditions
* ^experimental = false
* ^immutable = true  // Permite cache agressivo
* ^compose.lockedDate = "2024-01-01"  // Data de congelamento
```

## 13. CONFORMIDADE COM PADRÕES

### 13.1 ISO/TS 21564:2019³¹
Requisitos para classificações de saúde:
- Completude
- Não-redundância
- Não-ambiguidade
- Múltipla hierarquia permitida
- Definições formais

### 13.2 HL7 Terminology Infrastructure³²
```fsh
// Conformidade com THO
ValueSet: MyValueSet
* ^meta.profile = "http://terminology.hl7.org/StructureDefinition/shareablevalueset"
* ^url = "http://example.org/fhir/ValueSet/my-valueset"
* ^version = "1.0.0"
* ^name = "MyValueSet"
* ^status = #active
* ^experimental = false
* ^publisher = "Example Organization"
```

## 14. FERRAMENTAS E RECURSOS

### 14.1 Ferramentas de Desenvolvimento³³
- **FHIR Shorthand**: https://fshschool.org/
- **Ontoserver**: https://ontoserver.csiro.au/
- **Snowstorm**: https://github.com/IHTSDO/snowstorm
- **OCL (Open Concept Lab)**: https://openconceptlab.org/

### 14.2 Navegadores de Terminologia
- **VSAC**: https://vsac.nlm.nih.gov/
- **SNOMED Browser**: https://browser.ihtsdotools.org/
- **LOINC Search**: https://loinc.org/search/
- **RxNav**: https://rxnav.nlm.nih.gov/

### 14.3 Validadores
```bash
# FHIR Validator
java -jar validator_cli.jar -txServer https://tx.fhir.org -ig [seu-ig]

# Terminology Server Tester
curl -X POST https://tx.fhir.org/r4/ValueSet/$validate-code \
  -H "Content-Type: application/fhir+json" \
  -d '{"resourceType":"Parameters","parameter":[...]}'
```

## 15. TROUBLESHOOTING COMUM

### 15.1 Problemas Frequentes e Soluções

#### Erro: "Code not found in ValueSet"
```fsh
// Verificar:
// 1. Sistema correto
* code.system = "http://snomed.info/sct"  // não "http://snomed.org"

// 2. Código ativo
* ^compose.inactive = false

// 3. Versão correta
* $SCT|http://snomed.info/sct/900000000000207008/version/20230901#12345
```

#### Erro: "Binding strength violation"
```fsh
// Não pode relaxar binding strength
// Parent: required → Child: ❌ extensible
// Parent: extensible → Child: ✓ required
```

#### Erro: "Duplicate codes in ValueSet"
```fsh
// Usar exclude para remover duplicatas
ValueSet: UniqueConditions
* include codes from system $SCT where concept is-a #64572001
* exclude $SCT#duplicated-code
```

## 16. REFERÊNCIAS

1. HL7 International. HL7 Terminology (THO). https://terminology.hl7.org/
2. HL7. FHIR Terminology Service. http://hl7.org/fhir/R5/terminology-service.html
3. HL7. Using Codes in FHIR. http://hl7.org/fhir/R5/terminologies.html
4. ISO. ISO/TR 21300:2014. Health Informatics - Principles of Mapping Between Terminological Systems.
5. SNOMED International. SNOMED CT Implementation Guide. https://confluence.ihtsdotools.org/
6. HL7. SNOMED CT IPS Free Set. http://hl7.org/fhir/uv/ips/terminology.html
7. Regenstrief Institute. LOINC Users' Guide. https://loinc.org/get-started/
8. CDC. ICD-10-CM Official Guidelines. https://www.cdc.gov/nchs/icd/icd-10-cm.htm
9. WHO. ICD-11 Implementation Guide. https://icd.who.int/icd11refguide/
10. NLM. RxNorm Technical Documentation. https://www.nlm.nih.gov/research/umls/rxnorm/
11. WHO. ATC Classification. https://www.whocc.no/atc_ddd_index/
12. HL7. CodeSystem Resource. http://hl7.org/fhir/R5/codesystem.html
13. HL7. ValueSet Resource. http://hl7.org/fhir/R5/valueset.html
14. HL7. ConceptMap Resource. http://hl7.org/fhir/R5/conceptmap.html
15. HL7. ConceptMap Equivalence. http://hl7.org/fhir/R5/valueset-concept-map-equivalence.html
16. HL7. NamingSystem Resource. http://hl7.org/fhir/R5/namingsystem.html
17. HL7. Binding Strength. http://hl7.org/fhir/R5/terminologies.html#strength
18. ISO/TS 21564:2019. Terminology mapping.
19. Bodenreider O. The Unified Medical Language System (UMLS). Nucleic Acids Res. 2004.
20. HL7. Translation and Localization. http://hl7.org/fhir/R5/languages.html
21. HL7. Terminology Service Operations. http://hl7.org/fhir/R5/terminology-service.html#4.6
22. HAPI FHIR. Terminology Configuration. https://hapifhir.io/hapi-fhir/docs/server_jpa/terminology.html
23. HL7. Best Practices for Terminology. https://confluence.hl7.org/display/FHIR/Terminology+Best+Practices
24. HL7. Terminology Versioning. http://hl7.org/fhir/R5/terminologies.html#versioning
25. ANS. TUSS - Terminologia Unificada da Saúde Suplementar. http://www.ans.gov.br/tuss
26. DATASUS. SIGTAP. http://sigtap.datasus.gov.br
27. HL7. Terminology Maintenance. https://confluence.hl7.org/display/TA/Maintenance
28. HL7. Deprecated Codes. http://hl7.org/fhir/R5/codesystem-definitions.html#CodeSystem.concept.deprecated
29. HL7. Terminology Validation. http://hl7.org/fhir/R5/validation.html#terminology
30. HL7. Terminology Performance. https://confluence.hl7.org/display/FHIR/Terminology+Performance
31. ISO/TS 21564:2019. Health informatics — Terminology classifications.
32. HL7. Terminology Infrastructure. https://confluence.hl7.org/display/TA/Terminology+Infrastructure
33. HL7. Terminology Tools. https://confluence.hl7.org/display/FHIR/Terminology+Tools

---
**Documento aprovado por:** [Gerência de Terminologias Clínicas]  
**Data de vigência:** 2024-2025  
**Próxima revisão:** Janeiro 2026


// ===== Conteúdo de: sop-ig-fundamentals.md =====

# SOP-001: Fundamentos de Implementation Guides FHIR
**Standard Operating Procedure para Desenvolvimento de HL7 FHIR Implementation Guides**

## 1. INTRODUÇÃO E PROPÓSITO

### 1.1 Objetivo
Este documento estabelece os procedimentos padrão para o desenvolvimento de Implementation Guides (IGs) FHIR, garantindo conformidade com as especificações HL7 International e suas afiliadas.

### 1.2 Escopo
Aplicável a todos os projetos de desenvolvimento de IGs FHIR, incluindo perfis nacionais, domínios específicos de conhecimento, comunidades de implementação e produtos específicos.

### 1.3 Referências Normativas
- HL7 FHIR R5 Specification¹: http://hl7.org/fhir/R5/
- FHIR Implementation Guide Resource²: http://hl7.org/fhir/R5/implementationguide.html
- FHIR IG Publishing Requirements³: https://wiki.hl7.org/FHIR_Implementation_Guide_Publishing_Requirements
- FHIR Shorthand Specification⁴: https://build.fhir.org/ig/HL7/fhir-shorthand/

## 2. DEFINIÇÕES E CONCEITOS FUNDAMENTAIS

### 2.1 Implementation Guide (IG)
Um IG FHIR é um conjunto de regras computáveis e documentação narrativa que determina como solucionar problemas específicos de interoperabilidade usando recursos FHIR⁵.

### 2.2 Categorias de IGs
Conforme definido por Grahame Grieve⁶:

1. **National Base IGs**: Descrevem como regulamentações nacionais se aplicam no contexto FHIR
2. **Domain of Knowledge IGs**: Representam conceitos clínicos ou de negócio sem definir APIs
3. **Community of Implementation**: Acordos sobre troca de dados entre atores específicos
4. **Product IGs**: Documentam funcionalidades de software específico

### 2.3 Componentes Essenciais
- **Profiles**: Restrições em recursos FHIR base
- **Extensions**: Elementos adicionais para dados não cobertos pelo padrão
- **ValueSets**: Conjuntos de valores permitidos para elementos codificados
- **CodeSystems**: Sistemas de códigos customizados
- **Examples**: Instâncias de recursos conformes
- **NamingSystems**: Identificadores únicos para sistemas

## 3. ESTRUTURA DE DIRETÓRIOS

### 3.1 Estrutura Padrão FSH/SUSHI⁷
```
IG-Project/
├── input/
│   ├── fsh/                    # Arquivos FSH
│   │   ├── aliases.fsh         # Definições de aliases
│   │   ├── profiles/           # Perfis de recursos
│   │   ├── extensions/         # Extensões customizadas
│   │   ├── valuesets/          # Conjuntos de valores
│   │   ├── codesystems/        # Sistemas de códigos
│   │   ├── examples/           # Exemplos
│   │   └── invariants/         # Regras de validação
│   ├── pagecontent/           # Conteúdo narrativo (Markdown)
│   └── images/                # Imagens e diagramas
├── fsh-generated/             # Saída do SUSHI (não editar)
├── output/                    # IG publicado (não editar)
├── sushi-config.yaml          # Configuração do projeto
├── ig.ini                     # Configuração do IG Publisher
└── _genonce.sh/.bat          # Scripts de build
```

### 3.2 Convenções de Nomenclatura
- Arquivos FSH: `[tipo]-[domínio].fsh`
  - Exemplo: `profile-patient.fsh`, `valueset-conditions.fsh`
- IDs de recursos: `[projeto]-[tipo]-[nome]`
  - Exemplo: `br-core-patient`, `us-core-condition`

## 4. DESENVOLVIMENTO DE PROFILES

### 4.1 Sintaxe FSH para Profiles⁸
```fsh
Profile: [NomeDoPerfil]
Parent: [RecursoBase ou PerfilPai]
Id: [id-único]
Title: "[Título Legível]"
Description: "[Descrição Detalhada]"
* [elemento] [cardinalidade] [flags] "[descrição]"
```

### 4.2 Flags de Conformidade
- **MS (MustSupport)**: Elemento deve ser suportado
- **?!**: Modificador (altera significado se presente)
- **SU (Summary)**: Incluído em resumos

### 4.3 Exemplo Prático
```fsh
Profile: BRPatient
Parent: Patient
Id: br-patient
Title: "Paciente Brasileiro"
Description: "Perfil de Paciente para o contexto brasileiro"
* identifier 1..* MS
* identifier ^slicing.discriminator.type = #pattern
* identifier ^slicing.discriminator.path = "type"
* identifier ^slicing.rules = #open
* identifier contains cpf 1..1 MS
* identifier[cpf].system = "http://rnds.saude.gov.br/fhir/r4/NamingSystem/cpf"
* identifier[cpf].type = http://terminology.hl7.org/CodeSystem/v2-0203#TAX
* birthDate 1..1 MS
* address.state from http://hl7.org/fhir/ValueSet/br-estados (required)
```

## 5. DESENVOLVIMENTO DE EXTENSIONS

### 5.1 Quando Criar Extensions⁹
- Dados necessários não existem no recurso base
- Extensão padrão FHIR não atende necessidade
- Dados não podem ser derivados

### 5.2 Estrutura de Extension
```fsh
Extension: [NomeExtension]
Id: [id-extension]
Title: "[Título]"
Description: "[Descrição do uso]"
Context: [Recurso(s) onde se aplica]
* value[x] only [tipo de dado]
* value[x] 1..1
```

## 6. PROCESSO DE BUILD E PUBLICAÇÃO

### 6.1 Ferramentas Necessárias¹⁰
1. **SUSHI**: Compilador FSH (npm install -g fsh-sushi)
2. **IG Publisher**: Publicador HL7 (Java required)
3. **Validator**: Validador FHIR

### 6.2 Comandos de Build
```bash
# Compilar FSH para JSON
sushi .

# Gerar IG completo
./_genonce.sh  # Linux/Mac
_genonce.bat   # Windows

# Validar recursos
java -jar validator_cli.jar [arquivo] -ig [ig-package]
```

### 6.3 Validação de Qualidade
- Verificar arquivo `output/qa.html` após build
- Resolver todos os erros antes de publicar
- Warnings devem ser justificados em `input/ignoreWarnings.txt`

## 7. VERSIONAMENTO E MANUTENÇÃO

### 7.1 Semantic Versioning¹¹
- **Major (X.0.0)**: Mudanças incompatíveis
- **Minor (0.X.0)**: Novas funcionalidades compatíveis
- **Patch (0.0.X)**: Correções de bugs

### 7.2 Estados de Maturidade
1. **Draft**: Em desenvolvimento
2. **Trial Use**: Teste de implementação
3. **Normative**: Estável e aprovado
4. **Deprecated**: Descontinuado

## 8. CONFORMIDADE E TESTES

### 8.1 Níveis de Conformidade¹²
- **SHALL**: Obrigatório
- **SHOULD**: Recomendado
- **MAY**: Opcional

### 8.2 Testes de Conformidade
```bash
# Validar instância contra perfil
java -jar validator_cli.jar [instancia.json] -profile [url-perfil]

# Testar servidor FHIR
java -jar validator_cli.jar -txTests [servidor]/metadata
```

## 9. DOCUMENTAÇÃO NARRATIVA

### 9.1 Páginas Obrigatórias¹³
- **index.md**: Página inicial com visão geral
- **profiles.md**: Lista e descrição de perfis
- **terminology.md**: Sistemas de códigos e valuesets
- **downloads.md**: Pacotes para download
- **changes.md**: Histórico de mudanças

### 9.2 Formato Markdown
```markdown
### Título da Seção
Descrição do conteúdo com referência a perfil: [NomePerfil](StructureDefinition-[id-perfil].html)

#### Requisitos de Negócio
- Requisito 1
- Requisito 2

#### Exemplo de Uso
```json
{
  "resourceType": "Patient",
  "id": "exemplo"
}
```
```

## 10. INTEGRAÇÃO COM PADRÕES EXTERNOS

### 10.1 Harmonização com IGs Internacionais¹⁴
- **IPS (International Patient Summary)**: http://hl7.org/fhir/uv/ips/
- **US Core**: http://hl7.org/fhir/us/core/
- **AU Base**: http://hl7.org.au/fhir/

### 10.2 Reutilização de Componentes
```fsh
// Importar perfil de outro IG
Profile: MyPatient
Parent: http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient
```

## 11. CHECKLIST DE PUBLICAÇÃO

### 11.1 Pré-Publicação
- [ ] Todos os testes passando
- [ ] QA report sem erros críticos
- [ ] Documentação completa
- [ ] Exemplos validados
- [ ] Versão atualizada em sushi-config.yaml
- [ ] Change log atualizado

### 11.2 Publicação
- [ ] Build final executado
- [ ] Package gerado
- [ ] Upload para servidor de publicação
- [ ] Registro no registry FHIR
- [ ] Notificação à comunidade

## 12. REFERÊNCIAS

1. HL7 International. FHIR R5 Specification. Disponível em: http://hl7.org/fhir/R5/
2. HL7 International. Resource ImplementationGuide. Disponível em: http://hl7.org/fhir/R5/implementationguide.html
3. HL7 Wiki. FHIR Implementation Guide Publishing Requirements. Disponível em: https://wiki.hl7.org/FHIR_Implementation_Guide_Publishing_Requirements
4. HL7 International. FHIR Shorthand Specification. Disponível em: https://build.fhir.org/ig/HL7/fhir-shorthand/
5. MITRE. FSH School - Part 1: Reading an IG. Disponível em: https://fshschool.org/courses/fsh-seminar/01-reading-an-ig.html
6. Grieve, G. FHIR Implementation Guide Purposes. HL7 FHIR DevDays Presentation. 2021.
7. MITRE. FSH Quick Start Guide. Disponível em: https://fshschool.org/quickstart/
8. HL7 International. FHIR Shorthand Quick Reference. Version 3.0.0.
9. HL7 International. Extending FHIR. Disponível em: http://hl7.org/fhir/R5/extensibility.html
10. KRAMER, M. & MOESEL, C. Tutorial: Create an Implementation Guide with FHIR Shorthand. HL7 FHIR DevDays 2021.
11. HL7 International. FHIR Versioning. Disponível em: http://hl7.org/fhir/R5/versioning.html
12. HL7 International. Conformance Rules. Disponível em: http://hl7.org/fhir/R5/conformance-rules.html
13. HL7 International. IG Publisher Documentation. Disponível em: https://confluence.hl7.org/display/FHIR/IG+Publisher+Documentation
14. HL7 International. International Patient Summary Implementation Guide. Disponível em: http://hl7.org/fhir/uv/ips/

---
**Documento aprovado por:** [Gerência de Interoperabilidade]  
**Data de vigência:** 2024-2025  
**Próxima revisão:** Janeiro 2026


// ===== Conteúdo de: sop-openehr-integration.md =====

# SOP-004: Integração openEHR com HL7 FHIR Implementation Guides
**Standard Operating Procedure para Persistência de Dados e Interoperabilidade openEHR-FHIR**

## 1. INTRODUÇÃO

### 1.1 Objetivo
Estabelecer procedimentos para integração entre sistemas openEHR e Implementation Guides FHIR, garantindo persistência semântica de dados clínicos e interoperabilidade bidirecional.

### 1.2 Escopo
Aplicável a projetos que necessitam combinar a persistência de longo prazo do openEHR com a interoperabilidade do FHIR, incluindo mapeamento de arquétipos, templates e linguagens de decisão.

### 1.3 Referências Fundamentais
- openEHR Specifications¹: https://specifications.openehr.org/
- openEHR Architecture Overview²: https://specifications.openehr.org/releases/BASE/latest/architecture_overview.html
- Archetype Definition Language (ADL)³: https://specifications.openehr.org/releases/AM/latest/ADL2.html
- Guideline Definition Language (GDL)⁴: https://specifications.openehr.org/releases/CDS/latest/GDL.html
- Decision Language (DL)⁵: https://specifications.openehr.org/releases/PROC/latest/decision_language.html

## 2. FUNDAMENTOS openEHR

### 2.1 Arquitetura de Modelo Dual
O openEHR utiliza uma abordagem de modelo dual⁶:

#### 2.1.1 Reference Model (RM)
```xml
<!-- Modelo de Referência openEHR -->
<composition archetype_node_id="openEHR-EHR-COMPOSITION.encounter.v1">
  <content xsi:type="OBSERVATION" archetype_node_id="openEHR-EHR-OBSERVATION.blood_pressure.v2">
    <data>
      <events xsi:type="POINT_EVENT">
        <data xsi:type="ITEM_TREE">
          <items xsi:type="ELEMENT" archetype_node_id="at0004">
            <value xsi:type="DV_QUANTITY">
              <magnitude>120</magnitude>
              <units>mm[Hg]</units>
            </value>
          </items>
        </data>
      </events>
    </data>
  </content>
</composition>
```

#### 2.1.2 Archetype Model (AM)
```adl
archetype (adl_version=2.0.0)
    openEHR-EHR-OBSERVATION.blood_pressure.v2

concept
    [at0000]    -- Blood pressure

language
    original_language = <[ISO_639-1::en]>
    
definition
    OBSERVATION[at0000] matches {
        data matches {
            HISTORY[at0001] matches {
                events cardinality matches {1..*; unordered} matches {
                    EVENT[at0006] occurrences matches {0..*} matches {
                        data matches {
                            ITEM_TREE[at0003] matches {
                                items cardinality matches {0..*; unordered} matches {
                                    ELEMENT[at0004] occurrences matches {0..1} matches {
                                        value matches {
                                            DV_QUANTITY matches {
                                                property matches {[openehr::125]}
                                                magnitude matches {|0.0..<1000.0|}
                                                units matches {"mm[Hg]"}
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
```

### 2.2 Templates Operacionais (OPT)
Templates combinam arquétipos para casos de uso específicos⁷:

```xml
<template xmlns="http://schemas.openehr.org/v1">
    <id>emergency_encounter</id>
    <name>Emergency Encounter Template</name>
    <definition>
        <root_archetype>openEHR-EHR-COMPOSITION.encounter.v1</root_archetype>
        <include_archetypes>
            <archetype>openEHR-EHR-OBSERVATION.blood_pressure.v2</archetype>
            <archetype>openEHR-EHR-OBSERVATION.pulse.v2</archetype>
            <archetype>openEHR-EHR-EVALUATION.problem_diagnosis.v1</archetype>
        </include_archetypes>
    </definition>
</template>
```

## 3. MAPEAMENTO openEHR-FHIR

### 3.1 Estratégias de Mapeamento⁸

#### 3.1.1 Arquétipos para Recursos FHIR
```javascript
// Mapeamento de Arquétipo para Recurso FHIR
function mapArchetypeToFHIR(archetype) {
    const mapping = {
        'openEHR-EHR-OBSERVATION.blood_pressure.v2': {
            fhirResource: 'Observation',
            profileUrl: 'http://hl7.org/fhir/StructureDefinition/bp',
            mappings: {
                '/data[at0001]/events[at0006]/data[at0003]/items[at0004]': 'component[systolic].valueQuantity',
                '/data[at0001]/events[at0006]/data[at0003]/items[at0005]': 'component[diastolic].valueQuantity',
                '/data[at0001]/events[at0006]/time': 'effectiveDateTime',
                '/subject': 'subject',
                '/protocol[at0011]/items[at0013]': 'bodySite'
            }
        }
    };
    
    return mapping[archetype.archetypeId];
}
```

#### 3.1.2 Templates para Profiles FHIR
```fsh
// Profile FHIR baseado em Template openEHR
Profile: OpenEHRBloodPressure
Parent: Observation
Id: openehr-blood-pressure
Title: "openEHR Blood Pressure Observation"
Description: "Blood pressure mapped from openEHR archetype"

* code = $LOINC#85354-9 "Blood pressure panel"
* component ^slicing.discriminator.type = #pattern
* component ^slicing.discriminator.path = "code"
* component contains
    systolic 1..1 MS and
    diastolic 1..1 MS
* component[systolic].code = $LOINC#8480-6 "Systolic blood pressure"
* component[systolic].value[x] only Quantity
* component[systolic].valueQuantity.system = $UCUM
* component[systolic].valueQuantity.code = #mm[Hg]
* component[diastolic].code = $LOINC#8462-4 "Diastolic blood pressure"
* component[diastolic].value[x] only Quantity
* component[diastolic].valueQuantity.system = $UCUM
* component[diastolic].valueQuantity.code = #mm[Hg]

// Extension para metadados openEHR
* extension contains OpenEHRMetadata named openehrMetadata 0..1 MS

Extension: OpenEHRMetadata
Id: openehr-metadata
Title: "openEHR Metadata"
Description: "Metadados do arquétipo openEHR original"
* extension contains
    archetypeId 1..1 MS and
    templateId 0..1 MS and
    rmVersion 0..1 MS
* extension[archetypeId].value[x] only string
* extension[templateId].value[x] only string
* extension[rmVersion].value[x] only string
```

### 3.2 Conversão Bidirecional⁹

#### 3.2.1 openEHR para FHIR
```javascript
class OpenEHRToFHIRConverter {
    convertComposition(composition) {
        const bundle = {
            resourceType: "Bundle",
            type: "document",
            entry: []
        };
        
        // Converter Composition para Bundle
        const fhirComposition = {
            resourceType: "Composition",
            status: "final",
            type: this.mapConceptToCodeableConcept(composition.category),
            subject: this.mapSubject(composition.subject),
            date: composition.context.start_time,
            author: this.mapComposer(composition.composer),
            section: []
        };
        
        // Converter conteúdo
        composition.content.forEach(content => {
            if (content._type === "OBSERVATION") {
                const observation = this.convertObservation(content);
                bundle.entry.push({
                    resource: observation
                });
                fhirComposition.section.push({
                    entry: [{
                        reference: `Observation/${observation.id}`
                    }]
                });
            }
        });
        
        bundle.entry.unshift({
            resource: fhirComposition
        });
        
        return bundle;
    }
    
    convertObservation(observation) {
        const fhirObs = {
            resourceType: "Observation",
            id: this.generateId(),
            status: "final",
            code: this.mapArchetypeToLOINC(observation.archetype_node_id),
            effectiveDateTime: observation.data.events[0].time,
            value: this.convertDataValue(observation.data.events[0].data)
        };
        
        // Adicionar metadados openEHR
        fhirObs.extension = [{
            url: "http://openehr.org/fhir/StructureDefinition/openehr-metadata",
            extension: [
                {
                    url: "archetypeId",
                    valueString: observation.archetype_node_id
                },
                {
                    url: "rmVersion",
                    valueString: "1.0.4"
                }
            ]
        }];
        
        return fhirObs;
    }
}
```

## 10. MELHORES PRÁTICAS

### 10.1 Design Patterns²³
1. **Use openEHR para persistência de longo prazo**
2. **Use FHIR para interoperabilidade e APIs**
3. **Mantenha mapeamentos versionados**
4. **Implemente cache inteligente**
5. **Sincronize de forma assíncrona**

### 10.2 Checklist de Integração
- [ ] Arquétipos mapeados para Profiles FHIR
- [ ] Templates documentados
- [ ] Conversores bidirecionais testados
- [ ] Validação semântica implementada
- [ ] Performance otimizada
- [ ] Sincronização configurada
- [ ] Fallback strategies definidas
- [ ] Auditoria completa

## 11. TROUBLESHOOTING

### 11.1 Problemas Comuns
| Problema | Causa | Solução |
|----------|-------|---------|
| Perda de dados na conversão | Mapeamento incompleto | Usar extensões FHIR para dados openEHR |
| Performance lenta | Queries complexas | Implementar cache e índices |
| Sincronização falha | Conflitos de versão | Usar event sourcing |
| Validação falha | Incompatibilidade de tipos | Normalizar tipos de dados |

## 12. REFERÊNCIAS

1. openEHR International. openEHR Specifications. https://specifications.openehr.org/
2. openEHR. Architecture Overview. https://specifications.openehr.org/releases/BASE/latest/architecture_overview.html
3. openEHR. Archetype Definition Language 2. https://specifications.openehr.org/releases/AM/latest/ADL2.html
4. openEHR. Guideline Definition Language. https://specifications.openehr.org/releases/CDS/latest/GDL.html
5. openEHR. Decision Language. https://specifications.openehr.org/releases/PROC/latest/decision_language.html
6. Beale T, Heard S. openEHR Architecture: Architecture Overview. openEHR Foundation. 2018.
7. openEHR. Template Object Model. https://specifications.openehr.org/releases/AM/latest/OPT2.html
8. Moner D, et al. Combining Archetypes with Fast Healthcare Interoperability Resources. Stud Health Technol Inform. 2014.
9. LinkEHR. Archetype-based Data Transformation. https://linkehr.com/
10. Anani N, et al. Guideline Definition Language (GDL) - Design Specifications. Cambio Healthcare Systems. 2013.
11. openEHR. Process Model and Decision Language. https://specifications.openehr.org/releases/PROC/latest/
12. openEHR. EHR Information Model. https://specifications.openehr.org/releases/RM/latest/ehr.html
13. Sundvall E, et al. Integration of openEHR and FHIR. MedInfo 2019.
14. Gamma E, et al. Design Patterns: Elements of Reusable Object-Oriented Software. Addison-Wesley. 1994.
15. Ma C, et al. EHR Query Language (EQL). Stud Health Technol Inform. 2007.
16. EHRBase. openEHR Clinical Data Repository. https://ehrbase.org/
17. openEHR. Clinical Knowledge Manager. https://ckm.openehr.org/
18. openEHR. Implementation Technology Specifications. https://specifications.openehr.org/releases/ITS/latest/
19. openEHR. Archetype Object Model. https://specifications.openehr.org/releases/AM/latest/AOM2.html
20. openEHR. Conformance Specifications. https://specifications.openehr.org/releases/CNF/latest/
21. Ocean Health Systems. openEHR Platform Integration Guide. 2021.
22. Better Platform. FHIR-openEHR Migration Guide. 2022.
23. openEHR. Implementation Guide. https://specifications.openehr.org/releases/ITS/latest/implementation_guide.html

---
**Documento aprovado por:** [Comitê de Arquitetura e Integração]  
**Data de vigência:** 2024-2025  
**Próxima revisão:** Janeiro 2026
```

#### 3.2.2 FHIR para openEHR
```javascript
class FHIRToOpenEHRConverter {
    convertBundle(bundle) {
        const composition = {
            _type: "COMPOSITION",
            archetype_node_id: this.mapProfileToArchetype(bundle.entry[0].resource.meta?.profile),
            language: {
                terminology_id: {value: "ISO_639-1"},
                code_string: "en"
            },
            territory: {
                terminology_id: {value: "ISO_3166-1"},
                code_string: "US"
            },
            category: this.mapCodeableConceptToDvCodedText(bundle.entry[0].resource.type),
            composer: this.mapAuthorToComposer(bundle.entry[0].resource.author),
            content: []
        };
        
        // Converter recursos para conteúdo openEHR
        bundle.entry.slice(1).forEach(entry => {
            if (entry.resource.resourceType === "Observation") {
                composition.content.push(
                    this.convertObservationToOpenEHR(entry.resource)
                );
            }
        });
        
        return composition;
    }
}
```

## 4. LINGUAGENS DE DECISÃO CLÍNICA

### 4.1 Guideline Definition Language (GDL)¹⁰

#### 4.1.1 GDL versão 2
```gdl2
(GUIDE) <
    gdl_version = <"2.0">
    id = <"CHA2DS2VASc_Score.v1">
    concept = <"gt0001">
    
    definition = (GUIDE_DEFINITION) <
        archetype_bindings = <
            ["gt0002"] = (ARCHETYPE_BINDING) <
                archetype_id = <"openEHR-EHR-OBSERVATION.chadsvasc_score.v1">
                domain = <"CDS">
                elements = <
                    ["gt0003"] = (ELEMENT_BINDING) <
                        path = <"/data[at0001]/events[at0002]/data[at0003]/items[at0004]">
                    >
                >
            >
        >
        
        rules = <
            ["gt0010"] = (RULE) <
                when = <"$gt0003 != null">
                then = <"$gt0004 = $gt0003.value">
                priority = <1>
            >
        >
    >
>
```

#### 4.1.2 Integração GDL com FHIR CQL
```cql
// CQL equivalente ao GDL
library CHA2DS2VAScScore version '1.0'

using FHIR version '4.0.1'

include FHIRHelpers version '4.0.1'

context Patient

define "CHA2DS2-VASc Score":
  let
    AgeScore: if AgeInYears() >= 75 then 2
              else if AgeInYears() >= 65 then 1
              else 0,
    SexScore: if Patient.gender = 'female' then 1 else 0,
    CHFScore: if exists([Condition: "Congestive Heart Failure"]) then 1 else 0,
    HypertensionScore: if exists([Condition: "Hypertension"]) then 1 else 0,
    StrokeScore: if exists([Condition: "Stroke"]) then 2 else 0,
    VascularScore: if exists([Condition: "Vascular Disease"]) then 1 else 0,
    DiabetesScore: if exists([Condition: "Diabetes"]) then 1 else 0
  return
    AgeScore + SexScore + CHFScore + HypertensionScore + 
    StrokeScore + VascularScore + DiabetesScore
```

### 4.2 Decision Language (DL)¹¹

#### 4.2.1 Decision Logic Module (DLM)
```yaml
dlm_version: "1.0"
id: "medication_check"
description: "Check medication interactions"

preconditions:
  - "has_active_medications"
  
data_context:
  medications:
    source: "EHR"
    archetype: "openEHR-EHR-INSTRUCTION.medication_order.v3"
    
  allergies:
    source: "EHR"  
    archetype: "openEHR-EHR-EVALUATION.adverse_reaction_risk.v2"

rules:
  - id: "check_allergy"
    when:
      all:
        - "$medications.agent matches $allergies.substance"
    then:
      - create_alert:
          severity: "high"
          message: "Potential allergic reaction"
          
  - id: "check_interaction"
    when:
      all:
        - "$medications.count() > 1"
        - "has_interaction($medications)"
    then:
      - create_warning:
          severity: "medium"
          message: "Drug interaction detected"
```

#### 4.2.2 Mapeamento DL para CDS Hooks
```javascript
// Converter DLM para CDS Hooks Card
function convertDLMToCDSHooks(dlm, context) {
    const cards = [];
    
    dlm.rules.forEach(rule => {
        if (evaluateCondition(rule.when, context)) {
            rule.then.forEach(action => {
                if (action.create_alert || action.create_warning) {
                    cards.push({
                        summary: action.message,
                        indicator: mapSeverityToIndicator(action.severity),
                        source: {
                            label: dlm.description,
                            url: `http://openehr.org/dlm/${dlm.id}`
                        }
                    });
                }
            });
        }
    });
    
    return cards;
}
```

## 5. PERSISTÊNCIA DE DADOS

### 5.1 Arquitetura de Persistência¹²

#### 5.1.1 Clinical Data Repository (CDR)
```yaml
# Configuração CDR openEHR
cdr_configuration:
  type: "openEHR"
  version: "1.0.4"
  
  storage:
    type: "postgresql"
    schema: "versioned"
    
  indices:
    - archetype_id
    - template_id
    - uid
    - time_created
    
  partitioning:
    strategy: "by_date"
    interval: "monthly"
    
  archetype_repository:
    url: "https://ckm.openehr.org/ckm"
    cache: true
    
  template_repository:
    local: "/opt/openehr/templates"
    
  api_endpoints:
    rest: "http://localhost:8080/ehrbase/rest/v1"
    fhir: "http://localhost:8080/fhir/r4"
```

#### 5.1.2 Versionamento de Dados
```sql
-- Estrutura de versionamento openEHR
CREATE TABLE ehr.versioned_composition (
    uid UUID PRIMARY KEY,
    ehr_id UUID NOT NULL,
    time_created TIMESTAMPTZ NOT NULL,
    
    -- Versionamento
    version_tree_id TEXT NOT NULL,
    preceding_version_uid UUID,
    lifecycle_state TEXT NOT NULL,
    
    -- Dados
    data JSONB NOT NULL,
    
    -- Auditoria
    committer_name TEXT NOT NULL,
    committer_id TEXT NOT NULL,
    change_type TEXT NOT NULL,
    description TEXT,
    
    -- Índices para busca
    archetype_node_id TEXT NOT NULL,
    template_id TEXT,
    
    CONSTRAINT fk_ehr 
        FOREIGN KEY (ehr_id) 
        REFERENCES ehr.ehr(id)
);

-- Índices otimizados
CREATE INDEX idx_archetype ON ehr.versioned_composition(archetype_node_id);
CREATE INDEX idx_template ON ehr.versioned_composition(template_id);
CREATE INDEX idx_time ON ehr.versioned_composition(time_created);
CREATE INDEX idx_data_gin ON ehr.versioned_composition USING gin(data);
```

### 5.2 Sincronização openEHR-FHIR¹³

#### 5.2.1 Event-Driven Synchronization
```javascript
class OpenEHRFHIRSynchronizer {
    constructor(openehrClient, fhirClient) {
        this.openehr = openehrClient;
        this.fhir = fhirClient;
        this.converter = new OpenEHRToFHIRConverter();
    }
    
    async syncComposition(compositionUid) {
        try {
            // Buscar composition do openEHR
            const composition = await this.openehr.getComposition(compositionUid);
            
            // Converter para FHIR Bundle
            const bundle = this.converter.convertComposition(composition);
            
            // Adicionar metadados de sincronização
            bundle.meta = {
                lastUpdated: new Date().toISOString(),
                tag: [{
                    system: "http://openehr.org/sync",
                    code: "synchronized",
                    display: `Synced from openEHR composition ${compositionUid}`
                }]
            };
            
            // Enviar para servidor FHIR
            const result = await this.fhir.transaction(bundle);
            
            // Registrar sincronização
            await this.logSync(compositionUid, result.id, 'success');
            
            return result;
            
        } catch (error) {
            await this.logSync(compositionUid, null, 'error', error.message);
            throw error;
        }
    }
    
    async setupWebhook() {
        // Configurar webhook no openEHR para mudanças
        await this.openehr.registerWebhook({
            url: 'http://fhir-sync/webhook',
            events: ['composition.created', 'composition.updated'],
            filters: {
                archetypes: ['openEHR-EHR-COMPOSITION.encounter.v1']
            }
        });
    }
}
```

## 6. ARQUITETURA DE INTEGRAÇÃO

### 6.1 Padrão Facade¹⁴
```javascript
// Facade para unificar acesso openEHR/FHIR
class ClinicalDataFacade {
    constructor() {
        this.openehrRepo = new OpenEHRRepository();
        this.fhirRepo = new FHIRRepository();
        this.cache = new RedisCache();
    }
    
    async getPatientData(patientId, format = 'fhir') {
        // Verificar cache
        const cacheKey = `patient:${patientId}:${format}`;
        const cached = await this.cache.get(cacheKey);
        if (cached) return cached;
        
        // Buscar dados do openEHR (fonte de verdade)
        const ehrId = await this.openehrRepo.getEhrId(patientId);
        const compositions = await this.openehrRepo.getCompositions(ehrId);
        
        // Retornar no formato solicitado
        let result;
        if (format === 'fhir') {
            result = await this.convertToFHIR(compositions);
        } else if (format === 'openehr') {
            result = compositions;
        } else {
            throw new Error(`Unsupported format: ${format}`);
        }
        
        // Cachear resultado
        await this.cache.set(cacheKey, result, 300); // 5 minutos
        
        return result;
    }
    
    async saveObservation(observation, source = 'fhir') {
        let openehrData;
        
        if (source === 'fhir') {
            // Converter FHIR para openEHR
            openehrData = await this.convertToOpenEHR(observation);
        } else {
            openehrData = observation;
        }
        
        // Salvar no openEHR (persistência principal)
        const result = await this.openehrRepo.saveObservation(openehrData);
        
        // Sincronizar com FHIR (para interoperabilidade)
        if (source === 'openehr') {
            const fhirData = await this.convertToFHIR(openehrData);
            await this.fhirRepo.saveObservation(fhirData);
        }
        
        // Invalidar cache
        await this.cache.invalidate(`patient:${observation.subject}`);
        
        return result;
    }
}
```

### 6.2 Query Integration¹⁵

#### 6.2.1 Archetype Query Language (AQL)
```aql
-- Query AQL para buscar pressões arteriais
SELECT
    c/context/start_time as encounter_time,
    o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude as systolic,
    o/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude as diastolic
FROM
    EHR e
    CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.encounter.v1]
    CONTAINS OBSERVATION o[openEHR-EHR-OBSERVATION.blood_pressure.v2]
WHERE
    e/ehr_id/value = $ehrId
    AND c/context/start_time > $startDate
ORDER BY
    c/context/start_time DESC
```

#### 6.2.2 Conversão AQL para FHIR Search
```javascript
class AQLToFHIRSearchConverter {
    convertAQL(aql) {
        // Parser simplificado de AQL
        const parsed = this.parseAQL(aql);
        
        // Mapear para parâmetros FHIR
        const searchParams = {};
        
        if (parsed.archetypes.includes('blood_pressure')) {
            searchParams.code = 'http://loinc.org|85354-9';
        }
        
        if (parsed.where.ehrId) {
            searchParams.patient = this.mapEhrIdToPatientId(parsed.where.ehrId);
        }
        
        if (parsed.where.startDate) {
            searchParams.date = `ge${parsed.where.startDate}`;
        }
        
        if (parsed.orderBy) {
            searchParams._sort = '-date';
        }
        
        return searchParams;
    }
    
    async executeHybridQuery(aql) {
        // Tentar primeiro no FHIR (mais rápido)
        const searchParams = this.convertAQL(aql);
        let results = await this.fhirClient.search('Observation', searchParams);
        
        // Se não encontrar, buscar no openEHR
        if (results.total === 0) {
            const openehrResults = await this.openehrClient.query(aql);
            results = await this.convertResults(openehrResults);
        }
        
        return results;
    }
}
```

## 7. FERRAMENTAS E PLATAFORMAS

### 7.1 Plataformas openEHR¹⁶
- **EHRBase**: https://ehrbase.org/
- **Better Platform**: https://platform.better.care/
- **Ocean Platform**: https://oceanhealthsystems.com/
- **EtherCIS**: https://ethercis.org/ (descontinuado)

### 7.2 Ferramentas de Modelagem¹⁷
- **Archetype Designer**: https://tools.openehr.org/designer/
- **LinkEHR**: https://linkehr.com/
- **Template Designer**: https://tools.openehr.org/templateDesigner/
- **CKM (Clinical Knowledge Manager)**: https://ckm.openehr.org/

### 7.3 Bibliotecas de Integração¹⁸
```json
{
  "dependencies": {
    "openehr-js": "^2.0.0",
    "fhir": "^4.11.0",
    "archetype-validator": "^1.0.0",
    "aql-parser": "^0.5.0",
    "gdl-tools": "^1.2.0"
  }
}
```

## 8. VALIDAÇÃO E CONFORMIDADE

### 8.1 Validação de Arquétipos¹⁹
```javascript
class ArchetypeValidator {
    validateAgainstRM(data, archetype) {
        const errors = [];
        
        // Validar estrutura do RM
        if (!this.isValidRMType(data._type)) {
            errors.push(`Invalid RM type: ${data._type}`);
        }
        
        // Validar constraints do arquétipo
        archetype.definition.attributes.forEach(attr => {
            if (attr.existence.lower > 0 && !data[attr.rm_attribute_name]) {
                errors.push(`Missing required attribute: ${attr.rm_attribute_name}`);
            }
            
            if (data[attr.rm_attribute_name]) {
                const validation = this.validateAttribute(
                    data[attr.rm_attribute_name],
                    attr.children[0]
                );
                errors.push(...validation.errors);
            }
        });
        
        return {
            valid: errors.length === 0,
            errors
        };
    }
}
```

### 8.2 Testes de Integração²⁰
```javascript
describe('openEHR-FHIR Integration', () => {
    test('Should convert blood pressure observation bidirectionally', async () => {
        // openEHR para FHIR
        const openehrObs = createOpenEHRBloodPressure(120, 80);
        const fhirObs = await converter.toFHIR(openehrObs);
        
        expect(fhirObs.resourceType).toBe('Observation');
        expect(fhirObs.component[0].valueQuantity.value).toBe(120);
        
        // FHIR para openEHR
        const backToOpenEHR = await converter.toOpenEHR(fhirObs);
        
        expect(backToOpenEHR.archetype_node_id).toBe(
            'openEHR-EHR-OBSERVATION.blood_pressure.v2'
        );
    });
    
    test('Should preserve semantic meaning', async () => {
        const original = createComplexComposition();
        const fhir = await converter.toFHIR(original);
        const restored = await converter.toOpenEHR(fhir);
        
        expect(semanticCompare(original, restored)).toBe(true);
    });
});
```

## 9. CASOS DE USO

### 9.1 Caso: Hospital com openEHR expondo API FHIR²¹
```yaml
architecture:
  components:
    - name: "Legacy EHR"
      type: "proprietary"
      
    - name: "openEHR CDR"
      type: "ehrbase"
      purpose: "Long-term clinical data storage"
      
    - name: "FHIR Facade"
      type: "custom"
      purpose: "FHIR API for external integration"
      
    - name: "Sync Service"
      type: "kafka-connect"
      purpose: "Real-time synchronization"
      
  flow:
    1: "Legacy EHR → ETL → openEHR CDR"
    2: "openEHR CDR → Converter → FHIR Facade"
    3: "External Apps ← FHIR API ← FHIR Facade"
```

### 9.2 Caso: Migração FHIR para openEHR²²
```javascript
class FHIRToOpenEHRMigration {
    async migrate(fhirServerUrl, openehrServer) {
        const stats = {
            total: 0,
            migrated: 0,
            errors: []
        };
        
        // Buscar todos os pacientes
        const patients = await this.fhirClient.search('Patient', {
            _count: 1000
        });
        
        for (const patient of patients.entry) {
            try {
                // Criar EHR no openEHR
                const ehrId = await this.createEHR(patient.resource);
                
                // Migrar observações
                const observations = await this.fhirClient.search('Observation', {
                    patient: patient.resource.id
                });
                
                for (const obs of observations.entry) {
                    const openehrObs = await this.converter.toOpenEHR(obs.resource);
                    await this.openehrClient.saveObservation(ehrId, openehrObs);
                }
                
                stats.migrated++;
            } catch (error) {
                stats.errors.push({
                    patient: patient.resource.id,
                    error: error.message
                });
            }
            
            stats.total++;
        }
        
        return stats;
    }
}


// ===== Conteúdo de: sop-omop-analytics.md =====

# SOP-005: OMOP CDM e Análise de Dados com FHIR IGs
**Standard Operating Procedure para Integração OMOP Common Data Model com Implementation Guides FHIR**

## 1. INTRODUÇÃO

### 1.1 Objetivo
Estabelecer procedimentos para integração entre OMOP CDM (Observational Medical Outcomes Partnership Common Data Model) e FHIR IGs, facilitando análises observacionais e pesquisa em mundo real.

### 1.2 Escopo
Aplicável a projetos de análise de dados observacionais, estudos de coorte, farmacovigilância e pesquisa de efetividade comparativa usando dados harmonizados.

### 1.3 Referências Fundamentais
- OHDSI Documentation¹: https://ohdsi.github.io/TheBookOfOhdsi/
- OMOP CDM v5.4²: https://ohdsi.github.io/CommonDataModel/
- FHIR to OMOP Mapping³: https://build.fhir.org/ig/HL7/fhir-omop-ig/
- Sentinel Initiative⁴: https://www.sentinelinitiative.org/
- i2b2 (Predecessor)⁵: https://www.i2b2.org/

## 2. FUNDAMENTOS OMOP CDM

### 2.1 Evolução Histórica⁶

#### 2.1.1 Antecessores do OMOP
```mermaid
timeline
    title Evolução dos Modelos de Dados Observacionais
    
    2004 : i2b2 (Informatics for Integrating Biology and the Bedside)
    2008 : Sentinel Common Data Model (FDA)
    2009 : OMOP CDM v1 (FNIH)
    2012 : OMOP CDM v4 (IMEDS)
    2014 : OHDSI formado (OMOP CDM v5)
    2020 : OMOP CDM v5.3
    2023 : OMOP CDM v5.4
    2024 : FHIR-OMOP Integration
```

#### 2.1.2 Benefícios da Integração OMOP-FHIR⁷
1. **Interoperabilidade**: FHIR para troca de dados
2. **Análise**: OMOP para pesquisa observacional
3. **Padronização**: Vocabulários harmonizados
4. **Escalabilidade**: Análises em rede distribuída
5. **Reprodutibilidade**: Estudos padronizados

### 2.2 Estrutura do OMOP CDM⁸

#### 2.2.1 Domínios Principais
```sql
-- Estrutura básica OMOP CDM v5.4
CREATE SCHEMA omop;

-- Domínio Clínico
CREATE TABLE omop.person (
    person_id INTEGER PRIMARY KEY,
    gender_concept_id INTEGER NOT NULL,
    year_of_birth INTEGER NOT NULL,
    month_of_birth INTEGER,
    day_of_birth INTEGER,
    birth_datetime TIMESTAMP,
    race_concept_id INTEGER NOT NULL,
    ethnicity_concept_id INTEGER NOT NULL,
    location_id INTEGER,
    provider_id INTEGER,
    care_site_id INTEGER,
    person_source_value VARCHAR(50),
    gender_source_value VARCHAR(50),
    race_source_value VARCHAR(50),
    ethnicity_source_value VARCHAR(50)
);

CREATE TABLE omop.observation_period (
    observation_period_id INTEGER PRIMARY KEY,
    person_id INTEGER NOT NULL,
    observation_period_start_date DATE NOT NULL,
    observation_period_end_date DATE NOT NULL,
    period_type_concept_id INTEGER NOT NULL,
    FOREIGN KEY (person_id) REFERENCES omop.person(person_id)
);

CREATE TABLE omop.condition_occurrence (
    condition_occurrence_id INTEGER PRIMARY KEY,
    person_id INTEGER NOT NULL,
    condition_concept_id INTEGER NOT NULL,
    condition_start_date DATE NOT NULL,
    condition_start_datetime TIMESTAMP,
    condition_end_date DATE,
    condition_end_datetime TIMESTAMP,
    condition_type_concept_id INTEGER NOT NULL,
    stop_reason VARCHAR(20),
    provider_id INTEGER,
    visit_occurrence_id INTEGER,
    condition_source_value VARCHAR(50),
    condition_source_concept_id INTEGER,
    condition_status_source_value VARCHAR(50),
    condition_status_concept_id INTEGER
);
```

#### 2.2.2 Vocabulários Padronizados
```sql
-- Tabelas de vocabulário
CREATE TABLE omop.concept (
    concept_id INTEGER PRIMARY KEY,
    concept_name VARCHAR(255) NOT NULL,
    domain_id VARCHAR(20) NOT NULL,
    vocabulary_id VARCHAR(20) NOT NULL,
    concept_class_id VARCHAR(20) NOT NULL,
    standard_concept VARCHAR(1),
    concept_code VARCHAR(50) NOT NULL,
    valid_start_date DATE NOT NULL,
    valid_end_date DATE NOT NULL,
    invalid_reason VARCHAR(1)
);

CREATE TABLE omop.concept_relationship (
    concept_id_1 INTEGER NOT NULL,
    concept_id_2 INTEGER NOT NULL,
    relationship_id VARCHAR(20) NOT NULL,
    valid_start_date DATE NOT NULL,
    valid_end_date DATE NOT NULL,
    invalid_reason VARCHAR(1)
);

CREATE TABLE omop.concept_ancestor (
    ancestor_concept_id INTEGER NOT NULL,
    descendant_concept_id INTEGER NOT NULL,
    min_levels_of_separation INTEGER NOT NULL,
    max_levels_of_separation INTEGER NOT NULL
);
```

## 3. MAPEAMENTO FHIR-OMOP

### 3.1 Estratégias de ETL⁹

#### 3.1.1 FHIR Resources para OMOP Tables
```javascript
class FHIRToOMOPMapper {
    constructor(omopDb, fhirClient) {
        this.omop = omopDb;
        this.fhir = fhirClient;
        this.conceptMapper = new ConceptMapper();
    }
```

### 6.2 ACHILLES¹⁶

```r
# Executar ACHILLES para caracterização do CDM
library(Achilles)

achilles(
  connectionDetails = connectionDetails,
  cdmDatabaseSchema = "omop",
  resultsDatabaseSchema = "achilles_results",
  sourceName = "MyDataSource",
  createTable = TRUE,
  smallCellCount = 5,
  cdmVersion = "5.4",
  runHeel = TRUE,
  runCostAnalysis = FALSE
)

# Exportar resultados para JSON
exportToJson(
  connectionDetails = connectionDetails,
  cdmDatabaseSchema = "omop",
  resultsDatabaseSchema = "achilles_results",
  outputPath = "achilles_results"
)
```

## 7. QUALIDADE DE DADOS

### 7.1 Data Quality Dashboard¹⁷

```sql
-- Verificações de qualidade de dados
-- Baseado no OHDSI Data Quality Dashboard

-- Completude
SELECT 
    'person' as table_name,
    'gender_concept_id' as field_name,
    COUNT(*) as total_records,
    SUM(CASE WHEN gender_concept_id IS NULL OR gender_concept_id = 0 THEN 1 ELSE 0 END) as null_count,
    ROUND(100.0 * SUM(CASE WHEN gender_concept_id IS NULL OR gender_concept_id = 0 THEN 1 ELSE 0 END) / COUNT(*), 2) as null_percentage
FROM omop.person
UNION ALL
SELECT 
    'condition_occurrence',
    'condition_concept_id',
    COUNT(*),
    SUM(CASE WHEN condition_concept_id = 0 THEN 1 ELSE 0 END),
    ROUND(100.0 * SUM(CASE WHEN condition_concept_id = 0 THEN 1 ELSE 0 END) / COUNT(*), 2)
FROM omop.condition_occurrence;

-- Conformidade
SELECT 
    'Invalid concept mappings' as check_name,
    COUNT(*) as failed_records
FROM omop.condition_occurrence co
LEFT JOIN omop.concept c ON co.condition_concept_id = c.concept_id
WHERE c.concept_id IS NULL OR c.invalid_reason IS NOT NULL;

-- Plausibilidade
SELECT 
    'Future dates' as check_name,
    COUNT(*) as failed_records
FROM omop.condition_occurrence
WHERE condition_start_date > CURRENT_DATE;
```

### 7.2 Métricas de Mapeamento¹⁸

```python
# Análise de qualidade do mapeamento FHIR-OMOP
import pandas as pd
import numpy as np
from sqlalchemy import create_engine

class MappingQualityAnalyzer:
    def __init__(self, omop_engine, fhir_client):
        self.omop = omop_engine
        self.fhir = fhir_client
    
    def analyze_concept_coverage(self):
        """Analisa cobertura de conceitos mapeados"""
        
        query = """
        SELECT 
            vocabulary_id,
            COUNT(*) as total_concepts,
            SUM(CASE WHEN standard_concept = 'S' THEN 1 ELSE 0 END) as standard_concepts,
            SUM(CASE WHEN concept_id IN (
                SELECT DISTINCT condition_source_concept_id 
                FROM omop.condition_occurrence
                WHERE condition_source_concept_id != 0
            ) THEN 1 ELSE 0 END) as used_concepts
        FROM omop.concept
        WHERE invalid_reason IS NULL
        GROUP BY vocabulary_id
        """
        
        df = pd.read_sql(query, self.omop)
        df['coverage_rate'] = df['used_concepts'] / df['total_concepts'] * 100
        
        return df
    
    def validate_temporal_consistency(self):
        """Valida consistência temporal entre FHIR e OMOP"""
        
        # Comparar datas entre sistemas
        fhir_conditions = self.fhir.search('Condition', {
            '_count': 1000
        })
        
        fhir_dates = []
        for entry in fhir_conditions.entry:
            if entry.resource.onsetDateTime:
                fhir_dates.append({
                    'id': entry.resource.id,
                    'date': entry.resource.onsetDateTime
                })
        
        fhir_df = pd.DataFrame(fhir_dates)
        
        omop_query = """
        SELECT 
            condition_source_value as id,
            condition_start_date as date
        FROM omop.condition_occurrence
        WHERE condition_source_value IN ({})
        """.format(','.join([f"'{id}'" for id in fhir_df['id']]))
        
        omop_df = pd.read_sql(omop_query, self.omop)
        
        # Comparar datas
        merged = pd.merge(fhir_df, omop_df, on='id', suffixes=('_fhir', '_omop'))
        merged['date_match'] = merged['date_fhir'] == merged['date_omop']
        
        consistency_rate = merged['date_match'].mean() * 100
        
        return {
            'total_records': len(merged),
            'matching_dates': merged['date_match'].sum(),
            'consistency_rate': consistency_rate
        }
```

## 8. CASOS DE USO AVANÇADOS

### 8.1 Farmacovigilância¹⁹

```sql
-- Detecção de eventos adversos usando OMOP
WITH drug_exposure_cohort AS (
    SELECT 
        de.person_id,
        de.drug_exposure_start_date as index_date,
        de.drug_concept_id,
        c.concept_name as drug_name
    FROM omop.drug_exposure de
    JOIN omop.concept c ON de.drug_concept_id = c.concept_id
    WHERE de.drug_concept_id IN (
        SELECT descendant_concept_id
        FROM omop.concept_ancestor
        WHERE ancestor_concept_id = 1140088 -- ACE inhibitors
    )
),
outcome_cohort AS (
    SELECT 
        co.person_id,
        co.condition_start_date as outcome_date,
        co.condition_concept_id,
        c.concept_name as condition_name
    FROM omop.condition_occurrence co
    JOIN omop.concept c ON co.condition_concept_id = c.concept_id
    WHERE co.condition_concept_id = 432791 -- Angioedema
),
exposed_with_outcome AS (
    SELECT 
        dec.person_id,
        dec.drug_name,
        oc.condition_name,
        dec.index_date,
        oc.outcome_date,
        oc.outcome_date - dec.index_date as days_to_event
    FROM drug_exposure_cohort dec
    JOIN outcome_cohort oc ON 
        dec.person_id = oc.person_id AND
        oc.outcome_date BETWEEN dec.index_date AND dec.index_date + 30
)
SELECT 
    drug_name,
    condition_name,
    COUNT(DISTINCT person_id) as case_count,
    AVG(days_to_event) as avg_days_to_event,
    MIN(days_to_event) as min_days_to_event,
    MAX(days_to_event) as max_days_to_event
FROM exposed_with_outcome
GROUP BY drug_name, condition_name;
```

### 8.2 Efetividade Comparativa²⁰

```python
# Análise de efetividade comparativa
from pyspark.sql import SparkSession
from pyspark.sql.functions import *

class ComparativeEffectivenessAnalysis:
    def __init__(self, spark_session):
        self.spark = spark_session
    
    def compare_treatments(self, treatment_a_concept, treatment_b_concept, outcome_concept):
        """
        Compara efetividade de dois tratamentos
        """
        
        # Carregar dados OMOP
        drug_exposure = self.spark.table("omop.drug_exposure")
        condition_occurrence = self.spark.table("omop.condition_occurrence")
        person = self.spark.table("omop.person")
        
        # Identificar coortes de tratamento
        treatment_a = drug_exposure.filter(
            col("drug_concept_id") == treatment_a_concept
        ).select(
            col("person_id"),
            col("drug_exposure_start_date").alias("treatment_start"),
            lit("A").alias("treatment_group")
        )
        
        treatment_b = drug_exposure.filter(
            col("drug_concept_id") == treatment_b_concept
        ).select(
            col("person_id"),
            col("drug_exposure_start_date").alias("treatment_start"),
            lit("B").alias("treatment_group")
        )
        
        # Combinar coortes
        cohort = treatment_a.union(treatment_b)
        
        # Identificar outcomes
        outcomes = condition_occurrence.filter(
            col("condition_concept_id") == outcome_concept
        ).select(
            col("person_id"),
            col("condition_start_date").alias("outcome_date")
        )
        
        # Join e calcular time-to-event
        results = cohort.join(
            outcomes,
            (cohort.person_id == outcomes.person_id) &
            (outcomes.outcome_date > cohort.treatment_start),
            "left"
        ).withColumn(
            "time_to_event",
            datediff(col("outcome_date"), col("treatment_start"))
        ).withColumn(
            "had_outcome",
            when(col("outcome_date").isNotNull(), 1).otherwise(0)
        )
        
        # Calcular estatísticas
        stats = results.groupBy("treatment_group").agg(
            count("*").alias("n_patients"),
            sum("had_outcome").alias("n_outcomes"),
            avg("time_to_event").alias("avg_time_to_event"),
            stddev("time_to_event").alias("std_time_to_event")
        ).withColumn(
            "outcome_rate",
            col("n_outcomes") / col("n_patients")
        )
        
        return stats.toPandas()
```

## 9. INTEGRAÇÃO COM IG FHIR

### 9.1 IG para Pesquisa Observacional²¹

```fsh
// Implementation Guide para integração OMOP
ImplementationGuide: OMOPResearchIG
Id: omop-research-ig
Title: "OMOP Research Integration Guide"
Status: active
Version: 1.0.0
FhirVersion: 4.0.1

* definition.resource[+].reference.reference = "StructureDefinition/omop-patient"
* definition.resource[=].name = "OMOP Compatible Patient"
* definition.resource[=].description = "Patient profile for OMOP integration"
* definition.resource[=].exampleBoolean = false

* definition.resource[+].reference.reference = "StructureDefinition/omop-condition"
* definition.resource[=].name = "OMOP Compatible Condition"
* definition.resource[=].description = "Condition profile for OMOP integration"
* definition.resource[=].exampleBoolean = false

* definition.resource[+].reference.reference = "ConceptMap/fhir-to-omop-gender"
* definition.resource[=].name = "FHIR to OMOP Gender Mapping"
* definition.resource[=].description = "Maps FHIR gender to OMOP concepts"
* definition.resource[=].exampleBoolean = false

* definition.page.nameUrl = "index.html"
* definition.page.title = "OMOP Research Integration Guide"
* definition.page.generation = #html
* definition.page.page[+].nameUrl = "etl.html"
* definition.page.page[=].title = "ETL Guidelines"
* definition.page.page[=].generation = #markdown
* definition.page.page[+].nameUrl = "mapping.html"
* definition.page.page[=].title = "Vocabulary Mapping"
* definition.page.page[=].generation = #markdown
```

### 9.2 Operações Customizadas²²

```fsh
// Operação para converter FHIR Bundle para OMOP
OperationDefinition: ConvertToOMOP
Id: convert-to-omop
Title: "Convert FHIR to OMOP"
Status: active
Kind: operation
Code: convert-to-omop
System: false
Type: true
Instance: false
Resource: Bundle

* parameter[+].name = #input
* parameter[=].use = #in
* parameter[=].min = 1
* parameter[=].max = "1"
* parameter[=].type = #Bundle
* parameter[=].documentation = "FHIR Bundle to convert"

* parameter[+].name = #targetDatabase
* parameter[=].use = #in
* parameter[=].min = 1
* parameter[=].max = "1"
* parameter[=].type = #string
* parameter[=].documentation = "Target OMOP database identifier"

* parameter[+].name = #mappingVersion
* parameter[=].use = #in
* parameter[=].min = 0
* parameter[=].max = "1"
* parameter[=].type = #string
* parameter[=].documentation = "Version of mapping to use"

* parameter[+].name = #result
* parameter[=].use = #out
* parameter[=].min = 1
* parameter[=].max = "1"
* parameter[=].type = #OperationOutcome
* parameter[=].documentation = "Result of conversion"

* parameter[+].name = #statistics
* parameter[=].use = #out
* parameter[=].min = 0
* parameter[=].max = "1"
* parameter[=].part[+].name = #recordsProcessed
* parameter[=].part[=].type = #integer
* parameter[=].part[+].name = #recordsMapped
* parameter[=].part[=].type = #integer
* parameter[=].part[+].name = #errors
* parameter[=].part[=].type = #integer
```

## 10. MELHORES PRÁTICAS

### 10.1 Checklist de Integração²³
- [ ] Mapeamento de vocabulários documentado
- [ ] ETL pipeline testado
- [ ] Validação de dados implementada
- [ ] ACHILLES executado
- [ ] Data Quality Dashboard configurado
- [ ] Backup e recovery configurados
- [ ] Documentação de conceitos locais
- [ ] Treinamento da equipe

### 10.2 Recomendações
1. **Preservar dados fonte**: Sempre manter valores originais
2. **Mapear para conceitos padrão**: Usar vocabulários OMOP
3. **Validar continuamente**: Implementar checks automáticos
4. **Versionar mapeamentos**: Controlar mudanças
5. **Documentar decisões**: Manter log de mapeamentos

## 11. REFERÊNCIAS

1. OHDSI Collaborative. The Book of OHDSI. 2021. https://ohdsi.github.io/TheBookOfOhdsi/
2. OMOP CDM Working Group. OMOP Common Data Model v5.4. https://ohdsi.github.io/CommonDataModel/
3. HL7 International. FHIR to OMOP Implementation Guide. https://build.fhir.org/ig/HL7/fhir-omop-ig/
4. FDA. Sentinel Initiative. https://www.sentinelinitiative.org/
5. i2b2 tranSMART Foundation. Informatics for Integrating Biology and the Bedside. https://www.i2b2.org/
6. Overhage JM, et al. Validation of a common data model for active safety surveillance research. J Am Med Inform Assoc. 2012.
7. Zhang X, et al. FHIRChain: Applying Blockchain to Securely and Scalably Share Clinical Data. Comput Struct Biotechnol J. 2018.
8. OHDSI. OMOP CDM Documentation. https://ohdsi.github.io/CommonDataModel/cdm54.html
9. Reinecke I, et al. The FHIR to OMOP ETL. Stud Health Technol Inform. 2021.
10. HL7 FHIR. US Core Implementation Guide. http://hl7.org/fhir/us/core/
11. Garza M, et al. Evaluating common data models for use with a longitudinal community registry. J Biomed Inform. 2016.
12. Apache Spark. Healthcare Analytics with Spark. https://spark.apache.org/
13. Hripcsak G, et al. Characterizing treatment pathways at scale using the OHDSI network. PNAS. 2016.
14. Schuemie MJ, et al. Principles of Large-scale Evidence Generation and Evaluation across a Network of Databases. 2020.
15. OHDSI. ATLAS Documentation. https://github.com/OHDSI/Atlas/wiki
16. OHDSI. ACHILLES Documentation. https://github.com/OHDSI/Achilles
17. OHDSI. Data Quality Dashboard. https://github.com/OHDSI/DataQualityDashboard
18. Kahn MG, et al. A Harmonized Data Quality Assessment Terminology and Framework. JAMIA. 2016.
19. Ryan PB, et al. Defining a reference set to support methodological research in drug safety. Drug Saf. 2013.
20. Suchard MA, et al. Comprehensive comparative effectiveness and safety of first-line antihypertensive drug classes. Lancet. 2019.
21. FHIR Foundation. Implementation Guide Registry. https://registry.fhir.org/
22. HL7 FHIR. OperationDefinition Resource. http://hl7.org/fhir/operationdefinition.html
23. OHDSI. OMOP CDM Conventions. https://ohdsi.github.io/CommonDataModel/conventions.html

---
**Documento aprovado por:** [Comitê de Pesquisa e Análise de Dados]  
**Data de vigência:** 2024-2025  
**Próxima revisão:** Janeiro 2026
    
    async mapPatient(fhirPatient) {
        const omopPerson = {
            person_id: this.generatePersonId(fhirPatient.id),
            gender_concept_id: await this.mapGenderConcept(fhirPatient.gender),
            year_of_birth: new Date(fhirPatient.birthDate).getFullYear(),
            month_of_birth: new Date(fhirPatient.birthDate).getMonth() + 1,
            day_of_birth: new Date(fhirPatient.birthDate).getDate(),
            birth_datetime: fhirPatient.birthDate,
            race_concept_id: await this.mapRaceConcept(fhirPatient.extension),
            ethnicity_concept_id: await this.mapEthnicityConcept(fhirPatient.extension),
            person_source_value: fhirPatient.id,
            gender_source_value: fhirPatient.gender
        };
        
        // Mapear endereço
        if (fhirPatient.address?.[0]) {
            omopPerson.location_id = await this.mapLocation(fhirPatient.address[0]);
        }
        
        return omopPerson;
    }
    
    async mapCondition(fhirCondition) {
        const omopCondition = {
            condition_occurrence_id: this.generateConditionId(),
            person_id: await this.getPersonId(fhirCondition.subject),
            condition_concept_id: await this.mapConditionConcept(fhirCondition.code),
            condition_start_date: fhirCondition.onsetDateTime || fhirCondition.recordedDate,
            condition_start_datetime: fhirCondition.onsetDateTime,
            condition_end_date: fhirCondition.abatementDateTime,
            condition_type_concept_id: this.mapConditionType(fhirCondition.verificationStatus),
            condition_source_value: fhirCondition.code.coding[0]?.code,
            condition_source_concept_id: await this.getSourceConceptId(fhirCondition.code)
        };
        
        // Mapear encounter
        if (fhirCondition.encounter) {
            omopCondition.visit_occurrence_id = await this.getVisitId(fhirCondition.encounter);
        }
        
        return omopCondition;
    }
    
    async mapObservation(fhirObservation) {
        // Determinar domínio alvo (measurement ou observation)
        const domain = await this.determineDomain(fhirObservation.code);
        
        if (domain === 'Measurement') {
            return this.mapToMeasurement(fhirObservation);
        } else {
            return this.mapToObservation(fhirObservation);
        }
    }
    
    async mapToMeasurement(fhirObservation) {
        const measurement = {
            measurement_id: this.generateMeasurementId(),
            person_id: await this.getPersonId(fhirObservation.subject),
            measurement_concept_id: await this.mapMeasurementConcept(fhirObservation.code),
            measurement_date: fhirObservation.effectiveDateTime,
            measurement_datetime: fhirObservation.effectiveDateTime,
            measurement_type_concept_id: 44818702, // Lab result
            operator_concept_id: this.mapOperator(fhirObservation.value),
            value_as_number: this.extractNumericValue(fhirObservation.value),
            value_as_concept_id: await this.mapValueConcept(fhirObservation.value),
            unit_concept_id: await this.mapUnitConcept(fhirObservation.value?.unit),
            range_low: fhirObservation.referenceRange?.[0]?.low?.value,
            range_high: fhirObservation.referenceRange?.[0]?.high?.value,
            measurement_source_value: fhirObservation.code.coding[0]?.code,
            unit_source_value: fhirObservation.value?.unit
        };
        
        return measurement;
    }
}
```

#### 3.1.2 Mapeamento de Vocabulários
```javascript
class ConceptMapper {
    constructor() {
        this.cache = new Map();
    }
    
    async mapToStandardConcept(sourceCode, sourceVocabulary) {
        const cacheKey = `${sourceVocabulary}:${sourceCode}`;
        
        if (this.cache.has(cacheKey)) {
            return this.cache.get(cacheKey);
        }
        
        const query = `
            SELECT c2.concept_id
            FROM omop.concept c1
            JOIN omop.concept_relationship cr ON c1.concept_id = cr.concept_id_1
            JOIN omop.concept c2 ON cr.concept_id_2 = c2.concept_id
            WHERE c1.concept_code = $1
            AND c1.vocabulary_id = $2
            AND cr.relationship_id = 'Maps to'
            AND cr.invalid_reason IS NULL
            AND c2.standard_concept = 'S'
            AND c2.invalid_reason IS NULL
        `;
        
        const result = await this.db.query(query, [sourceCode, sourceVocabulary]);
        const conceptId = result.rows[0]?.concept_id || 0;
        
        this.cache.set(cacheKey, conceptId);
        return conceptId;
    }
    
    async mapFHIRToOMOPVocabulary(system) {
        const mapping = {
            'http://loinc.org': 'LOINC',
            'http://snomed.info/sct': 'SNOMED',
            'http://www.nlm.nih.gov/research/umls/rxnorm': 'RxNorm',
            'http://hl7.org/fhir/sid/icd-10-cm': 'ICD10CM',
            'http://hl7.org/fhir/sid/icd-9-cm': 'ICD9CM',
            'http://www.ama-assn.org/go/cpt': 'CPT4'
        };
        
        return mapping[system] || 'Unknown';
    }
}
```

### 3.2 Profile FHIR para OMOP¹⁰

```fsh
// Profile para compatibilidade OMOP
Profile: OMOPCompatiblePatient
Parent: Patient
Id: omop-patient
Title: "OMOP Compatible Patient"
Description: "Patient profile compatible with OMOP Person table"

* identifier 1..* MS
* identifier ^slicing.discriminator.type = #pattern
* identifier ^slicing.discriminator.path = "type"
* identifier contains omopPersonId 1..1 MS
* identifier[omopPersonId].system = "http://omop.org/person_id"
* identifier[omopPersonId].value 1..1

* gender 1..1 MS
* gender from http://hl7.org/fhir/ValueSet/administrative-gender (required)

* birthDate 1..1 MS

* extension contains
    race 0..1 MS and
    ethnicity 0..1 MS and
    observationPeriod 0..* MS

Extension: ObservationPeriod
Id: omop-observation-period
Title: "OMOP Observation Period"
Description: "Period during which patient data is available"
* value[x] only Period
* valuePeriod 1..1

// Mapeamento de conceitos
ConceptMap: GenderToOMOP
Id: gender-to-omop
Title: "FHIR Gender to OMOP Concept"
Source: http://hl7.org/fhir/ValueSet/administrative-gender
Target: http://omop.org/vocabulary/Gender
* group[0].element[0].code = #male
* group[0].element[0].target[0].code = #8507
* group[0].element[0].target[0].equivalence = #equivalent
* group[0].element[1].code = #female
* group[0].element[1].target[0].code = #8532
* group[0].element[1].target[0].equivalence = #equivalent
```

## 4. PIPELINE DE ANÁLISE

### 4.1 Arquitetura ETL¹¹

```yaml
# Pipeline configuration
pipeline:
  name: "FHIR to OMOP ETL Pipeline"
  version: "1.0.0"
  
  stages:
    - name: "extraction"
      type: "fhir_bulk_export"
      config:
        server: "https://fhir.example.org"
        resources:
          - Patient
          - Condition
          - Observation
          - MedicationRequest
          - Procedure
        format: "ndjson"
        
    - name: "transformation"
      type: "fhir_to_omop"
      config:
        mapping_rules: "/config/mappings.yaml"
        vocabulary_db: "postgresql://omop_vocab"
        parallel_workers: 4
        
    - name: "loading"
      type: "omop_loader"
      config:
        target_db: "postgresql://omop_cdm"
        batch_size: 1000
        validation: true
        
    - name: "quality_check"
      type: "achilles"
      config:
        analyses: "all"
        output_format: "json"
```

### 4.2 Implementação com Apache Spark¹²

```scala
// ETL com Spark para grande volume
import org.apache.spark.sql.SparkSession
import org.apache.spark.sql.functions._

class FHIRToOMOPETL(spark: SparkSession) {
  
  def transformPatients(fhirPatientsPath: String): DataFrame = {
    val patients = spark.read.json(fhirPatientsPath)
    
    patients
      .select(
        generatePersonId(col("id")).as("person_id"),
        mapGenderConcept(col("gender")).as("gender_concept_id"),
        year(col("birthDate")).as("year_of_birth"),
        month(col("birthDate")).as("month_of_birth"),
        dayofmonth(col("birthDate")).as("day_of_birth"),
        col("birthDate").as("birth_datetime"),
        mapRaceConcept(col("extension")).as("race_concept_id"),
        mapEthnicityConcept(col("extension")).as("ethnicity_concept_id"),
        col("id").as("person_source_value"),
        col("gender").as("gender_source_value")
      )
  }
  
  def transformConditions(fhirConditionsPath: String): DataFrame = {
    val conditions = spark.read.json(fhirConditionsPath)
    
    // Explodir códigos múltiplos
    val exploded = conditions
      .select(
        col("*"),
        explode(col("code.coding")).as("coding")
      )
    
    // Mapear para OMOP
    exploded
      .join(vocabularyMapping, 
        exploded("coding.system") === vocabularyMapping("source_vocabulary") &&
        exploded("coding.code") === vocabularyMapping("source_code"))
      .select(
        generateConditionId().as("condition_occurrence_id"),
        extractPersonId(col("subject.reference")).as("person_id"),
        col("target_concept_id").as("condition_concept_id"),
        coalesce(col("onsetDateTime"), col("recordedDate")).as("condition_start_date"),
        col("onsetDateTime").as("condition_start_datetime"),
        col("abatementDateTime").as("condition_end_date"),
        mapConditionType(col("verificationStatus")).as("condition_type_concept_id"),
        col("coding.code").as("condition_source_value")
      )
  }
  
  def runETL(config: ETLConfig): Unit = {
    // Extrair
    val patients = transformPatients(config.patientsPath)
    val conditions = transformConditions(config.conditionsPath)
    val observations = transformObservations(config.observationsPath)
    
    // Carregar
    patients.write
      .mode("append")
      .jdbc(config.omopUrl, "omop.person", config.dbProperties)
      
    conditions.write
      .mode("append")
      .jdbc(config.omopUrl, "omop.condition_occurrence", config.dbProperties)
      
    // Atualizar estatísticas
    updateAchillesStats(config.omopUrl)
  }
}
```

## 5. ANÁLISES OBSERVACIONAIS

### 5.1 Estudos de Coorte¹³

```sql
-- Definição de coorte usando OMOP
WITH diabetes_cohort AS (
    SELECT DISTINCT
        co.person_id,
        MIN(co.condition_start_date) as index_date
    FROM omop.condition_occurrence co
    JOIN omop.concept c ON co.condition_concept_id = c.concept_id
    WHERE c.concept_id IN (
        SELECT descendant_concept_id
        FROM omop.concept_ancestor
        WHERE ancestor_concept_id = 201826 -- Type 2 diabetes mellitus
    )
    GROUP BY co.person_id
),
baseline_characteristics AS (
    SELECT
        dc.person_id,
        dc.index_date,
        p.gender_concept_id,
        EXTRACT(YEAR FROM dc.index_date) - p.year_of_birth as age_at_index,
        -- Comorbidades
        MAX(CASE WHEN ht.condition_concept_id IS NOT NULL THEN 1 ELSE 0 END) as has_hypertension,
        MAX(CASE WHEN ckd.condition_concept_id IS NOT NULL THEN 1 ELSE 0 END) as has_ckd
    FROM diabetes_cohort dc
    JOIN omop.person p ON dc.person_id = p.person_id
    LEFT JOIN omop.condition_occurrence ht ON 
        dc.person_id = ht.person_id AND
        ht.condition_concept_id IN (316866, 320128) AND -- Hypertension
        ht.condition_start_date <= dc.index_date
    LEFT JOIN omop.condition_occurrence ckd ON
        dc.person_id = ckd.person_id AND
        ckd.condition_concept_id IN (46271022) AND -- CKD
        ckd.condition_start_date <= dc.index_date
    GROUP BY dc.person_id, dc.index_date, p.gender_concept_id, p.year_of_birth
)
SELECT * FROM baseline_characteristics;
```

### 5.2 Análise de Tratamento¹⁴

```r
# Análise usando R e OHDSI tools
library(DatabaseConnector)
library(CohortMethod)
library(FeatureExtraction)

# Conectar ao OMOP CDM
connectionDetails <- createConnectionDetails(
  dbms = "postgresql",
  server = "localhost/omop",
  user = "omop_user",
  password = "password"
)

conn <- connect(connectionDetails)

# Definir coortes de exposição
sql <- "
INSERT INTO @cohort_database_schema.@cohort_table (
  cohort_definition_id, 
  subject_id, 
  cohort_start_date, 
  cohort_end_date
)
SELECT 
  1 as cohort_definition_id,
  person_id,
  drug_exposure_start_date,
  drug_exposure_end_date
FROM @cdm_database_schema.drug_exposure
WHERE drug_concept_id IN (
  SELECT descendant_concept_id
  FROM @cdm_database_schema.concept_ancestor
  WHERE ancestor_concept_id = 1503297 -- Metformin
)"

renderTranslateExecuteSql(
  connection = conn,
  sql = sql,
  cdm_database_schema = "omop",
  cohort_database_schema = "results",
  cohort_table = "cohort"
)

# Extrair features
covariateSettings <- createCovariateSettings(
  useDemographicsGender = TRUE,
  useDemographicsAge = TRUE,
  useConditionOccurrenceAnyTimePrior = TRUE,
  useDrugExposureAnyTimePrior = TRUE,
  useMeasurementAnyTimePrior = TRUE
)

covariateData <- getDbCovariateData(
  connectionDetails = connectionDetails,
  cdmDatabaseSchema = "omop",
  cohortDatabaseSchema = "results",
  cohortTable = "cohort",
  cohortId = 1,
  covariateSettings = covariateSettings
)

# Análise de propensity score
ps <- createPs(
  cohortMethodData = cohortMethodData,
  population = studyPop,
  prior = createPrior("laplace", variance = 1),
  control = createControl(
    cvType = "auto",
    startingVariance = 0.01,
    noiseLevel = "quiet"
  )
)
```

## 6. INTEGRAÇÃO COM FERRAMENTAS OHDSI

### 6.1 ATLAS¹⁵

```javascript
// Integração com ATLAS via WebAPI
class ATLASIntegration {
    constructor(webApiUrl) {
        this.webApi = webApiUrl;
    }
    
    async createCohortDefinition(definition) {
        const response = await fetch(`${this.webApi}/cohortdefinition`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                name: definition.name,
                description: definition.description,
                expressionType: 'SIMPLE_EXPRESSION',
                expression: {
                    ConceptSets: definition.conceptSets,
                    PrimaryCriteria: definition.primaryCriteria,
                    QualifiedLimit: {
                        Type: 'First'
                    },
                    ExpressionLimit: {
                        Type: 'All'
                    },
                    InclusionRules: definition.inclusionRules,
                    CensoringCriteria: [],
                    CollapseSettings: {
                        CollapseType: 'ERA',
                        EraPad: 0
                    }
                }
            })
        });
        
        return response.json();
    }
    
    async generateCohort(cohortId, sourceKey) {
        const response = await fetch(
            `${this.webApi}/cohortdefinition/${cohortId}/generate/${sourceKey}`,
            {
                method: 'GET'
            }
        );
        
        return response.json();
    }
    
    async getCohortResults(cohortId, sourceKey) {
        const response = await fetch(
            `${this.webApi}/cohortresults/${sourceKey}/${cohortId}/breakdown`,
            {
                method: 'GET'
            }
        );
        
        return response.json();
    }
}


// ===== Conteúdo de: README.md =====

# Documentação de Implementation Guides FHIR

## Standard Operating Procedures (SOPs)

### SOPs Fundamentais

1. **[SOP-001: Fundamentos de Implementation Guides FHIR](SOPs/markdown/SOP-001-IG-Fundamentals.md)**
   - Estrutura e componentes de IGs
   - Processo de desenvolvimento
   - Ferramentas e tecnologias

2. **[SOP-002: Terminologias e Vocabulários em FHIR](SOPs/markdown/SOP-002-Terminologies.md)**
   - SNOMED CT, LOINC, ICD-10/11
   - CodeSystems e ValueSets
   - Mapeamento e tradução

3. **[SOP-003: Políticas de Privacidade e Segurança](SOPs/markdown/SOP-003-Privacy-Security.md)**
   - Conformidade LGPD, GDPR, HIPAA
   - Segurança e criptografia
   - Gestão de consentimento

## Templates

- [Template de Profile](templates/profile-template.fsh)
- [Template de Extension](templates/extension-template.fsh)
- [Template de ValueSet](templates/valueset-template.fsh)
- [Template de IG Config](templates/sushi-config-template.yaml)

## Referências Rápidas

- [Comandos FSH](references/fsh-quick-reference.md)
- [Checklist de Publicação](references/publication-checklist.md)
- [Troubleshooting Guide](references/troubleshooting.md)

---
Última atualização: $(date +"%Y-%m-%d")



// ===== Conteúdo de: SOP-001-IG-Fundamentals.md =====

# SOP-001: Fundamentos de Implementation Guides FHIR
**Standard Operating Procedure para Desenvolvimento de HL7 FHIR Implementation Guides**

## 1. INTRODUÇÃO E PROPÓSITO

### 1.1 Objetivo
Este documento estabelece os procedimentos padrão para o desenvolvimento de Implementation Guides (IGs) FHIR, garantindo conformidade com as especificações HL7 International e suas afiliadas.

### 1.2 Escopo
Aplicável a todos os projetos de desenvolvimento de IGs FHIR, incluindo perfis nacionais, domínios específicos de conhecimento, comunidades de implementação e produtos específicos.

### 1.3 Referências Normativas
- HL7 FHIR R5 Specification¹: http://hl7.org/fhir/R5/
- FHIR Implementation Guide Resource²: http://hl7.org/fhir/R5/implementationguide.html
- FHIR IG Publishing Requirements³: https://wiki.hl7.org/FHIR_Implementation_Guide_Publishing_Requirements
- FHIR Shorthand Specification⁴: https://build.fhir.org/ig/HL7/fhir-shorthand/

## 2. DEFINIÇÕES E CONCEITOS FUNDAMENTAIS

### 2.1 Implementation Guide (IG)
Um IG FHIR é um conjunto de regras computáveis e documentação narrativa que determina como solucionar problemas específicos de interoperabilidade usando recursos FHIR⁵.

### 2.2 Categorias de IGs
Conforme definido por Grahame Grieve⁶:

1. **National Base IGs**: Descrevem como regulamentações nacionais se aplicam no contexto FHIR
2. **Domain of Knowledge IGs**: Representam conceitos clínicos ou de negócio sem definir APIs
3. **Community of Implementation**: Acordos sobre troca de dados entre atores específicos
4. **Product IGs**: Documentam funcionalidades de software específico

### 2.3 Componentes Essenciais
- **Profiles**: Restrições em recursos FHIR base
- **Extensions**: Elementos adicionais para dados não cobertos pelo padrão
- **ValueSets**: Conjuntos de valores permitidos para elementos codificados
- **CodeSystems**: Sistemas de códigos customizados
- **Examples**: Instâncias de recursos conformes
- **NamingSystems**: Identificadores únicos para sistemas

## 3. ESTRUTURA DE DIRETÓRIOS

### 3.1 Estrutura Padrão FSH/SUSHI⁷
```
IG-Project/
├── input/
│   ├── fsh/                    # Arquivos FSH
│   │   ├── aliases.fsh         # Definições de aliases
│   │   ├── profiles/           # Perfis de recursos
│   │   ├── extensions/         # Extensões customizadas
│   │   ├── valuesets/          # Conjuntos de valores
│   │   ├── codesystems/        # Sistemas de códigos
│   │   ├── examples/           # Exemplos
│   │   └── invariants/         # Regras de validação
│   ├── pagecontent/           # Conteúdo narrativo (Markdown)
│   └── images/                # Imagens e diagramas
├── fsh-generated/             # Saída do SUSHI (não editar)
├── output/                    # IG publicado (não editar)
├── sushi-config.yaml          # Configuração do projeto
├── ig.ini                     # Configuração do IG Publisher
└── _genonce.sh/.bat          # Scripts de build
```

### 3.2 Convenções de Nomenclatura
- Arquivos FSH: `[tipo]-[domínio].fsh`
  - Exemplo: `profile-patient.fsh`, `valueset-conditions.fsh`
- IDs de recursos: `[projeto]-[tipo]-[nome]`
  - Exemplo: `br-core-patient`, `us-core-condition`

## 4. DESENVOLVIMENTO DE PROFILES

### 4.1 Sintaxe FSH para Profiles⁸
```fsh
Profile: [NomeDoPerfil]
Parent: [RecursoBase ou PerfilPai]
Id: [id-único]
Title: "[Título Legível]"
Description: "[Descrição Detalhada]"
* [elemento] [cardinalidade] [flags] "[descrição]"
```

### 4.2 Flags de Conformidade
- **MS (MustSupport)**: Elemento deve ser suportado
- **?!**: Modificador (altera significado se presente)
- **SU (Summary)**: Incluído em resumos

### 4.3 Exemplo Prático
```fsh
Profile: BRPatient
Parent: Patient
Id: br-patient
Title: "Paciente Brasileiro"
Description: "Perfil de Paciente para o contexto brasileiro"
* identifier 1..* MS
* identifier ^slicing.discriminator.type = #pattern
* identifier ^slicing.discriminator.path = "type"
* identifier ^slicing.rules = #open
* identifier contains cpf 1..1 MS
* identifier[cpf].system = "http://rnds.saude.gov.br/fhir/r4/NamingSystem/cpf"
* identifier[cpf].type = http://terminology.hl7.org/CodeSystem/v2-0203#TAX
* birthDate 1..1 MS
* address.state from http://hl7.org/fhir/ValueSet/br-estados (required)
```

## 5. DESENVOLVIMENTO DE EXTENSIONS

### 5.1 Quando Criar Extensions⁹
- Dados necessários não existem no recurso base
- Extensão padrão FHIR não atende necessidade
- Dados não podem ser derivados

### 5.2 Estrutura de Extension
```fsh
Extension: [NomeExtension]
Id: [id-extension]
Title: "[Título]"
Description: "[Descrição do uso]"
Context: [Recurso(s) onde se aplica]
* value[x] only [tipo de dado]
* value[x] 1..1
```

## 6. PROCESSO DE BUILD E PUBLICAÇÃO

### 6.1 Ferramentas Necessárias¹⁰
1. **SUSHI**: Compilador FSH (npm install -g fsh-sushi)
2. **IG Publisher**: Publicador HL7 (Java required)
3. **Validator**: Validador FHIR

### 6.2 Comandos de Build
```bash
# Compilar FSH para JSON
sushi .

# Gerar IG completo
./_genonce.sh  # Linux/Mac
_genonce.bat   # Windows

# Validar recursos
java -jar validator_cli.jar [arquivo] -ig [ig-package]
```

### 6.3 Validação de Qualidade
- Verificar arquivo `output/qa.html` após build
- Resolver todos os erros antes de publicar
- Warnings devem ser justificados em `input/ignoreWarnings.txt`

## 7. VERSIONAMENTO E MANUTENÇÃO

### 7.1 Semantic Versioning¹¹
- **Major (X.0.0)**: Mudanças incompatíveis
- **Minor (0.X.0)**: Novas funcionalidades compatíveis
- **Patch (0.0.X)**: Correções de bugs

### 7.2 Estados de Maturidade
1. **Draft**: Em desenvolvimento
2. **Trial Use**: Teste de implementação
3. **Normative**: Estável e aprovado
4. **Deprecated**: Descontinuado

## 8. CONFORMIDADE E TESTES

### 8.1 Níveis de Conformidade¹²
- **SHALL**: Obrigatório
- **SHOULD**: Recomendado
- **MAY**: Opcional

### 8.2 Testes de Conformidade
```bash
# Validar instância contra perfil
java -jar validator_cli.jar [instancia.json] -profile [url-perfil]

# Testar servidor FHIR
java -jar validator_cli.jar -txTests [servidor]/metadata
```

## 9. DOCUMENTAÇÃO NARRATIVA

### 9.1 Páginas Obrigatórias¹³
- **index.md**: Página inicial com visão geral
- **profiles.md**: Lista e descrição de perfis
- **terminology.md**: Sistemas de códigos e valuesets
- **downloads.md**: Pacotes para download
- **changes.md**: Histórico de mudanças

### 9.2 Formato Markdown
```markdown
### Título da Seção
Descrição do conteúdo com referência a perfil: [NomePerfil](StructureDefinition-[id-perfil].html)

#### Requisitos de Negócio
- Requisito 1
- Requisito 2

#### Exemplo de Uso
```json
{
  "resourceType": "Patient",
  "id": "exemplo"
}
```
```

## 10. INTEGRAÇÃO COM PADRÕES EXTERNOS

### 10.1 Harmonização com IGs Internacionais¹⁴
- **IPS (International Patient Summary)**: http://hl7.org/fhir/uv/ips/
- **US Core**: http://hl7.org/fhir/us/core/
- **AU Base**: http://hl7.org.au/fhir/

### 10.2 Reutilização de Componentes
```fsh
// Importar perfil de outro IG
Profile: MyPatient
Parent: http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient
```

## 11. CHECKLIST DE PUBLICAÇÃO

### 11.1 Pré-Publicação
- [ ] Todos os testes passando
- [ ] QA report sem erros críticos
- [ ] Documentação completa
- [ ] Exemplos validados
- [ ] Versão atualizada em sushi-config.yaml
- [ ] Change log atualizado

### 11.2 Publicação
- [ ] Build final executado
- [ ] Package gerado
- [ ] Upload para servidor de publicação
- [ ] Registro no registry FHIR
- [ ] Notificação à comunidade

## 12. REFERÊNCIAS

1. HL7 International. FHIR R5 Specification. Disponível em: http://hl7.org/fhir/R5/
2. HL7 International. Resource ImplementationGuide. Disponível em: http://hl7.org/fhir/R5/implementationguide.html
3. HL7 Wiki. FHIR Implementation Guide Publishing Requirements. Disponível em: https://wiki.hl7.org/FHIR_Implementation_Guide_Publishing_Requirements
4. HL7 International. FHIR Shorthand Specification. Disponível em: https://build.fhir.org/ig/HL7/fhir-shorthand/
5. MITRE. FSH School - Part 1: Reading an IG. Disponível em: https://fshschool.org/courses/fsh-seminar/01-reading-an-ig.html
6. Grieve, G. FHIR Implementation Guide Purposes. HL7 FHIR DevDays Presentation. 2021.
7. MITRE. FSH Quick Start Guide. Disponível em: https://fshschool.org/quickstart/
8. HL7 International. FHIR Shorthand Quick Reference. Version 3.0.0.
9. HL7 International. Extending FHIR. Disponível em: http://hl7.org/fhir/R5/extensibility.html
10. KRAMER, M. & MOESEL, C. Tutorial: Create an Implementation Guide with FHIR Shorthand. HL7 FHIR DevDays 2021.
11. HL7 International. FHIR Versioning. Disponível em: http://hl7.org/fhir/R5/versioning.html
12. HL7 International. Conformance Rules. Disponível em: http://hl7.org/fhir/R5/conformance-rules.html
13. HL7 International. IG Publisher Documentation. Disponível em: https://confluence.hl7.org/display/FHIR/IG+Publisher+Documentation
14. HL7 International. International Patient Summary Implementation Guide. Disponível em: http://hl7.org/fhir/uv/ips/

---
**Documento aprovado por:** [Gerência de Interoperabilidade]  
**Data de vigência:** 2024-2025  
**Próxima revisão:** Janeiro 2026



// ===== Conteúdo de: SOP-002-Terminologies.md =====

# SOP-002: Terminologias e Vocabulários em FHIR
**Standard Operating Procedure para Gestão de Terminologias em Implementation Guides**

## 1. INTRODUÇÃO

### 1.1 Objetivo
Este SOP estabelece os procedimentos para implementação, mapeamento e gestão de terminologias em Implementation Guides FHIR, garantindo interoperabilidade semântica entre sistemas de saúde.

### 1.2 Escopo
Aplica-se a todos os aspectos de terminologia incluindo CodeSystems, ValueSets, ConceptMaps e NamingSystems em projetos FHIR.

### 1.3 Referências Fundamentais
- HL7 Terminology (THO)¹: https://terminology.hl7.org/
- FHIR Terminology Service²: http://hl7.org/fhir/R5/terminology-service.html
- Using Codes in FHIR³: http://hl7.org/fhir/R5/terminologies.html
- ISO TR 21300:2014⁴: Principles of Mapping Between Terminological Systems

## 2. TERMINOLOGIAS PADRÃO INTERNACIONAIS

### 2.1 SNOMED CT
**Systematized Nomenclature of Medicine Clinical Terms**

#### 2.1.1 Identificação
- **URI**: `http://snomed.info/sct`
- **OID**: `2.16.840.1.113883.6.96`
- **Versão**: Especificar sempre (ex: `http://snomed.info/sct|http://snomed.info/sct/900000000000207008/version/20230901`)

#### 2.1.2 Uso em FHIR⁵
```fsh
// Alias para SNOMED CT
Alias: $SCT = http://snomed.info/sct

// Uso em ValueSet
ValueSet: ConditionsVS
* $SCT#38341003 "Hypertensive disorder"
* $SCT#73211009 "Diabetes mellitus"

// Uso em Binding
* code from http://hl7.org/fhir/ValueSet/condition-code (extensible)
* code.coding ^slicing.discriminator.type = #pattern
* code.coding ^slicing.discriminator.path = "system"
* code.coding contains snomed 1..1 MS
* code.coding[snomed].system = $SCT
```

#### 2.1.3 SNOMED CT IPS Free Set⁶
Subconjunto gratuito para International Patient Summary:
- URI: `http://hl7.org/fhir/uv/ips/ValueSet/snomed-intl-ips`
- Não requer licença nacional SNOMED

### 2.2 LOINC
**Logical Observation Identifiers Names and Codes**

#### 2.2.1 Identificação⁷
- **URI**: `http://loinc.org`
- **OID**: `2.16.840.1.113883.6.1`

#### 2.2.2 Estrutura de Códigos LOINC
```
[Componente]:[Propriedade]:[Tempo]:[Sistema]:[Escala]:[Método]
Exemplo: 8867-4 = Heart rate:NRat:Pt:XXX:Qn
```

#### 2.2.3 Implementação em FHIR
```fsh
Profile: LabResult
Parent: Observation
* code from http://hl7.org/fhir/ValueSet/observation-codes (preferred)
* code.coding ^slicing.discriminator.type = #pattern
* code.coding ^slicing.discriminator.path = "system"
* code.coding contains loinc 1..1 MS
* code.coding[loinc].system = "http://loinc.org"

// Exemplo de uso
Instance: lab-glucose
InstanceOf: LabResult
* code.coding[loinc] = http://loinc.org#15074-8 "Glucose [Mass/volume] in Blood"
* valueQuantity = 95 'mg/dL'
```

### 2.3 ICD-10 e ICD-11
**International Classification of Diseases**

#### 2.3.1 ICD-10-CM/PCS⁸
```fsh
// ICD-10-CM (Clinical Modification)
Alias: $ICD10CM = http://hl7.org/fhir/sid/icd-10-cm

// ICD-10-PCS (Procedure Coding System)  
Alias: $ICD10PCS = http://www.cms.gov/Medicare/Coding/ICD10

// Uso em ValueSet
ValueSet: DiabetesConditions
* $ICD10CM#E11 "Type 2 diabetes mellitus"
* $ICD10CM#E11.9 "Type 2 diabetes mellitus without complications"
* $ICD10CM#E11.65 "Type 2 diabetes mellitus with hyperglycemia"
```

#### 2.3.2 ICD-11⁹
```fsh
// ICD-11 MMS (Mortality and Morbidity Statistics)
Alias: $ICD11 = http://id.who.int/icd11/mms

// Exemplo de uso
* code = $ICD11#5A11 "Type 2 diabetes mellitus"
```

### 2.4 Terminologias de Medicamentos

#### 2.4.1 RxNorm¹⁰
```fsh
Alias: $RXNORM = http://www.nlm.nih.gov/research/umls/rxnorm

ValueSet: CommonMedications
* $RXNORM#314076 "lisinopril 10 MG Oral Tablet"
* $RXNORM#860975 "metformin hydrochloride 500 MG Oral Tablet"
```

#### 2.4.2 ATC (Anatomical Therapeutic Chemical)¹¹
```fsh
Alias: $ATC = http://www.whocc.no/atc

* medication.code = $ATC#C09AA03 "lisinopril"
```

## 3. COMPONENTES DE TERMINOLOGIA EM FHIR

### 3.1 CodeSystem
Define um sistema de códigos completo ou suplemento¹².

#### 3.1.1 Estrutura FSH
```fsh
CodeSystem: CustomConditionStatus
Id: custom-condition-status
Title: "Status de Condições Customizado"
Description: "Estados específicos para condições clínicas"
* #preliminary "Preliminar" "Diagnóstico preliminar, aguardando confirmação"
* #confirmed "Confirmado" "Diagnóstico confirmado por exames"
* #ruled-out "Descartado" "Condição descartada após investigação"
* #in-remission "Em remissão" "Condição em remissão"
```

#### 3.1.2 Hierarquia em CodeSystem
```fsh
CodeSystem: BodySites
* #head "Cabeça"
  * #face "Face"
    * #eye "Olho"
      * #left-eye "Olho esquerdo"
      * #right-eye "Olho direito"
  * #scalp "Couro cabeludo"
```

### 3.2 ValueSet
Define subconjunto de códigos para uso específico¹³.

#### 3.2.1 ValueSet Extensional
Lista explícita de códigos:
```fsh
ValueSet: EmergencyConditions
Id: emergency-conditions
Title: "Condições de Emergência"
* $SCT#410429000 "Cardiac arrest"
* $SCT#230690007 "Stroke"
* $ICD10CM#I21 "Acute myocardial infarction"
```

#### 3.2.2 ValueSet Intensional
Definido por regras:
```fsh
ValueSet: AllDiabetesConditions
* include codes from system $SCT where concept is-a #73211009 "Diabetes mellitus"
* include codes from system $ICD10CM where code regex "^E1[0-4].*"
```

#### 3.2.3 ValueSet com Filtros Complexos
```fsh
ValueSet: ActiveMedicationStatus
* include codes from system http://hl7.org/fhir/CodeSystem/medication-statement-status
  where concept is-a #active
* exclude http://hl7.org/fhir/CodeSystem/medication-statement-status#entered-in-error
```

### 3.3 ConceptMap
Mapeia conceitos entre sistemas diferentes¹⁴.

#### 3.3.1 Estrutura de ConceptMap
```fsh
ConceptMap: ConditionSeverityMap
Id: condition-severity-map
Source: LocalSeverityVS
Target: http://hl7.org/fhir/ValueSet/condition-severity
* group[0].source = "http://example.org/severity"
* group[0].target = $SCT
* group[0].element[0].code = #mild
* group[0].element[0].target[0].code = #255604002
* group[0].element[0].target[0].equivalence = #equivalent
* group[0].element[1].code = #moderate  
* group[0].element[1].target[0].code = #6736007
* group[0].element[1].target[0].equivalence = #equivalent
```

#### 3.3.2 Tipos de Equivalência¹⁵
- **equivalent**: Conceitos são equivalentes
- **wider**: Target é mais amplo
- **narrower**: Target é mais específico
- **inexact**: Mapeamento aproximado
- **unmatched**: Sem correspondência

### 3.4 NamingSystem
Define identificadores únicos para sistemas¹⁶.

```fsh
Instance: cpf-naming-system
InstanceOf: NamingSystem
* name = "CPF"
* status = #active
* kind = #identifier
* description = "Cadastro de Pessoas Físicas brasileiro"
* uniqueId[0].type = #uri
* uniqueId[0].value = "http://rnds.saude.gov.br/fhir/r4/NamingSystem/cpf"
* uniqueId[1].type = #oid
* uniqueId[1].value = "2.16.840.1.113883.13.18"
```

## 4. BINDING DE TERMINOLOGIAS

### 4.1 Tipos de Binding¹⁷

#### 4.1.1 Required
Deve usar código do ValueSet:
```fsh
* status from http://hl7.org/fhir/ValueSet/observation-status (required)
```

#### 4.1.2 Extensible
Deve usar se aplicável, pode estender:
```fsh
* code from http://hl7.org/fhir/ValueSet/observation-codes (extensible)
```

#### 4.1.3 Preferred
Recomendado, mas opcional:
```fsh
* bodySite from http://hl7.org/fhir/ValueSet/body-site (preferred)
```

#### 4.1.4 Example
Apenas sugestão:
```fsh
* category from http://hl7.org/fhir/ValueSet/observation-category (example)
```

## 5. MAPEAMENTO DE TERMINOLOGIAS

### 5.1 Estratégias de Mapeamento¹⁸

#### 5.1.1 Mapeamento Direto
```javascript
// Função de mapeamento
function mapLocalToSNOMED(localCode) {
  const mappings = {
    "HT": "38341003",  // Hypertension
    "DM": "73211009",  // Diabetes
    "CHF": "42343007"  // Congestive heart failure
  };
  return mappings[localCode];
}
```

#### 5.1.2 Mapeamento com ConceptMap
```fsh
// Uso do ConceptMap via operação $translate
GET [base]/ConceptMap/$translate?system=http://local&code=HT&target=http://snomed.info/sct
```

### 5.2 Qualidade de Mapeamento¹⁹

#### 5.2.1 Critérios de Avaliação
- **Completude**: Todos os conceitos origem mapeados
- **Precisão**: Correspondência semântica correta
- **Consistência**: Mapeamentos uniformes
- **Manutenibilidade**: Facilidade de atualização

#### 5.2.2 Validação de Mapeamentos
```bash
# Validar mapeamentos usando FHIR Validator
java -jar validator_cli.jar -ig [ig-package] -profile http://hl7.org/fhir/StructureDefinition/ConceptMap [conceptmap.json]
```

## 6. TRADUÇÃO E LOCALIZAÇÃO

### 6.1 Designations (Traduções)²⁰
```fsh
CodeSystem: LocalConditions
* #hypertension "Hypertension"
* #hypertension ^designation[0].language = #pt-BR
* #hypertension ^designation[0].value = "Hipertensão"
* #hypertension ^designation[1].language = #es
* #hypertension ^designation[1].value = "Hipertensión"
```

### 6.2 Preferred Display
```fsh
ValueSet: ConditionsVS
* $SCT#38341003 "Hypertensive disorder"
* $SCT#38341003 ^designation[0].language = #pt-BR
* $SCT#38341003 ^designation[0].use = http://terminology.hl7.org/CodeSystem/designation-usage#display
* $SCT#38341003 ^designation[0].value = "Transtorno hipertensivo"
```

## 7. SERVIDOR DE TERMINOLOGIA

### 7.1 Operações de Terminologia²¹

#### 7.1.1 $expand
Expande ValueSet para lista de códigos:
```http
GET [base]/ValueSet/[id]/$expand?filter=diabetes
```

#### 7.1.2 $validate-code
Valida se código pertence ao ValueSet:
```http
GET [base]/ValueSet/[id]/$validate-code?system=http://snomed.info/sct&code=73211009
```

#### 7.1.3 $lookup
Obtém detalhes de um código:
```http
GET [base]/CodeSystem/$lookup?system=http://loinc.org&code=15074-8
```

#### 7.1.4 $translate
Traduz código entre sistemas:
```http
GET [base]/ConceptMap/[id]/$translate?system=http://local&code=DM
```

### 7.2 Configuração de Servidor Tx²²
```yaml
# hapi-fhir-server config
hapi:
  fhir:
    terminology:
      validation:
        enabled: true
      servers:
        - url: https://r4.ontoserver.csiro.au/fhir
        - url: https://tx.fhir.org/r4
```

## 8. BOAS PRÁTICAS

### 8.1 Reutilização de Terminologias²³
1. **Verificar existência**: Sempre procurar ValueSets existentes antes de criar novos
2. **Usar THO**: Terminology.hl7.org para terminologias HL7
3. **VSAC**: Value Set Authority Center para US-specific
4. **Simplifier**: Para IGs publicados

### 8.2 Documentação de Terminologias
```markdown
### Terminologias Utilizadas

| Sistema | URI | Versão | Licença |
|---------|-----|--------|---------|
| SNOMED CT | http://snomed.info/sct | 2023-09-01 | Requer licença nacional |
| LOINC | http://loinc.org | 2.74 | Gratuito com registro |
| ICD-10-CM | http://hl7.org/fhir/sid/icd-10-cm | 2024 | Domínio público |
```

### 8.3 Versionamento de Terminologias²⁴
```fsh
// Especificar versão quando crítico
ValueSet: CriticalConditions
* $SCT|http://snomed.info/sct/900000000000207008/version/20230901#410429000
```

## 9. INTEGRAÇÃO COM TERMINOLOGIAS NACIONAIS

### 9.1 Brasil
#### 9.1.1 TUSS (Terminologia Unificada da Saúde Suplementar)²⁵
```fsh
Alias: $TUSS = http://www.ans.gov.br/tuss

ValueSet: ProcedimentosTUSS
* $TUSS#30101018 "Consulta médica em pronto socorro"
* $TUSS#40301354 "Hemograma completo"
```

#### 9.1.2 CBHPM (Classificação Brasileira Hierarquizada de Procedimentos Médicos)
```fsh
Alias: $CBHPM = http://amb.org.br/cbhpm

* procedure.code = $CBHPM#1.01.01.01-2 "Consulta em consultório"
```

#### 9.1.3 Tabela SUS (SIGTAP)²⁶
```fsh
Alias: $SIGTAP = http://sigtap.datasus.gov.br

ValueSet: ProcedimentosSUS
* $SIGTAP#0301010072 "Consulta médica em atenção básica"
* $SIGTAP#0202010503 "Hemograma completo"
```

### 9.2 Mapeamento Internacional para Nacional
```fsh
ConceptMap: LOINCtoSIGTAP
* group[0].source = "http://loinc.org"
* group[0].target = "http://sigtap.datasus.gov.br"
* group[0].element[0].code = #58410-2  // CBC panel
* group[0].element[0].target[0].code = #0202010503
* group[0].element[0].target[0].equivalence = #equivalent
```

## 10. GESTÃO DE MUDANÇAS EM TERMINOLOGIAS

### 10.1 Monitoramento de Atualizações²⁷
- **SNOMED CT**: Releases semestrais (Janeiro/Julho)
- **LOINC**: Releases semestrais (Junho/Dezembro)
- **ICD-10-CM**: Atualizações anuais (Outubro)
- **RxNorm**: Atualizações mensais

### 10.2 Processo de Atualização
```bash
# 1. Baixar nova versão
wget https://download.loinc.org/loinc-2.74.zip

# 2. Validar compatibilidade
java -jar validator_cli.jar -version 2.74 -ig [seu-ig]

# 3. Testar mapeamentos
npm run test-terminology

# 4. Atualizar documentação
echo "LOINC atualizado para versão 2.74" >> CHANGELOG.md
```

### 10.3 Deprecação de Códigos²⁸
```fsh
ValueSet: ActiveConditions
* $SCT#73211009 "Diabetes mellitus"
// Código deprecated - usar conceito mais específico
* exclude $SCT#46635009 "Diabetes mellitus type 1" 
* ^compose.inactive = false  // Excluir códigos inativos
```

## 11. TESTES E VALIDAÇÃO

### 11.1 Testes de Terminologia
```javascript
// Teste unitário para ValueSet
describe('Emergency Conditions ValueSet', () => {
  test('should contain cardiac arrest', async () => {
    const expanded = await expandValueSet('emergency-conditions');
    expect(expanded.contains).toContainEqual(
      expect.objectContaining({
        system: 'http://snomed.info/sct',
        code: '410429000'
      })
    );
  });
});
```

### 11.2 Validação de Bindings²⁹
```bash
# Validar todas as bindings do IG
java -jar validator_cli.jar -ig [ig-package] -txLog tx.log

# Verificar log de terminologia
grep "ERROR" tx.log
```

### 11.3 Cobertura de Terminologia
```sql
-- Query para verificar cobertura
SELECT 
  vs.url as valueset,
  COUNT(DISTINCT c.code) as total_codes,
  COUNT(DISTINCT CASE WHEN c.display IS NOT NULL THEN c.code END) as with_display,
  COUNT(DISTINCT CASE WHEN c.definition IS NOT NULL THEN c.code END) as with_definition
FROM valuesets vs
JOIN codes c ON vs.id = c.valueset_id
GROUP BY vs.url;
```

## 12. PERFORMANCE E OTIMIZAÇÃO

### 12.1 Cache de Terminologias³⁰
```yaml
# Configuração de cache
terminology:
  cache:
    enabled: true
    ttl: 86400  # 24 horas
    max-entries: 10000
```

### 12.2 Pré-expansão de ValueSets
```fsh
// Marcar para pré-expansão
ValueSet: CommonConditions
* ^experimental = false
* ^immutable = true  // Permite cache agressivo
* ^compose.lockedDate = "2024-01-01"  // Data de congelamento
```

## 13. CONFORMIDADE COM PADRÕES

### 13.1 ISO/TS 21564:2019³¹
Requisitos para classificações de saúde:
- Completude
- Não-redundância
- Não-ambiguidade
- Múltipla hierarquia permitida
- Definições formais

### 13.2 HL7 Terminology Infrastructure³²
```fsh
// Conformidade com THO
ValueSet: MyValueSet
* ^meta.profile = "http://terminology.hl7.org/StructureDefinition/shareablevalueset"
* ^url = "http://example.org/fhir/ValueSet/my-valueset"
* ^version = "1.0.0"
* ^name = "MyValueSet"
* ^status = #active
* ^experimental = false
* ^publisher = "Example Organization"
```

## 14. FERRAMENTAS E RECURSOS

### 14.1 Ferramentas de Desenvolvimento³³
- **FHIR Shorthand**: https://fshschool.org/
- **Ontoserver**: https://ontoserver.csiro.au/
- **Snowstorm**: https://github.com/IHTSDO/snowstorm
- **OCL (Open Concept Lab)**: https://openconceptlab.org/

### 14.2 Navegadores de Terminologia
- **VSAC**: https://vsac.nlm.nih.gov/
- **SNOMED Browser**: https://browser.ihtsdotools.org/
- **LOINC Search**: https://loinc.org/search/
- **RxNav**: https://rxnav.nlm.nih.gov/

### 14.3 Validadores
```bash
# FHIR Validator
java -jar validator_cli.jar -txServer https://tx.fhir.org -ig [seu-ig]

# Terminology Server Tester
curl -X POST https://tx.fhir.org/r4/ValueSet/$validate-code \
  -H "Content-Type: application/fhir+json" \
  -d '{"resourceType":"Parameters","parameter":[...]}'
```

## 15. TROUBLESHOOTING COMUM

### 15.1 Problemas Frequentes e Soluções

#### Erro: "Code not found in ValueSet"
```fsh
// Verificar:
// 1. Sistema correto
* code.system = "http://snomed.info/sct"  // não "http://snomed.org"

// 2. Código ativo
* ^compose.inactive = false

// 3. Versão correta
* $SCT|http://snomed.info/sct/900000000000207008/version/20230901#12345
```

#### Erro: "Binding strength violation"
```fsh
// Não pode relaxar binding strength
// Parent: required → Child: ❌ extensible
// Parent: extensible → Child: ✓ required
```

#### Erro: "Duplicate codes in ValueSet"
```fsh
// Usar exclude para remover duplicatas
ValueSet: UniqueConditions
* include codes from system $SCT where concept is-a #64572001
* exclude $SCT#duplicated-code
```

## 16. REFERÊNCIAS

1. HL7 International. HL7 Terminology (THO). https://terminology.hl7.org/
2. HL7. FHIR Terminology Service. http://hl7.org/fhir/R5/terminology-service.html
3. HL7. Using Codes in FHIR. http://hl7.org/fhir/R5/terminologies.html
4. ISO. ISO/TR 21300:2014. Health Informatics - Principles of Mapping Between Terminological Systems.
5. SNOMED International. SNOMED CT Implementation Guide. https://confluence.ihtsdotools.org/
6. HL7. SNOMED CT IPS Free Set. http://hl7.org/fhir/uv/ips/terminology.html
7. Regenstrief Institute. LOINC Users' Guide. https://loinc.org/get-started/
8. CDC. ICD-10-CM Official Guidelines. https://www.cdc.gov/nchs/icd/icd-10-cm.htm
9. WHO. ICD-11 Implementation Guide. https://icd.who.int/icd11refguide/
10. NLM. RxNorm Technical Documentation. https://www.nlm.nih.gov/research/umls/rxnorm/
11. WHO. ATC Classification. https://www.whocc.no/atc_ddd_index/
12. HL7. CodeSystem Resource. http://hl7.org/fhir/R5/codesystem.html
13. HL7. ValueSet Resource. http://hl7.org/fhir/R5/valueset.html
14. HL7. ConceptMap Resource. http://hl7.org/fhir/R5/conceptmap.html
15. HL7. ConceptMap Equivalence. http://hl7.org/fhir/R5/valueset-concept-map-equivalence.html
16. HL7. NamingSystem Resource. http://hl7.org/fhir/R5/namingsystem.html
17. HL7. Binding Strength. http://hl7.org/fhir/R5/terminologies.html#strength
18. ISO/TS 21564:2019. Terminology mapping.
19. Bodenreider O. The Unified Medical Language System (UMLS). Nucleic Acids Res. 2004.
20. HL7. Translation and Localization. http://hl7.org/fhir/R5/languages.html
21. HL7. Terminology Service Operations. http://hl7.org/fhir/R5/terminology-service.html#4.6
22. HAPI FHIR. Terminology Configuration. https://hapifhir.io/hapi-fhir/docs/server_jpa/terminology.html
23. HL7. Best Practices for Terminology. https://confluence.hl7.org/display/FHIR/Terminology+Best+Practices
24. HL7. Terminology Versioning. http://hl7.org/fhir/R5/terminologies.html#versioning
25. ANS. TUSS - Terminologia Unificada da Saúde Suplementar. http://www.ans.gov.br/tuss
26. DATASUS. SIGTAP. http://sigtap.datasus.gov.br
27. HL7. Terminology Maintenance. https://confluence.hl7.org/display/TA/Maintenance
28. HL7. Deprecated Codes. http://hl7.org/fhir/R5/codesystem-definitions.html#CodeSystem.concept.deprecated
29. HL7. Terminology Validation. http://hl7.org/fhir/R5/validation.html#terminology
30. HL7. Terminology Performance. https://confluence.hl7.org/display/FHIR/Terminology+Performance
31. ISO/TS 21564:2019. Health informatics — Terminology classifications.
32. HL7. Terminology Infrastructure. https://confluence.hl7.org/display/TA/Terminology+Infrastructure
33. HL7. Terminology Tools. https://confluence.hl7.org/display/FHIR/Terminology+Tools

---
**Documento aprovado por:** [Gerência de Terminologias Clínicas]  
**Data de vigência:** 2024-2025  
**Próxima revisão:** Janeiro 2026



// ===== Conteúdo de: SOP-003-Privacy-Security.md =====

# SOP-003: Políticas de Privacidade e Segurança de Dados em Saúde
**Standard Operating Procedure para Conformidade com LGPD, GDPR e HIPAA em Implementation Guides FHIR**

## 1. INTRODUÇÃO

### 1.1 Objetivo
Este documento estabelece as diretrizes e procedimentos para garantir a conformidade com as principais regulamentações de proteção de dados em saúde ao desenvolver Implementation Guides FHIR, incluindo LGPD (Brasil), GDPR (União Europeia) e HIPAA (Estados Unidos).

### 1.2 Escopo
Aplica-se a todos os aspectos de privacidade, segurança e proteção de dados em projetos de interoperabilidade FHIR, incluindo design, implementação, testes e operação.

### 1.3 Regulamentações Base
- **LGPD**: Lei Geral de Proteção de Dados (Lei nº 13.709/2018)¹
- **GDPR**: General Data Protection Regulation (EU 2016/679)²
- **HIPAA**: Health Insurance Portability and Accountability Act³
- **ISO/IEC 27001**: Information Security Management⁴
- **ISO/IEC 27799**: Health informatics security management⁵

## 2. PRINCÍPIOS FUNDAMENTAIS

### 2.1 Princípios Comuns às Três Regulamentações

#### 2.1.1 Minimização de Dados
Coletar apenas dados necessários para finalidade específica:

```fsh
Profile: MinimalPatientProfile
Parent: Patient
Description: "Perfil com dados mínimos necessários"
* identifier 1..1 MS  // Apenas identificador obrigatório
* name.given 0..1 MS  // Nome opcional
* name.family 1..1 MS
* birthDate 0..1 MS
* gender 0..1
// Elementos sensíveis marcados como proibidos
* maritalStatus 0..0
* photo 0..0
* contact 0..0
```

#### 2.1.2 Finalidade e Transparência
Documentar claramente o propósito do processamento:

```fsh
Extension: DataProcessingPurpose
Id: data-processing-purpose
Title: "Finalidade do Processamento"
Description: "Documenta a finalidade legal do processamento de dados"
* value[x] only CodeableConcept
* valueCodeableConcept from DataPurposeVS (required)

ValueSet: DataPurposeVS
* #treatment "Tratamento médico"
* #research "Pesquisa científica"
* #public-health "Saúde pública"
* #billing "Faturamento"
```

#### 2.1.3 Segurança por Design (Security by Design)
```fsh
Profile: SecureObservation
Parent: Observation
* meta.security 1..* MS
* meta.security from SecurityLabelsVS (required)
* text 0..0  // Proibir narrativa para evitar vazamento
* note 0..0  // Proibir anotações livres
```

## 3. LGPD - LEI GERAL DE PROTEÇÃO DE DADOS (BRASIL)

### 3.1 Requisitos Específicos LGPD⁶

#### 3.1.1 Bases Legais para Tratamento
```fsh
Extension: LGPDLegalBasis
Id: lgpd-legal-basis
Title: "Base Legal LGPD"
Context: Consent, Contract
* extension contains
    basis 1..1 MS and
    article 0..1 MS
* extension[basis].value[x] only code
* extension[basis].valueCode from LGPDLegalBasisVS (required)
* extension[article].value[x] only string

ValueSet: LGPDLegalBasisVS
* #consent "Consentimento do titular (Art. 7º, I)"
* #vital-interest "Proteção da vida (Art. 7º, II)"
* #legal-obligation "Obrigação legal (Art. 7º, II)"
* #public-health "Tutela da saúde (Art. 7º, VIII)"
* #legitimate-interest "Interesse legítimo (Art. 7º, IX)"
* #research "Pesquisa (Art. 7º, IV)"
```

#### 3.1.2 Dados Sensíveis de Saúde
```fsh
Profile: LGPDSensitiveData
Parent: Basic
* code = #sensitive-health-data
* extension contains
    DataCategory named category 1..1 MS and
    SpecialProtection named protection 0..* MS
* extension[category].valueCode from SensitiveDataCategoryVS
* extension[protection].valueString 1..1

ValueSet: SensitiveDataCategoryVS
* #genetic "Dados genéticos"
* #biometric "Dados biométricos"  
* #health "Dados de saúde"
* #sexual "Vida sexual"
* #religious "Convicção religiosa"
* #racial "Origem racial ou étnica"
```

#### 3.1.3 Direitos do Titular⁷
```fsh
CapabilityStatement: LGPDDataSubjectRights
* rest.resource[0].type = #Patient
* rest.resource[0].interaction[0].code = #read  // Acesso
* rest.resource[0].interaction[1].code = #update  // Correção
* rest.resource[0].interaction[2].code = #delete  // Eliminação
* rest.resource[0].operation[0].name = "portability"
* rest.resource[0].operation[0].definition = "OperationDefinition/data-portability"
* rest.resource[0].operation[1].name = "anonymize"
* rest.resource[0].operation[1].definition = "OperationDefinition/anonymize"
```

#### 3.1.4 Relatório de Impacto (RIPD)⁸
```yaml
# Template RIPD para IG FHIR
ripd:
  projeto: "Implementation Guide XYZ"
  controlador: "Organização ABC"
  encarregado_dpo: "nome@organizacao.com"
  
  dados_tratados:
    - tipo: "Dados de identificação"
      categoria: "Pessoais"
      volume_estimado: "10000 registros/mês"
    - tipo: "Dados clínicos"
      categoria: "Sensíveis"
      volume_estimado: "50000 registros/mês"
      
  finalidades:
    - "Continuidade do cuidado"
    - "Gestão hospitalar"
    
  medidas_seguranca:
    - "Criptografia AES-256"
    - "Controle de acesso baseado em papéis"
    - "Auditoria completa"
    
  riscos_identificados:
    - risco: "Vazamento de dados"
      probabilidade: "Baixa"
      impacto: "Alto"
      mitigacao: "Criptografia e monitoramento"
```

### 3.2 Implementação LGPD em FHIR

#### 3.2.1 Consentimento LGPD
```fsh
Profile: LGPDConsent
Parent: Consent
* status = #active
* scope = http://terminology.hl7.org/CodeSystem/consentscope#patient-privacy
* category = http://loinc.org#59284-0 "Consent Document"
* patient 1..1 MS
* dateTime 1..1 MS
* policy.uri 1..1 MS  // Link para política de privacidade
* provision.type 1..1
* provision.period 1..1  // Período de validade
* provision.data.meaning 1..1
* provision.data.reference 1..1  // Recursos cobertos
* sourceReference 1..1  // Documento de consentimento
```

## 4. GDPR - GENERAL DATA PROTECTION REGULATION (EU)

### 4.1 Requisitos Específicos GDPR⁹

#### 4.1.1 Lawful Basis (Base Legal)
```fsh
Extension: GDPRLawfulBasis
Id: gdpr-lawful-basis
Title: "Base Legal GDPR"
* value[x] only CodeableConcept
* valueCodeableConcept from GDPRLawfulBasisVS (required)

ValueSet: GDPRLawfulBasisVS
* #consent "Consent (Article 6(1)(a))"
* #contract "Contract (Article 6(1)(b))"
* #legal-obligation "Legal obligation (Article 6(1)(c))"
* #vital-interests "Vital interests (Article 6(1)(d))"
* #public-task "Public task (Article 6(1)(e))"
* #legitimate-interests "Legitimate interests (Article 6(1)(f))"
* #special-category "Special category - health (Article 9)"
```

#### 4.1.2 Data Protection by Design¹⁰
```fsh
Profile: GDPRCompliantResource
Abstract: true
* meta.security 1..* MS
* meta.security contains
    confidentiality 1..1 MS and
    dataController 0..1 MS and
    dataProcessor 0..* MS
* meta.tag contains
    pseudonymized 0..1 MS and
    encrypted 0..1 MS
    
// Aplicar a todos os recursos
Profile: GDPRPatient
Parent: Patient
Mixins: GDPRCompliantResource
```

#### 4.1.3 Right to Erasure (Direito ao Esquecimento)¹¹
```fsh
OperationDefinition: ErasePersonalData
* url = "http://example.org/fhir/OperationDefinition/erase"
* name = "ErasePersonalData"
* title = "GDPR Right to Erasure"
* status = #active
* kind = #operation
* code = #erase
* resource = #Patient
* system = false
* type = false
* instance = true
* parameter[0].name = #confirmation
* parameter[0].use = #in
* parameter[0].min = 1
* parameter[0].max = "1"
* parameter[0].type = #string
* parameter[1].name = #result
* parameter[1].use = #out
* parameter[1].min = 1
* parameter[1].max = "1"
* parameter[1].type = #OperationOutcome
```

#### 4.1.4 Data Portability¹²
```fsh
OperationDefinition: ExportPersonalData
* url = "http://example.org/fhir/OperationDefinition/export-personal-data"
* name = "ExportPersonalData"
* title = "GDPR Data Portability"
* status = #active
* kind = #operation
* code = #export
* resource = #Patient
* parameter[0].name = #format
* parameter[0].use = #in
* parameter[0].type = #code
* parameter[0].binding.strength = #required
* parameter[0].binding.valueSet = "http://hl7.org/fhir/ValueSet/mimetypes"
```

### 4.2 Privacy by Default¹³
```fsh
Profile: PrivacyByDefaultPatient
Parent: Patient
* name.use = #anonymous  // Default para anônimo
* birthDate.extension contains DataAccuracy named accuracy 0..1
* address.use = #temp  // Endereço temporário por padrão
* telecom 0..0  // Sem contato por padrão
* photo 0..0  // Sem foto por padrão
```

## 5. HIPAA - HEALTH INSURANCE PORTABILITY AND ACCOUNTABILITY ACT (USA)

### 5.1 Requisitos HIPAA¹⁴

#### 5.1.1 Protected Health Information (PHI)
```fsh
Profile: HIPAAProtectedResource
Abstract: true
* meta.security contains
    phi 1..1 MS and
    accessControl 1..* MS
* meta.security[phi] = http://terminology.hl7.org/CodeSystem/v3-Confidentiality#R "Restricted"
* meta.tag contains
    hipaaCovered 1..1 MS

CodeSystem: PHIIdentifiers
* #name "Names"
* #geographic "Geographic identifiers"
* #dates "Dates related to individual"
* #phone "Phone numbers"
* #fax "Fax numbers"
* #email "Email addresses"
* #ssn "Social Security numbers"
* #mrn "Medical record numbers"
* #health-plan "Health plan numbers"
* #account "Account numbers"
* #license "License numbers"
* #vehicle "Vehicle identifiers"
* #device "Device identifiers"
* #url "URLs"
* #ip "IP addresses"
* #biometric "Biometric identifiers"
* #photo "Photos"
* #other "Other identifying information"
```

#### 5.1.2 Minimum Necessary Standard¹⁵
```fsh
Profile: MinimumNecessaryBundle
Parent: Bundle
* type = #collection
* entry.resource obeys minimum-necessary-rule
* entry.search.mode = #match
* entry.search.score 0..0  // Remover scores desnecessários

Invariant: minimum-necessary-rule
Description: "Only include necessary data elements"
Expression: "resource.meta.tag.where(system='http://hipaa.org/minimum-necessary').exists()"
Severity: #error
```

#### 5.1.3 De-identification Safe Harbor¹⁶
```fsh
OperationDefinition: DeIdentifySafeHarbor
* url = "http://example.org/fhir/OperationDefinition/deidentify"
* name = "DeIdentify"
* title = "HIPAA Safe Harbor De-identification"
* parameter[0].name = #method
* parameter[0].use = #in
* parameter[0].type = #code
* parameter[0].binding.valueSet = "http://example.org/ValueSet/deidentification-methods"

ValueSet: DeidentificationMethods
* #safe-harbor "Safe Harbor (Remove 18 identifiers)"
* #expert-determination "Expert Determination"
* #limited-dataset "Limited Data Set"
```

### 5.2 Security Rule Requirements¹⁷

#### 5.2.1 Access Controls
```fsh
CapabilityStatement: HIPAAAccessControl
* rest.security.service = http://terminology.hl7.org/CodeSystem/restful-security-service#OAuth
* rest.security.description = "OAuth2 with SMART on FHIR"
* rest.resource.interaction.extension contains
    AccessControl named access 1..1 MS
    
Extension: AccessControl
* value[x] only CodeableConcept
* valueCodeableConcept from HIPAAAccessLevelVS

ValueSet: HIPAAAccessLevelVS
* #provider "Healthcare Provider"
* #payer "Insurance Payer"
* #patient "Patient Access"
* #emergency "Emergency Access"
* #admin "Administrative"
```

#### 5.2.2 Audit Logging¹⁸
```fsh
Profile: HIAAAAuditEvent
Parent: AuditEvent
* type 1..1 MS
* subtype 1..* MS
* action 1..1 MS
* period 1..1 MS
* outcome 1..1 MS
* outcomeDesc 0..1 MS
* agent 1..* MS
* agent.who 1..1 MS
* agent.requestor 1..1 MS
* source 1..1 MS
* entity 1..* MS
* entity.what 1..1 MS
* entity.role 1..1 MS
```

## 6. IMPLEMENTAÇÃO TÉCNICA DE SEGURANÇA

### 6.1 Criptografia¹⁹

#### 6.1.1 Em Trânsito
```yaml
# Configuração TLS mínima
security:
  tls:
    minimum_version: "1.2"
    preferred_version: "1.3"
    cipher_suites:
      - "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
      - "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"
    certificate:
      type: "X.509"
      key_size: 2048
```

#### 6.1.2 Em Repouso
```fsh
Extension: EncryptionMethod
Id: encryption-method
* value[x] only CodeableConcept
* valueCodeableConcept from EncryptionMethodVS

ValueSet: EncryptionMethodVS
* #AES256 "AES 256-bit"
* #AES128 "AES 128-bit"
* #RSA2048 "RSA 2048-bit"
* #RSA4096 "RSA 4096-bit"
```

### 6.2 Controle de Acesso (RBAC/ABAC)²⁰

#### 6.2.1 Role-Based Access Control
```fsh
CodeSystem: SecurityRoles
* #physician "Physician"
* #nurse "Nurse"
* #admin "Administrator"
* #patient "Patient"
* #emergency "Emergency Personnel"

Profile: RBACPractitioner
Parent: Practitioner
* extension contains SecurityRole named role 1..* MS
* extension[role].valueCodeableConcept from SecurityRolesVS
```

#### 6.2.2 Attribute-Based Access Control
```fsh
Extension: ABACPolicy
* extension contains
    resource 1..1 MS and
    action 1..* MS and
    condition 0..* MS and
    obligation 0..* MS
* extension[resource].value[x] only Reference
* extension[action].value[x] only code
* extension[condition].value[x] only Expression
```

### 6.3 Anonimização e Pseudonimização²¹

#### 6.3.1 Técnicas de Anonimização
```javascript
// Função de anonimização
function anonymizePatient(patient) {
  return {
    ...patient,
    identifier: generatePseudonym(patient.identifier),
    name: [{use: "anonymous"}],
    birthDate: generalizeDate(patient.birthDate),
    address: generalizeAddress(patient.address),
    telecom: [],
    photo: [],
    contact: []
  };
}

// Generalização de data
function generalizeDate(date) {
  const year = new Date(date).getFullYear();
  return `${year}-01-01`; // Apenas ano
}

// Generalização de endereço
function generalizeAddress(address) {
  return address.map(addr => ({
    ...addr,
    line: [],
    text: undefined,
    postalCode: addr.postalCode?.substring(0, 3) + "00"
  }));
}
```

#### 6.3.2 Pseudonimização Reversível
```fsh
Profile: PseudonymizedPatient
Parent: Patient
* identifier.system = "http://example.org/pseudonym"
* identifier.value 1..1 MS
* identifier.extension contains
    PseudonymMapping named mapping 0..1 MS
* name.given 0..0
* name.family = "PSEUDONYMIZED"
* birthDate.extension contains
    DatePrecision named precision 0..1 MS

Extension: PseudonymMapping
Id: pseudonym-mapping
* value[x] only Identifier
* valueIdentifier.system = "http://example.org/mapping-key"
```

### 6.4 Auditoria e Monitoramento²²

#### 6.4.1 Padrão de Auditoria FHIR
```fsh
Profile: ComprehensiveAuditEvent
Parent: AuditEvent
* type from http://terminology.hl7.org/ValueSet/audit-event-type (required)
* subtype 1..* MS
* action 1..1 MS
* period.start 1..1 MS
* period.end 1..1 MS
* outcome 1..1 MS
* agent ^slicing.discriminator.type = #pattern
* agent ^slicing.discriminator.path = "type"
* agent contains
    user 1..1 MS and
    system 0..1 MS
* agent[user].who.identifier 1..1 MS
* agent[user].requestor = true
* agent[system].who.identifier 1..1 MS
* agent[system].requestor = false
* source.observer 1..1 MS
* entity 1..* MS
* entity.what 1..1 MS
* entity.securityLabel 0..* MS
```

#### 6.4.2 Eventos de Auditoria Obrigatórios
```fsh
ValueSet: MandatoryAuditEvents
* #C "Create"
* #R "Read/View"
* #U "Update"
* #D "Delete"
* #E "Execute"
* http://dicom.nema.org/resources/ontology/DCM#110100 "Application Activity"
* http://dicom.nema.org/resources/ontology/DCM#110101 "Audit Log Used"
* http://dicom.nema.org/resources/ontology/DCM#110102 "Begin Transferring DICOM Instances"
* http://dicom.nema.org/resources/ontology/DCM#110103 "DICOM Instances Accessed"
* http://dicom.nema.org/resources/ontology/DCM#110104 "DICOM Instances Transferred"
* http://dicom.nema.org/resources/ontology/DCM#110105 "DICOM Study Deleted"
* http://dicom.nema.org/resources/ontology/DCM#110106 "Export"
* http://dicom.nema.org/resources/ontology/DCM#110107 "Import"
* http://dicom.nema.org/resources/ontology/DCM#110108 "Network Entry"
* http://dicom.nema.org/resources/ontology/DCM#110109 "Order Record"
* http://dicom.nema.org/resources/ontology/DCM#110110 "Patient Record"
* http://dicom.nema.org/resources/ontology/DCM#110111 "Procedure Record"
* http://dicom.nema.org/resources/ontology/DCM#110112 "Query"
* http://dicom.nema.org/resources/ontology/DCM#110113 "Security Alert"
* http://dicom.nema.org/resources/ontology/DCM#110114 "User Authentication"
```

## 7. CONSENTIMENTO E GESTÃO DE PREFERÊNCIAS

### 7.1 Modelo Unificado de Consentimento²³
```fsh
Profile: UnifiedConsent
Parent: Consent
* status 1..1 MS
* scope 1..1 MS
* category 1..* MS
* patient 1..1 MS
* dateTime 1..1 MS
* performer 1..1 MS
* organization 1..* MS
* source[x] 1..1 MS
* policy 1..* MS
* policy.authority 0..1 MS
* policy.uri 1..1 MS
* verification 0..* MS
* provision 1..1 MS
* provision.type 1..1 MS
* provision.period 0..1 MS
* provision.actor 0..* MS
* provision.action 0..* MS
* provision.securityLabel 0..* MS
* provision.purpose 0..* MS
* provision.class 0..* MS
* provision.code 0..* MS
* provision.dataPeriod 0..1 MS
* provision.data 0..* MS
* provision.provision 0..* MS

// Extensões para regulamentações específicas
* extension contains
    LGPDCompliance named lgpd 0..1 MS and
    GDPRCompliance named gdpr 0..1 MS and
    HIPAACompliance named hipaa 0..1 MS
```

### 7.2 Granularidade de Consentimento²⁴
```fsh
ValueSet: ConsentGranularity
* #all "Todos os dados"
* #category "Por categoria"
* #resource "Por tipo de recurso"
* #instance "Por instância específica"
* #element "Por elemento de dado"

Profile: GranularConsent
Parent: Consent
* provision.data ^slicing.discriminator.type = #pattern
* provision.data ^slicing.discriminator.path = "meaning"
* provision.data contains
    included 0..* MS and
    excluded 0..* MS
* provision.data[included].meaning = #authorizes
* provision.data[excluded].meaning = #denies
```

## 8. GESTÃO DE INCIDENTES E VIOLAÇÕES

### 8.1 Detecção de Violações²⁵
```fsh
Profile: DataBreachIncident
Parent: DetectedIssue
* status = #final
* code from DataBreachTypeVS (required)
* severity 1..1 MS
* patient 0..* MS  // Pacientes afetados
* identified[x] 1..1 MS
* author 1..1 MS
* implicated 1..* MS  // Recursos comprometidos
* detail 1..1 MS
* mitigation 0..* MS

ValueSet: DataBreachTypeVS
* #unauthorized-access "Acesso não autorizado"
* #data-loss "Perda de dados"
* #data-theft "Roubo de dados"
* #malware "Infecção por malware"
* #phishing "Ataque de phishing"
* #insider-threat "Ameaça interna"
* #physical-breach "Violação física"
```

### 8.2 Processo de Notificação²⁶
```fsh
Task: BreachNotificationTask
* status = #requested
* intent = #order
* priority = #urgent
* code = #breach-notification
* description = "Notificar autoridades e afetados sobre violação de dados"
* for 1..* MS  // Pacientes afetados
* authoredOn 1..1 MS
* requester 1..1 MS
* owner 1..1 MS  // DPO ou responsável
* restriction.period.end 1..1 MS  // Prazo legal (72h GDPR, 2 dias LGPD)
* input contains
    breachDetails 1..1 MS and
    affectedCount 1..1 MS and
    riskAssessment 1..1 MS
```

## 9. TRANSFERÊNCIA INTERNACIONAL DE DADOS

### 9.1 Mecanismos de Transferência²⁷
```fsh
Extension: InternationalTransfer
Id: international-transfer
* extension contains
    destination 1..1 MS and
    mechanism 1..1 MS and
    safeguards 0..* MS
* extension[destination].value[x] only CodeableConcept
* extension[destination].valueCodeableConcept from CountryCodeVS
* extension[mechanism].value[x] only CodeableConcept
* extension[mechanism].valueCodeableConcept from TransferMechanismVS
* extension[safeguards].value[x] only string

ValueSet: TransferMechanismVS
* #adequacy "Decisão de adequação"
* #scc "Cláusulas contratuais padrão"
* #bcr "Binding Corporate Rules"
* #consent "Consentimento explícito"
* #legitimate-interest "Interesse legítimo"
```

### 9.2 Adequação e Garantias²⁸
```fsh
Profile: CrossBorderDataTransfer
Parent: Contract
* type = #data-transfer-agreement
* subject 1..* MS  // Dados transferidos
* authority 0..* MS  // Autoridade supervisora
* domain 1..* MS  // Jurisdições envolvidas
* term.offer.party 1..* MS  // Exportador de dados
* term.offer.answer 1..1 MS
* term.asset 1..* MS  // Categorias de dados
* term.action 1..* MS  // Obrigações de proteção
* legal 0..* MS  // Base legal
* rule 0..* MS  // Salvaguardas aplicáveis
```

## 10. PRIVACIDADE DIFERENCIAL E TÉCNICAS AVANÇADAS

### 10.1 Privacidade Diferencial²⁹
```javascript
// Implementação de ruído Laplaciano
function addLaplacianNoise(value, sensitivity, epsilon) {
  const scale = sensitivity / epsilon;
  const u = Math.random() - 0.5;
  const noise = -scale * Math.sign(u) * Math.log(1 - 2 * Math.abs(u));
  return value + noise;
}

// Aplicar a contagens agregadas
function differentiallyPrivateCount(realCount, epsilon = 1.0) {
  const sensitivity = 1; // Sensibilidade para contagem
  return Math.round(addLaplacianNoise(realCount, sensitivity, epsilon));
}
```

### 10.2 K-Anonimato³⁰
```fsh
Profile: KAnonymousDataset
Parent: Bundle
* type = #collection
* entry.resource obeys k-anonymity-rule

Invariant: k-anonymity-rule
Description: "Cada combinação de quasi-identificadores deve aparecer em pelo menos k registros"
Expression: "entry.resource.where(
  birthDate = %resource.birthDate and 
  address.postalCode = %resource.address.postalCode
).count() >= 5"
Severity: #error
```

### 10.3 Homomorphic Encryption³¹
```fsh
Extension: HomomorphicEncryption
Id: homomorphic-encryption
* extension contains
    algorithm 1..1 MS and
    publicKey 1..1 MS and
    operations 0..* MS
* extension[algorithm].value[x] only code
* extension[algorithm].valueCode from HomomorphicAlgorithmVS
* extension[publicKey].value[x] only base64Binary
* extension[operations].value[x] only code

ValueSet: HomomorphicAlgorithmVS
* #paillier "Paillier cryptosystem"
* #gentry "Gentry's scheme"
* #bgv "Brakerski-Gentry-Vaikuntanathan"
* #ckks "Cheon-Kim-Kim-Song"
```

## 11. MONITORAMENTO E MÉTRICAS DE CONFORMIDADE

### 11.1 KPIs de Privacidade³²
```fsh
Measure: PrivacyComplianceMetrics
* status = #active
* subjectCodeableConcept = #Location
* date = "2024-01-01"
* publisher = "Organization"
* group contains
    consentRate 1..1 MS and
    breachCount 1..1 MS and
    dataMinimization 1..1 MS and
    encryptionCoverage 1..1 MS
* group[consentRate].code = #consent-rate
* group[consentRate].population.code = #initial-population
* group[breachCount].code = #breach-incidents
* group[dataMinimization].code = #data-minimization-score
* group[encryptionCoverage].code = #encryption-percentage
```

### 11.2 Dashboard de Conformidade
```yaml
privacy_dashboard:
  metrics:
    - id: consent_coverage
      name: "Cobertura de Consentimento"
      target: 100%
      current: 98.5%
      
    - id: encryption_status
      name: "Dados Criptografados"
      target: 100%
      current: 99.9%
      
    - id: audit_completeness
      name: "Completude de Auditoria"
      target: 100%
      current: 100%
      
    - id: incident_response_time
      name: "Tempo de Resposta a Incidentes"
      target: "<24h"
      current: "18h"
      
    - id: data_retention_compliance
      name: "Conformidade de Retenção"
      target: 100%
      current: 97%
```

## 12. TEMPLATES E CHECKLISTS

### 12.1 Checklist de Conformidade LGPD/GDPR/HIPAA
```markdown
## Checklist de Conformidade

### LGPD
- [ ] Base legal definida para cada tratamento
- [ ] Consentimento documentado quando aplicável
- [ ] RIPD elaborado para operações de alto risco
- [ ] DPO/Encarregado designado
- [ ] Canal de comunicação com titulares
- [ ] Procedimento para atender direitos dos titulares
- [ ] Notificação de incidentes à ANPD

### GDPR
- [ ] Lawful basis identificada
- [ ] DPIA conduzida quando necessário
- [ ] Privacy by Design implementado
- [ ] Privacy by Default configurado
- [ ] Registro de atividades de tratamento
- [ ] Acordos com processadores
- [ ] Mecanismos para transferência internacional

### HIPAA
- [ ] PHI identificada e classificada
- [ ] Minimum necessary implementado
- [ ] De-identification aplicada quando apropriado
- [ ] BAA com business associates
- [ ] Security Rule safeguards implementados
- [ ] Breach notification procedures
- [ ] Training documentation
```

### 12.2 Template de Privacy Notice
```markdown
# Aviso de Privacidade / Privacy Notice

## Controlador de Dados / Data Controller
[Nome da Organização]
[Endereço]
[Contato do DPO]

## Dados Coletados / Data Collected
- Identificação pessoal
- Dados de saúde
- [Outras categorias]

## Finalidade do Tratamento / Purpose of Processing
- Prestação de cuidados de saúde
- Pesquisa médica (com consentimento)
- [Outras finalidades]

## Base Legal / Legal Basis
- LGPD Art. 7º, VIII (tutela da saúde)
- GDPR Art. 9(2)(h) (healthcare)
- HIPAA covered entity obligations

## Compartilhamento / Data Sharing
[Descrever com quem os dados são compartilhados]

## Direitos do Titular / Data Subject Rights
- Acesso / Access
- Correção / Rectification
- Exclusão / Erasure
- Portabilidade / Portability
- Oposição / Objection

## Retenção / Retention
[Período de retenção e critérios]

## Contato / Contact
[E-mail e telefone para exercício de direitos]
```

## 13. REFERÊNCIAS

1. Brasil. Lei nº 13.709/2018 - Lei Geral de Proteção de Dados Pessoais (LGPD). Disponível em: http://www.planalto.gov.br/ccivil_03/_ato2015-2018/2018/lei/l13709.htm
2. European Union. Regulation (EU) 2016/679 - General Data Protection Regulation (GDPR). Disponível em: https://eur-lex.europa.eu/eli/reg/2016/679/oj
3. U.S. Department of Health & Human Services. HIPAA Administrative Simplification. Disponível em: https://www.hhs.gov/hipaa/index.html
4. ISO/IEC 27001:2022. Information security management systems. ISO.
5. ISO 27799:2016. Health informatics — Information security management in health. ISO.
6. ANPD. Guia Orientativo para Definições dos Agentes de Tratamento. Disponível em: https://www.gov.br/anpd/
7. ANPD. Direitos do Titular. Disponível em: https://www.gov.br/anpd/pt-br/assuntos/direitos-do-titular
8. ANPD. Guia de Boas Práticas para Relatório de Impacto. 2023.
9. European Data Protection Board. Guidelines on consent under Regulation 2016/679. 2020.
10. ENISA. Privacy by Design. Disponível em: https://www.enisa.europa.eu/
11. Article 29 Working Party. Guidelines on the right to data portability. 2017.
12. EDPB. Guidelines 01/2022 on data subject rights - Right of access. 2022.
13. ICO. Privacy by design. Disponível em: https://ico.org.uk/
14. HHS. Summary of the HIPAA Privacy Rule. Disponível em: https://www.hhs.gov/hipaa/for-professionals/privacy/
15. HHS. Minimum Necessary Requirement. Disponível em: https://www.hhs.gov/hipaa/for-professionals/privacy/guidance/minimum-necessary-requirement/
16. HHS. Methods for De-identification of PHI. Disponível em: https://www.hhs.gov/hipaa/for-professionals/privacy/special-topics/de-identification/
17. HHS. HIPAA Security Rule. Disponível em: https://www.hhs.gov/hipaa/for-professionals/security/
18. HHS. Audit Controls. 45 CFR 164.312(b).
19. NIST. SP 800-175B - Guideline for Using Cryptographic Standards. 2020.
20. NIST. SP 800-162 - Guide to Attribute Based Access Control. 2014.
21. ISO/IEC 20889:2018. Privacy enhancing data de-identification terminology and classification of techniques.
22. HL7. FHIR Security and Privacy Module. Disponível em: http://hl7.org/fhir/security.html
23. HL7. Consent Resource. Disponível em: http://hl7.org/fhir/consent.html
24. Kantara Initiative. Consent Receipt Specification. 2018.
25. ENISA. Recommendations for a methodology of the assessment of severity of personal data breaches. 2013.
26. GDPR Art. 33 & 34. Personal data breach notification.
27. EDPB. Recommendations 01/2020 on measures that supplement transfer tools. 2020.
28. European Commission. Standard Contractual Clauses. 2021.
29. Dwork, C. Differential Privacy. ICALP 2006.
30. Sweeney, L. k-anonymity: a model for protecting privacy. 2002.
31. Gentry, C. Fully homomorphic encryption using ideal lattices. STOC 2009.
32. ISO/IEC 27701:2019. Privacy information management. ISO.

---
**Documento aprovado por:** [Comitê de Privacidade e Segurança]  
**Data de vigência:** 2024-2025  
**Próxima revisão:** Janeiro 2026



// ===== Conteúdo de: nutrition.md =====

# Nutrition

## General Description
This module describes how nutritional data collected from the iOS Health App and through questionnaires are mapped to FHIR resources. Nutritional data is essential for assessment and intervention in lifestyle medicine.

## Data Sources
Nutritional data is collected from:
- iOS Health App (automatic data)
- User-completed questionnaires 
- Integrated nutrition apps
- Manual records

## Types of Data Collected

### 1. Hydration
- Water intake volume
- Other non-caloric beverages
- Intake timestamps
- Record source

### 2. Energy
- Total calories consumed
- Distribution by meal
- Meal timestamps
- Energy balance

### 3. Macronutrients
- Carbohydrates (g)
- Proteins (g) 
- Fats (g)
  - Saturated
  - Unsaturated
  - Trans

### 4. Micronutrients
- Vitamins
- Minerals
- Electrolytes

### 5. Other
- Caffeine
- Fiber
- Alcohol

## FHIR Resources
The nutritional data is mapped to FHIR resources with specific profiles for each type of measurement:

### Observations
- Nutrition intake observations
- Hydration observations
- Energy/caloric intake
- Nutrient measurements

### Care Plans
- Nutrition care plans
- Dietary recommendations
- Supplementation plans

### Goals
- Nutritional goals
- Hydration targets
- Weight management goals

## Implementation Considerations

### Data Validation
- Physiological range validation
- Consistency checks
- Cross-validation between related measurements
- Unit standardization

### Privacy & Security  
- Data anonymization
- Access control
- Audit logging
- Consent management

## Questionnaire to Observation Mapping

### QuestionnaireResponse to Observation
| Questionnaire Item | FHIR Observation |
|-------------------|------------------|
| water_intake | WaterIntakeObservation |
| calories | CalorieIntakeObservation |
| macronutrients | MacronutrientsObservation |

### Transformation Rules
1. Each meal response generates:
   - A calorie observation
   - A macronutrients observation
  
2. Daily Aggregations:
   - Total calories
   - Total macronutrients
   - Total water
   - Total caffeine

3. Validations:
   - Sum of macronutrients in grams
   - Calorie calculation from macronutrients
   - Values within physiological ranges

### Implementation Notes
- Each QuestionnaireResponse is processed into multiple Observations
- Timestamps from meal records are preserved in Observations
- Aggregations are performed at the end of each day
- All measurements include source attribution

## Implementation Considerations

### Data Flow
1. Collection
   - Questionnaire completion
   - App integration
   - iOS Health App data

2. Processing
   - Data validation
   - Derived calculations
   - Aggregations

3. Storage
   - QuestionnaireResponse
   - Observations
   - History

### Validations
1. Raw Data
   - Valid ranges
   - Temporal consistency
   - Completeness

2. Calculations
   - Macronutrient balance
   - Caloric equivalence
   - Daily goals

### UX Considerations
1. Questionnaire Interface
   - Easy completion
   - Default values
   - Real-time validation

2. Feedback
   - Daily progress
   - Goal alerts
   - Suggestions

### Technical Aspects
1. Device Integration
   - HealthKit permissions
   - Data synchronization
   - Offline support

2. Performance
   - Batch processing
   - Query optimization
   - Data aggregation strategies

3. Security
   - Data encryption
   - Access control
   - Audit logging



// ===== Conteúdo de: sleep.md =====

# Sleep

## General Description
This module describes how sleep data collected from the iOS Health App is mapped to FHIR resources. Sleep monitoring is a critical component of lifestyle medicine, providing insights into sleep quality and quantity.

## Data Source
The iOS Health App collects sleep data from the following sources:
- Apple Watch
- Integrated third-party apps
- Manual records

## Types of Collected Data

### Key Metrics
1. Time in Bed
   - Start time
   - End time
   - Total duration

2. Sleep Time
   - Total time sleeping
   - Sleep efficiency (percentage of time in bed actually sleeping)

3. Sleep Stages
   - Deep Sleep
   - REM Sleep
   - Light Sleep
   - Awake Time

4. Physiological Data During Sleep
   - Respiratory rate
   - Heart rate variability
   - Average heart rate

5. Sleep Quality
   - Sleep interruptions
   - Time to fall asleep
   - Sleep consistency

## Collection Frequency
- Continuous data during sleep period
- Daily metrics aggregation
- Weekly trend analysis

## Supported Operations

### Search
- patient + date
- patient + date-range
- patient + category

### Search Parameters
- patient: Patient identifier
- date: Sleep record date
- category: Observation category (always "sleep")

### Search Examples
GET [base]/Observation?category=sleep&patient=[id]&date=[date]
GET [base]/Observation?category=sleep&patient=[id]&date=ge[start]&date=le[end]

## Conformance

### Must Support
Elements marked with MS must be supported:
- status
- category
- code
- subject
- effectiveDateTime/effectivePeriod
- component.timeInBed
- component.totalSleepTime
- component.deepSleep
- component.remSleep
- component.lightSleep
- component.respiratoryRate
- component.heartRateVariability
- component.interruptions

### Cardinality
- Time in bed and total sleep time are mandatory (1..1)
- Other components are optional (0..1)

### Validation
- Total sleep time must be less than or equal to time in bed
- The sum of sleep stages must equal the total sleep time

## iOS Health App to FHIR Mapping

### Main Fields
| iOS Health App | FHIR Path |
|----------------|-----------|
| Time in Bed | component[timeInBed].valueQuantity |
| Sleep Time | component[totalSleepTime].valueQuantity |
| Deep Sleep | component[deepSleep].valueQuantity |
| REM Sleep | component[remSleep].valueQuantity |
| Light Sleep | component[lightSleep].valueQuantity |
| Respiratory Rate | component[respiratoryRate].valueQuantity |
| HRV | component[heartRateVariability].valueQuantity |
| Interruptions | component[interruptions].valueQuantity |

### Implementation Considerations
1. Data Aggregation
   - Data is collected continuously during sleep
   - Nightly aggregation is done automatically
   - Metrics are calculated per night of sleep

2. Data Quality
   - Temporal overlap validation
   - Consistency check between metrics
   - Outlier detection

3. Privacy and Security
   - Sensitive data requiring protection
   - User consent required
   - Anonymization for research use



// ===== Conteúdo de: stress.md =====

# Stress Assessment Module

## Overview
This module describes how stress data collected from iOS Health App sensors and user inputs are mapped to FHIR resources for lifestyle medicine interventions.

## Data Sources
- Heart Rate Variability (HRV) from Apple Watch 
- Blood pressure patterns
- Activity patterns
- Self-reported stress levels
- Mindfulness session data
- Sleep quality metrics

## Types of Data Collected

### 1. Physiological Stress Metrics
- Heart rate variability analysis
- Blood pressure patterns  
- Respiratory rate changes
- Sleep disruption
- Physical activity impact

### 2. Psychological Stress Assessment
- Perceived stress levels
- Mood changes
- Anxiety indicators
- Cognitive impacts
- Behavioral changes

### 3. Stress Response Patterns
- Acute vs chronic stress
- Recovery efficiency
- Adaptation capacity
- Resilience metrics
- Coping mechanisms

### 4. Environmental Context
- Location/setting
- Time patterns
- Activity context
- Social factors
- Environmental triggers

## Implementation Considerations

### 1. Data Collection
- Continuous sensor monitoring
- Periodic assessments
- Event-triggered recording
- Context capture
- User input validation

### 2. Analysis Pipeline
- Real-time processing
- Pattern detection
- Trend analysis
- Risk assessment
- Alert generation

### 3. Clinical Integration 
- Care plan updates
- Provider notifications
- Decision support
- Progress tracking
- Outcome measurement

## FHIR Resources

### Core Resources
- Observation: For stress measurements
- Questionnaire: For stress assessments
- CarePlan: For stress management plans
- Goal: For stress reduction targets

### Profiles
- StressLevelProfile
- StressAssessmentProfile
- StressManagementProfile

### Extensions
- StressContext
- StressTriggers
- StressCoping

### Value Sets
- StressChronicityVS
- StressImpactVS
- StressTriggersVS
- StressCopingVS

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | Description |
|----------------|-----------|-------------|
| HRV | Observation.component[hrv] | Heart rate variability |
| Stress Level | Observation.valueQuantity | Perceived stress level |
| Context | Observation.component[context] | Environmental context |
| Response | Observation.component[response] | Stress response pattern |

### Mapping Considerations
1. Data Validation
   - Physiological ranges
   - Temporal consistency
   - Context validation
   - Pattern validation

2. Context Handling  
   - Location tracking
   - Activity correlation
   - Social context
   - Environmental factors

3. Clinical Context
   - Care plan integration
   - Provider communication
   - Alert management
   - Progress tracking



// ===== Conteúdo de: reproductive.md =====


## FHIR Resources

### Main Resources Used
- Observation: For cycle tracking and temperature measurements
- QuestionnaireResponse: For symptom reporting
- CarePlan: For fertility planning
- Goal: For reproductive health goals

### Parameters
- patient: Patient identifier
- date: Record date
- category: reproductive-health
- code: Specific measurement type

### Search Examples
GET [base]/Observation?category=reproductive-health&patient=[id]&date=[date]
GET [base]/Observation?code=menstrual-cycle&patient=[id]

## Conformance

### Must Support Elements
Elements marked with MS must be supported:
- status
- category
- code
- subject
- effectiveDateTime
- value[x]
- component (for composite measurements)

## Implementation Considerations

### Data Collection
1. Automated Measurements
   - Temperature tracking
   - Activity patterns
   - Sleep quality
   - Heart rate variability

2. Manual Records
   - Symptom logging
   - Cycle tracking
   - Fertility signs
   - Medication use

### Data Analysis
1. Pattern Recognition
   - Cycle regularity
   - Temperature trends
   - Symptom correlations
   - Fertility windows

2. Alert Generation
   - Cycle predictions
   - Fertile days
   - Temperature changes
   - Symptom patterns

### Clinical Integration
1. Reports
   - Cycle summaries
   - Fertility tracking
   - Symptom patterns
   - Treatment responses

2. Decision Support
   - Fertility planning
   - Cycle abnormalities
   - Risk identification
   - Treatment monitoring

### Privacy & Security
1. Data Protection
   - Encryption
   - Access control
   - Consent management
   - Data sharing

2. User Control
   - Data visibility
   - Sharing preferences
   - Export options
   - Deletion rights

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code |
|----------------|-----------|------------|
| Cycle Start | Observation.effectiveDateTime | 8665-2 |
| Cycle Length | Observation.valueQuantity | 8664-5 |
| Flow Duration | Observation.component[duration].valueQuantity | 49033-4 |
| Basal Temperature | Observation.valueQuantity | 8310-5 |
| Cervical Mucus | Observation.valueCodeableConcept | 8669-4 |

### Integration Requirements
1. HealthKit Access
   - Permissions setup
   - Data synchronization
   - Background updates
   - Error handling

2. Data Validation
   - Range checks
   - Pattern validation
   - Temporal consistency
   - Cross-reference verification

### Performance Considerations
1. Data Processing
   - Real-time updates
   - Batch processing
   - Historical data
   - Trend analysis

2. Resource Optimization
   - Battery usage
   - Storage efficiency
   - Network usage
   - Processing load

### User Interface Guidelines
1. Data Entry
   - Quick input methods
   - Template options
   - Reminder settings
   - Validation feedback

2. Visualization
   - Cycle calendar
   - Temperature charts
   - Symptom tracking
   - Fertility windows

3. Notifications
   - Cycle predictions
   - Fertile days
   - Temperature alerts
   - Medication reminders


## Detailed Implementation Considerations

### Data Management
1. Storage Strategy
   - Real-time data storage
   - Historical data archival
   - Data compression techniques
   - Backup procedures
   - Recovery mechanisms
   - Version control

2. Data Quality
   - Input validation rules
   - Data completeness checks
   - Cross-validation methods
   - Anomaly detection
   - Error correction procedures
   - Quality metrics

### Clinical Integration Details
1. Provider Integration
   - Clinical portal access
   - Data export formats
   - Integration APIs
   - Real-time notifications
   - Emergency alerts
   - Audit trails

2. Decision Support
   - Clinical guidelines integration
   - Risk assessment algorithms
   - Treatment recommendations
   - Follow-up protocols
   - Alert thresholds
   - Intervention triggers

### Advanced Analytics
1. Pattern Recognition
   - Cycle irregularity detection
   - Symptom correlation analysis
   - Fertility window prediction
   - Risk factor identification
   - Trend analysis
   - Outcome prediction

2. Machine Learning Integration
   - Prediction models
   - Pattern classification
   - Anomaly detection
   - Personalization
   - Model training
   - Performance monitoring

### System Integration
1. External Systems
   - EHR integration
   - Laboratory systems
   - Pharmacy systems
   - Insurance systems
   - Research databases
   - Public health reporting

2. Data Exchange
   - HL7 FHIR APIs
   - Standard terminologies
   - Data mapping
   - Transform rules
   - Validation checks
   - Error handling

### Performance Optimization
1. Resource Management
   - CPU usage
   - Memory allocation
   - Storage optimization
   - Network bandwidth
   - Battery consumption
   - Cache strategy

2. Scalability
   - Load balancing
   - Database sharding
   - Service distribution
   - Queue management
   - Batch processing
   - Real-time processing

### User Experience
1. Accessibility
   - Screen reader support
   - Color contrast
   - Font sizing
   - Touch targets
   - Keyboard navigation
   - Voice input

2. Localization
   - Multiple languages
   - Cultural considerations
   - Date formats
   - Unit preferences
   - Terminology adaptation
   - Regional compliance

### Security Details
1. Authentication
   - Multi-factor authentication
   - Biometric options
   - Session management
   - Token handling
   - Password policies
   - Account recovery

2. Authorization
   - Role-based access
   - Attribute-based control
   - Dynamic permissions
   - Temporary access
   - Emergency access
   - Audit logging

3. Compliance
   - HIPAA requirements
   - GDPR compliance
   - Local regulations
   - Industry standards
   - Security frameworks
   - Privacy policies




// ===== Conteúdo de: fsh-link-references.md =====

[DeviceActivityTracker]: Device-DeviceActivityTracker.html
[AdvancedVitalSignsContextCS]: CodeSystem-advanced-vital-signs-context-cs.html
[AdvancedVitalSignsContext]: StructureDefinition-advanced-vital-signs-context.html
[AdvancedVitalSignsContextVS]: ValueSet-advanced-vital-signs-context-vs.html
[AdvancedVitalSigns]: StructureDefinition-advanced-vital-signs.html
[AlertMessage]: StructureDefinition-alert-message.html
[AlertTiming]: StructureDefinition-alert-timing.html
[AllostaticLoad]: StructureDefinition-allostatic-load.html
[AssistanceLevelOutcomesValueSet]: ValueSet-assistance-level-outcomes.html
[AuditFormatExtension]: StructureDefinition-audit-format.html
[AuditFormatsCodeSystem]: CodeSystem-audit-formats.html
[AuditFormatsValueSet]: ValueSet-audit-formats.html
[AuditLevelExtension]: StructureDefinition-audit-level.html
[AuditLevelsCodeSystem]: CodeSystem-audit-levels.html
[AuditLevelsValueSet]: ValueSet-audit-levels.html
[AuditRetentionExtension]: StructureDefinition-audit-retention.html
[BalanceStatusCodeSystem]: CodeSystem-balance-status.html
[BalanceStatusValueSet]: ValueSet-balance-status.html
[BioimpedanceAnalyzer]: Device-BioimpedanceAnalyzer.html
[BloodPressureExample]: Observation-BloodPressureExample.html
[DeviceBloodPressureMonitor]: Device-DeviceBloodPressureMonitor.html
[BloodPressureObservation]: StructureDefinition-blood-pressure-observation.html
[BMIExample]: Observation-BMIExample.html
[BMIObservation]: StructureDefinition-bmi-observation.html
[BodyCompositionExample]: Observation-BodyCompositionExample.html
[BodyCompositionObservation]: StructureDefinition-body-composition-observation.html
[BodyLocationsVS]: ValueSet-body-locations-vs.html
[BodyMetricsObservation]: StructureDefinition-body-metrics-observation.html
[CalorieIntakeObservation]: StructureDefinition-calorie-intake-observation.html
[CervicalMucusCodeSystem]: CodeSystem-cervical-mucus-cs.html
[CervicalMucusValueSet]: ValueSet-cervical-mucus-valueset.html
[ChronicSymptomExample]: Observation-ChronicSymptomExample.html
[CircadianPhaseCS]: CodeSystem-circadian-phase-cs.html
[CircadianPhase]: StructureDefinition-circadian-phase.html
[CircadianPhaseVS]: ValueSet-circadian-phase-vs.html
[CompleteMindfulnessSession]: Observation-CompleteMindfulnessSession.html
[CompleteMindfulnessResponse]: QuestionnaireResponse-CompleteMindfulnessResponse.html
[MindfulnessCSVTransform]: StructureMap-MindfulnessCSVTransform.html
[DailyMindfulnessAlert]: Basic-DailyMindfulnessAlert.html
[DailyMindfulnessQuestionnaire]: Questionnaire-DailyMindfulnessQuestionnaire.html
[DailyNutritionQuestionnaire]: Questionnaire-DailyNutritionQuestionnaire.html
[NutritionQuestionnaireResponseExample]: QuestionnaireResponse-NutritionQuestionnaireResponseExample.html
[DataLocalization]: StructureDefinition-data-localization.html
[DefaultAuditConfig]: Basic-DefaultAuditConfig.html
[DefaultMindfulnessConfig]: Basic-DefaultMindfulnessConfig.html
[DurationUnitsVS]: ValueSet-duration-units-vs.html
[EndSessionMessage]: MessageDefinition-EndSessionMessage.html
[EndSessionOperation]: OperationDefinition-EndSessionOperation.html
[EnvironmentTypeValueSet]: ValueSet-environment-type.html
[EnvironmentalContext]: StructureDefinition-environmental-context.html
[EnvironmentalContextValueSet]: ValueSet-environmental-context.html
[EnvironmentalDeviceExample]: Device-EnvironmentalDeviceExample.html
[EnvironmentalObservation]: StructureDefinition-environmental-observation.html
[example]: Patient-example.html
[MindfulnessAuditExample]: Basic-MindfulnessAuditExample.html
[MindfulnessQuestionnaireExample]: Questionnaire-MindfulnessQuestionnaireExample.html
[MindfulnessObservationExample]: Observation-MindfulnessObservationExample.html
[SleepObservationExample1]: Observation-SleepObservationExample1.html
[PhysicalActivityExample1]: Observation-PhysicalActivityExample1.html
[ExampleReproductiveActivity]: CarePlan-ExampleReproductiveActivity.html
[ExampleSymptomSeverity]: Observation-ExampleSymptomSeverity.html
[ExposureConditionsCS]: CodeSystem-exposure-conditions-cs.html
[ExposureConditions]: StructureDefinition-exposure-conditions.html
[ExposureConditionsVS]: ValueSet-exposure-conditions-vs.html
[ExposureLocationCS]: CodeSystem-exposure-location-cs.html
[ExposureLocation]: StructureDefinition-exposure-location.html
[ExposureLocationVS]: ValueSet-exposure-location-vs.html
[FallRiskOutcomesValueSet]: ValueSet-fall-risk-outcomes.html
[FertilityObservation]: StructureDefinition-fertility-observation.html
[FertilityStatusCodeSystem]: CodeSystem-fertility-status-cs.html
[FertilityStatusValueSet]: ValueSet-fertility-status-valueset.html
[MindfulnessHealthKitTransform]: StructureMap-MindfulnessHealthKitTransform.html
[HeartRateExample]: Observation-HeartRateExample.html
[DeviceHeartRateMonitor]: Device-DeviceHeartRateMonitor.html
[HeartRateObservation]: StructureDefinition-heart-rate-observation.html
[HeightExample]: Observation-HeightExample.html
[HeightObservation]: StructureDefinition-height-observation.html
[HomeostasisIndex]: StructureDefinition-homeostasis-index.html
[JurisdictionApplicability]: StructureDefinition-jurisdiction-applicability.html
[LifestyleVitalSigns]: StructureDefinition-lifestyle-vital-signs.html
[MacronutrientsObservation]: StructureDefinition-macronutrients-observation.html
[MeasurementConditions]: StructureDefinition-measurement-conditions.html
[MeasurementConditionsVS]: ValueSet-measurement-conditions-vs.html
[MeasurementContext]: StructureDefinition-measurement-context.html
[MeasurementContextVitalSigns]: ValueSet-measurement-context-vital-signs.html
[MeasurementContextVS]: ValueSet-measurement-context-vs.html
[MeasurementDevice]: StructureDefinition-measurement-device-type.html
[MeasurementDeviceTypeVS]: ValueSet-measurement-device-type-vs.html
[MeasurementQualityCS]: CodeSystem-measurement-quality-cs.html
[MeasurementQuality]: StructureDefinition-measurement-quality.html
[MeasurementQualityVS]: ValueSet-measurement-quality-vs.html
[MindfulnessAlert]: StructureDefinition-mindfulness-alert.html
[MindfulnessAudit]: StructureDefinition-mindfulness-audit.html
[MindfulnessAuditConfig]: StructureDefinition-mindfulness-audit-config.html
[MindfulnessAuditFormat]: StructureDefinition-mindfulness-audit-format.html
[MindfulnessAuditLevel]: StructureDefinition-mindfulness-audit-level.html
[MindfulnessAuditRetention]: StructureDefinition-mindfulness-audit-retention.html
[MindfulnessConfiguration]: StructureDefinition-mindfulness-configuration.html
[MindfulnessDiagnosticMap]: ConceptMap-MindfulnessDiagnosticMap.html
[MindfulnessImportMap]: StructureDefinition-mindfulness-import-map.html
[MindfulnessMessageDefinition]: StructureDefinition-mindfulness-message-definition.html
[MindfulnessCapabilityStatement]: CapabilityStatement-MindfulnessCapabilityStatement.html
[MindfulnessNotificationEnabled]: StructureDefinition-mindfulness-notification-enabled.html
[MindfulnessOperation]: StructureDefinition-mindfulness-operation.html
[MindfulnessOutcomeCS]: CodeSystem-mindfulness-outcome-cs.html
[MindfulnessOutcomeVS]: ValueSet-mindfulness-outcome-vs.html
[MindfulnessProgressReport]: Measure-MindfulnessProgressReport.html
[MindfulnessQualifierCS]: CodeSystem-mindfulness-qualifier-cs.html
[MindfulnessQualifierVS]: ValueSet-mindfulness-qualifier-vs.html
[MindfulnessTypeCS]: CodeSystem-mindfulness-type-cs.html
[MindfulnessTypeVS]: ValueSet-mindfulness-type-vs.html
[MindfulnessPreferredGuide]: StructureDefinition-mindfulness-preferred-guide.html
[MindfulnessReminderTime]: StructureDefinition-mindfulness-reminder-time.html
[MindfulnessSchedule]: StructureDefinition-mindfulness-schedule.html
[MindfulnessScheduleTiming]: StructureDefinition-mindfulness-schedule-timing.html
[MindfulnessContext]: StructureDefinition-mindfulness-context.html
[MindfulnessSessionDuration]: StructureDefinition-mindfulness-session-duration.html
[MindfulnessObservation]: StructureDefinition-mindfulness-observation.html
[MindfulnessSettingCS]: CodeSystem-MindfulnessSettingCS.html
[MindfulnessTypeValueSet]: ValueSet-mindfulness-type.html
[MindfulnessAccessPolicy]: Consent-MindfulnessAccessPolicy.html
[MindfulnessSecurityDefinition]: Consent-MindfulnessSecurityDefinition.html
[MindfulnessType]: SearchParameter-MindfulnessType.html
[MobilityAlertLevelCS]: CodeSystem-mobility-alert-level-cs.html
[MobilityAlertLevel]: StructureDefinition-mobility-alert-level.html
[MobilityAlertLevelVS]: ValueSet-mobility-alert-level-vs.html
[MobilityDeclineOutcomesValueSet]: ValueSet-mobility-decline-outcomes.html
[MobilityProfile]: StructureDefinition-mobility-profile.html
[MobilityRiskAssessment]: StructureDefinition-mobility-risk-assessment.html
[MoodCodeSystem]: CodeSystem-mood.html
[MoodValueSet]: ValueSet-mood.html
[MultiJurisdictionalConsent]: StructureDefinition-multi-jurisdictional-consent.html
[NoiseExposureExample]: Observation-NoiseExposureExample.html
[NoiseExposureObservation]: StructureDefinition-noise-exposure-observation.html
[NutritionDataSourceCS]: CodeSystem-nutrition-data-source-cs.html
[NutritionDataSource]: StructureDefinition-nutrition-data-source.html
[NutritionDataSourceVS]: ValueSet-nutrition-data-source-vs.html
[NutritionIntakeObservation]: StructureDefinition-nutrition-intake-observation.html
[Org2RDoc]: Organization-Org2RDoc.html
[osa-practitioner-kyle-anydoc]: Practitioner-osa-practitioner-kyle-anydoc.html
[OvulationTestCodeSystem]: CodeSystem-ovulation-test-cs.html
[OvulationTestValueSet]: ValueSet-ovulation-test-valueset.html
[OxygenSaturationObservation]: StructureDefinition-oxygen-saturation-observation.html
[PatientExample]: Patient-PatientExample.html
[PatientMindfulness]: Patient-PatientMindfulness.html
[PhysicalActivityObservation]: StructureDefinition-physical-activity-observation.html
[PhysicalActivityTypeVS]: ValueSet-physical-activity-type-vs.html
[PhysiologicalStressIndex]: StructureDefinition-physiological-stress-index.html
[EnvironmentTypeCS]: CodeSystem-environment-type-cs.html
[EnvironmentTypeVS]: ValueSet-environment-type-vs.html
[PractitionerIdentifierCS]: CodeSystem-practitioner-identifier-cs.html
[PractitionerIdentifierVS]: ValueSet-practitioner-identifier-vs.html
[PractitionerExample]: Practitioner-PractitionerExample.html
[RecoveryEfficiency]: StructureDefinition-recovery-efficiency.html
[RegulatoryBasis]: StructureDefinition-regulatory-basis.html
[RegulatoryFrameworkCS]: CodeSystem-regulatory-framework-cs.html
[RegulatoryFrameworkVS]: ValueSet-regulatory-framework-vs.html
[ReproductiveActivityCS]: CodeSystem-reproductive-activity-cs.html
[ReproductiveActivityVS]: ValueSet-reproductive-activity-vs.html
[ReproductiveObservation]: StructureDefinition-reproductive-observation.html
[ReproductiveGoalVS]: ValueSet-reproductive-goal-vs.html
[ReproductiveHealthQuestionnaire]: Questionnaire-ReproductiveHealthQuestionnaire.html
[RiskLevelValueSet]: ValueSet-risk-level.html
[DeviceSleepMonitor]: Device-DeviceSleepMonitor.html
[SleepObservation]: StructureDefinition-sleep-observation.html
[SleepQuality]: StructureDefinition-sleep-quality.html
[SleepQualityExtendedVS]: ValueSet-sleep-quality-extended-vs.html
[SleepQualityVS]: ValueSet-sleep-quality-vs.html
[SmartScale]: Device-SmartScale.html
[SocialActivityCS]: CodeSystem-social-activity-cs.html
[SocialActivity]: StructureDefinition-social-activity.html
[SocialActivityVS]: ValueSet-social-activity-vs.html
[SocialContextCS]: CodeSystem-social-context-cs.html
[SocialContext]: StructureDefinition-social-context.html
[SocialContextVS]: ValueSet-social-context-vs.html
[SocialInteractionExample]: Observation-SocialInteractionExample.html
[SocialInteractionMediumCS]: CodeSystem-social-interaction-medium-cs.html
[SocialInteractionMediumVS]: ValueSet-social-interaction-medium-vs.html
[SocialInteractionProfile]: StructureDefinition-social-interaction.html
[SocialInteractionQualityCS]: CodeSystem-social-interaction-quality-cs.html
[SocialInteractionQualityVS]: ValueSet-social-interaction-quality-vs.html
[SocialInteractionTypeCS]: CodeSystem-social-interaction-type-cs.html
[SocialInteractionTypeVS]: ValueSet-social-interaction-type-vs.html
[SocialSupportCS]: CodeSystem-social-support-cs.html
[SocialSupport]: StructureDefinition-social-support.html
[SocialSupportVS]: ValueSet-social-support-vs.html
[StartSessionMessage]: MessageDefinition-StartSessionMessage.html
[StartSessionOperation]: OperationDefinition-StartSessionOperation.html
[StressChronicityCS]: CodeSystem-stress-chronicity-cs.html
[StressChronicityVS]: ValueSet-stress-chronicity-vs.html
[StressCopingCS]: CodeSystem-stress-coping-cs.html
[StressCoping]: StructureDefinition-stress-coping.html
[StressCopingVS]: ValueSet-stress-coping-vs.html
[StressImpactCS]: CodeSystem-stress-impact-cs.html
[StressImpactVS]: ValueSet-stress-impact-vs.html
[StressLevelExample]: Observation-StressLevelExample.html
[StressLevelProfile]: StructureDefinition-stress-level.html
[StressTriggersCS]: CodeSystem-stress-triggers-cs.html
[StressTriggers]: StructureDefinition-stress-triggers.html
[StressTriggersVS]: ValueSet-stress-triggers-vs.html
[SymptomQuestionnaire]: StructureDefinition-symptom-questionnaire.html
[SymptomFrequencyCS]: CodeSystem-symptom-frequency-cs.html
[SymptomFrequencyVS]: ValueSet-symptom-frequency-vs.html
[SymptomImpactCS]: CodeSystem-symptom-impact-cs.html
[SymptomImpactVS]: ValueSet-symptom-impact-vs.html
[SymptomProgressionVS]: ValueSet-symptom-progression-vs.html
[SymptomSeverityCS]: CodeSystem-symptom-severity-cs.html
[TimeOfDayVS]: ValueSet-time-of-day-vs.html
[UVExposureExample]: Observation-UVExposureExample.html
[UVExposureObservation]: StructureDefinition-uv-exposure-observation.html
[WalkingSpeedExample]: Observation-WalkingSpeedExample.html
[WalkingSpeedObservation]: StructureDefinition-walking-speed-observation.html
[WalkingSteadinessExample]: Observation-WalkingSteadinessExample.html
[WalkingSteadinessObservation]: StructureDefinition-walking-steadiness-observation.html
[WaterIntakeObservation]: StructureDefinition-water-intake-observation.html
[WeeklyMindfulnessSchedule]: Basic-WeeklyMindfulnessSchedule.html
[WeightExample]: Observation-WeightExample.html
[WeightObservation]: StructureDefinition-weight-observation.html
[WeightWithConditions]: Observation-WeightWithConditions.html


// ===== Conteúdo de: vitalsigns.md =====

# Vital Signs

## General Description
This module describes how vital signs data collected from the iOS Health App are mapped to FHIR resources. Vital signs are fundamental physiological measurements that reflect essential body functions and health states.

## Data Source
The iOS Health App collects vital signs from the following sources:
- Apple Watch
- Bluetooth-connected medical devices
- Integrated third-party apps
- Manual records

## Types of Data Collected

### 1. Heart Rate
- Continuous measurement (Apple Watch)
- Resting heart rate
- Exercise heart rate
- Recovery heart rate
- Heart rate variability (HRV)
- Anomaly recording

### 2. Blood Pressure
- Systolic pressure
- Diastolic pressure
- Date and time of measurement
- Body position during measurement
- Device used

### 3. Oxygen Saturation (SpO2)
- Saturation percentage
- Trends over time
- Sleep measurements
- Activity measurements

### 4. Body Temperature
- Temperature in Celsius/Fahrenheit
- Measurement location
- Measurement method

### 5. Respiratory Rate
- Breaths per minute
- Resting measurements
- Sleep measurements
- Exercise measurements

### 6. ECG (Electrocardiogram)
- Trace recording
- Rhythm classification
- Beat interval
- Anomaly analysis

## Collection Frequency
- Heart Rate: Continuous (when using Apple Watch)
- Blood Pressure: Per measurement
- SpO2: Continuous or on-demand
- Temperature: Per measurement
- Respiratory Rate: Continuous during sleep/exercise
- ECG: On-demand/recording

## Operations Supported

### Search
- patient + date
- patient + code
- patient + category
- patient + code + date-range

### Search Parameters
- patient: Patient identifier
- date: Measurement date
- code: Vital sign type
- category: Category (vital-signs)

### Search Examples
GET [base]/Observation?category=vital-signs&patient=[id]&code=8867-4
GET [base]/Observation?category=vital-signs&patient=[id]&date=ge2024-03-19

## Conformance

### Must Support
Elements marked with MS must be supported:
- status
- category
- code
- subject
- effectiveDateTime
- valueQuantity
- component (when applicable)

### Cardinality
- Blood pressure requires systolic and diastolic components
- Other vital signs require at least one value

## iOS Health App to FHIR Mapping

### Main Fields
| iOS Health App | FHIR Path | LOINC Code |
|----------------|-----------|-------------|
| Heart Rate | valueQuantity | 8867-4 |
| HRV | component[heartRateVariability] | 80404-7 |
| Blood Pressure Systolic | component[systolic] | 8480-6 |
| Blood Pressure Diastolic | component[diastolic] | 8462-4 |
| SpO2 | valueQuantity | 2708-6 |
| Body Temperature | valueQuantity | 8310-5 |
| Respiratory Rate | valueQuantity | 9279-1 |

### Implementation Considerations

1. Source Prioritization
- Apple Watch has priority for continuous measurements
- Validated medical devices for specific measurements
- Manual entries as last resort

2. Data Validation
- Verification of values within physiological ranges
- Outlier detection
- Temporal consistency of measurements

3. Data Aggregation
- Continuous measurements aggregated in intervals
- Calculation of averages, minimums and maximums
- Trends over time

4. Accuracy and Reliability
- Indication of measurement source/device
- Measurement confidence level
- Device calibration and validation

5. Alert Management
- Definition of normal limits
- Notification of abnormal values
- Critical alert escalation

6. Storage and Retention
- Data retention policy
- Historical data compression
- Backup and recovery



// ===== Conteúdo de: physical_activity.md =====

# Physical Activity

## General Description
This module describes how physical activity data from the iOS Health App is mapped to FHIR resources.

## Data Source
The iOS Health App collects physical activity data in the following ways:
- iPhone sensors (step counter, GPS)
- Apple Watch (when available)
- Integrated third-party apps

## Types of Data Collected

### Steps
- Total step count
- Start and end timestamp
- Data source

### Distance
- Total distance covered
- Unit of measurement (meters/kilometers)
- Type of movement (walking/running)

### Workouts
- Type of exercise
- Duration
- Calories burned
- Distance (when applicable)
- Heart rate (when available)

### Energy
- Active calories
- Resting calories
- Total calories

## Collection Frequency
- Steps: Continuous when in motion
- Distance: Continuous during activity
- Workouts: Per session
- Energy: Daily calculation

## Supported Operations

### Search
- patient + date
- patient + activity-type
- patient + date + activity-type

### Search Parameters
- patient: Patient identifier
- date: Activity date
- activity-type: Type of physical activity

### Search Examples
GET [base]/Observation?category=activity&patient=[id]&date=[date]
GET [base]/Observation?category=activity&patient=[id]&code=[activity-type]
## Conformance

### Must Support
Elements marked with MS must be supported by the implementing system:
- status
- category
- code
- subject
- effectiveDateTime
- component.steps
- component.distance
- component.duration
- component.energy



// ===== Conteúdo de: mindfulness.md =====

# Mindfulness and Mental Health

## General Description 
This module describes how mindfulness practice and mental health data collected from the iOS Health App and through questionnaires are mapped to FHIR resources. This data is fundamental for assessing stress management and emotional wellbeing.

## Data Sources
Data is collected from:
- iOS Health App (automatic data)
- Apple Watch (breathing and mindfulness sessions) 
- Self-assessment questionnaires
- Integrated meditation apps
- Manual records

## Types of Data Collected

### 1. Mindfulness Practices
- Session duration
- Type of practice
- Session frequency 
- Practice timing

### 2. Mood State
- Current mood
- Daily variations
- Influencing factors
- Intensity

### 3. Stress Levels
- Perceived stress level
- Physical symptoms
- Identified triggers
- Management strategies

### 4. Relaxation
- Time dedicated
- Techniques used
- Perceived effectiveness
- Regularity

## Collection Frequency
- Mindfulness: Per session
- Mood: Multiple times per day
- Stress: Daily
- Relaxation: Per session

## FHIR Resources
Mindfulness and mental health data is mapped to FHIR resources with specific profiles for each type of measurement:

### Observations
- Mindfulness session observations
- Mood assessments 
- Stress level measurements
- Relaxation practice records

### Questionnaires 
- Mental health screenings
- Stress assessments
- Mood tracking
- Practice logs

### Goals
- Practice frequency targets
- Stress reduction goals
- Emotional wellbeing objectives

## Implementation Considerations

### Data Privacy 
- Enhanced security measures
- Patient consent management
- Access control
- Data anonymization

### Data Integration
- HealthKit integration
- Third-party app connectivity
- Multi-device synchronization
- Data consolidation
## Implementation Considerations

### Data Flow
1. Collection
   - Questionnaire completion
   - Apple Watch data
   - Meditation apps integration

2. Processing
   - Data validation
   - Trend analysis
   - Correlations with other indicators

3. Storage
   - QuestionnaireResponse
   - Observations
   - History and trends

### Validations
1. Input Data
   - Valid ranges for scales
   - Temporal consistency
   - Correlation between measurements

2. Analysis
   - Mood patterns
   - Practice effectiveness
   - Stress triggers

### UX Considerations
1. Questionnaire Interface
   - Simple completion
   - Immediate visual feedback
   - Multi-language support

2. Feedback
   - Trend visualization
   - Personalized recommendations
   - Adaptive reminders

### Integration Requirements
1. HealthKit Integration
   - Mindfulness minutes
   - Heart rate variability
   - Sleep data correlation

2. Third-party Apps
   - API requirements
   - Data synchronization
   - Privacy considerations



// ===== Conteúdo de: data-protection-policies.md =====



# Healthcare Data Protection Policies

This Implementation Guide complies with multiple international data protection regulations.

## Supported Jurisdictions

### 🇪🇺 European Union - GDPR
- **Regulation**: General Data Protection Regulation (EU) 2016/679
- **Official URL**: [EUR-Lex GDPR](https://eur-lex.europa.eu/eli/reg/2016/679/oj)
- **Key Requirements**:
  - Explicit consent for data processing
  - Right to erasure ("right to be forgotten")
  - Data portability
  - Privacy by design

### 🇺🇸 United States - HIPAA
- **Regulation**: Health Insurance Portability and Accountability Act
- **Official URL**: [HHS HIPAA](https://www.hhs.gov/hipaa/index.html)
- **Key Requirements**:
  - Minimum necessary standard
  - Administrative, physical, and technical safeguards
  - Breach notification
  - Business Associate Agreements

### 🇧🇷 Brazil - LGPD
- **Regulation**: Lei Geral de Proteção de Dados (Law 13.709/2018)
- **Official URL**: [Planalto LGPD](http://www.planalto.gov.br/ccivil_03/_ato2015-2018/2018/lei/L13709compilado.htm)
- **Key Requirements**:
  - Legal basis for processing
  - Data subject rights
  - International transfer restrictions
  - Data Protection Officer requirement

## Implementation in FHIR

This IG uses the [IHE Privacy Consent on FHIR (PCF)](https://profiles.ihe.net/ITI/PCF/) profile for consent management.

### Consent Resources
- [Multi-Jurisdictional Consent Profile](StructureDefinition-multi-jurisdictional-consent.html)
- [Mindfulness Access Policy](Consent-MindfulnessAccessPolicy.html)
- [Security Definition](Consent-MindfulnessSecurityDefinition.html)

### Security Implementation
- OAuth 2.0 with SMART on FHIR
- TLS 1.2+ for all communications
- Audit logging per BALP specification
- Role-based access control (RBAC)



// ===== Conteúdo de: bodymetrics.md =====

# Body Measurements

## Overview
This module describes how anthropometric and body composition data collected from the iOS Health App are mapped to FHIR resources. These measurements are fundamental for assessing nutritional status and monitoring lifestyle medicine interventions.

## Data Sources
The iOS Health App collects body measurements from the following sources:
- Connected smart scales
- Bioimpedance devices 
- Manual measurements
- Integrated third-party apps

## Types of Collected Data

### 1. Basic Measurements
- Body weight
- Height
- BMI (automatically calculated)
- Waist circumference

### 2. Body Composition
- Body fat percentage
- Lean mass
- Body water
- Muscle mass 
- Bone mass

### 3. Segmental Analysis
- Body fat distribution
- Muscle mass distribution
- Body symmetry

### 4. Trends and Analysis
- Weight variation
- BMI history
- Body composition progression
- Goals and objectives

## Collection Frequency
- Weight: Recommended daily
- Height: Periodically 
- Body composition: Weekly
- Circumference: Monthly

## FHIR Resources
The body measurements are mapped to FHIR Observation resources with specific profiles for each type of measurement.

### Examples
- Weight measurements use the [body-weight](StructureDefinition-body-weight.html) profile
- Height uses the [body-height](StructureDefinition-body-height.html) profile
- BMI calculations use the [bmi](StructureDefinition-bmi.html) profile

## Supported Operations

### Search
- patient + date
- patient + code
- patient + date-range + code
- patient + category

### Search Parameters
- patient: Patient identifier
- date: Measurement date
- code: Type of body measurement
- category: Category (vital-signs)

### Search Examples
GET [base]/Observation?category=vital-signs&patient=[id]&code=29463-7
GET [base]/Observation?category=vital-signs&patient=[id]&date=ge2024-03-19
GET [base]/Observation?category=vital-signs&patient=[id]&code=88365-2&date=ge2024-01-01&date=le2024-12-31
Copy
## Conformance

### Must Support
Elements marked with MS must be supported:
- status: Measurement status
- category: Vital signs category
- code: Type of measurement (LOINC code)
- subject: Reference to patient
- effectiveDateTime: When measurement was taken
- valueQuantity: The measurement value and unit
- component: Body composition components (for composition measurements)

### Device Support
The following device types are supported for data capture:
- Smart scales
- Bioimpedance analyzers
- Manual entry
- Third-party apps via HealthKit

### Security Requirements
- Patient access control
- Device authentication
- Data validation rules

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code | Description |
|----------------|-----------|-------------|-------------|
| Weight | WeightObservation.valueQuantity | 29463-7 | Body weight measurement |
| Height | HeightObservation.valueQuantity | 8302-2 | Body height measurement |
| BMI | BMIObservation.valueQuantity | 39156-5 | Body Mass Index calculation |
| Body Fat % | BodyCompositionObservation.component[bodyFat] | 41982-0 | Percentage of body fat |
| Lean Mass | BodyCompositionObservation.component[leanMass] | 291-7 | Lean body mass |
| Body Water | BodyCompositionObservation.component[bodyWater] | 73708-0 | Total body water |
| Muscle Mass | BodyCompositionObservation.component[muscleMass] | 73713-0 | Skeletal muscle mass |
| Bone Mass | BodyCompositionObservation.component[boneMass] | 73711-4 | Bone mass measurement |

### Implementation Considerations

1. Data Validation
- Physiological range validation
- Sudden variation detection
- Cross-validation between related measurements
- Unit conversion and standardization

2. Automatic Calculations
- BMI calculation from weight and height
- Cross-validation of composition measurements
- Percentage changes and trends
- Statistical analysis of measurements

3. Frequency and Timing
- Measurement frequency recommendations
- Preferred measurement timing
- Minimum intervals between measurements
- Time zone handling for measurements

4. Data Quality
- Measurement source (device/manual)
- Device calibration status
- Measurement conditions
- Data completeness checks

5. Goal Integration
- Goal setting and tracking
- Progress monitoring
- Significant deviation alerts
- Personalized target ranges

6. Reports and Visualizations
- Trend charts and graphs
- Reference comparisons
- Body composition analysis
- Progress reports and summaries

### Device Integration

1. Smart Scale Integration
- Bluetooth connectivity
- Data synchronization
- Error handling
- Battery status monitoring

2. Bioimpedance Analysis
- Device calibration requirements
- Measurement protocol
- Environmental conditions
- Quality control checks

3. Manual Entry
- Data validation rules
- Required fields
- Unit conversion support
- Entry confirmation

### Error Handling

1. Device Errors
- Connection failures
- Calibration errors
- Battery warnings
- Invalid measurements

2. Data Validation Errors
- Out of range values
- Inconsistent measurements
- Missing required data
- Invalid units

3. Synchronization Errors
- Network connectivity issues
- Data transfer failures
- Version conflicts
- Retry mechanisms




// ===== Conteúdo de: index.md =====

# iOS Health App Lifestyle Medicine Implementation Guide

## Purpose
This FHIR implementation guide defines how to extract and represent health and lifestyle data from the iOS Health App to support lifestyle medicine interventions.

## Scope
The implementation guide covers the following data domains from iOS Health App:

### Vital Signs
- Basic vital signs (heart rate, blood pressure, temperature, etc.)
- Advanced physiological metrics (HRV, respiratory patterns, etc.)
- Physiological stress biomarkers
- Thermoregulation metrics

### Physical Activity
- Steps and distance
- Workouts and exercise
- Energy expenditure
- Activity patterns
- Movement analysis

### Sleep
- Sleep duration and stages
- Sleep quality metrics
- Breathing during sleep
- Heart rate during sleep
- Sleep consistency

### Mindfulness & Mental Health
- Mindfulness sessions
- Stress levels
- Mood tracking
- Relaxation practices
- Mental well-being metrics

### Body Measurements
- Weight and height
- BMI calculations
- Body composition
- Anthropometric measurements

### Nutrition
- Food and water intake
- Macronutrients tracking
- Energy balance
- Meal patterns

### Environmental Factors
- Noise exposure
- UV exposure
- Environmental context
- Exposure patterns

### Reproductive Health
- Cycle tracking
- Fertility signs
- Symptoms tracking
- Health patterns

### Social & Behavioral
- Social interactions
- Support networks
- Behavioral patterns
- Activity context

## Use Cases
1. Automated health data collection and monitoring
2. Lifestyle pattern assessment and analysis
3. Intervention planning and tracking
4. Progress monitoring and outcomes assessment
5. Patient engagement and self-management
6. Clinical decision support
7. Research and population health

## Audience
- Healthcare software developers
- Healthcare professionals and providers
- Digital health platform developers
- Health researchers
- Lifestyle medicine specialists
- Health informaticians
- Digital health innovators

## Technical Framework
Built on FHIR R4 (4.0.1) with:
- Custom profiles for iOS Health data
- Extensions for contextual information
- Terminologies for standardized coding
- Search parameters for data access
- Operations for data processing
- Examples for implementation guidance

## Implementation Notes
- Integration with HealthKit API
- Privacy and security considerations
- Data validation requirements
- Interoperability guidelines
- Best practices for implementation



// ===== Conteúdo de: advanced_vitalsigns.md =====

# Advanced Vital Signs Data

## Overview
This module defines how advanced vital signs data collected from the iOS Health App are mapped to FHIR resources. These data provide a deeper insight into individual physiology and homeostasis, complementing basic vital signs.

## Data Sources
- Apple Watch (advanced sensors)
- Connected medical devices
- Integrated biomedical sensors
- Specialized health apps

## Types of Collected Data

### 1. Advanced Cardiovascular Metrics
- Detailed Heart Rate Variability
  - HRV spectral analysis
  - Low/high frequency indicators
  - HRV entropy measurements
  - Time-domain metrics
  - Frequency-domain parameters
- Cardiac Recovery Indices
  - Post-exercise recovery rate
  - Time to normalization
  - Recovery pattern analysis
  - Heart rate reserve
- Advanced Blood Pressure
  - Mean arterial pressure
  - Pulse pressure
  - Blood pressure variability
  - Circadian pattern tracking
  - Pressure waveform analysis

### 2. Advanced Respiratory Metrics
- Respiratory Patterns
  - Respiratory variability
  - Estimated respiratory volume
  - Ventilation/perfusion ratio
  - Breathing pattern analysis
  - Respiratory rate variability
- Advanced Oxygen Saturation
  - Nocturnal trends
  - Exercise desaturation
  - Hypoxia index
  - Recovery patterns
  - Continuous monitoring

### 3. Physiological Stress Biomarkers
- Physiological stress index
- Allostatic load measurement
- Autonomic recovery tracking
- Sympathetic-vagal balance
- Stress response patterns
- Recovery efficiency metrics
- Chronic stress indicators

### 4. Thermoregulation Metrics
- Circadian temperature variation
- Temperature gradients
- Exercise thermal response
- Heat dissipation patterns
- Core temperature estimation
- Skin temperature mapping
- Environmental adaptation

### 5. Multiparametric Integration
- Composite health indices
- Parameter correlations
- Trend prediction models
- Abnormal pattern detection
- Risk stratification
- Personalized baselines
- Adaptive thresholds

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code | Description |
|----------------|-----------|------------|-------------|
| Heart Rate Variability | HRVObservation.component[hrv] | 80404-7 | R-R interval standard deviation |
| Respiratory Rate | RespiratoryObservation.component[rate] | 9279-1 | Respiratory rate |
| Blood Pressure | BPObservation.component[systolic/diastolic] | 85354-9 | Blood pressure panel with all children |
| Temperature | TempObservation.component[core] | 8310-5 | Body temperature |
| Oxygen Saturation | SpO2Observation.component[saturation] | 59408-5 | Oxygen saturation in blood |

### Advanced Measurements
| iOS Health App | FHIR Path | LOINC Code | Description |
|----------------|-----------|------------|-------------|
| HRV Analysis | HRVObservation.component[spectral] | 80405-4 | Heart rate variability metrics |
| Recovery Rate | RecoveryObservation.component[rate] | 80406-2 | Cardiac recovery rate |
| Stress Index | StressObservation.component[index] | 80407-0 | Physiological stress index |
| Temperature Variation | TempObservation.component[variation] | 80408-8 | Temperature pattern |

## Implementation Requirements

### 1. Data Collection
- Sensor accuracy
- Sampling frequency
- Calibration protocols
- Quality assurance
- Data validation

### 2. Processing Pipeline
- Signal processing
- Noise reduction
- Feature extraction
- Pattern analysis
- Real-time processing

### 3. Integration Aspects
- Data synchronization
- Device compatibility
- API requirements
- Security protocols
- Privacy compliance

### 4. Clinical Validation
- Accuracy verification
- Clinical correlation
- Reference standards
- Validation studies
- Performance metrics

## Technical Implementation

### Data Processing Pipeline
1. Data Collection
   - Sensor data acquisition
   - Quality checks
   - Initial validation
   - Raw data storage

2. Signal Processing
   - Noise reduction
   - Artifact removal
   - Signal enhancement
   - Feature extraction

3. Analysis Pipeline
   - Pattern detection
   - Trend analysis
   - Statistical processing
   - Composite index calculation

4. Clinical Integration
   - Risk assessment
   - Alert generation
   - Clinical correlation
   - Decision support

### Data Quality Management
1. Validation Rules
   - Range checking
   - Consistency verification
   - Cross-validation
   - Temporal validation

2. Quality Metrics
   - Signal quality
   - Data completeness
   - Measurement accuracy
   - Sensor reliability

3. Error Handling
   - Data gaps
   - Sensor failures
   - Connection issues
   - Processing errors

### Integration Requirements
1. Device Integration
   - Sensor compatibility
   - Data protocols
   - Synchronization
   - Calibration

2. System Integration
   - API requirements
   - Data formats
   - Security protocols
   - Performance standards

3. Clinical Systems
   - EHR integration
   - Alert systems
   - Decision support
   - Documentation

## Clinical Applications

### 1. Preventive Medicine
- Early warning systems
- Risk assessment
- Trend analysis
- Intervention timing
- Prevention strategies

### 2. Performance Monitoring
- Athletic performance
- Recovery optimization
- Training adaptation
- Fatigue detection
- Overtraining prevention

### 3. Clinical Decision Support
- Pattern recognition
- Risk stratification
- Treatment response
- Progress monitoring
- Outcome prediction

### Use Cases
1. Clinical Monitoring
   - Patient tracking
   - Progress assessment
   - Treatment response
   - Risk prediction

2. Research Applications
   - Data collection
   - Pattern analysis
   - Outcome studies
   - Population health

3. Personal Health
   - Self-monitoring
   - Health goals
   - Lifestyle tracking
   - Preventive care

### Best Practices
1. Implementation Guidelines
   - Setup procedures
   - Configuration steps
   - Maintenance protocols
   - Update processes

2. User Training
   - Clinical staff
   - Technical team
   - End users
   - Support staff

3. Quality Assurance
   - Testing protocols
   - Validation procedures
   - Performance monitoring
   - Continuous improvement

## Privacy and Security

### Data Protection
1. Security Measures
   - Encryption
   - Access control
   - Audit logging
   - Data segregation

2. Privacy Controls
   - Consent management
   - Data anonymization
   - Access restrictions
   - Usage tracking

### Compliance Requirements
1. Regulatory Standards
   - HIPAA compliance
   - GDPR requirements
   - Local regulations
   - Industry standards

2. Documentation
   - Policy documentation
   - Procedure records
   - Audit trails
   - Compliance reports

## Supported Operations

### Advanced Search Capabilities
- Multiparametric search
- Trend analysis queries
- Temporal correlations
- Circadian pattern analysis
- Complex pattern matching
- Event sequence detection

### Specific Search Parameters
1. Composite Indices
   - physiological-stress-index
   - allostatic-load
   - autonomic-balance
   - recovery-index

2. Temporal Patterns
   - circadian-rhythm
   - ultradian-pattern
   - seasonal-variation
   - adaptation-trend

3. Physiological Correlations
   - cardio-respiratory
   - thermo-regulatory
   - stress-recovery
   - autonomic-balance

4. Adaptive Trends
   - baseline-shift
   - response-pattern
   - recovery-trajectory
   - adaptation-rate

### Advanced Search Examples

GET [base]/Observation?category=advanced-vitals&patient=[id]&code=physiological-stress
GET [base]/Observation?category=advanced-vitals&patient=[id]&date=ge[start]&component-code=autonomic-balance
GET [base]/Observation?category=advanced-vitals&patient=[id]&code=recovery-index&date=ge[start]&date=le[end]
GET [base]/Observation?category=advanced-vitals&patient=[id]&component-code=circadian-pattern&_include=related-observations

## Calculations and Transformations

### 1. Advanced Cardiac Metrics
- HRV Spectral Analysis:

	- Power(f) = |FFT(RR intervals)|²
	
	- LF Power = ∫(0.04-0.15 Hz) Power(f)df
	
	- HF Power = ∫(0.15-0.40 Hz) Power(f)df

- HRV Entropy:

	- SampEn = -ln(A/B), where:
		- A = matches of length m+1
		- B = matches of length m

- Autonomic Balance:

	- LF/HF ratio = (LF Power)/(HF Power)
	
	- Normalized LF = LF/(LF+HF)*100
	
	- Normalized HF = HF/(LF+HF)*100

### 2. Respiratory Metrics
- Respiratory Variability:

	- CV = (SD of intervals)/(Mean interval)*100
	
	- RMSSD = √(Σ(RRi+1 - RRi)²/n)

- Oxygenation Indices:

	- PaO2/FiO2 ratio
	
	- SpO2/FiO2 ratio
	
	- OI = (FiO2 * MAP)/(PaO2)

### 3. Composite Indices
- Physiological Stress Index (PSI):
	- PSI = w1HRVnorm + w2BPnorm + w3SpO2norm + w4Tempnorm, where:
	
		- HRVnorm = normalized HRV deviation
	
		- BPnorm = normalized blood pressure variation
	
		- SpO2norm = normalized oxygen saturation
	
		- Tempnorm = normalized temperature variation
	
		- wi = weighting factors

- Homeostasis Index (HI):
	- HI = Σ(wi * Mi) / Σwi, where:
	
		- Mi = normalized metric i
	
		- wi = weight for metric i

- Allostatic Load Index (ALI): 
	- ALI = Σ(Ci), where:
	
		- Ci = count of metrics outside normal range

### 4. Advanced Statistical Transformations
- Time Domain Analysis:
	- SDNN = √(Σ(RRi - RRmean)²/(n-1))
	
	- pNN50 = (NN50 count)/(total NN count)

- Frequency Domain Analysis:
	- Welch's periodogram
	
	- AR spectral analysis
	
	- Wavelet transform

- Non-linear Methods:
	- Poincaré plot indices
	- Detrended fluctuation analysis
	- Sample entropy
	- Approximate entropy

### 5. Pattern Recognition
- Circadian Pattern Analysis:
	- Cosinor analysis
	- Phase estimation
	- Amplitude calculation
	- MESOR determination

- Trend Detection:
	- Moving averages
	- Exponential smoothing
	- Change point detection
	- Pattern matching

These calculations and transformations provide the mathematical foundation for advanced vital signs analysis. Each metric is carefully validated and normalized to ensure clinical relevance and reliability.




// ===== Conteúdo de: environmental.md =====

# Environmental Factors

## Overview
This module describes how environmental data collected from the iOS Health App is mapped to FHIR resources. These data are crucial for assessing exposure to environmental factors that may impact health.

## Data Sources
Environmental data is collected through:
- iPhone (built-in sensors)
- Apple Watch
- Integrated environmental monitoring apps
- Connected environmental monitoring devices

## Types of Collected Data

### 1. Audio Exposure
- Exposure level in decibels (dB)
- Duration of exposure
- Peak moments
- Dangerous level alerts
- Exposure history
- Sound pressure level measurements
- Daily noise dose calculation

### 2. Environmental Noise
- Continuous noise levels
- Daily variations
- Exposure patterns
- Associated locations
- Critical periods
- Background noise analysis
- Quiet time periods

### 3. UV Exposure
- UV index measurements
- Exposure duration
- Time of exposure
- Intensity levels
- Protection recommendations
- Cumulative exposure
- Risk assessments

## Collection Frequency
- Noise: Continuous monitoring
- UV: During sun exposure
- Alerts: Real-time
- Analysis: Daily and weekly aggregation

## FHIR Resources
Environmental data is mapped to FHIR Observation resources with specific profiles:
- AudioExposureObservation
- EnvironmentalNoiseObservation
- UVExposureObservation

## Supported Operations
- Search by date
- Search by exposure type
- Search by intensity level
- Aggregate reports

## Implementation Considerations
1. Data Validation
   - Sensor calibration
   - Measurement accuracy
   - Data consistency checks
   - Outlier detection

2. Privacy & Security
   - Location data protection
   - Personal exposure data
   - Data aggregation rules
   - Access controls

3. Clinical Integration
   - Health impact assessment
   - Risk factor analysis
   - Prevention recommendations
   - Clinical decision support

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code | Description |
|----------------|-----------|------------|-------------|
| Audio Exposure | NoiseExposureObservation.component[level] | 89020-2 | Environmental sound intensity |
| UV Index | UVExposureObservation.component[index] | 89022-8 | UV Index measurement |
| Noise Duration | NoiseExposureObservation.component[duration] | 89023-6 | Duration of noise exposure |
| Peak Level | NoiseExposureObservation.component[peak] | 89024-4 | Peak sound pressure level |
| Background Noise | NoiseExposureObservation.component[background] | 89025-1 | Background noise level |

### Mapping Considerations

1. Temporality
   - Continuous measurements aggregation
   - Analysis periods
   - Update frequency
   - Time zone handling
   - Event correlation

2. Data Quality
   - Sensor calibration
   - Measurement conditions
   - Data validation
   - Accuracy thresholds
   - Error detection

3. Context
   - Location data
   - Related activity
   - Environmental conditions
   - Device specifications
   - Measurement settings

4. Integration Requirements
   - HealthKit permissions
   - Data synchronization
   - API compatibility
   - Error handling
   - Batch processing

5. Validation Rules
   - Range validation
   - Unit conversion
   - Threshold alerts
   - Data consistency
   - Cross-validation

## Implementation Considerations

### Data Processing
1. Collection
   - Sensor calibration requirements
   - Measurement validation rules
   - Sampling frequency optimization
   - Data quality checks
   - Device synchronization

2. Analysis
   - Temporal aggregation methods
   - Pattern identification algorithms
   - Location correlation techniques
   - Trend analysis
   - Statistical processing

3. Storage
   - Raw data management
   - Processed metrics
   - Exposure history
   - Data retention policies
   - Backup procedures

### Alert System
1. Noise Alerts
   - Dangerous levels (>85 dB)
   - Extended exposure warnings
   - Intensity peaks detection
   - Daily exposure limits
   - Cumulative exposure tracking

2. UV Alerts
   - High UV index warnings
   - Exposure time monitoring
   - Critical hours alerts
   - Skin type considerations
   - Protection recommendations

### Visualizations
1. Dashboards
   - Daily exposure metrics
   - Weekly trends analysis
   - Comparative reports
   - Risk assessments
   - Historical patterns

2. Maps
   - Exposure locations
   - Risk zones mapping
   - Geographic patterns
   - Time-based heatmaps
   - Location clustering

### Integrations
1. Device Integration
   - Calibration procedures
   - Synchronization protocols
   - Validation methods
   - Error handling
   - Data consistency

2. External Data
   - UV forecasts
   - Noise mapping
   - Weather data
   - Environmental alerts
   - Public health data

### Clinical Integration
1. Risk Assessment
   - Exposure thresholds
   - Cumulative effects
   - Health impact analysis
   - Population comparisons
   - Trend evaluation

2. Decision Support
   - Clinical guidelines
   - Intervention triggers
   - Treatment recommendations
   - Follow-up protocols
   - Prevention strategies

### Recommendations
1. Protection Measures
   - Protective equipment
   - Optimal timing
   - Duration limits
   - Safety guidelines
   - Best practices

2. Mitigation Strategies
   - Exposure reduction
   - Preventive measures
   - Alternative options
   - Risk management
   - Behavioral changes

### Privacy & Security
1. Data Protection
   - Personal information handling
   - Location data privacy
   - Access controls
   - Encryption requirements
   - Audit trails

2. Compliance
   - Regulatory requirements
   - Data retention policies
   - Consent management
   - Security protocols
   - Privacy standards



// ===== Conteúdo de: symptoms.md =====


## FHIR Resources

### Main Resources Used
- Observation: For recording symptom details and measurements
- QuestionnaireResponse: For capturing structured symptom assessments
- Condition: For documenting ongoing symptoms
- ClinicalImpression: For clinical assessment of symptoms

### Parameters
- patient: Patient identifier
- date: Symptom record date
- category: symptom-assessment
- code: Specific symptom type

### Search Examples
GET [base]/Observation?category=symptom&patient=[id]&date=[date]
GET [base]/Observation?code=severity&patient=[id]

## Conformance

### Must Support Elements
Elements marked with MS must be supported:
- status
- category
- code
- subject
- effectiveDateTime
- value[x]
- component (for composite measurements)

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code |
|----------------|-----------|------------|
| Symptom Type | Observation.code | 75325-1 |
| Severity | Observation.component[severity].valueQuantity | 72514-3 |
| Duration | Observation.component[duration].valueDuration | 103333-2 |
| Frequency | Observation.component[frequency].valueQuantity | 103334-0 |

### Implementation Considerations

1. Data Collection
   - Questionnaire design
   - User interface optimization
   - Data validation rules
   - Real-time feedback
   - Multi-language support
   - Accessibility features

2. Data Quality
   - Input validation
   - Consistency checks
   - Temporal validation
   - Cross-reference verification
   - Completeness assessment
   - Error detection

3. Clinical Integration
   - Care plan updates
   - Alert generation
   - Decision support
   - Provider notifications
   - Trend analysis
   - Risk assessment

4. Privacy & Security
   - Data encryption
   - Access control
   - Audit logging
   - Consent management
   - Data retention
   - Regulatory compliance

5. Performance Optimization
   - Response time
   - Data compression
   - Cache management
   - Network efficiency
   - Battery impact
   - Storage optimization

## Implementation Details

### Data Flow
1. Collection
   - Direct user input
   - Periodic questionnaires
   - Follow-up records
   - Automated data validation
   - Real-time processing
   - Data synchronization

2. Validation
   - Data consistency
   - Record completeness
   - Temporal coherence
   - Value ranges
   - Logical relationships
   - Cross-validation

3. Analysis
   - Temporal patterns
   - Correlations
   - Trends
   - Statistical analysis
   - Pattern recognition
   - Predictive modeling

### User Interface
1. Recording
   - Easy data entry
   - Predefined templates
   - Customizable options
   - Quick input methods
   - Offline capability
   - Multi-device support

2. Visualization
   - Timelines
   - Intensity graphs
   - Recurrence patterns
   - Interactive charts
   - Custom views
   - Export options

3. Alerts
   - Severe symptoms
   - Concerning patterns
   - Recording reminders
   - Smart notifications
   - Priority levels
   - Custom thresholds

### Clinical Integration
1. Reports
   - Professional summaries
   - Symptom history
   - Trend analysis
   - Clinical metrics
   - Custom formats
   - Export capabilities

2. Clinical Decision Support
   - Pattern identification
   - Intervention triggers
   - Progress monitoring
   - Risk assessment
   - Treatment recommendations
   - Outcome tracking

### Quality Assurance
1. Data Quality
   - Input validation
   - Completeness checks
   - Consistency verification
   - Anomaly detection
   - Error handling
   - Data correction

2. System Performance
   - Response time
   - Data processing
   - Storage optimization
   - Battery efficiency
   - Network usage
   - Cache management

3. Security Measures
   - Data encryption
   - Access control
   - Audit trails
   - Compliance checks
   - Privacy protection
   - Backup procedures




// ===== Conteúdo de: mindfulness_module.md =====

# Mindfulness Module Implementation Guide

## Overview
This module provides FHIR resources and profiles for tracking mindfulness practices and their outcomes in healthcare applications.

## Scope
- Mindfulness session recording
- Mood and stress assessments
- Practice outcomes tracking
- Data integration with HealthKit

## Key Resources

### Profiles
- MindfulnessObservation: Core profile for recording mindfulness sessions
- MindfulnessQuestionnaire: Profile for mindfulness assessment tools
- MindfulnessConfiguration: Profile for module configuration

### Extensions
- MindfulnessContext: Additional context about practice sessions
- MindfulnessImportMap: Mapping configuration for data import

### Value Sets
- MoodValueSet: Standardized mood states
- MindfulnessOutcomeVS: Practice outcomes
- MindfulnessQualifierVS: Practice qualifiers

## Implementation Guidelines

### Data Collection
1. Session Recording
   - Duration tracking
   - Practice type categorization
   - Environmental context

2. Assessment Tools
   - Mood evaluation
   - Stress level measurement
   - Practice effectiveness

### Integration Points
1. HealthKit
   - Mindfulness minutes
   - Heart rate data
   - Activity correlation

2. Clinical Systems
   - EHR integration
   - Care plan incorporation
   - Progress monitoring

### Security Considerations
- Patient data privacy
- Access control
- Audit logging
- Data encryption

## Conformance Requirements
- Must support core profiles
- Required value set bindings
- Mandatory elements
- Validation rules

## Usage Examples
See the examples directory for detailed implementation scenarios.



// ===== Conteúdo de: mobility.md =====

# Mobility Implementation Guide

## Overview
This module describes how to implement mobility monitoring using iOS motion sensors data, covering data collection, processing, analysis, and clinical integration.

## FHIR Resources

### Main Resources Used
- Observation: For recording mobility metrics
- RiskAssessment: For fall risk evaluations
- Goal: For mobility improvement targets
- CarePlan: For mobility enhancement plans

### Parameters
- patient: Patient identifier
- date: Assessment date
- category: mobility
- code: Specific mobility metric

### Search Examples
GET [base]/Observation?category=mobility&patient=[id]&date=[date]
GET [base]/Observation?code=walking-steadiness&patient=[id]

## Conformance

### Must Support
Elements marked with MS must be supported:
- status
- category
- code
- subject
- effectiveDateTime
- value[x]
- device
- component (for composite measurements)

## Implementation Considerations

### Data Processing
1. Collection
   - Raw sensor data from iPhone motion sensors
   - Processing algorithms for motion data
   - Noise filtering and signal processing
   - Sampling rates and data quality checks
   - Battery optimization considerations
   - Motion context detection

2. Analysis
   - Key metrics calculation (speed, steadiness, balance)
   - Trend detection and pattern recognition
   - Statistical analysis methods
   - Machine learning model integration
   - Real-time vs batch processing
   - Performance optimization strategies

3. Storage
   - Raw sensor data management
   - Processed metrics database
   - Historical trend storage
   - Data compression techniques
   - Backup and archival policies
   - Privacy considerations

### Data Quality Validations
1. Data Quality
   - Signal integrity verification
   - Temporal consistency checks
   - Anomaly detection algorithms
   - Sensor calibration validation
   - Environmental interference detection
   - Movement artifact filtering

2. Trend Analysis
   - Significant change detection
   - Deterioration pattern identification
   - Cross-metric correlations
   - Baseline comparison methods
   - Statistical significance testing
   - Confidence level calculations

### Alert System
1. Alert Levels
   - Normal (green)
     * Within baseline parameters
     * Regular movement patterns
     * Stable measurements
   - Caution (yellow)
     * Minor deviations from baseline
     * Subtle pattern changes
     * Early warning indicators
   - Alert (red)
     * Significant changes detected
     * Concerning patterns identified
     * Immediate attention required

2. Triggers
   - Sudden changes in measurements
   - Negative trend development
   - Abnormal pattern detection
   - Multiple metric correlation
   - Time-based thresholds
   - Context-aware alerting

### User Interface
1. Visualizations
   - Trend graphs and charts
   - Status indicators and dashboards
   - Baseline comparisons
   - Interactive data exploration
   - Custom view configurations
   - Accessibility considerations

2. Notifications
   - Real-time alerts and updates
   - Periodic summary reports
   - Contextual recommendations
   - Priority-based notifications
   - User preference settings
   - Do-not-disturb protocols

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path |
|------------------|-----------|
| Walking Steadiness | Observation.component[steadiness] |
| Walking Speed | Observation.component[speed] |
| Step Length | Observation.component[stepLength] |
| Double Support Time | Observation.component[supportTime] |
| Walking Asymmetry | Observation.component[asymmetry] |

### Integration Requirements
1. Health App Integration
   - HealthKit permissions
   - Data synchronization
   - Background processing
   - Battery optimization
   - Error handling
   - Version compatibility

2. Clinical Systems
   - FHIR compliance
   - API endpoints
   - Authentication
   - Data mapping
   - Error handling
   - Versioning strategy

### Security and Privacy
1. Data Protection
   - Encryption standards
   - Access control
   - Audit logging
   - Data anonymization
   - Consent management
   - Regulatory compliance

2. System Security
   - Authentication methods
   - Authorization protocols
   - Secure communication
   - Threat detection
   - Incident response
   - System monitoring

### Performance Optimization
1. Resource Management
   - Battery optimization
   - Network usage
   - Storage efficiency
   - Processing optimization
   - Memory management
   - Cache strategies

2. Scalability
   - Load balancing
   - Data partitioning
   - Service distribution
   - Query optimization
   - Batch processing
   - Real-time processing

## Testing and Validation
1. Test Cases
   - Unit tests
   - Integration tests
   - Performance tests
   - Security tests
   - User acceptance tests
   - Compliance validation

2. Quality Assurance
   - Code review
   - Documentation review
   - Performance monitoring
   - Security audits
   - Compliance checks
   - User feedback

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code |
|----------------|-----------|------------|
| Walking Steadiness | WalkingSteadinessObservation.valueQuantity | LA32-8 |
| Walking Speed | WalkingSpeedObservation.valueQuantity | LA29042-4 |
| Step Length | StepLengthObservation.valueQuantity | LA19752-7 |
| Double Support Time | DoubleSupportTimeObservation.valueQuantity | LA32-9 |
| Walking Asymmetry | WalkingAsymmetryObservation.valueQuantity | LA32-10 |

### Mapping Considerations
1. Temporality
   - Aggregation of continuous measurements
   - Analysis periods 
   - Update frequency
   - Data synchronization timing
   - Historical data handling
   - Real-time vs batch processing

2. Quality Assurance
   - Measurement reliability
   - Collection conditions
   - Cross-validation
   - Data consistency checks
   - Calibration verification
   - Error detection and handling

3. Context
   - Environmental conditions
   - User state and conditions
   - Related activity
   - Device positioning
   - Movement patterns
   - Activity intensity

4. Data Flow
   - Continuous monitoring
   - Batch processing
   - Event triggers
   - Alert handling
   - Data transformation
   - Error recovery

5. Integration Requirements
   - HealthKit permissions
   - Data synchronization
   - Background processing
   - Battery optimization
   - Error handling
   - Version compatibility


// ===== Conteúdo de: social_interaction.md =====

# Social Interaction Module

## Overview
This module describes how social interaction data from iOS devices is mapped to FHIR resources to support lifestyle medicine interventions focused on social wellbeing.

## Data Sources
- Location data
- Calendar events
- Communication patterns
- Activity context
- User reported data

## Types of Data Collected

### 1. Interaction Metrics
- Duration
- Frequency  
- Group size
- Interaction type
- Communication mode

### 2. Social Context
- Location type
- Activity setting
- Time of day
- Environmental factors
- Social purpose

### 3. Quality Assessment
- Engagement level
- Satisfaction rating
- Support received
- Connection strength
- Interaction impact

### 4. Support Network
- Relationship types
- Network size
- Contact frequency
- Support availability
- Social capital

## Implementation Considerations

### Data Collection
1. Privacy Protection
   - Data minimization
   - Location masking
   - Identity protection
   - Consent management
   
2. Context Capture
   - Location context
   - Activity context
   - Social setting
   - Environmental factors

### Analysis
1. Pattern Recognition
   - Interaction frequency
   - Social rhythms
   - Support patterns
   - Isolation risks

2. Quality Assessment
   - Interaction depth
   - Support effectiveness
   - Connection strength
   - Network resilience

## FHIR Resources

### Core Resources
- Observation: For interaction records
- Questionnaire: For social assessments  
- CarePlan: For social engagement plans
- Goal: For social wellbeing targets

### Profiles
- SocialInteractionProfile
- SocialSupportProfile
- SocialNetworkProfile

### Extensions
- SocialContext
- SocialSupport
- SocialQuality

### Value Sets
- InteractionTypeVS
- SocialContextVS
- SupportTypeVS
- QualityMetricsVS

## iOS Data to FHIR Mapping

### Core Fields
| iOS Data | FHIR Path | Description |
|----------|-----------|-------------|
| Duration | component[duration] | Interaction length |
| Type | component[type] | Interaction category |
| Quality | component[quality] | Interaction quality |
| Support | component[support] | Support received |

### Implementation Notes
1. Privacy Controls
   - Data anonymization
   - Access restrictions
   - Audit logging
   - Consent tracking

2. Integration Points
   - Calendar sync
   - Location services
   - Communication apps
   - Health data correlation

3. Clinical Uses
   - Social prescribing
   - Isolation prevention
   - Support coordination
   - Wellbeing monitoring



// ===== Conteúdo de: practitioner-identifiers.md =====



# International Practitioner Identification

## Supported Identifier Systems

### United States
- **NPI (National Provider Identifier)**: `http://hl7.org/fhir/sid/us-npi`

### European Union
- **EUDAMED**: European database for medical devices practitioners
- National systems per member state

### Brazil  
- **CRM (Conselho Regional de Medicina)**: Medical council registration
- **CPF**: For general practitioner identification

## Usage Example

```json
{
  "identifier": [{
    "system": "http://hl7.org/fhir/sid/us-npi",
    "value": "1234567890"
  }]
}



// ===== Conteúdo de: nutrition.md =====

# Nutrition

## General Description
This module describes how nutritional data collected from the iOS Health App and through questionnaires are mapped to FHIR resources. Nutritional data is essential for assessment and intervention in lifestyle medicine.

## Data Sources
Nutritional data is collected from:
- iOS Health App (automatic data)
- User-completed questionnaires 
- Integrated nutrition apps
- Manual records

## Types of Data Collected

### 1. Hydration
- Water intake volume
- Other non-caloric beverages
- Intake timestamps
- Record source

### 2. Energy
- Total calories consumed
- Distribution by meal
- Meal timestamps
- Energy balance

### 3. Macronutrients
- Carbohydrates (g)
- Proteins (g) 
- Fats (g)
  - Saturated
  - Unsaturated
  - Trans

### 4. Micronutrients
- Vitamins
- Minerals
- Electrolytes

### 5. Other
- Caffeine
- Fiber
- Alcohol

## FHIR Resources
The nutritional data is mapped to FHIR resources with specific profiles for each type of measurement:

### Observations
- Nutrition intake observations
- Hydration observations
- Energy/caloric intake
- Nutrient measurements

### Care Plans
- Nutrition care plans
- Dietary recommendations
- Supplementation plans

### Goals
- Nutritional goals
- Hydration targets
- Weight management goals

## Implementation Considerations

### Data Validation
- Physiological range validation
- Consistency checks
- Cross-validation between related measurements
- Unit standardization

### Privacy & Security  
- Data anonymization
- Access control
- Audit logging
- Consent management

## Questionnaire to Observation Mapping

### QuestionnaireResponse to Observation
| Questionnaire Item | FHIR Observation |
|-------------------|------------------|
| water_intake | WaterIntakeObservation |
| calories | CalorieIntakeObservation |
| macronutrients | MacronutrientsObservation |

### Transformation Rules
1. Each meal response generates:
   - A calorie observation
   - A macronutrients observation
  
2. Daily Aggregations:
   - Total calories
   - Total macronutrients
   - Total water
   - Total caffeine

3. Validations:
   - Sum of macronutrients in grams
   - Calorie calculation from macronutrients
   - Values within physiological ranges

### Implementation Notes
- Each QuestionnaireResponse is processed into multiple Observations
- Timestamps from meal records are preserved in Observations
- Aggregations are performed at the end of each day
- All measurements include source attribution

## Implementation Considerations

### Data Flow
1. Collection
   - Questionnaire completion
   - App integration
   - iOS Health App data

2. Processing
   - Data validation
   - Derived calculations
   - Aggregations

3. Storage
   - QuestionnaireResponse
   - Observations
   - History

### Validations
1. Raw Data
   - Valid ranges
   - Temporal consistency
   - Completeness

2. Calculations
   - Macronutrient balance
   - Caloric equivalence
   - Daily goals

### UX Considerations
1. Questionnaire Interface
   - Easy completion
   - Default values
   - Real-time validation

2. Feedback
   - Daily progress
   - Goal alerts
   - Suggestions

### Technical Aspects
1. Device Integration
   - HealthKit permissions
   - Data synchronization
   - Offline support

2. Performance
   - Batch processing
   - Query optimization
   - Data aggregation strategies

3. Security
   - Data encryption
   - Access control
   - Audit logging



// ===== Conteúdo de: sleep.md =====

# Sleep

## General Description
This module describes how sleep data collected from the iOS Health App is mapped to FHIR resources. Sleep monitoring is a critical component of lifestyle medicine, providing insights into sleep quality and quantity.

## Data Source
The iOS Health App collects sleep data from the following sources:
- Apple Watch
- Integrated third-party apps
- Manual records

## Types of Collected Data

### Key Metrics
1. Time in Bed
   - Start time
   - End time
   - Total duration

2. Sleep Time
   - Total time sleeping
   - Sleep efficiency (percentage of time in bed actually sleeping)

3. Sleep Stages
   - Deep Sleep
   - REM Sleep
   - Light Sleep
   - Awake Time

4. Physiological Data During Sleep
   - Respiratory rate
   - Heart rate variability
   - Average heart rate

5. Sleep Quality
   - Sleep interruptions
   - Time to fall asleep
   - Sleep consistency

## Collection Frequency
- Continuous data during sleep period
- Daily metrics aggregation
- Weekly trend analysis

## Supported Operations

### Search
- patient + date
- patient + date-range
- patient + category

### Search Parameters
- patient: Patient identifier
- date: Sleep record date
- category: Observation category (always "sleep")

### Search Examples
GET [base]/Observation?category=sleep&patient=[id]&date=[date]
GET [base]/Observation?category=sleep&patient=[id]&date=ge[start]&date=le[end]

## Conformance

### Must Support
Elements marked with MS must be supported:
- status
- category
- code
- subject
- effectiveDateTime/effectivePeriod
- component.timeInBed
- component.totalSleepTime
- component.deepSleep
- component.remSleep
- component.lightSleep
- component.respiratoryRate
- component.heartRateVariability
- component.interruptions

### Cardinality
- Time in bed and total sleep time are mandatory (1..1)
- Other components are optional (0..1)

### Validation
- Total sleep time must be less than or equal to time in bed
- The sum of sleep stages must equal the total sleep time

## iOS Health App to FHIR Mapping

### Main Fields
| iOS Health App | FHIR Path |
|----------------|-----------|
| Time in Bed | component[timeInBed].valueQuantity |
| Sleep Time | component[totalSleepTime].valueQuantity |
| Deep Sleep | component[deepSleep].valueQuantity |
| REM Sleep | component[remSleep].valueQuantity |
| Light Sleep | component[lightSleep].valueQuantity |
| Respiratory Rate | component[respiratoryRate].valueQuantity |
| HRV | component[heartRateVariability].valueQuantity |
| Interruptions | component[interruptions].valueQuantity |

### Implementation Considerations
1. Data Aggregation
   - Data is collected continuously during sleep
   - Nightly aggregation is done automatically
   - Metrics are calculated per night of sleep

2. Data Quality
   - Temporal overlap validation
   - Consistency check between metrics
   - Outlier detection

3. Privacy and Security
   - Sensitive data requiring protection
   - User consent required
   - Anonymization for research use



// ===== Conteúdo de: stress.md =====

# Stress Assessment Module

## Overview
This module describes how stress data collected from iOS Health App sensors and user inputs are mapped to FHIR resources for lifestyle medicine interventions.

## Data Sources
- Heart Rate Variability (HRV) from Apple Watch 
- Blood pressure patterns
- Activity patterns
- Self-reported stress levels
- Mindfulness session data
- Sleep quality metrics

## Types of Data Collected

### 1. Physiological Stress Metrics
- Heart rate variability analysis
- Blood pressure patterns  
- Respiratory rate changes
- Sleep disruption
- Physical activity impact

### 2. Psychological Stress Assessment
- Perceived stress levels
- Mood changes
- Anxiety indicators
- Cognitive impacts
- Behavioral changes

### 3. Stress Response Patterns
- Acute vs chronic stress
- Recovery efficiency
- Adaptation capacity
- Resilience metrics
- Coping mechanisms

### 4. Environmental Context
- Location/setting
- Time patterns
- Activity context
- Social factors
- Environmental triggers

## Implementation Considerations

### 1. Data Collection
- Continuous sensor monitoring
- Periodic assessments
- Event-triggered recording
- Context capture
- User input validation

### 2. Analysis Pipeline
- Real-time processing
- Pattern detection
- Trend analysis
- Risk assessment
- Alert generation

### 3. Clinical Integration 
- Care plan updates
- Provider notifications
- Decision support
- Progress tracking
- Outcome measurement

## FHIR Resources

### Core Resources
- Observation: For stress measurements
- Questionnaire: For stress assessments
- CarePlan: For stress management plans
- Goal: For stress reduction targets

### Profiles
- StressLevelProfile
- StressAssessmentProfile
- StressManagementProfile

### Extensions
- StressContext
- StressTriggers
- StressCoping

### Value Sets
- StressChronicityVS
- StressImpactVS
- StressTriggersVS
- StressCopingVS

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | Description |
|----------------|-----------|-------------|
| HRV | Observation.component[hrv] | Heart rate variability |
| Stress Level | Observation.valueQuantity | Perceived stress level |
| Context | Observation.component[context] | Environmental context |
| Response | Observation.component[response] | Stress response pattern |

### Mapping Considerations
1. Data Validation
   - Physiological ranges
   - Temporal consistency
   - Context validation
   - Pattern validation

2. Context Handling  
   - Location tracking
   - Activity correlation
   - Social context
   - Environmental factors

3. Clinical Context
   - Care plan integration
   - Provider communication
   - Alert management
   - Progress tracking



// ===== Conteúdo de: reproductive.md =====


## FHIR Resources

### Main Resources Used
- Observation: For cycle tracking and temperature measurements
- QuestionnaireResponse: For symptom reporting
- CarePlan: For fertility planning
- Goal: For reproductive health goals

### Parameters
- patient: Patient identifier
- date: Record date
- category: reproductive-health
- code: Specific measurement type

### Search Examples
GET [base]/Observation?category=reproductive-health&patient=[id]&date=[date]
GET [base]/Observation?code=menstrual-cycle&patient=[id]

## Conformance

### Must Support Elements
Elements marked with MS must be supported:
- status
- category
- code
- subject
- effectiveDateTime
- value[x]
- component (for composite measurements)

## Implementation Considerations

### Data Collection
1. Automated Measurements
   - Temperature tracking
   - Activity patterns
   - Sleep quality
   - Heart rate variability

2. Manual Records
   - Symptom logging
   - Cycle tracking
   - Fertility signs
   - Medication use

### Data Analysis
1. Pattern Recognition
   - Cycle regularity
   - Temperature trends
   - Symptom correlations
   - Fertility windows

2. Alert Generation
   - Cycle predictions
   - Fertile days
   - Temperature changes
   - Symptom patterns

### Clinical Integration
1. Reports
   - Cycle summaries
   - Fertility tracking
   - Symptom patterns
   - Treatment responses

2. Decision Support
   - Fertility planning
   - Cycle abnormalities
   - Risk identification
   - Treatment monitoring

### Privacy & Security
1. Data Protection
   - Encryption
   - Access control
   - Consent management
   - Data sharing

2. User Control
   - Data visibility
   - Sharing preferences
   - Export options
   - Deletion rights

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code |
|----------------|-----------|------------|
| Cycle Start | Observation.effectiveDateTime | 8665-2 |
| Cycle Length | Observation.valueQuantity | 8664-5 |
| Flow Duration | Observation.component[duration].valueQuantity | 49033-4 |
| Basal Temperature | Observation.valueQuantity | 8310-5 |
| Cervical Mucus | Observation.valueCodeableConcept | 8669-4 |

### Integration Requirements
1. HealthKit Access
   - Permissions setup
   - Data synchronization
   - Background updates
   - Error handling

2. Data Validation
   - Range checks
   - Pattern validation
   - Temporal consistency
   - Cross-reference verification

### Performance Considerations
1. Data Processing
   - Real-time updates
   - Batch processing
   - Historical data
   - Trend analysis

2. Resource Optimization
   - Battery usage
   - Storage efficiency
   - Network usage
   - Processing load

### User Interface Guidelines
1. Data Entry
   - Quick input methods
   - Template options
   - Reminder settings
   - Validation feedback

2. Visualization
   - Cycle calendar
   - Temperature charts
   - Symptom tracking
   - Fertility windows

3. Notifications
   - Cycle predictions
   - Fertile days
   - Temperature alerts
   - Medication reminders


## Detailed Implementation Considerations

### Data Management
1. Storage Strategy
   - Real-time data storage
   - Historical data archival
   - Data compression techniques
   - Backup procedures
   - Recovery mechanisms
   - Version control

2. Data Quality
   - Input validation rules
   - Data completeness checks
   - Cross-validation methods
   - Anomaly detection
   - Error correction procedures
   - Quality metrics

### Clinical Integration Details
1. Provider Integration
   - Clinical portal access
   - Data export formats
   - Integration APIs
   - Real-time notifications
   - Emergency alerts
   - Audit trails

2. Decision Support
   - Clinical guidelines integration
   - Risk assessment algorithms
   - Treatment recommendations
   - Follow-up protocols
   - Alert thresholds
   - Intervention triggers

### Advanced Analytics
1. Pattern Recognition
   - Cycle irregularity detection
   - Symptom correlation analysis
   - Fertility window prediction
   - Risk factor identification
   - Trend analysis
   - Outcome prediction

2. Machine Learning Integration
   - Prediction models
   - Pattern classification
   - Anomaly detection
   - Personalization
   - Model training
   - Performance monitoring

### System Integration
1. External Systems
   - EHR integration
   - Laboratory systems
   - Pharmacy systems
   - Insurance systems
   - Research databases
   - Public health reporting

2. Data Exchange
   - HL7 FHIR APIs
   - Standard terminologies
   - Data mapping
   - Transform rules
   - Validation checks
   - Error handling

### Performance Optimization
1. Resource Management
   - CPU usage
   - Memory allocation
   - Storage optimization
   - Network bandwidth
   - Battery consumption
   - Cache strategy

2. Scalability
   - Load balancing
   - Database sharding
   - Service distribution
   - Queue management
   - Batch processing
   - Real-time processing

### User Experience
1. Accessibility
   - Screen reader support
   - Color contrast
   - Font sizing
   - Touch targets
   - Keyboard navigation
   - Voice input

2. Localization
   - Multiple languages
   - Cultural considerations
   - Date formats
   - Unit preferences
   - Terminology adaptation
   - Regional compliance

### Security Details
1. Authentication
   - Multi-factor authentication
   - Biometric options
   - Session management
   - Token handling
   - Password policies
   - Account recovery

2. Authorization
   - Role-based access
   - Attribute-based control
   - Dynamic permissions
   - Temporary access
   - Emergency access
   - Audit logging

3. Compliance
   - HIPAA requirements
   - GDPR compliance
   - Local regulations
   - Industry standards
   - Security frameworks
   - Privacy policies




// ===== Conteúdo de: vitalsigns.md =====

# Vital Signs

## General Description
This module describes how vital signs data collected from the iOS Health App are mapped to FHIR resources. Vital signs are fundamental physiological measurements that reflect essential body functions and health states.

## Data Source
The iOS Health App collects vital signs from the following sources:
- Apple Watch
- Bluetooth-connected medical devices
- Integrated third-party apps
- Manual records

## Types of Data Collected

### 1. Heart Rate
- Continuous measurement (Apple Watch)
- Resting heart rate
- Exercise heart rate
- Recovery heart rate
- Heart rate variability (HRV)
- Anomaly recording

### 2. Blood Pressure
- Systolic pressure
- Diastolic pressure
- Date and time of measurement
- Body position during measurement
- Device used

### 3. Oxygen Saturation (SpO2)
- Saturation percentage
- Trends over time
- Sleep measurements
- Activity measurements

### 4. Body Temperature
- Temperature in Celsius/Fahrenheit
- Measurement location
- Measurement method

### 5. Respiratory Rate
- Breaths per minute
- Resting measurements
- Sleep measurements
- Exercise measurements

### 6. ECG (Electrocardiogram)
- Trace recording
- Rhythm classification
- Beat interval
- Anomaly analysis

## Collection Frequency
- Heart Rate: Continuous (when using Apple Watch)
- Blood Pressure: Per measurement
- SpO2: Continuous or on-demand
- Temperature: Per measurement
- Respiratory Rate: Continuous during sleep/exercise
- ECG: On-demand/recording

## Operations Supported

### Search
- patient + date
- patient + code
- patient + category
- patient + code + date-range

### Search Parameters
- patient: Patient identifier
- date: Measurement date
- code: Vital sign type
- category: Category (vital-signs)

### Search Examples
GET [base]/Observation?category=vital-signs&patient=[id]&code=8867-4
GET [base]/Observation?category=vital-signs&patient=[id]&date=ge2024-03-19

## Conformance

### Must Support
Elements marked with MS must be supported:
- status
- category
- code
- subject
- effectiveDateTime
- valueQuantity
- component (when applicable)

### Cardinality
- Blood pressure requires systolic and diastolic components
- Other vital signs require at least one value

## iOS Health App to FHIR Mapping

### Main Fields
| iOS Health App | FHIR Path | LOINC Code |
|----------------|-----------|-------------|
| Heart Rate | valueQuantity | 8867-4 |
| HRV | component[heartRateVariability] | 80404-7 |
| Blood Pressure Systolic | component[systolic] | 8480-6 |
| Blood Pressure Diastolic | component[diastolic] | 8462-4 |
| SpO2 | valueQuantity | 2708-6 |
| Body Temperature | valueQuantity | 8310-5 |
| Respiratory Rate | valueQuantity | 9279-1 |

### Implementation Considerations

1. Source Prioritization
- Apple Watch has priority for continuous measurements
- Validated medical devices for specific measurements
- Manual entries as last resort

2. Data Validation
- Verification of values within physiological ranges
- Outlier detection
- Temporal consistency of measurements

3. Data Aggregation
- Continuous measurements aggregated in intervals
- Calculation of averages, minimums and maximums
- Trends over time

4. Accuracy and Reliability
- Indication of measurement source/device
- Measurement confidence level
- Device calibration and validation

5. Alert Management
- Definition of normal limits
- Notification of abnormal values
- Critical alert escalation

6. Storage and Retention
- Data retention policy
- Historical data compression
- Backup and recovery



// ===== Conteúdo de: physical_activity.md =====

# Physical Activity

## General Description
This module describes how physical activity data from the iOS Health App is mapped to FHIR resources.

## Data Source
The iOS Health App collects physical activity data in the following ways:
- iPhone sensors (step counter, GPS)
- Apple Watch (when available)
- Integrated third-party apps

## Types of Data Collected

### Steps
- Total step count
- Start and end timestamp
- Data source

### Distance
- Total distance covered
- Unit of measurement (meters/kilometers)
- Type of movement (walking/running)

### Workouts
- Type of exercise
- Duration
- Calories burned
- Distance (when applicable)
- Heart rate (when available)

### Energy
- Active calories
- Resting calories
- Total calories

## Collection Frequency
- Steps: Continuous when in motion
- Distance: Continuous during activity
- Workouts: Per session
- Energy: Daily calculation

## Supported Operations

### Search
- patient + date
- patient + activity-type
- patient + date + activity-type

### Search Parameters
- patient: Patient identifier
- date: Activity date
- activity-type: Type of physical activity

### Search Examples
GET [base]/Observation?category=activity&patient=[id]&date=[date]
GET [base]/Observation?category=activity&patient=[id]&code=[activity-type]
## Conformance

### Must Support
Elements marked with MS must be supported by the implementing system:
- status
- category
- code
- subject
- effectiveDateTime
- component.steps
- component.distance
- component.duration
- component.energy



// ===== Conteúdo de: mindfulness.md =====

# Mindfulness and Mental Health

## General Description 
This module describes how mindfulness practice and mental health data collected from the iOS Health App and through questionnaires are mapped to FHIR resources. This data is fundamental for assessing stress management and emotional wellbeing.

## Data Sources
Data is collected from:
- iOS Health App (automatic data)
- Apple Watch (breathing and mindfulness sessions) 
- Self-assessment questionnaires
- Integrated meditation apps
- Manual records

## Types of Data Collected

### 1. Mindfulness Practices
- Session duration
- Type of practice
- Session frequency 
- Practice timing

### 2. Mood State
- Current mood
- Daily variations
- Influencing factors
- Intensity

### 3. Stress Levels
- Perceived stress level
- Physical symptoms
- Identified triggers
- Management strategies

### 4. Relaxation
- Time dedicated
- Techniques used
- Perceived effectiveness
- Regularity

## Collection Frequency
- Mindfulness: Per session
- Mood: Multiple times per day
- Stress: Daily
- Relaxation: Per session

## FHIR Resources
Mindfulness and mental health data is mapped to FHIR resources with specific profiles for each type of measurement:

### Observations
- Mindfulness session observations
- Mood assessments 
- Stress level measurements
- Relaxation practice records

### Questionnaires 
- Mental health screenings
- Stress assessments
- Mood tracking
- Practice logs

### Goals
- Practice frequency targets
- Stress reduction goals
- Emotional wellbeing objectives

## Implementation Considerations

### Data Privacy 
- Enhanced security measures
- Patient consent management
- Access control
- Data anonymization

### Data Integration
- HealthKit integration
- Third-party app connectivity
- Multi-device synchronization
- Data consolidation
## Implementation Considerations

### Data Flow
1. Collection
   - Questionnaire completion
   - Apple Watch data
   - Meditation apps integration

2. Processing
   - Data validation
   - Trend analysis
   - Correlations with other indicators

3. Storage
   - QuestionnaireResponse
   - Observations
   - History and trends

### Validations
1. Input Data
   - Valid ranges for scales
   - Temporal consistency
   - Correlation between measurements

2. Analysis
   - Mood patterns
   - Practice effectiveness
   - Stress triggers

### UX Considerations
1. Questionnaire Interface
   - Simple completion
   - Immediate visual feedback
   - Multi-language support

2. Feedback
   - Trend visualization
   - Personalized recommendations
   - Adaptive reminders

### Integration Requirements
1. HealthKit Integration
   - Mindfulness minutes
   - Heart rate variability
   - Sleep data correlation

2. Third-party Apps
   - API requirements
   - Data synchronization
   - Privacy considerations



// ===== Conteúdo de: data-protection-policies.md =====

---
title: Data Protection Policies
---

# Healthcare Data Protection Policies

This Implementation Guide complies with multiple international data protection regulations.

## Supported Jurisdictions

### 🇪🇺 European Union - GDPR
- **Regulation**: General Data Protection Regulation (EU) 2016/679
- **Official URL**: [EUR-Lex GDPR](https://eur-lex.europa.eu/eli/reg/2016/679/oj)
- **Key Requirements**:
  - Explicit consent for data processing
  - Right to erasure ("right to be forgotten")
  - Data portability
  - Privacy by design

### 🇺🇸 United States - HIPAA
- **Regulation**: Health Insurance Portability and Accountability Act
- **Official URL**: [HHS HIPAA](https://www.hhs.gov/hipaa/index.html)
- **Key Requirements**:
  - Minimum necessary standard
  - Administrative, physical, and technical safeguards
  - Breach notification
  - Business Associate Agreements

### 🇧🇷 Brazil - LGPD
- **Regulation**: Lei Geral de Proteção de Dados (Law 13.709/2018)
- **Official URL**: [Planalto LGPD](http://www.planalto.gov.br/ccivil_03/_ato2015-2018/2018/lei/L13709compilado.htm)
- **Key Requirements**:
  - Legal basis for processing
  - Data subject rights
  - International transfer restrictions
  - Data Protection Officer requirement

## Implementation in FHIR

This IG uses the [IHE Privacy Consent on FHIR (PCF)](https://profiles.ihe.net/ITI/PCF/) profile for consent management.

### Consent Resources
- [Multi-Jurisdictional Consent Profile](StructureDefinition-multi-jurisdictional-consent.html)
- [Mindfulness Access Policy](Consent-MindfulnessAccessPolicy.html)
- [Security Definition](Consent-MindfulnessSecurityDefinition.html)

### Security Implementation
- OAuth 2.0 with SMART on FHIR
- TLS 1.2+ for all communications
- Audit logging per BALP specification
- Role-based access control (RBAC)



// ===== Conteúdo de: bodymetrics.md =====

# Body Measurements

## Overview
This module describes how anthropometric and body composition data collected from the iOS Health App are mapped to FHIR resources. These measurements are fundamental for assessing nutritional status and monitoring lifestyle medicine interventions.

## Data Sources
The iOS Health App collects body measurements from the following sources:
- Connected smart scales
- Bioimpedance devices 
- Manual measurements
- Integrated third-party apps

## Types of Collected Data

### 1. Basic Measurements
- Body weight
- Height
- BMI (automatically calculated)
- Waist circumference

### 2. Body Composition
- Body fat percentage
- Lean mass
- Body water
- Muscle mass 
- Bone mass

### 3. Segmental Analysis
- Body fat distribution
- Muscle mass distribution
- Body symmetry

### 4. Trends and Analysis
- Weight variation
- BMI history
- Body composition progression
- Goals and objectives

## Collection Frequency
- Weight: Recommended daily
- Height: Periodically 
- Body composition: Weekly
- Circumference: Monthly

## FHIR Resources
The body measurements are mapped to FHIR Observation resources with specific profiles for each type of measurement.

### Examples
- Weight measurements use the [body-weight](StructureDefinition-body-weight.html) profile
- Height uses the [body-height](StructureDefinition-body-height.html) profile
- BMI calculations use the [bmi](StructureDefinition-bmi.html) profile

## Supported Operations

### Search
- patient + date
- patient + code
- patient + date-range + code
- patient + category

### Search Parameters
- patient: Patient identifier
- date: Measurement date
- code: Type of body measurement
- category: Category (vital-signs)

### Search Examples
GET [base]/Observation?category=vital-signs&patient=[id]&code=29463-7
GET [base]/Observation?category=vital-signs&patient=[id]&date=ge2024-03-19
GET [base]/Observation?category=vital-signs&patient=[id]&code=88365-2&date=ge2024-01-01&date=le2024-12-31
Copy
## Conformance

### Must Support
Elements marked with MS must be supported:
- status: Measurement status
- category: Vital signs category
- code: Type of measurement (LOINC code)
- subject: Reference to patient
- effectiveDateTime: When measurement was taken
- valueQuantity: The measurement value and unit
- component: Body composition components (for composition measurements)

### Device Support
The following device types are supported for data capture:
- Smart scales
- Bioimpedance analyzers
- Manual entry
- Third-party apps via HealthKit

### Security Requirements
- Patient access control
- Device authentication
- Data validation rules

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code | Description |
|----------------|-----------|-------------|-------------|
| Weight | WeightObservation.valueQuantity | 29463-7 | Body weight measurement |
| Height | HeightObservation.valueQuantity | 8302-2 | Body height measurement |
| BMI | BMIObservation.valueQuantity | 39156-5 | Body Mass Index calculation |
| Body Fat % | BodyCompositionObservation.component[bodyFat] | 41982-0 | Percentage of body fat |
| Lean Mass | BodyCompositionObservation.component[leanMass] | 291-7 | Lean body mass |
| Body Water | BodyCompositionObservation.component[bodyWater] | 73708-0 | Total body water |
| Muscle Mass | BodyCompositionObservation.component[muscleMass] | 73713-0 | Skeletal muscle mass |
| Bone Mass | BodyCompositionObservation.component[boneMass] | 73711-4 | Bone mass measurement |

### Implementation Considerations

1. Data Validation
- Physiological range validation
- Sudden variation detection
- Cross-validation between related measurements
- Unit conversion and standardization

2. Automatic Calculations
- BMI calculation from weight and height
- Cross-validation of composition measurements
- Percentage changes and trends
- Statistical analysis of measurements

3. Frequency and Timing
- Measurement frequency recommendations
- Preferred measurement timing
- Minimum intervals between measurements
- Time zone handling for measurements

4. Data Quality
- Measurement source (device/manual)
- Device calibration status
- Measurement conditions
- Data completeness checks

5. Goal Integration
- Goal setting and tracking
- Progress monitoring
- Significant deviation alerts
- Personalized target ranges

6. Reports and Visualizations
- Trend charts and graphs
- Reference comparisons
- Body composition analysis
- Progress reports and summaries

### Device Integration

1. Smart Scale Integration
- Bluetooth connectivity
- Data synchronization
- Error handling
- Battery status monitoring

2. Bioimpedance Analysis
- Device calibration requirements
- Measurement protocol
- Environmental conditions
- Quality control checks

3. Manual Entry
- Data validation rules
- Required fields
- Unit conversion support
- Entry confirmation

### Error Handling

1. Device Errors
- Connection failures
- Calibration errors
- Battery warnings
- Invalid measurements

2. Data Validation Errors
- Out of range values
- Inconsistent measurements
- Missing required data
- Invalid units

3. Synchronization Errors
- Network connectivity issues
- Data transfer failures
- Version conflicts
- Retry mechanisms




// ===== Conteúdo de: index.md =====

# iOS Health App Lifestyle Medicine Implementation Guide

## Purpose
This FHIR implementation guide defines how to extract and represent health and lifestyle data from the iOS Health App to support lifestyle medicine interventions.

## Scope
The implementation guide covers the following data domains from iOS Health App:

### Vital Signs
- Basic vital signs (heart rate, blood pressure, temperature, etc.)
- Advanced physiological metrics (HRV, respiratory patterns, etc.)
- Physiological stress biomarkers
- Thermoregulation metrics

### Physical Activity
- Steps and distance
- Workouts and exercise
- Energy expenditure
- Activity patterns
- Movement analysis

### Sleep
- Sleep duration and stages
- Sleep quality metrics
- Breathing during sleep
- Heart rate during sleep
- Sleep consistency

### Mindfulness & Mental Health
- Mindfulness sessions
- Stress levels
- Mood tracking
- Relaxation practices
- Mental well-being metrics

### Body Measurements
- Weight and height
- BMI calculations
- Body composition
- Anthropometric measurements

### Nutrition
- Food and water intake
- Macronutrients tracking
- Energy balance
- Meal patterns

### Environmental Factors
- Noise exposure
- UV exposure
- Environmental context
- Exposure patterns

### Reproductive Health
- Cycle tracking
- Fertility signs
- Symptoms tracking
- Health patterns

### Social & Behavioral
- Social interactions
- Support networks
- Behavioral patterns
- Activity context

## Use Cases
1. Automated health data collection and monitoring
2. Lifestyle pattern assessment and analysis
3. Intervention planning and tracking
4. Progress monitoring and outcomes assessment
5. Patient engagement and self-management
6. Clinical decision support
7. Research and population health

## Audience
- Healthcare software developers
- Healthcare professionals and providers
- Digital health platform developers
- Health researchers
- Lifestyle medicine specialists
- Health informaticians
- Digital health innovators

## Technical Framework
Built on FHIR R4 (4.0.1) with:
- Custom profiles for iOS Health data
- Extensions for contextual information
- Terminologies for standardized coding
- Search parameters for data access
- Operations for data processing
- Examples for implementation guidance

## Implementation Notes
- Integration with HealthKit API
- Privacy and security considerations
- Data validation requirements
- Interoperability guidelines
- Best practices for implementation



// ===== Conteúdo de: advanced_vitalsigns.md =====

# Advanced Vital Signs Data

## Overview
This module defines how advanced vital signs data collected from the iOS Health App are mapped to FHIR resources. These data provide a deeper insight into individual physiology and homeostasis, complementing basic vital signs.

## Data Sources
- Apple Watch (advanced sensors)
- Connected medical devices
- Integrated biomedical sensors
- Specialized health apps

## Types of Collected Data

### 1. Advanced Cardiovascular Metrics
- Detailed Heart Rate Variability
  - HRV spectral analysis
  - Low/high frequency indicators
  - HRV entropy measurements
  - Time-domain metrics
  - Frequency-domain parameters
- Cardiac Recovery Indices
  - Post-exercise recovery rate
  - Time to normalization
  - Recovery pattern analysis
  - Heart rate reserve
- Advanced Blood Pressure
  - Mean arterial pressure
  - Pulse pressure
  - Blood pressure variability
  - Circadian pattern tracking
  - Pressure waveform analysis

### 2. Advanced Respiratory Metrics
- Respiratory Patterns
  - Respiratory variability
  - Estimated respiratory volume
  - Ventilation/perfusion ratio
  - Breathing pattern analysis
  - Respiratory rate variability
- Advanced Oxygen Saturation
  - Nocturnal trends
  - Exercise desaturation
  - Hypoxia index
  - Recovery patterns
  - Continuous monitoring

### 3. Physiological Stress Biomarkers
- Physiological stress index
- Allostatic load measurement
- Autonomic recovery tracking
- Sympathetic-vagal balance
- Stress response patterns
- Recovery efficiency metrics
- Chronic stress indicators

### 4. Thermoregulation Metrics
- Circadian temperature variation
- Temperature gradients
- Exercise thermal response
- Heat dissipation patterns
- Core temperature estimation
- Skin temperature mapping
- Environmental adaptation

### 5. Multiparametric Integration
- Composite health indices
- Parameter correlations
- Trend prediction models
- Abnormal pattern detection
- Risk stratification
- Personalized baselines
- Adaptive thresholds

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code | Description |
|----------------|-----------|------------|-------------|
| Heart Rate Variability | HRVObservation.component[hrv] | 80404-7 | R-R interval standard deviation |
| Respiratory Rate | RespiratoryObservation.component[rate] | 9279-1 | Respiratory rate |
| Blood Pressure | BPObservation.component[systolic/diastolic] | 85354-9 | Blood pressure panel with all children |
| Temperature | TempObservation.component[core] | 8310-5 | Body temperature |
| Oxygen Saturation | SpO2Observation.component[saturation] | 59408-5 | Oxygen saturation in blood |

### Advanced Measurements
| iOS Health App | FHIR Path | LOINC Code | Description |
|----------------|-----------|------------|-------------|
| HRV Analysis | HRVObservation.component[spectral] | 80405-4 | Heart rate variability metrics |
| Recovery Rate | RecoveryObservation.component[rate] | 80406-2 | Cardiac recovery rate |
| Stress Index | StressObservation.component[index] | 80407-0 | Physiological stress index |
| Temperature Variation | TempObservation.component[variation] | 80408-8 | Temperature pattern |

## Implementation Requirements

### 1. Data Collection
- Sensor accuracy
- Sampling frequency
- Calibration protocols
- Quality assurance
- Data validation

### 2. Processing Pipeline
- Signal processing
- Noise reduction
- Feature extraction
- Pattern analysis
- Real-time processing

### 3. Integration Aspects
- Data synchronization
- Device compatibility
- API requirements
- Security protocols
- Privacy compliance

### 4. Clinical Validation
- Accuracy verification
- Clinical correlation
- Reference standards
- Validation studies
- Performance metrics

## Technical Implementation

### Data Processing Pipeline
1. Data Collection
   - Sensor data acquisition
   - Quality checks
   - Initial validation
   - Raw data storage

2. Signal Processing
   - Noise reduction
   - Artifact removal
   - Signal enhancement
   - Feature extraction

3. Analysis Pipeline
   - Pattern detection
   - Trend analysis
   - Statistical processing
   - Composite index calculation

4. Clinical Integration
   - Risk assessment
   - Alert generation
   - Clinical correlation
   - Decision support

### Data Quality Management
1. Validation Rules
   - Range checking
   - Consistency verification
   - Cross-validation
   - Temporal validation

2. Quality Metrics
   - Signal quality
   - Data completeness
   - Measurement accuracy
   - Sensor reliability

3. Error Handling
   - Data gaps
   - Sensor failures
   - Connection issues
   - Processing errors

### Integration Requirements
1. Device Integration
   - Sensor compatibility
   - Data protocols
   - Synchronization
   - Calibration

2. System Integration
   - API requirements
   - Data formats
   - Security protocols
   - Performance standards

3. Clinical Systems
   - EHR integration
   - Alert systems
   - Decision support
   - Documentation

## Clinical Applications

### 1. Preventive Medicine
- Early warning systems
- Risk assessment
- Trend analysis
- Intervention timing
- Prevention strategies

### 2. Performance Monitoring
- Athletic performance
- Recovery optimization
- Training adaptation
- Fatigue detection
- Overtraining prevention

### 3. Clinical Decision Support
- Pattern recognition
- Risk stratification
- Treatment response
- Progress monitoring
- Outcome prediction

### Use Cases
1. Clinical Monitoring
   - Patient tracking
   - Progress assessment
   - Treatment response
   - Risk prediction

2. Research Applications
   - Data collection
   - Pattern analysis
   - Outcome studies
   - Population health

3. Personal Health
   - Self-monitoring
   - Health goals
   - Lifestyle tracking
   - Preventive care

### Best Practices
1. Implementation Guidelines
   - Setup procedures
   - Configuration steps
   - Maintenance protocols
   - Update processes

2. User Training
   - Clinical staff
   - Technical team
   - End users
   - Support staff

3. Quality Assurance
   - Testing protocols
   - Validation procedures
   - Performance monitoring
   - Continuous improvement

## Privacy and Security

### Data Protection
1. Security Measures
   - Encryption
   - Access control
   - Audit logging
   - Data segregation

2. Privacy Controls
   - Consent management
   - Data anonymization
   - Access restrictions
   - Usage tracking

### Compliance Requirements
1. Regulatory Standards
   - HIPAA compliance
   - GDPR requirements
   - Local regulations
   - Industry standards

2. Documentation
   - Policy documentation
   - Procedure records
   - Audit trails
   - Compliance reports

## Supported Operations

### Advanced Search Capabilities
- Multiparametric search
- Trend analysis queries
- Temporal correlations
- Circadian pattern analysis
- Complex pattern matching
- Event sequence detection

### Specific Search Parameters
1. Composite Indices
   - physiological-stress-index
   - allostatic-load
   - autonomic-balance
   - recovery-index

2. Temporal Patterns
   - circadian-rhythm
   - ultradian-pattern
   - seasonal-variation
   - adaptation-trend

3. Physiological Correlations
   - cardio-respiratory
   - thermo-regulatory
   - stress-recovery
   - autonomic-balance

4. Adaptive Trends
   - baseline-shift
   - response-pattern
   - recovery-trajectory
   - adaptation-rate

### Advanced Search Examples

GET [base]/Observation?category=advanced-vitals&patient=[id]&code=physiological-stress
GET [base]/Observation?category=advanced-vitals&patient=[id]&date=ge[start]&component-code=autonomic-balance
GET [base]/Observation?category=advanced-vitals&patient=[id]&code=recovery-index&date=ge[start]&date=le[end]
GET [base]/Observation?category=advanced-vitals&patient=[id]&component-code=circadian-pattern&_include=related-observations

## Calculations and Transformations

### 1. Advanced Cardiac Metrics
- HRV Spectral Analysis:

	- Power(f) = |FFT(RR intervals)|²
	
	- LF Power = ∫(0.04-0.15 Hz) Power(f)df
	
	- HF Power = ∫(0.15-0.40 Hz) Power(f)df

- HRV Entropy:

	- SampEn = -ln(A/B), where:
		- A = matches of length m+1
		- B = matches of length m

- Autonomic Balance:

	- LF/HF ratio = (LF Power)/(HF Power)
	
	- Normalized LF = LF/(LF+HF)*100
	
	- Normalized HF = HF/(LF+HF)*100

### 2. Respiratory Metrics
- Respiratory Variability:

	- CV = (SD of intervals)/(Mean interval)*100
	
	- RMSSD = √(Σ(RRi+1 - RRi)²/n)

- Oxygenation Indices:

	- PaO2/FiO2 ratio
	
	- SpO2/FiO2 ratio
	
	- OI = (FiO2 * MAP)/(PaO2)

### 3. Composite Indices
- Physiological Stress Index (PSI):
	- PSI = w1HRVnorm + w2BPnorm + w3SpO2norm + w4Tempnorm, where:
	
		- HRVnorm = normalized HRV deviation
	
		- BPnorm = normalized blood pressure variation
	
		- SpO2norm = normalized oxygen saturation
	
		- Tempnorm = normalized temperature variation
	
		- wi = weighting factors

- Homeostasis Index (HI):
	- HI = Σ(wi * Mi) / Σwi, where:
	
		- Mi = normalized metric i
	
		- wi = weight for metric i

- Allostatic Load Index (ALI): 
	- ALI = Σ(Ci), where:
	
		- Ci = count of metrics outside normal range

### 4. Advanced Statistical Transformations
- Time Domain Analysis:
	- SDNN = √(Σ(RRi - RRmean)²/(n-1))
	
	- pNN50 = (NN50 count)/(total NN count)

- Frequency Domain Analysis:
	- Welch's periodogram
	
	- AR spectral analysis
	
	- Wavelet transform

- Non-linear Methods:
	- Poincaré plot indices
	- Detrended fluctuation analysis
	- Sample entropy
	- Approximate entropy

### 5. Pattern Recognition
- Circadian Pattern Analysis:
	- Cosinor analysis
	- Phase estimation
	- Amplitude calculation
	- MESOR determination

- Trend Detection:
	- Moving averages
	- Exponential smoothing
	- Change point detection
	- Pattern matching

These calculations and transformations provide the mathematical foundation for advanced vital signs analysis. Each metric is carefully validated and normalized to ensure clinical relevance and reliability.




// ===== Conteúdo de: environmental.md =====

# Environmental Factors

## Overview
This module describes how environmental data collected from the iOS Health App is mapped to FHIR resources. These data are crucial for assessing exposure to environmental factors that may impact health.

## Data Sources
Environmental data is collected through:
- iPhone (built-in sensors)
- Apple Watch
- Integrated environmental monitoring apps
- Connected environmental monitoring devices

## Types of Collected Data

### 1. Audio Exposure
- Exposure level in decibels (dB)
- Duration of exposure
- Peak moments
- Dangerous level alerts
- Exposure history
- Sound pressure level measurements
- Daily noise dose calculation

### 2. Environmental Noise
- Continuous noise levels
- Daily variations
- Exposure patterns
- Associated locations
- Critical periods
- Background noise analysis
- Quiet time periods

### 3. UV Exposure
- UV index measurements
- Exposure duration
- Time of exposure
- Intensity levels
- Protection recommendations
- Cumulative exposure
- Risk assessments

## Collection Frequency
- Noise: Continuous monitoring
- UV: During sun exposure
- Alerts: Real-time
- Analysis: Daily and weekly aggregation

## FHIR Resources
Environmental data is mapped to FHIR Observation resources with specific profiles:
- AudioExposureObservation
- EnvironmentalNoiseObservation
- UVExposureObservation

## Supported Operations
- Search by date
- Search by exposure type
- Search by intensity level
- Aggregate reports

## Implementation Considerations
1. Data Validation
   - Sensor calibration
   - Measurement accuracy
   - Data consistency checks
   - Outlier detection

2. Privacy & Security
   - Location data protection
   - Personal exposure data
   - Data aggregation rules
   - Access controls

3. Clinical Integration
   - Health impact assessment
   - Risk factor analysis
   - Prevention recommendations
   - Clinical decision support

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code | Description |
|----------------|-----------|------------|-------------|
| Audio Exposure | NoiseExposureObservation.component[level] | 89020-2 | Environmental sound intensity |
| UV Index | UVExposureObservation.component[index] | 89022-8 | UV Index measurement |
| Noise Duration | NoiseExposureObservation.component[duration] | 89023-6 | Duration of noise exposure |
| Peak Level | NoiseExposureObservation.component[peak] | 89024-4 | Peak sound pressure level |
| Background Noise | NoiseExposureObservation.component[background] | 89025-1 | Background noise level |

### Mapping Considerations

1. Temporality
   - Continuous measurements aggregation
   - Analysis periods
   - Update frequency
   - Time zone handling
   - Event correlation

2. Data Quality
   - Sensor calibration
   - Measurement conditions
   - Data validation
   - Accuracy thresholds
   - Error detection

3. Context
   - Location data
   - Related activity
   - Environmental conditions
   - Device specifications
   - Measurement settings

4. Integration Requirements
   - HealthKit permissions
   - Data synchronization
   - API compatibility
   - Error handling
   - Batch processing

5. Validation Rules
   - Range validation
   - Unit conversion
   - Threshold alerts
   - Data consistency
   - Cross-validation

## Implementation Considerations

### Data Processing
1. Collection
   - Sensor calibration requirements
   - Measurement validation rules
   - Sampling frequency optimization
   - Data quality checks
   - Device synchronization

2. Analysis
   - Temporal aggregation methods
   - Pattern identification algorithms
   - Location correlation techniques
   - Trend analysis
   - Statistical processing

3. Storage
   - Raw data management
   - Processed metrics
   - Exposure history
   - Data retention policies
   - Backup procedures

### Alert System
1. Noise Alerts
   - Dangerous levels (>85 dB)
   - Extended exposure warnings
   - Intensity peaks detection
   - Daily exposure limits
   - Cumulative exposure tracking

2. UV Alerts
   - High UV index warnings
   - Exposure time monitoring
   - Critical hours alerts
   - Skin type considerations
   - Protection recommendations

### Visualizations
1. Dashboards
   - Daily exposure metrics
   - Weekly trends analysis
   - Comparative reports
   - Risk assessments
   - Historical patterns

2. Maps
   - Exposure locations
   - Risk zones mapping
   - Geographic patterns
   - Time-based heatmaps
   - Location clustering

### Integrations
1. Device Integration
   - Calibration procedures
   - Synchronization protocols
   - Validation methods
   - Error handling
   - Data consistency

2. External Data
   - UV forecasts
   - Noise mapping
   - Weather data
   - Environmental alerts
   - Public health data

### Clinical Integration
1. Risk Assessment
   - Exposure thresholds
   - Cumulative effects
   - Health impact analysis
   - Population comparisons
   - Trend evaluation

2. Decision Support
   - Clinical guidelines
   - Intervention triggers
   - Treatment recommendations
   - Follow-up protocols
   - Prevention strategies

### Recommendations
1. Protection Measures
   - Protective equipment
   - Optimal timing
   - Duration limits
   - Safety guidelines
   - Best practices

2. Mitigation Strategies
   - Exposure reduction
   - Preventive measures
   - Alternative options
   - Risk management
   - Behavioral changes

### Privacy & Security
1. Data Protection
   - Personal information handling
   - Location data privacy
   - Access controls
   - Encryption requirements
   - Audit trails

2. Compliance
   - Regulatory requirements
   - Data retention policies
   - Consent management
   - Security protocols
   - Privacy standards



// ===== Conteúdo de: symptoms.md =====


## FHIR Resources

### Main Resources Used
- Observation: For recording symptom details and measurements
- QuestionnaireResponse: For capturing structured symptom assessments
- Condition: For documenting ongoing symptoms
- ClinicalImpression: For clinical assessment of symptoms

### Parameters
- patient: Patient identifier
- date: Symptom record date
- category: symptom-assessment
- code: Specific symptom type

### Search Examples
GET [base]/Observation?category=symptom&patient=[id]&date=[date]
GET [base]/Observation?code=severity&patient=[id]

## Conformance

### Must Support Elements
Elements marked with MS must be supported:
- status
- category
- code
- subject
- effectiveDateTime
- value[x]
- component (for composite measurements)

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code |
|----------------|-----------|------------|
| Symptom Type | Observation.code | 75325-1 |
| Severity | Observation.component[severity].valueQuantity | 72514-3 |
| Duration | Observation.component[duration].valueDuration | 103333-2 |
| Frequency | Observation.component[frequency].valueQuantity | 103334-0 |

### Implementation Considerations

1. Data Collection
   - Questionnaire design
   - User interface optimization
   - Data validation rules
   - Real-time feedback
   - Multi-language support
   - Accessibility features

2. Data Quality
   - Input validation
   - Consistency checks
   - Temporal validation
   - Cross-reference verification
   - Completeness assessment
   - Error detection

3. Clinical Integration
   - Care plan updates
   - Alert generation
   - Decision support
   - Provider notifications
   - Trend analysis
   - Risk assessment

4. Privacy & Security
   - Data encryption
   - Access control
   - Audit logging
   - Consent management
   - Data retention
   - Regulatory compliance

5. Performance Optimization
   - Response time
   - Data compression
   - Cache management
   - Network efficiency
   - Battery impact
   - Storage optimization

## Implementation Details

### Data Flow
1. Collection
   - Direct user input
   - Periodic questionnaires
   - Follow-up records
   - Automated data validation
   - Real-time processing
   - Data synchronization

2. Validation
   - Data consistency
   - Record completeness
   - Temporal coherence
   - Value ranges
   - Logical relationships
   - Cross-validation

3. Analysis
   - Temporal patterns
   - Correlations
   - Trends
   - Statistical analysis
   - Pattern recognition
   - Predictive modeling

### User Interface
1. Recording
   - Easy data entry
   - Predefined templates
   - Customizable options
   - Quick input methods
   - Offline capability
   - Multi-device support

2. Visualization
   - Timelines
   - Intensity graphs
   - Recurrence patterns
   - Interactive charts
   - Custom views
   - Export options

3. Alerts
   - Severe symptoms
   - Concerning patterns
   - Recording reminders
   - Smart notifications
   - Priority levels
   - Custom thresholds

### Clinical Integration
1. Reports
   - Professional summaries
   - Symptom history
   - Trend analysis
   - Clinical metrics
   - Custom formats
   - Export capabilities

2. Clinical Decision Support
   - Pattern identification
   - Intervention triggers
   - Progress monitoring
   - Risk assessment
   - Treatment recommendations
   - Outcome tracking

### Quality Assurance
1. Data Quality
   - Input validation
   - Completeness checks
   - Consistency verification
   - Anomaly detection
   - Error handling
   - Data correction

2. System Performance
   - Response time
   - Data processing
   - Storage optimization
   - Battery efficiency
   - Network usage
   - Cache management

3. Security Measures
   - Data encryption
   - Access control
   - Audit trails
   - Compliance checks
   - Privacy protection
   - Backup procedures




// ===== Conteúdo de: mindfulness_module.md =====

# Mindfulness Module Implementation Guide

## Overview
This module provides FHIR resources and profiles for tracking mindfulness practices and their outcomes in healthcare applications.

## Scope
- Mindfulness session recording
- Mood and stress assessments
- Practice outcomes tracking
- Data integration with HealthKit

## Key Resources

### Profiles
- MindfulnessObservation: Core profile for recording mindfulness sessions
- MindfulnessQuestionnaire: Profile for mindfulness assessment tools
- MindfulnessConfiguration: Profile for module configuration

### Extensions
- MindfulnessContext: Additional context about practice sessions
- MindfulnessImportMap: Mapping configuration for data import

### Value Sets
- MoodValueSet: Standardized mood states
- MindfulnessOutcomeVS: Practice outcomes
- MindfulnessQualifierVS: Practice qualifiers

## Implementation Guidelines

### Data Collection
1. Session Recording
   - Duration tracking
   - Practice type categorization
   - Environmental context

2. Assessment Tools
   - Mood evaluation
   - Stress level measurement
   - Practice effectiveness

### Integration Points
1. HealthKit
   - Mindfulness minutes
   - Heart rate data
   - Activity correlation

2. Clinical Systems
   - EHR integration
   - Care plan incorporation
   - Progress monitoring

### Security Considerations
- Patient data privacy
- Access control
- Audit logging
- Data encryption

## Conformance Requirements
- Must support core profiles
- Required value set bindings
- Mandatory elements
- Validation rules

## Usage Examples
See the examples directory for detailed implementation scenarios.



// ===== Conteúdo de: mobility.md =====

# Mobility Implementation Guide

## Overview
This module describes how to implement mobility monitoring using iOS motion sensors data, covering data collection, processing, analysis, and clinical integration.

## FHIR Resources

### Main Resources Used
- Observation: For recording mobility metrics
- RiskAssessment: For fall risk evaluations
- Goal: For mobility improvement targets
- CarePlan: For mobility enhancement plans

### Parameters
- patient: Patient identifier
- date: Assessment date
- category: mobility
- code: Specific mobility metric

### Search Examples
GET [base]/Observation?category=mobility&patient=[id]&date=[date]
GET [base]/Observation?code=walking-steadiness&patient=[id]

## Conformance

### Must Support
Elements marked with MS must be supported:
- status
- category
- code
- subject
- effectiveDateTime
- value[x]
- device
- component (for composite measurements)

## Implementation Considerations

### Data Processing
1. Collection
   - Raw sensor data from iPhone motion sensors
   - Processing algorithms for motion data
   - Noise filtering and signal processing
   - Sampling rates and data quality checks
   - Battery optimization considerations
   - Motion context detection

2. Analysis
   - Key metrics calculation (speed, steadiness, balance)
   - Trend detection and pattern recognition
   - Statistical analysis methods
   - Machine learning model integration
   - Real-time vs batch processing
   - Performance optimization strategies

3. Storage
   - Raw sensor data management
   - Processed metrics database
   - Historical trend storage
   - Data compression techniques
   - Backup and archival policies
   - Privacy considerations

### Data Quality Validations
1. Data Quality
   - Signal integrity verification
   - Temporal consistency checks
   - Anomaly detection algorithms
   - Sensor calibration validation
   - Environmental interference detection
   - Movement artifact filtering

2. Trend Analysis
   - Significant change detection
   - Deterioration pattern identification
   - Cross-metric correlations
   - Baseline comparison methods
   - Statistical significance testing
   - Confidence level calculations

### Alert System
1. Alert Levels
   - Normal (green)
     * Within baseline parameters
     * Regular movement patterns
     * Stable measurements
   - Caution (yellow)
     * Minor deviations from baseline
     * Subtle pattern changes
     * Early warning indicators
   - Alert (red)
     * Significant changes detected
     * Concerning patterns identified
     * Immediate attention required

2. Triggers
   - Sudden changes in measurements
   - Negative trend development
   - Abnormal pattern detection
   - Multiple metric correlation
   - Time-based thresholds
   - Context-aware alerting

### User Interface
1. Visualizations
   - Trend graphs and charts
   - Status indicators and dashboards
   - Baseline comparisons
   - Interactive data exploration
   - Custom view configurations
   - Accessibility considerations

2. Notifications
   - Real-time alerts and updates
   - Periodic summary reports
   - Contextual recommendations
   - Priority-based notifications
   - User preference settings
   - Do-not-disturb protocols

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path |
|------------------|-----------|
| Walking Steadiness | Observation.component[steadiness] |
| Walking Speed | Observation.component[speed] |
| Step Length | Observation.component[stepLength] |
| Double Support Time | Observation.component[supportTime] |
| Walking Asymmetry | Observation.component[asymmetry] |

### Integration Requirements
1. Health App Integration
   - HealthKit permissions
   - Data synchronization
   - Background processing
   - Battery optimization
   - Error handling
   - Version compatibility

2. Clinical Systems
   - FHIR compliance
   - API endpoints
   - Authentication
   - Data mapping
   - Error handling
   - Versioning strategy

### Security and Privacy
1. Data Protection
   - Encryption standards
   - Access control
   - Audit logging
   - Data anonymization
   - Consent management
   - Regulatory compliance

2. System Security
   - Authentication methods
   - Authorization protocols
   - Secure communication
   - Threat detection
   - Incident response
   - System monitoring

### Performance Optimization
1. Resource Management
   - Battery optimization
   - Network usage
   - Storage efficiency
   - Processing optimization
   - Memory management
   - Cache strategies

2. Scalability
   - Load balancing
   - Data partitioning
   - Service distribution
   - Query optimization
   - Batch processing
   - Real-time processing

## Testing and Validation
1. Test Cases
   - Unit tests
   - Integration tests
   - Performance tests
   - Security tests
   - User acceptance tests
   - Compliance validation

2. Quality Assurance
   - Code review
   - Documentation review
   - Performance monitoring
   - Security audits
   - Compliance checks
   - User feedback

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code |
|----------------|-----------|------------|
| Walking Steadiness | WalkingSteadinessObservation.valueQuantity | LA32-8 |
| Walking Speed | WalkingSpeedObservation.valueQuantity | LA29042-4 |
| Step Length | StepLengthObservation.valueQuantity | LA19752-7 |
| Double Support Time | DoubleSupportTimeObservation.valueQuantity | LA32-9 |
| Walking Asymmetry | WalkingAsymmetryObservation.valueQuantity | LA32-10 |

### Mapping Considerations
1. Temporality
   - Aggregation of continuous measurements
   - Analysis periods 
   - Update frequency
   - Data synchronization timing
   - Historical data handling
   - Real-time vs batch processing

2. Quality Assurance
   - Measurement reliability
   - Collection conditions
   - Cross-validation
   - Data consistency checks
   - Calibration verification
   - Error detection and handling

3. Context
   - Environmental conditions
   - User state and conditions
   - Related activity
   - Device positioning
   - Movement patterns
   - Activity intensity

4. Data Flow
   - Continuous monitoring
   - Batch processing
   - Event triggers
   - Alert handling
   - Data transformation
   - Error recovery

5. Integration Requirements
   - HealthKit permissions
   - Data synchronization
   - Background processing
   - Battery optimization
   - Error handling
   - Version compatibility


// ===== Conteúdo de: social_interaction.md =====

# Social Interaction Module

## Overview
This module describes how social interaction data from iOS devices is mapped to FHIR resources to support lifestyle medicine interventions focused on social wellbeing.

## Data Sources
- Location data
- Calendar events
- Communication patterns
- Activity context
- User reported data

## Types of Data Collected

### 1. Interaction Metrics
- Duration
- Frequency  
- Group size
- Interaction type
- Communication mode

### 2. Social Context
- Location type
- Activity setting
- Time of day
- Environmental factors
- Social purpose

### 3. Quality Assessment
- Engagement level
- Satisfaction rating
- Support received
- Connection strength
- Interaction impact

### 4. Support Network
- Relationship types
- Network size
- Contact frequency
- Support availability
- Social capital

## Implementation Considerations

### Data Collection
1. Privacy Protection
   - Data minimization
   - Location masking
   - Identity protection
   - Consent management
   
2. Context Capture
   - Location context
   - Activity context
   - Social setting
   - Environmental factors

### Analysis
1. Pattern Recognition
   - Interaction frequency
   - Social rhythms
   - Support patterns
   - Isolation risks

2. Quality Assessment
   - Interaction depth
   - Support effectiveness
   - Connection strength
   - Network resilience

## FHIR Resources

### Core Resources
- Observation: For interaction records
- Questionnaire: For social assessments  
- CarePlan: For social engagement plans
- Goal: For social wellbeing targets

### Profiles
- SocialInteractionProfile
- SocialSupportProfile
- SocialNetworkProfile

### Extensions
- SocialContext
- SocialSupport
- SocialQuality

### Value Sets
- InteractionTypeVS
- SocialContextVS
- SupportTypeVS
- QualityMetricsVS

## iOS Data to FHIR Mapping

### Core Fields
| iOS Data | FHIR Path | Description |
|----------|-----------|-------------|
| Duration | component[duration] | Interaction length |
| Type | component[type] | Interaction category |
| Quality | component[quality] | Interaction quality |
| Support | component[support] | Support received |

### Implementation Notes
1. Privacy Controls
   - Data anonymization
   - Access restrictions
   - Audit logging
   - Consent tracking

2. Integration Points
   - Calendar sync
   - Location services
   - Communication apps
   - Health data correlation

3. Clinical Uses
   - Social prescribing
   - Isolation prevention
   - Support coordination
   - Wellbeing monitoring



// ===== Conteúdo de: practitioner-identifiers.md =====

---
title: Practitioner Identifiers
---

# International Practitioner Identification

## Supported Identifier Systems

### United States
- **NPI (National Provider Identifier)**: `http://hl7.org/fhir/sid/us-npi`

### European Union
- **EUDAMED**: European database for medical devices practitioners
- National systems per member state

### Brazil  
- **CRM (Conselho Regional de Medicina)**: Medical council registration
- **CPF**: For general practitioner identification

## Usage Example

```json
{
  "identifier": [{
    "system": "http://hl7.org/fhir/sid/us-npi",
    "value": "1234567890"
  }]
}



// ===== Conteúdo de: README.md =====

# ig-template-base
package-id = fhir.base.template

Base IG template managed by HL7 but usable by anyone (no logos).  The foundation for most HL7-published IGs



// ===== Conteúdo de: README.md =====

# iOS Lifestyle Medicine HEADS2 FMUP

## Main Documentation
- [Quality Assurance Report](output/qa.html)
- [Implementation Guide Index](output/index.html)
- [Full Implementation Guide Package](output/full-ig.zip)

## Project Structure
The complete implementation guide and all related files can be found in the [output](output/) directory.

## Resource Navigation
For a complete list of all available resources and documentation, please visit the [output directory](output/).



// ===== Conteúdo de: LGPD_HIPAA_GDPR_text_markdown.md =====

# Políticas de Acesso a Dados de Saúde e Frameworks de Segurança para FHIR

**Os três principais frameworks regulatórios globais (GDPR, HIPAA e LGPD) exigem implementações técnicas específicas em sistemas FHIR para garantir compliance, com URLs canônicos oficiais, padrões de consentimento padronizados, e arquiteturas de segurança multinacionais já comprovadas em produção.** Organizações que operam internacionalmente podem agora referenciar regulamentações específicas usando códigos HL7 padronizados, implementar consent management através de Implementation Guides consolidados como IHE PCF, e adotar padrões técnicos que atendem simultaneamente múltiplas jurisdições através de frameworks como EHDS e SMART on FHIR.

## URLs oficiais e canônicos para sistemas FHIR

As três principais jurisdições oferecem **URLs oficiais específicos** que devem ser referenciados em implementações FHIR para garantir compliance legal e interoperabilidade técnica.

### Europa (GDPR)
- **URL Canônico Principal**: `https://eur-lex.europa.eu/eli/reg/2016/679/oj/eng` (Regulation EU 2016/679)
- **Versão Consolidada**: `https://eur-lex.europa.eu/legal-content/EN/AUTO/?uri=CELEX:02016R0679-20160504`
- **European Health Data Space (EHDS)**: `https://health.ec.europa.eu/ehealth-digital-health-and-care/european-health-data-space-regulation-ehds_en`
- **Autoridade Supervisora Europeia**: `https://www.edps.europa.eu/data-protection/our-work/subjects/health_en`

**Para referência em FHIR Consent:**
```json
{
  "regulatoryBasis": [{
    "coding": [{
      "system": "http://terminology.hl7.org/CodeSystem/consentpolicycodes",
      "code": "gdpr",
      "display": "GDPR Consent"
    }]
  }],
  "policyBasis": {
    "url": "https://eur-lex.europa.eu/eli/reg/2016/679/oj"
  }
}
```

### Estados Unidos (HIPAA)
- **URL Oficial HHS**: `https://www.hhs.gov/hipaa/index.html`
- **Privacy Rule**: `https://www.hhs.gov/hipaa/for-professionals/privacy/laws-regulations/index.html`
- **Security Rule**: `https://www.hhs.gov/hipaa/for-professionals/security/laws-regulations/index.html`
- **CFR References**: 45 CFR Parts 160 e 164

**Para referência em FHIR Consent:**
```json
{
  "regulatoryBasis": [{
    "coding": [{
      "system": "http://terminology.hl7.org/CodeSystem/consentpolicycodes",
      "code": "hipaa-auth",
      "display": "HIPAA Authorization"
    }]
  }],
  "policyBasis": {
    "url": "https://www.hhs.gov/hipaa/for-professionals/privacy/laws-regulations/"
  }
}
```

### Brasil (LGPD)
- **URL Oficial**: `http://www.planalto.gov.br/ccivil_03/_ato2015-2018/2018/lei/L13709compilado.htm`
- **ANPD**: `https://www.gov.br/anpd/pt-br/`
- **Assuntos Internacionais**: `https://www.gov.br/anpd/pt-br/assuntos/assuntos-internacionais/international-affairs`

**Para referência em FHIR Consent:**
```json
{
  "regulatoryBasis": [{
    "text": "Brazilian General Data Protection Law (LGPD)",
    "coding": [{
      "system": "http://terminology.hl7.org/CodeSystem/consentpolicycodes",
      "code": "lgpd",
      "display": "LGPD Consent"
    }]
  }],
  "policyBasis": {
    "url": "http://www.planalto.gov.br/ccivil_03/_ato2015-2018/2018/lei/l13709.htm"
  }
}
```

## URLs válidos do HL7 para consent policies internacionais

O HL7 estabeleceu **CodeSystems oficiais** para referenciar políticas de consentimento internacionais, centralizados no serviço de terminologia oficial.

### Terminologia Oficial HL7
- **Base URL**: `https://terminology.hl7.org/`
- **FHIR R4 Version**: `https://terminology.hl7.org/5.1.0/`
- **FHIR R5 Version**: `https://terminology.hl7.org/6.5.0/`

### CodeSystems Fundamentais para Consent
```
http://terminology.hl7.org/CodeSystem/consentcategorycodes
http://terminology.hl7.org/CodeSystem/consentscope
http://terminology.hl7.org/CodeSystem/consentaction  
http://terminology.hl7.org/CodeSystem/consentpolicycodes
```

### Value Sets Oficiais
```
http://hl7.org/fhir/ValueSet/consent-category
http://hl7.org/fhir/ValueSet/consent-scope
http://hl7.org/fhir/ValueSet/consent-action
http://terminology.hl7.org/ValueSet/consent-policy
```

**Códigos Específicos para Políticas Internacionais:**
- `hipaa-auth`: HIPAA Authorization
- `hipaa-npp`: HIPAA Notice of Privacy Practices
- `gdpr`: GDPR Consent Directive
- `nl-lsp`: Netherlands LSP Permission
- `at-elga`: Austria ELGA Opt-in Consent
- `ch-epr`: Switzerland EPR Consent

## Melhores práticas para consent e privacy policies

Três **padrões técnicos comprovados** emergiram como melhores práticas para implementar consent management em sistemas de saúde multinacionais, cada um com diferentes níveis de maturidade e aplicabilidade.

### Padrão IHE Privacy Consent on FHIR (PCF)
**Status**: Produção (v1.1.0)  
**URL**: `https://profiles.ihe.net/ITI/PCF/volume-1.html`

**Características técnicas:**
- **Três Níveis de Maturidade**: Basic (consent simples), Intermediate (scoping de dados), Advanced (segmentação de dados sensíveis)
- **Múltiplas Políticas**: Suporta "múltiplas regulamentações e políticas de consentimento diferentes" através de PolicyBasis único
- **Integração OAuth**: Construído sobre IUA com extensões para tokens conscientes de consentimento
- **Auditoria Obrigatória**: Integração BALP para atividades sensíveis à privacidade

### Arquitetura SMART on FHIR Security
**URL**: `https://docs.smarthealthit.org/authorization/best-practices/`

**Implementação técnica:**
- **Segurança de Transporte**: TLS 1.2+ obrigatório
- **Modelos de Grant OAuth**: Authorization Code (preferido) e Client Credentials para B2B
- **Segurança de Token**: Tokens de acesso de curta duração (1 hora recomendado)
- **Proteção CSRF**: Parâmetros state imprevisíveis com 128+ bits de entropia

### European Health Data Space (EHDS)
**Status**: Operacional março 2029  
**URL**: `https://health.ec.europa.eu/ehealth-digital-health-and-care/european-health-data-space-regulation-ehds_en`

**Framework multinacional:**
- **Cobertura**: 27 estados-membros da UE com framework unificado
- **Compliance Dupla**: Opera sob GDPR e leis nacionais de saúde
- **Infraestrutura Cross-Border**: MyHealth@EU para uso primário, HealthData@EU para uso secundário
- **Controle do Paciente**: Cidadãos podem "restringir acesso de profissionais de saúde a todos ou partes dos seus dados eletrônicos de saúde pessoais"

## Como referenciar políticas em recursos FHIR Consent

O **FHIR R5 introduziu elementos específicos** para referenciar múltiplas jurisdições regulatórias simultaneamente, oferecendo maior granularidade e rastreabilidade compliance.

### Estrutura FHIR R5 Consent Resource
```json
{
  "resourceType": "Consent",
  "status": "active",
  "category": [{
    "coding": [{
      "system": "http://terminology.hl7.org/CodeSystem/consentcategorycodes",
      "code": "59284-0"
    }]
  }],
  "subject": {
    "reference": "Patient/example"
  },
  "regulatoryBasis": [
    {
      "coding": [{
        "system": "http://terminology.hl7.org/CodeSystem/consentpolicycodes",
        "code": "gdpr"
      }]
    },
    {
      "coding": [{
        "system": "http://terminology.hl7.org/CodeSystem/consentpolicycodes", 
        "code": "hipaa-auth"
      }]
    }
  ],
  "policyBasis": {
    "reference": {
      "reference": "Contract/multi-jurisdiction-policy"
    }
  },
  "decision": "permit"
}
```

### Principais mudanças do R4 para R5
- **regulatoryBasis**: Novo elemento para referenciar frameworks regulatórios
- **policyBasis**: Estrutura aprimorada para referências de políticas
- **decision**: Substitui policyRule para decisão base

### Padrão de Conflito Multi-jurisdicional
```json
{
  "provision": [{
    "type": "permit",
    "actor": [{
      "role": {
        "coding": [{
          "system": "http://terminology.hl7.org/CodeSystem/v3-RoleCode",
          "code": "TREAT"
        }]
      }
    }],
    "purpose": [{
      "system": "http://terminology.hl7.org/CodeSystem/v3-ActReason",
      "code": "TREAT"
    }],
    "securityLabel": [{
      "system": "http://terminology.hl7.org/CodeSystem/v3-Confidentiality",
      "code": "N"
    }]
  }]
}
```

## Implementation Guides para múltiplas jurisdições

Três **Implementation Guides estabelecidos** oferecem padrões técnicos para gerenciamento de consentimento multi-jurisdicional, com diferentes níveis de maturidade e focos de aplicação.

### IHE Privacy Consent on FHIR (PCF) v1.1.0
**Status**: Pronto para produção  
**URL**: `https://profiles.ihe.net/ITI/PCF/`

**Características multi-jurisdicionais:**
- **Suporte a Múltiplas Políticas**: Através de PolicyBasis único que "resolve e reconcilia várias políticas"
- **Adaptabilidade Jurisdicional**: Suporta "regras jurisdicionais apoiadas por leis"
- **Rastreamento de Base Regulatória**: Usa elemento RegulatoryBasis para rastrear regulamentações específicas
- **Atores Técnicos**: Consent Recorder, Registry, Authorization Server, Enforcement Point

### HL7 FAST Scalable Consent Management v0.1.0
**Status**: Em desenvolvimento  
**URL**: `https://build.fhir.org/ig/HL7/fhir-consent-management/`

**Recursos cross-organizacionais:**
- **Consent Cross-Repository**: Projetado para "lidar com casos de uso através de conjunto de repositórios de gerenciamento de consentimento de forma escalável"
- **Suporte Multi-Organizacional**: Responde "é possível determinar se pagador/provedor X tem autoridade para visualizar dados de saúde Y sobre paciente Z?"
- **Operações FHIR Customizadas**: Define operações especializadas para workflows de cerimônia e gerenciamento de consentimento

### International Patient Summary (IPS)
**Status**: Padrão global ISO/EN  
**URL**: `https://build.fhir.org/ig/HL7/fhir-ips/`

**Recursos multi-jurisdicionais:**
- **Padrão ISO**: ISO 27269 fornece framework de interoperabilidade global
- **Considerações de Privacidade**: Suporte integrado para redação de "dados de saúde altamente sensíveis"
- **Integração de Consentimento**: Referencia IHE PCF para gerenciamento de consentimento
- **Implementação Global**: Usado por Epic, MEDITECH, CommonHealth, Google e outros

### European Health Data Space Implementation
**Status**: Framework multinacional operacional  
**Cobertura**: 27 países UE + infraestrutura cross-border

**Padrões técnicos:**
- **Integração FHIR**: Mandatório como padrão de interoperabilidade principal
- **Gerenciamento de Consentimento**: Mecanismos integrados para uso primário e secundário
- **Autoridades Digitais de Saúde**: Cada estado-membro deve designar autoridades para coordenação cross-border

## Estrutura de NamingSystem para practitioners internacionais

O **HL7 estabeleceu padrões específicos** para identificadores de practitioners que suportam contextos internacionais, incluindo elementos de jurisdição e tipos de identificadores padronizados.

### NamingSystem Resource Base
**URL Oficial**: `http://hl7.org/fhir/namingsystem.html`

### Exemplo US National Provider Identifier
```json
{
  "resourceType": "NamingSystem",
  "url": "http://terminology.hl7.org/NamingSystem/npi",
  "name": "NationalProviderIdentifier", 
  "title": "US National Provider Identifier",
  "status": "active",
  "kind": "identifier",
  "type": {
    "coding": [{
      "system": "http://terminology.hl7.org/CodeSystem/v2-0203",
      "code": "NPI",
      "display": "National Provider Identifier"
    }]
  },
  "uniqueId": [{
    "type": "uri",
    "value": "http://hl7.org/fhir/sid/us-npi",
    "preferred": true
  }]
}
```

### Padrão Internacional com Jurisdição
```json
{
  "resourceType": "NamingSystem",
  "name": "InternationalPractitionerID",
  "type": {
    "coding": [{
      "system": "http://terminology.hl7.org/CodeSystem/v2-0203", 
      "code": "PRN",
      "display": "Provider Number"
    }]
  },
  "jurisdiction": [{
    "coding": [{
      "system": "urn:iso:std:iso:3166",
      "code": "BE",
      "display": "Belgium"
    }]
  }]
}
```

### Exemplos de Implementação por País
**Belgian SSIN:**
```json
{
  "system": "https://www.ehealth.fgov.be/standards/fhir/core/NamingSystem/ssin",
  "value": "79121137740"
}
```

**Netherlands UZI:**
```json
{
  "system": "http://fhir.nl/fhir/NamingSystem/uzi-nr",
  "value": "12345678901"
}
```

## Conclusão

**A implementação de políticas de acesso a dados de saúde em sistemas FHIR requer abordagem técnica multinível** que combina compliance regulatório, padrões técnicos internacionais, e arquiteturas de segurança robustas. Os frameworks GDPR, HIPAA e LGPD convergem em princípios fundamentais - consentimento informado, direitos do titular dos dados, e segurança técnica - mas diferem em implementação específica, penalidades, e requisitos técnicos.

**As organizações devem priorizar** o uso de URLs canônicos oficiais para referências regulatórias, implementar consent management através de Implementation Guides comprovados como IHE PCF, e adotar arquiteturas técnicas que suportam simultaneamente múltiplas jurisdições. **A evolução para FHIR R5** oferece elementos específicos como regulatoryBasis e policyBasis que simplificam significativamente o compliance multi-jurisdicional, enquanto frameworks emergentes como EHDS demonstram viabilidade técnica de sistemas de saúde digitais verdadeiramente internacionais.

**Para implementações futuras**, organizações devem considerar padrões de segurança layered (TLS, OAuth, RBAC/ABAC, encryption), tecnologias privacy-preserving (differential privacy, homomorphic encryption), e governance frameworks que incluem DPOs, DPIAs regulares, e procedimentos de resposta a incidentes que atendem simultaneamente todos os frameworks regulatórios aplicáveis.

## Referências

### Legislação e Regulamentação

1. **GDPR - General Data Protection Regulation (Europa)**
   - Texto oficial: [https://eur-lex.europa.eu/eli/reg/2016/679/oj/eng](https://eur-lex.europa.eu/eli/reg/2016/679/oj/eng)
   - European Health Data Space (EHDS): [https://health.ec.europa.eu/ehealth-digital-health-and-care/european-health-data-space-regulation-ehds_en](https://health.ec.europa.eu/ehealth-digital-health-and-care/european-health-data-space-regulation-ehds_en)
   - European Data Protection Supervisor - Health: [https://www.edps.europa.eu/data-protection/our-work/subjects/health_en](https://www.edps.europa.eu/data-protection/our-work/subjects/health_en)

2. **HIPAA - Health Insurance Portability and Accountability Act (Estados Unidos)**
   - Portal oficial HHS: [https://www.hhs.gov/hipaa/index.html](https://www.hhs.gov/hipaa/index.html)
   - Privacy Rule: [https://www.hhs.gov/hipaa/for-professionals/privacy/laws-regulations/index.html](https://www.hhs.gov/hipaa/for-professionals/privacy/laws-regulations/index.html)
   - Security Rule: [https://www.hhs.gov/hipaa/for-professionals/security/laws-regulations/index.html](https://www.hhs.gov/hipaa/for-professionals/security/laws-regulations/index.html)

3. **LGPD - Lei Geral de Proteção de Dados (Brasil)**
   - Lei 13.709/2018 compilada: [http://www.planalto.gov.br/ccivil_03/_ato2015-2018/2018/lei/L13709compilado.htm](http://www.planalto.gov.br/ccivil_03/_ato2015-2018/2018/lei/L13709compilado.htm)
   - ANPD - Autoridade Nacional de Proteção de Dados: [https://www.gov.br/anpd/pt-br/](https://www.gov.br/anpd/pt-br/)

### Especificações FHIR e HL7

4. **FHIR Core Specifications**
   - FHIR R5 Consent Resource: [http://hl7.org/fhir/consent.html](http://hl7.org/fhir/consent.html)
   - FHIR R4 Consent Resource: [https://hl7.org/fhir/R4/consent.html](https://hl7.org/fhir/R4/consent.html)
   - FHIR Security: [https://www.hl7.org/fhir/security.html](https://www.hl7.org/fhir/security.html)
   - FHIR NamingSystem: [http://hl7.org/fhir/namingsystem.html](http://hl7.org/fhir/namingsystem.html)

5. **HL7 Terminology Services**
   - Base de Terminologia HL7: [https://terminology.hl7.org/](https://terminology.hl7.org/)
   - Consent Scope Codes: [https://terminology.hl7.org/CodeSystem-consentscope.html](https://terminology.hl7.org/CodeSystem-consentscope.html)
   - Consent PolicyRule Codes: [https://terminology.hl7.org/ValueSet-consent-policy.html](https://terminology.hl7.org/ValueSet-consent-policy.html)

### Implementation Guides

6. **IHE Privacy Consent on FHIR (PCF)**
   - Especificação principal v1.1.0: [https://profiles.ihe.net/ITI/PCF/volume-1.html](https://profiles.ihe.net/ITI/PCF/volume-1.html)
   - Repositório GitHub: [https://github.com/IHE/ITI.PCF](https://github.com/IHE/ITI.PCF)
   - Advanced Consent Definitions: [https://profiles.ihe.net/ITI/PCF/StructureDefinition-IHE.PCF.consentAdvanced-definitions.html](https://profiles.ihe.net/ITI/PCF/StructureDefinition-IHE.PCF.consentAdvanced-definitions.html)

7. **HL7 Scalable Consent Management**
   - IG v0.1.0: [https://build.fhir.org/ig/HL7/fhir-consent-management/](https://build.fhir.org/ig/HL7/fhir-consent-management/)

8. **International Patient Summary (IPS)**
   - IG v2.0.0: [https://build.fhir.org/ig/HL7/fhir-ips/](https://build.fhir.org/ig/HL7/fhir-ips/)
   - Privacy and Security Considerations: [https://build.fhir.org/ig/HL7/fhir-ips/Privacy-and-Security-Considerations.html](https://build.fhir.org/ig/HL7/fhir-ips/Privacy-and-Security-Considerations.html)

### Segurança e Autenticação

9. **SMART on FHIR**
   - Authorization Best Practices: [https://docs.smarthealthit.org/authorization/best-practices/](https://docs.smarthealthit.org/authorization/best-practices/)
   - Scopes and Launch Context: [http://www.hl7.org/fhir/smart-app-launch/scopes-and-launch-context/](http://www.hl7.org/fhir/smart-app-launch/scopes-and-launch-context/)

### Recursos Adicionais

10. **Análises Comparativas e Guias**
    - GDPR vs HIPAA Compliance: [https://www.onetrust.com/blog/hipaa-vs-gdpr-compliance/](https://www.onetrust.com/blog/hipaa-vs-gdpr-compliance/)
    - FHIR Security Best Practices: [https://kodjin.com/blog/fhir-security-best-practices/](https://kodjin.com/blog/fhir-security-best-practices/)
    - Cross-border Health Data Transfer Rules: [https://incountry.com/blog/cross-border-health-data-transfer-rules-around-the-world/](https://incountry.com/blog/cross-border-health-data-transfer-rules-around-the-world/)
    - Mental Health App Data Privacy (HIPAA-GDPR): [https://secureprivacy.ai/blog/mental-health-app-data-privacy-hipaa-gdpr-compliance](https://secureprivacy.ai/blog/mental-health-app-data-privacy-hipaa-gdpr-compliance)

11. **European Health Data Space Resources**
    - EHDS Overview - BC Platforms: [https://ehds.bcplatforms.com/overview-of-ehds/](https://ehds.bcplatforms.com/overview-of-ehds/)
    - The European Health Data Space: [https://www.european-health-data-space.com/](https://www.european-health-data-space.com/)

12. **Brasil - Recursos LGPD**
    - Brazil's Data Protection Authority Guidance: [https://www.hoganlovells.com/en/publications/brazils-data-protection-authority-releases-guidance-on-data-protection-officer-responsibilities-and-duties](https://www.hoganlovells.com/en/publications/brazils-data-protection-authority-releases-guidance-on-data-protection-officer-responsibilities-and-duties)
    - LGPD Compliance Guide: [https://www.cookiebot.com/en/lgpd/](https://www.cookiebot.com/en/lgpd/)
    - Data Protection for Health Insurance in Brazil: [https://www.ibanet.org/data-protection-health-insurance-brazil](https://www.ibanet.org/data-protection-health-insurance-brazil)


// ===== Conteúdo de: nutrition.md =====

# Nutrition

## General Description
This module describes how nutritional data collected from the iOS Health App and through questionnaires are mapped to FHIR resources. Nutritional data is essential for assessment and intervention in lifestyle medicine.

## Data Sources
Nutritional data is collected from:
- iOS Health App (automatic data)
- User-completed questionnaires 
- Integrated nutrition apps
- Manual records

## Types of Data Collected

### 1. Hydration
- Water intake volume
- Other non-caloric beverages
- Intake timestamps
- Record source

### 2. Energy
- Total calories consumed
- Distribution by meal
- Meal timestamps
- Energy balance

### 3. Macronutrients
- Carbohydrates (g)
- Proteins (g) 
- Fats (g)
  - Saturated
  - Unsaturated
  - Trans

### 4. Micronutrients
- Vitamins
- Minerals
- Electrolytes

### 5. Other
- Caffeine
- Fiber
- Alcohol

## FHIR Resources
The nutritional data is mapped to FHIR resources with specific profiles for each type of measurement:

### Observations
- Nutrition intake observations
- Hydration observations
- Energy/caloric intake
- Nutrient measurements

### Care Plans
- Nutrition care plans
- Dietary recommendations
- Supplementation plans

### Goals
- Nutritional goals
- Hydration targets
- Weight management goals

## Implementation Considerations

### Data Validation
- Physiological range validation
- Consistency checks
- Cross-validation between related measurements
- Unit standardization

### Privacy & Security  
- Data anonymization
- Access control
- Audit logging
- Consent management

## Questionnaire to Observation Mapping

### QuestionnaireResponse to Observation
| Questionnaire Item | FHIR Observation |
|-------------------|------------------|
| water_intake | WaterIntakeObservation |
| calories | CalorieIntakeObservation |
| macronutrients | MacronutrientsObservation |

### Transformation Rules
1. Each meal response generates:
   - A calorie observation
   - A macronutrients observation
  
2. Daily Aggregations:
   - Total calories
   - Total macronutrients
   - Total water
   - Total caffeine

3. Validations:
   - Sum of macronutrients in grams
   - Calorie calculation from macronutrients
   - Values within physiological ranges

### Implementation Notes
- Each QuestionnaireResponse is processed into multiple Observations
- Timestamps from meal records are preserved in Observations
- Aggregations are performed at the end of each day
- All measurements include source attribution

## Implementation Considerations

### Data Flow
1. Collection
   - Questionnaire completion
   - App integration
   - iOS Health App data

2. Processing
   - Data validation
   - Derived calculations
   - Aggregations

3. Storage
   - QuestionnaireResponse
   - Observations
   - History

### Validations
1. Raw Data
   - Valid ranges
   - Temporal consistency
   - Completeness

2. Calculations
   - Macronutrient balance
   - Caloric equivalence
   - Daily goals

### UX Considerations
1. Questionnaire Interface
   - Easy completion
   - Default values
   - Real-time validation

2. Feedback
   - Daily progress
   - Goal alerts
   - Suggestions

### Technical Aspects
1. Device Integration
   - HealthKit permissions
   - Data synchronization
   - Offline support

2. Performance
   - Batch processing
   - Query optimization
   - Data aggregation strategies

3. Security
   - Data encryption
   - Access control
   - Audit logging



// ===== Conteúdo de: sleep.md =====

# Sleep

## General Description
This module describes how sleep data collected from the iOS Health App is mapped to FHIR resources. Sleep monitoring is a critical component of lifestyle medicine, providing insights into sleep quality and quantity.

## Data Source
The iOS Health App collects sleep data from the following sources:
- Apple Watch
- Integrated third-party apps
- Manual records

## Types of Collected Data

### Key Metrics
1. Time in Bed
   - Start time
   - End time
   - Total duration

2. Sleep Time
   - Total time sleeping
   - Sleep efficiency (percentage of time in bed actually sleeping)

3. Sleep Stages
   - Deep Sleep
   - REM Sleep
   - Light Sleep
   - Awake Time

4. Physiological Data During Sleep
   - Respiratory rate
   - Heart rate variability
   - Average heart rate

5. Sleep Quality
   - Sleep interruptions
   - Time to fall asleep
   - Sleep consistency

## Collection Frequency
- Continuous data during sleep period
- Daily metrics aggregation
- Weekly trend analysis

## Supported Operations

### Search
- patient + date
- patient + date-range
- patient + category

### Search Parameters
- patient: Patient identifier
- date: Sleep record date
- category: Observation category (always "sleep")

### Search Examples
GET [base]/Observation?category=sleep&patient=[id]&date=[date]
GET [base]/Observation?category=sleep&patient=[id]&date=ge[start]&date=le[end]

## Conformance

### Must Support
Elements marked with MS must be supported:
- status
- category
- code
- subject
- effectiveDateTime/effectivePeriod
- component.timeInBed
- component.totalSleepTime
- component.deepSleep
- component.remSleep
- component.lightSleep
- component.respiratoryRate
- component.heartRateVariability
- component.interruptions

### Cardinality
- Time in bed and total sleep time are mandatory (1..1)
- Other components are optional (0..1)

### Validation
- Total sleep time must be less than or equal to time in bed
- The sum of sleep stages must equal the total sleep time

## iOS Health App to FHIR Mapping

### Main Fields
| iOS Health App | FHIR Path |
|----------------|-----------|
| Time in Bed | component[timeInBed].valueQuantity |
| Sleep Time | component[totalSleepTime].valueQuantity |
| Deep Sleep | component[deepSleep].valueQuantity |
| REM Sleep | component[remSleep].valueQuantity |
| Light Sleep | component[lightSleep].valueQuantity |
| Respiratory Rate | component[respiratoryRate].valueQuantity |
| HRV | component[heartRateVariability].valueQuantity |
| Interruptions | component[interruptions].valueQuantity |

### Implementation Considerations
1. Data Aggregation
   - Data is collected continuously during sleep
   - Nightly aggregation is done automatically
   - Metrics are calculated per night of sleep

2. Data Quality
   - Temporal overlap validation
   - Consistency check between metrics
   - Outlier detection

3. Privacy and Security
   - Sensitive data requiring protection
   - User consent required
   - Anonymization for research use



// ===== Conteúdo de: stress.md =====

# Stress Assessment Module

## Overview
This module describes how stress data collected from iOS Health App sensors and user inputs are mapped to FHIR resources for lifestyle medicine interventions.

## Data Sources
- Heart Rate Variability (HRV) from Apple Watch 
- Blood pressure patterns
- Activity patterns
- Self-reported stress levels
- Mindfulness session data
- Sleep quality metrics

## Types of Data Collected

### 1. Physiological Stress Metrics
- Heart rate variability analysis
- Blood pressure patterns  
- Respiratory rate changes
- Sleep disruption
- Physical activity impact

### 2. Psychological Stress Assessment
- Perceived stress levels
- Mood changes
- Anxiety indicators
- Cognitive impacts
- Behavioral changes

### 3. Stress Response Patterns
- Acute vs chronic stress
- Recovery efficiency
- Adaptation capacity
- Resilience metrics
- Coping mechanisms

### 4. Environmental Context
- Location/setting
- Time patterns
- Activity context
- Social factors
- Environmental triggers

## Implementation Considerations

### 1. Data Collection
- Continuous sensor monitoring
- Periodic assessments
- Event-triggered recording
- Context capture
- User input validation

### 2. Analysis Pipeline
- Real-time processing
- Pattern detection
- Trend analysis
- Risk assessment
- Alert generation

### 3. Clinical Integration 
- Care plan updates
- Provider notifications
- Decision support
- Progress tracking
- Outcome measurement

## FHIR Resources

### Core Resources
- Observation: For stress measurements
- Questionnaire: For stress assessments
- CarePlan: For stress management plans
- Goal: For stress reduction targets

### Profiles
- StressLevelProfile
- StressAssessmentProfile
- StressManagementProfile

### Extensions
- StressContext
- StressTriggers
- StressCoping

### Value Sets
- StressChronicityVS
- StressImpactVS
- StressTriggersVS
- StressCopingVS

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | Description |
|----------------|-----------|-------------|
| HRV | Observation.component[hrv] | Heart rate variability |
| Stress Level | Observation.valueQuantity | Perceived stress level |
| Context | Observation.component[context] | Environmental context |
| Response | Observation.component[response] | Stress response pattern |

### Mapping Considerations
1. Data Validation
   - Physiological ranges
   - Temporal consistency
   - Context validation
   - Pattern validation

2. Context Handling  
   - Location tracking
   - Activity correlation
   - Social context
   - Environmental factors

3. Clinical Context
   - Care plan integration
   - Provider communication
   - Alert management
   - Progress tracking



// ===== Conteúdo de: reproductive.md =====


## FHIR Resources

### Main Resources Used
- Observation: For cycle tracking and temperature measurements
- QuestionnaireResponse: For symptom reporting
- CarePlan: For fertility planning
- Goal: For reproductive health goals

### Parameters
- patient: Patient identifier
- date: Record date
- category: reproductive-health
- code: Specific measurement type

### Search Examples
GET [base]/Observation?category=reproductive-health&patient=[id]&date=[date]
GET [base]/Observation?code=menstrual-cycle&patient=[id]

## Conformance

### Must Support Elements
Elements marked with MS must be supported:
- status
- category
- code
- subject
- effectiveDateTime
- value[x]
- component (for composite measurements)

## Implementation Considerations

### Data Collection
1. Automated Measurements
   - Temperature tracking
   - Activity patterns
   - Sleep quality
   - Heart rate variability

2. Manual Records
   - Symptom logging
   - Cycle tracking
   - Fertility signs
   - Medication use

### Data Analysis
1. Pattern Recognition
   - Cycle regularity
   - Temperature trends
   - Symptom correlations
   - Fertility windows

2. Alert Generation
   - Cycle predictions
   - Fertile days
   - Temperature changes
   - Symptom patterns

### Clinical Integration
1. Reports
   - Cycle summaries
   - Fertility tracking
   - Symptom patterns
   - Treatment responses

2. Decision Support
   - Fertility planning
   - Cycle abnormalities
   - Risk identification
   - Treatment monitoring

### Privacy & Security
1. Data Protection
   - Encryption
   - Access control
   - Consent management
   - Data sharing

2. User Control
   - Data visibility
   - Sharing preferences
   - Export options
   - Deletion rights

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code |
|----------------|-----------|------------|
| Cycle Start | Observation.effectiveDateTime | 8665-2 |
| Cycle Length | Observation.valueQuantity | 8664-5 |
| Flow Duration | Observation.component[duration].valueQuantity | 49033-4 |
| Basal Temperature | Observation.valueQuantity | 8310-5 |
| Cervical Mucus | Observation.valueCodeableConcept | 8669-4 |

### Integration Requirements
1. HealthKit Access
   - Permissions setup
   - Data synchronization
   - Background updates
   - Error handling

2. Data Validation
   - Range checks
   - Pattern validation
   - Temporal consistency
   - Cross-reference verification

### Performance Considerations
1. Data Processing
   - Real-time updates
   - Batch processing
   - Historical data
   - Trend analysis

2. Resource Optimization
   - Battery usage
   - Storage efficiency
   - Network usage
   - Processing load

### User Interface Guidelines
1. Data Entry
   - Quick input methods
   - Template options
   - Reminder settings
   - Validation feedback

2. Visualization
   - Cycle calendar
   - Temperature charts
   - Symptom tracking
   - Fertility windows

3. Notifications
   - Cycle predictions
   - Fertile days
   - Temperature alerts
   - Medication reminders


## Detailed Implementation Considerations

### Data Management
1. Storage Strategy
   - Real-time data storage
   - Historical data archival
   - Data compression techniques
   - Backup procedures
   - Recovery mechanisms
   - Version control

2. Data Quality
   - Input validation rules
   - Data completeness checks
   - Cross-validation methods
   - Anomaly detection
   - Error correction procedures
   - Quality metrics

### Clinical Integration Details
1. Provider Integration
   - Clinical portal access
   - Data export formats
   - Integration APIs
   - Real-time notifications
   - Emergency alerts
   - Audit trails

2. Decision Support
   - Clinical guidelines integration
   - Risk assessment algorithms
   - Treatment recommendations
   - Follow-up protocols
   - Alert thresholds
   - Intervention triggers

### Advanced Analytics
1. Pattern Recognition
   - Cycle irregularity detection
   - Symptom correlation analysis
   - Fertility window prediction
   - Risk factor identification
   - Trend analysis
   - Outcome prediction

2. Machine Learning Integration
   - Prediction models
   - Pattern classification
   - Anomaly detection
   - Personalization
   - Model training
   - Performance monitoring

### System Integration
1. External Systems
   - EHR integration
   - Laboratory systems
   - Pharmacy systems
   - Insurance systems
   - Research databases
   - Public health reporting

2. Data Exchange
   - HL7 FHIR APIs
   - Standard terminologies
   - Data mapping
   - Transform rules
   - Validation checks
   - Error handling

### Performance Optimization
1. Resource Management
   - CPU usage
   - Memory allocation
   - Storage optimization
   - Network bandwidth
   - Battery consumption
   - Cache strategy

2. Scalability
   - Load balancing
   - Database sharding
   - Service distribution
   - Queue management
   - Batch processing
   - Real-time processing

### User Experience
1. Accessibility
   - Screen reader support
   - Color contrast
   - Font sizing
   - Touch targets
   - Keyboard navigation
   - Voice input

2. Localization
   - Multiple languages
   - Cultural considerations
   - Date formats
   - Unit preferences
   - Terminology adaptation
   - Regional compliance

### Security Details
1. Authentication
   - Multi-factor authentication
   - Biometric options
   - Session management
   - Token handling
   - Password policies
   - Account recovery

2. Authorization
   - Role-based access
   - Attribute-based control
   - Dynamic permissions
   - Temporary access
   - Emergency access
   - Audit logging

3. Compliance
   - HIPAA requirements
   - GDPR compliance
   - Local regulations
   - Industry standards
   - Security frameworks
   - Privacy policies




// ===== Conteúdo de: vitalsigns.md =====

# Vital Signs

## General Description
This module describes how vital signs data collected from the iOS Health App are mapped to FHIR resources. Vital signs are fundamental physiological measurements that reflect essential body functions and health states.

## Data Source
The iOS Health App collects vital signs from the following sources:
- Apple Watch
- Bluetooth-connected medical devices
- Integrated third-party apps
- Manual records

## Types of Data Collected

### 1. Heart Rate
- Continuous measurement (Apple Watch)
- Resting heart rate
- Exercise heart rate
- Recovery heart rate
- Heart rate variability (HRV)
- Anomaly recording

### 2. Blood Pressure
- Systolic pressure
- Diastolic pressure
- Date and time of measurement
- Body position during measurement
- Device used

### 3. Oxygen Saturation (SpO2)
- Saturation percentage
- Trends over time
- Sleep measurements
- Activity measurements

### 4. Body Temperature
- Temperature in Celsius/Fahrenheit
- Measurement location
- Measurement method

### 5. Respiratory Rate
- Breaths per minute
- Resting measurements
- Sleep measurements
- Exercise measurements

### 6. ECG (Electrocardiogram)
- Trace recording
- Rhythm classification
- Beat interval
- Anomaly analysis

## Collection Frequency
- Heart Rate: Continuous (when using Apple Watch)
- Blood Pressure: Per measurement
- SpO2: Continuous or on-demand
- Temperature: Per measurement
- Respiratory Rate: Continuous during sleep/exercise
- ECG: On-demand/recording

## Operations Supported

### Search
- patient + date
- patient + code
- patient + category
- patient + code + date-range

### Search Parameters
- patient: Patient identifier
- date: Measurement date
- code: Vital sign type
- category: Category (vital-signs)

### Search Examples
GET [base]/Observation?category=vital-signs&patient=[id]&code=8867-4
GET [base]/Observation?category=vital-signs&patient=[id]&date=ge2024-03-19

## Conformance

### Must Support
Elements marked with MS must be supported:
- status
- category
- code
- subject
- effectiveDateTime
- valueQuantity
- component (when applicable)

### Cardinality
- Blood pressure requires systolic and diastolic components
- Other vital signs require at least one value

## iOS Health App to FHIR Mapping

### Main Fields
| iOS Health App | FHIR Path | LOINC Code |
|----------------|-----------|-------------|
| Heart Rate | valueQuantity | 8867-4 |
| HRV | component[heartRateVariability] | 80404-7 |
| Blood Pressure Systolic | component[systolic] | 8480-6 |
| Blood Pressure Diastolic | component[diastolic] | 8462-4 |
| SpO2 | valueQuantity | 2708-6 |
| Body Temperature | valueQuantity | 8310-5 |
| Respiratory Rate | valueQuantity | 9279-1 |

### Implementation Considerations

1. Source Prioritization
- Apple Watch has priority for continuous measurements
- Validated medical devices for specific measurements
- Manual entries as last resort

2. Data Validation
- Verification of values within physiological ranges
- Outlier detection
- Temporal consistency of measurements

3. Data Aggregation
- Continuous measurements aggregated in intervals
- Calculation of averages, minimums and maximums
- Trends over time

4. Accuracy and Reliability
- Indication of measurement source/device
- Measurement confidence level
- Device calibration and validation

5. Alert Management
- Definition of normal limits
- Notification of abnormal values
- Critical alert escalation

6. Storage and Retention
- Data retention policy
- Historical data compression
- Backup and recovery



// ===== Conteúdo de: physical_activity.md =====

# Physical Activity

## General Description
This module describes how physical activity data from the iOS Health App is mapped to FHIR resources.

## Data Source
The iOS Health App collects physical activity data in the following ways:
- iPhone sensors (step counter, GPS)
- Apple Watch (when available)
- Integrated third-party apps

## Types of Data Collected

### Steps
- Total step count
- Start and end timestamp
- Data source

### Distance
- Total distance covered
- Unit of measurement (meters/kilometers)
- Type of movement (walking/running)

### Workouts
- Type of exercise
- Duration
- Calories burned
- Distance (when applicable)
- Heart rate (when available)

### Energy
- Active calories
- Resting calories
- Total calories

## Collection Frequency
- Steps: Continuous when in motion
- Distance: Continuous during activity
- Workouts: Per session
- Energy: Daily calculation

## Supported Operations

### Search
- patient + date
- patient + activity-type
- patient + date + activity-type

### Search Parameters
- patient: Patient identifier
- date: Activity date
- activity-type: Type of physical activity

### Search Examples
GET [base]/Observation?category=activity&patient=[id]&date=[date]
GET [base]/Observation?category=activity&patient=[id]&code=[activity-type]
## Conformance

### Must Support
Elements marked with MS must be supported by the implementing system:
- status
- category
- code
- subject
- effectiveDateTime
- component.steps
- component.distance
- component.duration
- component.energy



// ===== Conteúdo de: mindfulness.md =====

# Mindfulness and Mental Health

## General Description 
This module describes how mindfulness practice and mental health data collected from the iOS Health App and through questionnaires are mapped to FHIR resources. This data is fundamental for assessing stress management and emotional wellbeing.

## Data Sources
Data is collected from:
- iOS Health App (automatic data)
- Apple Watch (breathing and mindfulness sessions) 
- Self-assessment questionnaires
- Integrated meditation apps
- Manual records

## Types of Data Collected

### 1. Mindfulness Practices
- Session duration
- Type of practice
- Session frequency 
- Practice timing

### 2. Mood State
- Current mood
- Daily variations
- Influencing factors
- Intensity

### 3. Stress Levels
- Perceived stress level
- Physical symptoms
- Identified triggers
- Management strategies

### 4. Relaxation
- Time dedicated
- Techniques used
- Perceived effectiveness
- Regularity

## Collection Frequency
- Mindfulness: Per session
- Mood: Multiple times per day
- Stress: Daily
- Relaxation: Per session

## FHIR Resources
Mindfulness and mental health data is mapped to FHIR resources with specific profiles for each type of measurement:

### Observations
- Mindfulness session observations
- Mood assessments 
- Stress level measurements
- Relaxation practice records

### Questionnaires 
- Mental health screenings
- Stress assessments
- Mood tracking
- Practice logs

### Goals
- Practice frequency targets
- Stress reduction goals
- Emotional wellbeing objectives

## Implementation Considerations

### Data Privacy 
- Enhanced security measures
- Patient consent management
- Access control
- Data anonymization

### Data Integration
- HealthKit integration
- Third-party app connectivity
- Multi-device synchronization
- Data consolidation
## Implementation Considerations

### Data Flow
1. Collection
   - Questionnaire completion
   - Apple Watch data
   - Meditation apps integration

2. Processing
   - Data validation
   - Trend analysis
   - Correlations with other indicators

3. Storage
   - QuestionnaireResponse
   - Observations
   - History and trends

### Validations
1. Input Data
   - Valid ranges for scales
   - Temporal consistency
   - Correlation between measurements

2. Analysis
   - Mood patterns
   - Practice effectiveness
   - Stress triggers

### UX Considerations
1. Questionnaire Interface
   - Simple completion
   - Immediate visual feedback
   - Multi-language support

2. Feedback
   - Trend visualization
   - Personalized recommendations
   - Adaptive reminders

### Integration Requirements
1. HealthKit Integration
   - Mindfulness minutes
   - Heart rate variability
   - Sleep data correlation

2. Third-party Apps
   - API requirements
   - Data synchronization
   - Privacy considerations



// ===== Conteúdo de: bodymetrics.md =====

# Body Measurements

## Overview
This module describes how anthropometric and body composition data collected from the iOS Health App are mapped to FHIR resources. These measurements are fundamental for assessing nutritional status and monitoring lifestyle medicine interventions.

## Data Sources
The iOS Health App collects body measurements from the following sources:
- Connected smart scales
- Bioimpedance devices 
- Manual measurements
- Integrated third-party apps

## Types of Collected Data

### 1. Basic Measurements
- Body weight
- Height
- BMI (automatically calculated)
- Waist circumference

### 2. Body Composition
- Body fat percentage
- Lean mass
- Body water
- Muscle mass 
- Bone mass

### 3. Segmental Analysis
- Body fat distribution
- Muscle mass distribution
- Body symmetry

### 4. Trends and Analysis
- Weight variation
- BMI history
- Body composition progression
- Goals and objectives

## Collection Frequency
- Weight: Recommended daily
- Height: Periodically 
- Body composition: Weekly
- Circumference: Monthly

## FHIR Resources
The body measurements are mapped to FHIR Observation resources with specific profiles for each type of measurement.

### Examples
- Weight measurements use the [body-weight](StructureDefinition-body-weight.html) profile
- Height uses the [body-height](StructureDefinition-body-height.html) profile
- BMI calculations use the [bmi](StructureDefinition-bmi.html) profile

## Supported Operations

### Search
- patient + date
- patient + code
- patient + date-range + code
- patient + category

### Search Parameters
- patient: Patient identifier
- date: Measurement date
- code: Type of body measurement
- category: Category (vital-signs)

### Search Examples
GET [base]/Observation?category=vital-signs&patient=[id]&code=29463-7
GET [base]/Observation?category=vital-signs&patient=[id]&date=ge2024-03-19
GET [base]/Observation?category=vital-signs&patient=[id]&code=88365-2&date=ge2024-01-01&date=le2024-12-31
Copy
## Conformance

### Must Support
Elements marked with MS must be supported:
- status: Measurement status
- category: Vital signs category
- code: Type of measurement (LOINC code)
- subject: Reference to patient
- effectiveDateTime: When measurement was taken
- valueQuantity: The measurement value and unit
- component: Body composition components (for composition measurements)

### Device Support
The following device types are supported for data capture:
- Smart scales
- Bioimpedance analyzers
- Manual entry
- Third-party apps via HealthKit

### Security Requirements
- Patient access control
- Device authentication
- Data validation rules

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code | Description |
|----------------|-----------|-------------|-------------|
| Weight | WeightObservation.valueQuantity | 29463-7 | Body weight measurement |
| Height | HeightObservation.valueQuantity | 8302-2 | Body height measurement |
| BMI | BMIObservation.valueQuantity | 39156-5 | Body Mass Index calculation |
| Body Fat % | BodyCompositionObservation.component[bodyFat] | 41982-0 | Percentage of body fat |
| Lean Mass | BodyCompositionObservation.component[leanMass] | 291-7 | Lean body mass |
| Body Water | BodyCompositionObservation.component[bodyWater] | 73708-0 | Total body water |
| Muscle Mass | BodyCompositionObservation.component[muscleMass] | 73713-0 | Skeletal muscle mass |
| Bone Mass | BodyCompositionObservation.component[boneMass] | 73711-4 | Bone mass measurement |

### Implementation Considerations

1. Data Validation
- Physiological range validation
- Sudden variation detection
- Cross-validation between related measurements
- Unit conversion and standardization

2. Automatic Calculations
- BMI calculation from weight and height
- Cross-validation of composition measurements
- Percentage changes and trends
- Statistical analysis of measurements

3. Frequency and Timing
- Measurement frequency recommendations
- Preferred measurement timing
- Minimum intervals between measurements
- Time zone handling for measurements

4. Data Quality
- Measurement source (device/manual)
- Device calibration status
- Measurement conditions
- Data completeness checks

5. Goal Integration
- Goal setting and tracking
- Progress monitoring
- Significant deviation alerts
- Personalized target ranges

6. Reports and Visualizations
- Trend charts and graphs
- Reference comparisons
- Body composition analysis
- Progress reports and summaries

### Device Integration

1. Smart Scale Integration
- Bluetooth connectivity
- Data synchronization
- Error handling
- Battery status monitoring

2. Bioimpedance Analysis
- Device calibration requirements
- Measurement protocol
- Environmental conditions
- Quality control checks

3. Manual Entry
- Data validation rules
- Required fields
- Unit conversion support
- Entry confirmation

### Error Handling

1. Device Errors
- Connection failures
- Calibration errors
- Battery warnings
- Invalid measurements

2. Data Validation Errors
- Out of range values
- Inconsistent measurements
- Missing required data
- Invalid units

3. Synchronization Errors
- Network connectivity issues
- Data transfer failures
- Version conflicts
- Retry mechanisms




// ===== Conteúdo de: index.md =====

# iOS Health App Lifestyle Medicine Implementation Guide

## Purpose
This FHIR implementation guide defines how to extract and represent health and lifestyle data from the iOS Health App to support lifestyle medicine interventions.

## Scope
The implementation guide covers the following data domains from iOS Health App:

### Vital Signs
- Basic vital signs (heart rate, blood pressure, temperature, etc.)
- Advanced physiological metrics (HRV, respiratory patterns, etc.)
- Physiological stress biomarkers
- Thermoregulation metrics

### Physical Activity
- Steps and distance
- Workouts and exercise
- Energy expenditure
- Activity patterns
- Movement analysis

### Sleep
- Sleep duration and stages
- Sleep quality metrics
- Breathing during sleep
- Heart rate during sleep
- Sleep consistency

### Mindfulness & Mental Health
- Mindfulness sessions
- Stress levels
- Mood tracking
- Relaxation practices
- Mental well-being metrics

### Body Measurements
- Weight and height
- BMI calculations
- Body composition
- Anthropometric measurements

### Nutrition
- Food and water intake
- Macronutrients tracking
- Energy balance
- Meal patterns

### Environmental Factors
- Noise exposure
- UV exposure
- Environmental context
- Exposure patterns

### Reproductive Health
- Cycle tracking
- Fertility signs
- Symptoms tracking
- Health patterns

### Social & Behavioral
- Social interactions
- Support networks
- Behavioral patterns
- Activity context

## Use Cases
1. Automated health data collection and monitoring
2. Lifestyle pattern assessment and analysis
3. Intervention planning and tracking
4. Progress monitoring and outcomes assessment
5. Patient engagement and self-management
6. Clinical decision support
7. Research and population health

## Audience
- Healthcare software developers
- Healthcare professionals and providers
- Digital health platform developers
- Health researchers
- Lifestyle medicine specialists
- Health informaticians
- Digital health innovators

## Technical Framework
Built on FHIR R4 (4.0.1) with:
- Custom profiles for iOS Health data
- Extensions for contextual information
- Terminologies for standardized coding
- Search parameters for data access
- Operations for data processing
- Examples for implementation guidance

## Implementation Notes
- Integration with HealthKit API
- Privacy and security considerations
- Data validation requirements
- Interoperability guidelines
- Best practices for implementation



// ===== Conteúdo de: advanced_vitalsigns.md =====

# Advanced Vital Signs Data

## Overview
This module defines how advanced vital signs data collected from the iOS Health App are mapped to FHIR resources. These data provide a deeper insight into individual physiology and homeostasis, complementing basic vital signs.

## Data Sources
- Apple Watch (advanced sensors)
- Connected medical devices
- Integrated biomedical sensors
- Specialized health apps

## Types of Collected Data

### 1. Advanced Cardiovascular Metrics
- Detailed Heart Rate Variability
  - HRV spectral analysis
  - Low/high frequency indicators
  - HRV entropy measurements
  - Time-domain metrics
  - Frequency-domain parameters
- Cardiac Recovery Indices
  - Post-exercise recovery rate
  - Time to normalization
  - Recovery pattern analysis
  - Heart rate reserve
- Advanced Blood Pressure
  - Mean arterial pressure
  - Pulse pressure
  - Blood pressure variability
  - Circadian pattern tracking
  - Pressure waveform analysis

### 2. Advanced Respiratory Metrics
- Respiratory Patterns
  - Respiratory variability
  - Estimated respiratory volume
  - Ventilation/perfusion ratio
  - Breathing pattern analysis
  - Respiratory rate variability
- Advanced Oxygen Saturation
  - Nocturnal trends
  - Exercise desaturation
  - Hypoxia index
  - Recovery patterns
  - Continuous monitoring

### 3. Physiological Stress Biomarkers
- Physiological stress index
- Allostatic load measurement
- Autonomic recovery tracking
- Sympathetic-vagal balance
- Stress response patterns
- Recovery efficiency metrics
- Chronic stress indicators

### 4. Thermoregulation Metrics
- Circadian temperature variation
- Temperature gradients
- Exercise thermal response
- Heat dissipation patterns
- Core temperature estimation
- Skin temperature mapping
- Environmental adaptation

### 5. Multiparametric Integration
- Composite health indices
- Parameter correlations
- Trend prediction models
- Abnormal pattern detection
- Risk stratification
- Personalized baselines
- Adaptive thresholds

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code | Description |
|----------------|-----------|------------|-------------|
| Heart Rate Variability | HRVObservation.component[hrv] | 80404-7 | R-R interval standard deviation |
| Respiratory Rate | RespiratoryObservation.component[rate] | 9279-1 | Respiratory rate |
| Blood Pressure | BPObservation.component[systolic/diastolic] | 85354-9 | Blood pressure panel with all children |
| Temperature | TempObservation.component[core] | 8310-5 | Body temperature |
| Oxygen Saturation | SpO2Observation.component[saturation] | 59408-5 | Oxygen saturation in blood |

### Advanced Measurements
| iOS Health App | FHIR Path | LOINC Code | Description |
|----------------|-----------|------------|-------------|
| HRV Analysis | HRVObservation.component[spectral] | 80405-4 | Heart rate variability metrics |
| Recovery Rate | RecoveryObservation.component[rate] | 80406-2 | Cardiac recovery rate |
| Stress Index | StressObservation.component[index] | 80407-0 | Physiological stress index |
| Temperature Variation | TempObservation.component[variation] | 80408-8 | Temperature pattern |

## Implementation Requirements

### 1. Data Collection
- Sensor accuracy
- Sampling frequency
- Calibration protocols
- Quality assurance
- Data validation

### 2. Processing Pipeline
- Signal processing
- Noise reduction
- Feature extraction
- Pattern analysis
- Real-time processing

### 3. Integration Aspects
- Data synchronization
- Device compatibility
- API requirements
- Security protocols
- Privacy compliance

### 4. Clinical Validation
- Accuracy verification
- Clinical correlation
- Reference standards
- Validation studies
- Performance metrics

## Technical Implementation

### Data Processing Pipeline
1. Data Collection
   - Sensor data acquisition
   - Quality checks
   - Initial validation
   - Raw data storage

2. Signal Processing
   - Noise reduction
   - Artifact removal
   - Signal enhancement
   - Feature extraction

3. Analysis Pipeline
   - Pattern detection
   - Trend analysis
   - Statistical processing
   - Composite index calculation

4. Clinical Integration
   - Risk assessment
   - Alert generation
   - Clinical correlation
   - Decision support

### Data Quality Management
1. Validation Rules
   - Range checking
   - Consistency verification
   - Cross-validation
   - Temporal validation

2. Quality Metrics
   - Signal quality
   - Data completeness
   - Measurement accuracy
   - Sensor reliability

3. Error Handling
   - Data gaps
   - Sensor failures
   - Connection issues
   - Processing errors

### Integration Requirements
1. Device Integration
   - Sensor compatibility
   - Data protocols
   - Synchronization
   - Calibration

2. System Integration
   - API requirements
   - Data formats
   - Security protocols
   - Performance standards

3. Clinical Systems
   - EHR integration
   - Alert systems
   - Decision support
   - Documentation

## Clinical Applications

### 1. Preventive Medicine
- Early warning systems
- Risk assessment
- Trend analysis
- Intervention timing
- Prevention strategies

### 2. Performance Monitoring
- Athletic performance
- Recovery optimization
- Training adaptation
- Fatigue detection
- Overtraining prevention

### 3. Clinical Decision Support
- Pattern recognition
- Risk stratification
- Treatment response
- Progress monitoring
- Outcome prediction

### Use Cases
1. Clinical Monitoring
   - Patient tracking
   - Progress assessment
   - Treatment response
   - Risk prediction

2. Research Applications
   - Data collection
   - Pattern analysis
   - Outcome studies
   - Population health

3. Personal Health
   - Self-monitoring
   - Health goals
   - Lifestyle tracking
   - Preventive care

### Best Practices
1. Implementation Guidelines
   - Setup procedures
   - Configuration steps
   - Maintenance protocols
   - Update processes

2. User Training
   - Clinical staff
   - Technical team
   - End users
   - Support staff

3. Quality Assurance
   - Testing protocols
   - Validation procedures
   - Performance monitoring
   - Continuous improvement

## Privacy and Security

### Data Protection
1. Security Measures
   - Encryption
   - Access control
   - Audit logging
   - Data segregation

2. Privacy Controls
   - Consent management
   - Data anonymization
   - Access restrictions
   - Usage tracking

### Compliance Requirements
1. Regulatory Standards
   - HIPAA compliance
   - GDPR requirements
   - Local regulations
   - Industry standards

2. Documentation
   - Policy documentation
   - Procedure records
   - Audit trails
   - Compliance reports

## Supported Operations

### Advanced Search Capabilities
- Multiparametric search
- Trend analysis queries
- Temporal correlations
- Circadian pattern analysis
- Complex pattern matching
- Event sequence detection

### Specific Search Parameters
1. Composite Indices
   - physiological-stress-index
   - allostatic-load
   - autonomic-balance
   - recovery-index

2. Temporal Patterns
   - circadian-rhythm
   - ultradian-pattern
   - seasonal-variation
   - adaptation-trend

3. Physiological Correlations
   - cardio-respiratory
   - thermo-regulatory
   - stress-recovery
   - autonomic-balance

4. Adaptive Trends
   - baseline-shift
   - response-pattern
   - recovery-trajectory
   - adaptation-rate

### Advanced Search Examples

GET [base]/Observation?category=advanced-vitals&patient=[id]&code=physiological-stress
GET [base]/Observation?category=advanced-vitals&patient=[id]&date=ge[start]&component-code=autonomic-balance
GET [base]/Observation?category=advanced-vitals&patient=[id]&code=recovery-index&date=ge[start]&date=le[end]
GET [base]/Observation?category=advanced-vitals&patient=[id]&component-code=circadian-pattern&_include=related-observations

## Calculations and Transformations

### 1. Advanced Cardiac Metrics
- HRV Spectral Analysis:

	- Power(f) = |FFT(RR intervals)|²
	
	- LF Power = ∫(0.04-0.15 Hz) Power(f)df
	
	- HF Power = ∫(0.15-0.40 Hz) Power(f)df

- HRV Entropy:

	- SampEn = -ln(A/B), where:
		- A = matches of length m+1
		- B = matches of length m

- Autonomic Balance:

	- LF/HF ratio = (LF Power)/(HF Power)
	
	- Normalized LF = LF/(LF+HF)*100
	
	- Normalized HF = HF/(LF+HF)*100

### 2. Respiratory Metrics
- Respiratory Variability:

	- CV = (SD of intervals)/(Mean interval)*100
	
	- RMSSD = √(Σ(RRi+1 - RRi)²/n)

- Oxygenation Indices:

	- PaO2/FiO2 ratio
	
	- SpO2/FiO2 ratio
	
	- OI = (FiO2 * MAP)/(PaO2)

### 3. Composite Indices
- Physiological Stress Index (PSI):
	- PSI = w1HRVnorm + w2BPnorm + w3SpO2norm + w4Tempnorm, where:
	
		- HRVnorm = normalized HRV deviation
	
		- BPnorm = normalized blood pressure variation
	
		- SpO2norm = normalized oxygen saturation
	
		- Tempnorm = normalized temperature variation
	
		- wi = weighting factors

- Homeostasis Index (HI):
	- HI = Σ(wi * Mi) / Σwi, where:
	
		- Mi = normalized metric i
	
		- wi = weight for metric i

- Allostatic Load Index (ALI): 
	- ALI = Σ(Ci), where:
	
		- Ci = count of metrics outside normal range

### 4. Advanced Statistical Transformations
- Time Domain Analysis:
	- SDNN = √(Σ(RRi - RRmean)²/(n-1))
	
	- pNN50 = (NN50 count)/(total NN count)

- Frequency Domain Analysis:
	- Welch's periodogram
	
	- AR spectral analysis
	
	- Wavelet transform

- Non-linear Methods:
	- Poincaré plot indices
	- Detrended fluctuation analysis
	- Sample entropy
	- Approximate entropy

### 5. Pattern Recognition
- Circadian Pattern Analysis:
	- Cosinor analysis
	- Phase estimation
	- Amplitude calculation
	- MESOR determination

- Trend Detection:
	- Moving averages
	- Exponential smoothing
	- Change point detection
	- Pattern matching

These calculations and transformations provide the mathematical foundation for advanced vital signs analysis. Each metric is carefully validated and normalized to ensure clinical relevance and reliability.




// ===== Conteúdo de: environmental.md =====

# Environmental Factors

## Overview
This module describes how environmental data collected from the iOS Health App is mapped to FHIR resources. These data are crucial for assessing exposure to environmental factors that may impact health.

## Data Sources
Environmental data is collected through:
- iPhone (built-in sensors)
- Apple Watch
- Integrated environmental monitoring apps
- Connected environmental monitoring devices

## Types of Collected Data

### 1. Audio Exposure
- Exposure level in decibels (dB)
- Duration of exposure
- Peak moments
- Dangerous level alerts
- Exposure history
- Sound pressure level measurements
- Daily noise dose calculation

### 2. Environmental Noise
- Continuous noise levels
- Daily variations
- Exposure patterns
- Associated locations
- Critical periods
- Background noise analysis
- Quiet time periods

### 3. UV Exposure
- UV index measurements
- Exposure duration
- Time of exposure
- Intensity levels
- Protection recommendations
- Cumulative exposure
- Risk assessments

## Collection Frequency
- Noise: Continuous monitoring
- UV: During sun exposure
- Alerts: Real-time
- Analysis: Daily and weekly aggregation

## FHIR Resources
Environmental data is mapped to FHIR Observation resources with specific profiles:
- AudioExposureObservation
- EnvironmentalNoiseObservation
- UVExposureObservation

## Supported Operations
- Search by date
- Search by exposure type
- Search by intensity level
- Aggregate reports

## Implementation Considerations
1. Data Validation
   - Sensor calibration
   - Measurement accuracy
   - Data consistency checks
   - Outlier detection

2. Privacy & Security
   - Location data protection
   - Personal exposure data
   - Data aggregation rules
   - Access controls

3. Clinical Integration
   - Health impact assessment
   - Risk factor analysis
   - Prevention recommendations
   - Clinical decision support

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code | Description |
|----------------|-----------|------------|-------------|
| Audio Exposure | NoiseExposureObservation.component[level] | 89020-2 | Environmental sound intensity |
| UV Index | UVExposureObservation.component[index] | 89022-8 | UV Index measurement |
| Noise Duration | NoiseExposureObservation.component[duration] | 89023-6 | Duration of noise exposure |
| Peak Level | NoiseExposureObservation.component[peak] | 89024-4 | Peak sound pressure level |
| Background Noise | NoiseExposureObservation.component[background] | 89025-1 | Background noise level |

### Mapping Considerations

1. Temporality
   - Continuous measurements aggregation
   - Analysis periods
   - Update frequency
   - Time zone handling
   - Event correlation

2. Data Quality
   - Sensor calibration
   - Measurement conditions
   - Data validation
   - Accuracy thresholds
   - Error detection

3. Context
   - Location data
   - Related activity
   - Environmental conditions
   - Device specifications
   - Measurement settings

4. Integration Requirements
   - HealthKit permissions
   - Data synchronization
   - API compatibility
   - Error handling
   - Batch processing

5. Validation Rules
   - Range validation
   - Unit conversion
   - Threshold alerts
   - Data consistency
   - Cross-validation

## Implementation Considerations

### Data Processing
1. Collection
   - Sensor calibration requirements
   - Measurement validation rules
   - Sampling frequency optimization
   - Data quality checks
   - Device synchronization

2. Analysis
   - Temporal aggregation methods
   - Pattern identification algorithms
   - Location correlation techniques
   - Trend analysis
   - Statistical processing

3. Storage
   - Raw data management
   - Processed metrics
   - Exposure history
   - Data retention policies
   - Backup procedures

### Alert System
1. Noise Alerts
   - Dangerous levels (>85 dB)
   - Extended exposure warnings
   - Intensity peaks detection
   - Daily exposure limits
   - Cumulative exposure tracking

2. UV Alerts
   - High UV index warnings
   - Exposure time monitoring
   - Critical hours alerts
   - Skin type considerations
   - Protection recommendations

### Visualizations
1. Dashboards
   - Daily exposure metrics
   - Weekly trends analysis
   - Comparative reports
   - Risk assessments
   - Historical patterns

2. Maps
   - Exposure locations
   - Risk zones mapping
   - Geographic patterns
   - Time-based heatmaps
   - Location clustering

### Integrations
1. Device Integration
   - Calibration procedures
   - Synchronization protocols
   - Validation methods
   - Error handling
   - Data consistency

2. External Data
   - UV forecasts
   - Noise mapping
   - Weather data
   - Environmental alerts
   - Public health data

### Clinical Integration
1. Risk Assessment
   - Exposure thresholds
   - Cumulative effects
   - Health impact analysis
   - Population comparisons
   - Trend evaluation

2. Decision Support
   - Clinical guidelines
   - Intervention triggers
   - Treatment recommendations
   - Follow-up protocols
   - Prevention strategies

### Recommendations
1. Protection Measures
   - Protective equipment
   - Optimal timing
   - Duration limits
   - Safety guidelines
   - Best practices

2. Mitigation Strategies
   - Exposure reduction
   - Preventive measures
   - Alternative options
   - Risk management
   - Behavioral changes

### Privacy & Security
1. Data Protection
   - Personal information handling
   - Location data privacy
   - Access controls
   - Encryption requirements
   - Audit trails

2. Compliance
   - Regulatory requirements
   - Data retention policies
   - Consent management
   - Security protocols
   - Privacy standards



// ===== Conteúdo de: symptoms.md =====


## FHIR Resources

### Main Resources Used
- Observation: For recording symptom details and measurements
- QuestionnaireResponse: For capturing structured symptom assessments
- Condition: For documenting ongoing symptoms
- ClinicalImpression: For clinical assessment of symptoms

### Parameters
- patient: Patient identifier
- date: Symptom record date
- category: symptom-assessment
- code: Specific symptom type

### Search Examples
GET [base]/Observation?category=symptom&patient=[id]&date=[date]
GET [base]/Observation?code=severity&patient=[id]

## Conformance

### Must Support Elements
Elements marked with MS must be supported:
- status
- category
- code
- subject
- effectiveDateTime
- value[x]
- component (for composite measurements)

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code |
|----------------|-----------|------------|
| Symptom Type | Observation.code | 75325-1 |
| Severity | Observation.component[severity].valueQuantity | 72514-3 |
| Duration | Observation.component[duration].valueDuration | 103333-2 |
| Frequency | Observation.component[frequency].valueQuantity | 103334-0 |

### Implementation Considerations

1. Data Collection
   - Questionnaire design
   - User interface optimization
   - Data validation rules
   - Real-time feedback
   - Multi-language support
   - Accessibility features

2. Data Quality
   - Input validation
   - Consistency checks
   - Temporal validation
   - Cross-reference verification
   - Completeness assessment
   - Error detection

3. Clinical Integration
   - Care plan updates
   - Alert generation
   - Decision support
   - Provider notifications
   - Trend analysis
   - Risk assessment

4. Privacy & Security
   - Data encryption
   - Access control
   - Audit logging
   - Consent management
   - Data retention
   - Regulatory compliance

5. Performance Optimization
   - Response time
   - Data compression
   - Cache management
   - Network efficiency
   - Battery impact
   - Storage optimization

## Implementation Details

### Data Flow
1. Collection
   - Direct user input
   - Periodic questionnaires
   - Follow-up records
   - Automated data validation
   - Real-time processing
   - Data synchronization

2. Validation
   - Data consistency
   - Record completeness
   - Temporal coherence
   - Value ranges
   - Logical relationships
   - Cross-validation

3. Analysis
   - Temporal patterns
   - Correlations
   - Trends
   - Statistical analysis
   - Pattern recognition
   - Predictive modeling

### User Interface
1. Recording
   - Easy data entry
   - Predefined templates
   - Customizable options
   - Quick input methods
   - Offline capability
   - Multi-device support

2. Visualization
   - Timelines
   - Intensity graphs
   - Recurrence patterns
   - Interactive charts
   - Custom views
   - Export options

3. Alerts
   - Severe symptoms
   - Concerning patterns
   - Recording reminders
   - Smart notifications
   - Priority levels
   - Custom thresholds

### Clinical Integration
1. Reports
   - Professional summaries
   - Symptom history
   - Trend analysis
   - Clinical metrics
   - Custom formats
   - Export capabilities

2. Clinical Decision Support
   - Pattern identification
   - Intervention triggers
   - Progress monitoring
   - Risk assessment
   - Treatment recommendations
   - Outcome tracking

### Quality Assurance
1. Data Quality
   - Input validation
   - Completeness checks
   - Consistency verification
   - Anomaly detection
   - Error handling
   - Data correction

2. System Performance
   - Response time
   - Data processing
   - Storage optimization
   - Battery efficiency
   - Network usage
   - Cache management

3. Security Measures
   - Data encryption
   - Access control
   - Audit trails
   - Compliance checks
   - Privacy protection
   - Backup procedures




// ===== Conteúdo de: mindfulness_module.md =====

# Mindfulness Module Implementation Guide

## Overview
This module provides FHIR resources and profiles for tracking mindfulness practices and their outcomes in healthcare applications.

## Scope
- Mindfulness session recording
- Mood and stress assessments
- Practice outcomes tracking
- Data integration with HealthKit

## Key Resources

### Profiles
- MindfulnessObservation: Core profile for recording mindfulness sessions
- MindfulnessQuestionnaire: Profile for mindfulness assessment tools
- MindfulnessConfiguration: Profile for module configuration

### Extensions
- MindfulnessContext: Additional context about practice sessions
- MindfulnessImportMap: Mapping configuration for data import

### Value Sets
- MoodValueSet: Standardized mood states
- MindfulnessOutcomeVS: Practice outcomes
- MindfulnessQualifierVS: Practice qualifiers

## Implementation Guidelines

### Data Collection
1. Session Recording
   - Duration tracking
   - Practice type categorization
   - Environmental context

2. Assessment Tools
   - Mood evaluation
   - Stress level measurement
   - Practice effectiveness

### Integration Points
1. HealthKit
   - Mindfulness minutes
   - Heart rate data
   - Activity correlation

2. Clinical Systems
   - EHR integration
   - Care plan incorporation
   - Progress monitoring

### Security Considerations
- Patient data privacy
- Access control
- Audit logging
- Data encryption

## Conformance Requirements
- Must support core profiles
- Required value set bindings
- Mandatory elements
- Validation rules

## Usage Examples
See the examples directory for detailed implementation scenarios.



// ===== Conteúdo de: mobility.md =====

# Mobility Implementation Guide

## Overview
This module describes how to implement mobility monitoring using iOS motion sensors data, covering data collection, processing, analysis, and clinical integration.

## FHIR Resources

### Main Resources Used
- Observation: For recording mobility metrics
- RiskAssessment: For fall risk evaluations
- Goal: For mobility improvement targets
- CarePlan: For mobility enhancement plans

### Parameters
- patient: Patient identifier
- date: Assessment date
- category: mobility
- code: Specific mobility metric

### Search Examples
GET [base]/Observation?category=mobility&patient=[id]&date=[date]
GET [base]/Observation?code=walking-steadiness&patient=[id]

## Conformance

### Must Support
Elements marked with MS must be supported:
- status
- category
- code
- subject
- effectiveDateTime
- value[x]
- device
- component (for composite measurements)

## Implementation Considerations

### Data Processing
1. Collection
   - Raw sensor data from iPhone motion sensors
   - Processing algorithms for motion data
   - Noise filtering and signal processing
   - Sampling rates and data quality checks
   - Battery optimization considerations
   - Motion context detection

2. Analysis
   - Key metrics calculation (speed, steadiness, balance)
   - Trend detection and pattern recognition
   - Statistical analysis methods
   - Machine learning model integration
   - Real-time vs batch processing
   - Performance optimization strategies

3. Storage
   - Raw sensor data management
   - Processed metrics database
   - Historical trend storage
   - Data compression techniques
   - Backup and archival policies
   - Privacy considerations

### Data Quality Validations
1. Data Quality
   - Signal integrity verification
   - Temporal consistency checks
   - Anomaly detection algorithms
   - Sensor calibration validation
   - Environmental interference detection
   - Movement artifact filtering

2. Trend Analysis
   - Significant change detection
   - Deterioration pattern identification
   - Cross-metric correlations
   - Baseline comparison methods
   - Statistical significance testing
   - Confidence level calculations

### Alert System
1. Alert Levels
   - Normal (green)
     * Within baseline parameters
     * Regular movement patterns
     * Stable measurements
   - Caution (yellow)
     * Minor deviations from baseline
     * Subtle pattern changes
     * Early warning indicators
   - Alert (red)
     * Significant changes detected
     * Concerning patterns identified
     * Immediate attention required

2. Triggers
   - Sudden changes in measurements
   - Negative trend development
   - Abnormal pattern detection
   - Multiple metric correlation
   - Time-based thresholds
   - Context-aware alerting

### User Interface
1. Visualizations
   - Trend graphs and charts
   - Status indicators and dashboards
   - Baseline comparisons
   - Interactive data exploration
   - Custom view configurations
   - Accessibility considerations

2. Notifications
   - Real-time alerts and updates
   - Periodic summary reports
   - Contextual recommendations
   - Priority-based notifications
   - User preference settings
   - Do-not-disturb protocols

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path |
|------------------|-----------|
| Walking Steadiness | Observation.component[steadiness] |
| Walking Speed | Observation.component[speed] |
| Step Length | Observation.component[stepLength] |
| Double Support Time | Observation.component[supportTime] |
| Walking Asymmetry | Observation.component[asymmetry] |

### Integration Requirements
1. Health App Integration
   - HealthKit permissions
   - Data synchronization
   - Background processing
   - Battery optimization
   - Error handling
   - Version compatibility

2. Clinical Systems
   - FHIR compliance
   - API endpoints
   - Authentication
   - Data mapping
   - Error handling
   - Versioning strategy

### Security and Privacy
1. Data Protection
   - Encryption standards
   - Access control
   - Audit logging
   - Data anonymization
   - Consent management
   - Regulatory compliance

2. System Security
   - Authentication methods
   - Authorization protocols
   - Secure communication
   - Threat detection
   - Incident response
   - System monitoring

### Performance Optimization
1. Resource Management
   - Battery optimization
   - Network usage
   - Storage efficiency
   - Processing optimization
   - Memory management
   - Cache strategies

2. Scalability
   - Load balancing
   - Data partitioning
   - Service distribution
   - Query optimization
   - Batch processing
   - Real-time processing

## Testing and Validation
1. Test Cases
   - Unit tests
   - Integration tests
   - Performance tests
   - Security tests
   - User acceptance tests
   - Compliance validation

2. Quality Assurance
   - Code review
   - Documentation review
   - Performance monitoring
   - Security audits
   - Compliance checks
   - User feedback

## iOS Health App to FHIR Mapping

### Core Fields
| iOS Health App | FHIR Path | LOINC Code |
|----------------|-----------|------------|
| Walking Steadiness | WalkingSteadinessObservation.valueQuantity | LA32-8 |
| Walking Speed | WalkingSpeedObservation.valueQuantity | LA29042-4 |
| Step Length | StepLengthObservation.valueQuantity | LA19752-7 |
| Double Support Time | DoubleSupportTimeObservation.valueQuantity | LA32-9 |
| Walking Asymmetry | WalkingAsymmetryObservation.valueQuantity | LA32-10 |

### Mapping Considerations
1. Temporality
   - Aggregation of continuous measurements
   - Analysis periods 
   - Update frequency
   - Data synchronization timing
   - Historical data handling
   - Real-time vs batch processing

2. Quality Assurance
   - Measurement reliability
   - Collection conditions
   - Cross-validation
   - Data consistency checks
   - Calibration verification
   - Error detection and handling

3. Context
   - Environmental conditions
   - User state and conditions
   - Related activity
   - Device positioning
   - Movement patterns
   - Activity intensity

4. Data Flow
   - Continuous monitoring
   - Batch processing
   - Event triggers
   - Alert handling
   - Data transformation
   - Error recovery

5. Integration Requirements
   - HealthKit permissions
   - Data synchronization
   - Background processing
   - Battery optimization
   - Error handling
   - Version compatibility


// ===== Conteúdo de: social_interaction.md =====

# Social Interaction Module

## Overview
This module describes how social interaction data from iOS devices is mapped to FHIR resources to support lifestyle medicine interventions focused on social wellbeing.

## Data Sources
- Location data
- Calendar events
- Communication patterns
- Activity context
- User reported data

## Types of Data Collected

### 1. Interaction Metrics
- Duration
- Frequency  
- Group size
- Interaction type
- Communication mode

### 2. Social Context
- Location type
- Activity setting
- Time of day
- Environmental factors
- Social purpose

### 3. Quality Assessment
- Engagement level
- Satisfaction rating
- Support received
- Connection strength
- Interaction impact

### 4. Support Network
- Relationship types
- Network size
- Contact frequency
- Support availability
- Social capital

## Implementation Considerations

### Data Collection
1. Privacy Protection
   - Data minimization
   - Location masking
   - Identity protection
   - Consent management
   
2. Context Capture
   - Location context
   - Activity context
   - Social setting
   - Environmental factors

### Analysis
1. Pattern Recognition
   - Interaction frequency
   - Social rhythms
   - Support patterns
   - Isolation risks

2. Quality Assessment
   - Interaction depth
   - Support effectiveness
   - Connection strength
   - Network resilience

## FHIR Resources

### Core Resources
- Observation: For interaction records
- Questionnaire: For social assessments  
- CarePlan: For social engagement plans
- Goal: For social wellbeing targets

### Profiles
- SocialInteractionProfile
- SocialSupportProfile
- SocialNetworkProfile

### Extensions
- SocialContext
- SocialSupport
- SocialQuality

### Value Sets
- InteractionTypeVS
- SocialContextVS
- SupportTypeVS
- QualityMetricsVS

## iOS Data to FHIR Mapping

### Core Fields
| iOS Data | FHIR Path | Description |
|----------|-----------|-------------|
| Duration | component[duration] | Interaction length |
| Type | component[type] | Interaction category |
| Quality | component[quality] | Interaction quality |
| Support | component[support] | Support received |

### Implementation Notes
1. Privacy Controls
   - Data anonymization
   - Access restrictions
   - Audit logging
   - Consent tracking

2. Integration Points
   - Calendar sync
   - Location services
   - Communication apps
   - Health data correlation

3. Clinical Uses
   - Social prescribing
   - Isolation prevention
   - Support coordination
   - Wellbeing monitoring



// ===== Conteúdo de: fsh-link-references.md =====

[DeviceActivityTracker]: Device-DeviceActivityTracker.html
[AdvancedVitalSignsContextCS]: CodeSystem-advanced-vital-signs-context-cs.html
[AdvancedVitalSignsContext]: StructureDefinition-advanced-vital-signs-context.html
[AdvancedVitalSignsContextVS]: ValueSet-advanced-vital-signs-context-vs.html
[AdvancedVitalSigns]: StructureDefinition-advanced-vital-signs.html
[AlertMessage]: StructureDefinition-alert-message.html
[AlertTiming]: StructureDefinition-alert-timing.html
[AllostaticLoad]: StructureDefinition-allostatic-load.html
[AssistanceLevelOutcomesValueSet]: ValueSet-assistance-level-outcomes.html
[AuditFormatExtension]: StructureDefinition-audit-format.html
[AuditFormatsCodeSystem]: CodeSystem-audit-formats.html
[AuditFormatsValueSet]: ValueSet-audit-formats.html
[AuditLevelExtension]: StructureDefinition-audit-level.html
[AuditLevelsCodeSystem]: CodeSystem-audit-levels.html
[AuditLevelsValueSet]: ValueSet-audit-levels.html
[AuditRetentionExtension]: StructureDefinition-audit-retention.html
[BalanceStatusCodeSystem]: CodeSystem-balance-status.html
[BalanceStatusValueSet]: ValueSet-balance-status.html
[BioimpedanceAnalyzer]: Device-BioimpedanceAnalyzer.html
[BloodPressureExample]: Observation-BloodPressureExample.html
[DeviceBloodPressureMonitor]: Device-DeviceBloodPressureMonitor.html
[BloodPressureObservation]: StructureDefinition-blood-pressure-observation.html
[BMIExample]: Observation-BMIExample.html
[BMIObservation]: StructureDefinition-bmi-observation.html
[BodyCompositionExample]: Observation-BodyCompositionExample.html
[BodyCompositionObservation]: StructureDefinition-body-composition-observation.html
[BodyLocationsVS]: ValueSet-body-locations-vs.html
[BodyMetricsObservation]: StructureDefinition-body-metrics-observation.html
[CalorieIntakeObservation]: StructureDefinition-calorie-intake-observation.html
[CervicalMucusCodeSystem]: CodeSystem-cervical-mucus-cs.html
[CervicalMucusValueSet]: ValueSet-cervical-mucus-valueset.html
[ChronicSymptomExample]: Observation-ChronicSymptomExample.html
[CircadianPhaseCS]: CodeSystem-circadian-phase-cs.html
[CircadianPhase]: StructureDefinition-circadian-phase.html
[CircadianPhaseVS]: ValueSet-circadian-phase-vs.html
[CompleteMindfulnessSession]: Observation-CompleteMindfulnessSession.html
[CompleteMindfulnessResponse]: QuestionnaireResponse-CompleteMindfulnessResponse.html
[MindfulnessCSVTransform]: StructureMap-MindfulnessCSVTransform.html
[DailyMindfulnessAlert]: Basic-DailyMindfulnessAlert.html
[DailyMindfulnessQuestionnaire]: Questionnaire-DailyMindfulnessQuestionnaire.html
[DailyNutritionQuestionnaire]: Questionnaire-DailyNutritionQuestionnaire.html
[NutritionQuestionnaireResponseExample]: QuestionnaireResponse-NutritionQuestionnaireResponseExample.html
[DefaultAuditConfig]: Basic-DefaultAuditConfig.html
[DefaultMindfulnessConfig]: Basic-DefaultMindfulnessConfig.html
[DurationUnitsVS]: ValueSet-duration-units-vs.html
[EndSessionMessage]: MessageDefinition-EndSessionMessage.html
[EndSessionOperation]: OperationDefinition-EndSessionOperation.html
[EnvironmentTypeValueSet]: ValueSet-environment-type.html
[EnvironmentalContext]: StructureDefinition-environmental-context.html
[EnvironmentalContextValueSet]: ValueSet-environmental-context.html
[EnvironmentalDeviceExample]: Device-EnvironmentalDeviceExample.html
[EnvironmentalObservation]: StructureDefinition-environmental-observation.html
[MindfulnessAuditExample]: Basic-MindfulnessAuditExample.html
[MindfulnessQuestionnaireExample]: Questionnaire-MindfulnessQuestionnaireExample.html
[MindfulnessObservationExample]: Observation-MindfulnessObservationExample.html
[SleepObservationExample1]: Observation-SleepObservationExample1.html
[PhysicalActivityExample1]: Observation-PhysicalActivityExample1.html
[ExampleReproductiveActivity]: CarePlan-ExampleReproductiveActivity.html
[ExampleSymptomSeverity]: Observation-ExampleSymptomSeverity.html
[ExposureConditionsCS]: CodeSystem-exposure-conditions-cs.html
[ExposureConditions]: StructureDefinition-exposure-conditions.html
[ExposureConditionsVS]: ValueSet-exposure-conditions-vs.html
[ExposureLocationCS]: CodeSystem-exposure-location-cs.html
[ExposureLocation]: StructureDefinition-exposure-location.html
[ExposureLocationVS]: ValueSet-exposure-location-vs.html
[FallRiskOutcomesValueSet]: ValueSet-fall-risk-outcomes.html
[FertilityObservation]: StructureDefinition-fertility-observation.html
[FertilityStatusCodeSystem]: CodeSystem-fertility-status-cs.html
[FertilityStatusValueSet]: ValueSet-fertility-status-valueset.html
[MindfulnessHealthKitTransform]: StructureMap-MindfulnessHealthKitTransform.html
[HeartRateExample]: Observation-HeartRateExample.html
[DeviceHeartRateMonitor]: Device-DeviceHeartRateMonitor.html
[HeartRateObservation]: StructureDefinition-heart-rate-observation.html
[HeightExample]: Observation-HeightExample.html
[HeightObservation]: StructureDefinition-height-observation.html
[HomeostasisIndex]: StructureDefinition-homeostasis-index.html
[LifestyleVitalSigns]: StructureDefinition-lifestyle-vital-signs.html
[MacronutrientsObservation]: StructureDefinition-macronutrients-observation.html
[MeasurementConditions]: StructureDefinition-measurement-conditions.html
[MeasurementConditionsVS]: ValueSet-measurement-conditions-vs.html
[MeasurementContext]: StructureDefinition-measurement-context.html
[MeasurementContextVitalSigns]: ValueSet-measurement-context-vital-signs.html
[MeasurementContextVS]: ValueSet-measurement-context-vs.html
[MeasurementDevice]: StructureDefinition-measurement-device-type.html
[MeasurementDeviceTypeVS]: ValueSet-measurement-device-type-vs.html
[MeasurementQualityCS]: CodeSystem-measurement-quality-cs.html
[MeasurementQuality]: StructureDefinition-measurement-quality.html
[MeasurementQualityVS]: ValueSet-measurement-quality-vs.html
[MindfulnessAlert]: StructureDefinition-mindfulness-alert.html
[MindfulnessAudit]: StructureDefinition-mindfulness-audit.html
[MindfulnessAuditConfig]: StructureDefinition-mindfulness-audit-config.html
[MindfulnessAuditFormat]: StructureDefinition-mindfulness-audit-format.html
[MindfulnessAuditLevel]: StructureDefinition-mindfulness-audit-level.html
[MindfulnessAuditRetention]: StructureDefinition-mindfulness-audit-retention.html
[MindfulnessConfiguration]: StructureDefinition-mindfulness-configuration.html
[MindfulnessAccessPolicy]: Consent-MindfulnessAccessPolicy.html
[MindfulnessSecurityDefinition]: Consent-MindfulnessSecurityDefinition.html
[MindfulnessDiagnosticMap]: ConceptMap-MindfulnessDiagnosticMap.html
[MindfulnessImportMap]: StructureDefinition-mindfulness-import-map.html
[MindfulnessMessageDefinition]: StructureDefinition-mindfulness-message-definition.html
[MindfulnessCapabilityStatement]: CapabilityStatement-MindfulnessCapabilityStatement.html
[MindfulnessNotificationEnabled]: StructureDefinition-mindfulness-notification-enabled.html
[MindfulnessOperation]: StructureDefinition-mindfulness-operation.html
[MindfulnessOutcomeCS]: CodeSystem-mindfulness-outcome-cs.html
[MindfulnessOutcomeVS]: ValueSet-mindfulness-outcome-vs.html
[MindfulnessProgressReport]: Measure-MindfulnessProgressReport.html
[MindfulnessQualifierCS]: CodeSystem-mindfulness-qualifier-cs.html
[MindfulnessQualifierVS]: ValueSet-mindfulness-qualifier-vs.html
[MindfulnessTypeCS]: CodeSystem-mindfulness-type-cs.html
[MindfulnessTypeVS]: ValueSet-mindfulness-type-vs.html
[MindfulnessPreferredGuide]: StructureDefinition-mindfulness-preferred-guide.html
[MindfulnessReminderTime]: StructureDefinition-mindfulness-reminder-time.html
[MindfulnessSchedule]: StructureDefinition-mindfulness-schedule.html
[MindfulnessScheduleTiming]: StructureDefinition-mindfulness-schedule-timing.html
[MindfulnessContext]: StructureDefinition-mindfulness-context.html
[MindfulnessSessionDuration]: StructureDefinition-mindfulness-session-duration.html
[MindfulnessObservation]: StructureDefinition-mindfulness-observation.html
[MindfulnessSettingCS]: CodeSystem-MindfulnessSettingCS.html
[MindfulnessTypeValueSet]: ValueSet-mindfulness-type.html
[MindfulnessType]: SearchParameter-MindfulnessType.html
[MobilityAlertLevelCS]: CodeSystem-mobility-alert-level-cs.html
[MobilityAlertLevel]: StructureDefinition-mobility-alert-level.html
[MobilityAlertLevelVS]: ValueSet-mobility-alert-level-vs.html
[MobilityDeclineOutcomesValueSet]: ValueSet-mobility-decline-outcomes.html
[MobilityProfile]: StructureDefinition-mobility-profile.html
[MobilityRiskAssessment]: StructureDefinition-mobility-risk-assessment.html
[MoodCodeSystem]: CodeSystem-mood.html
[MoodValueSet]: ValueSet-mood.html
[NoiseExposureExample]: Observation-NoiseExposureExample.html
[NoiseExposureObservation]: StructureDefinition-noise-exposure-observation.html
[NutritionDataSourceCS]: CodeSystem-nutrition-data-source-cs.html
[NutritionDataSource]: StructureDefinition-nutrition-data-source.html
[NutritionDataSourceVS]: ValueSet-nutrition-data-source-vs.html
[NutritionIntakeObservation]: StructureDefinition-nutrition-intake-observation.html
[OvulationTestCodeSystem]: CodeSystem-ovulation-test-cs.html
[OvulationTestValueSet]: ValueSet-ovulation-test-valueset.html
[OxygenSaturationObservation]: StructureDefinition-oxygen-saturation-observation.html
[PatientExample]: Patient-PatientExample.html
[PhysicalActivityObservation]: StructureDefinition-physical-activity-observation.html
[PhysicalActivityTypeVS]: ValueSet-physical-activity-type-vs.html
[PhysiologicalStressIndex]: StructureDefinition-physiological-stress-index.html
[EnvironmentTypeCS]: CodeSystem-environment-type-cs.html
[EnvironmentTypeVS]: ValueSet-environment-type-vs.html
[PractitionerExample]: Practitioner-PractitionerExample.html
[RecoveryEfficiency]: StructureDefinition-recovery-efficiency.html
[ReproductiveActivityCS]: CodeSystem-reproductive-activity-cs.html
[ReproductiveActivityVS]: ValueSet-reproductive-activity-vs.html
[ReproductiveObservation]: StructureDefinition-reproductive-observation.html
[ReproductiveGoalVS]: ValueSet-reproductive-goal-vs.html
[ReproductiveHealthQuestionnaire]: Questionnaire-ReproductiveHealthQuestionnaire.html
[RiskLevelValueSet]: ValueSet-risk-level.html
[DeviceSleepMonitor]: Device-DeviceSleepMonitor.html
[SleepObservation]: StructureDefinition-sleep-observation.html
[SleepQuality]: StructureDefinition-sleep-quality.html
[SleepQualityExtendedVS]: ValueSet-sleep-quality-extended-vs.html
[SleepQualityVS]: ValueSet-sleep-quality-vs.html
[SmartScale]: Device-SmartScale.html
[SocialActivityCS]: CodeSystem-social-activity-cs.html
[SocialActivity]: StructureDefinition-social-activity.html
[SocialActivityVS]: ValueSet-social-activity-vs.html
[SocialContextCS]: CodeSystem-social-context-cs.html
[SocialContext]: StructureDefinition-social-context.html
[SocialContextVS]: ValueSet-social-context-vs.html
[SocialInteractionExample]: Observation-SocialInteractionExample.html
[SocialInteractionMediumCS]: CodeSystem-social-interaction-medium-cs.html
[SocialInteractionMediumVS]: ValueSet-social-interaction-medium-vs.html
[SocialInteractionProfile]: StructureDefinition-social-interaction.html
[SocialInteractionQualityCS]: CodeSystem-social-interaction-quality-cs.html
[SocialInteractionQualityVS]: ValueSet-social-interaction-quality-vs.html
[SocialInteractionTypeCS]: CodeSystem-social-interaction-type-cs.html
[SocialInteractionTypeVS]: ValueSet-social-interaction-type-vs.html
[SocialSupportCS]: CodeSystem-social-support-cs.html
[SocialSupport]: StructureDefinition-social-support.html
[SocialSupportVS]: ValueSet-social-support-vs.html
[StartSessionMessage]: MessageDefinition-StartSessionMessage.html
[StartSessionOperation]: OperationDefinition-StartSessionOperation.html
[StressChronicityCS]: CodeSystem-stress-chronicity-cs.html
[StressChronicityVS]: ValueSet-stress-chronicity-vs.html
[StressCopingCS]: CodeSystem-stress-coping-cs.html
[StressCoping]: StructureDefinition-stress-coping.html
[StressCopingVS]: ValueSet-stress-coping-vs.html
[StressImpactCS]: CodeSystem-stress-impact-cs.html
[StressImpactVS]: ValueSet-stress-impact-vs.html
[StressLevelExample]: Observation-StressLevelExample.html
[StressLevelProfile]: StructureDefinition-stress-level.html
[StressTriggersCS]: CodeSystem-stress-triggers-cs.html
[StressTriggers]: StructureDefinition-stress-triggers.html
[StressTriggersVS]: ValueSet-stress-triggers-vs.html
[SymptomQuestionnaire]: StructureDefinition-symptom-questionnaire.html
[SymptomFrequencyCS]: CodeSystem-symptom-frequency-cs.html
[SymptomFrequencyVS]: ValueSet-symptom-frequency-vs.html
[SymptomImpactCS]: CodeSystem-symptom-impact-cs.html
[SymptomImpactVS]: ValueSet-symptom-impact-vs.html
[SymptomProgressionVS]: ValueSet-symptom-progression-vs.html
[SymptomSeverityCS]: CodeSystem-symptom-severity-cs.html
[TimeOfDayVS]: ValueSet-time-of-day-vs.html
[UVExposureExample]: Observation-UVExposureExample.html
[UVExposureObservation]: StructureDefinition-uv-exposure-observation.html
[WalkingSpeedExample]: Observation-WalkingSpeedExample.html
[WalkingSpeedObservation]: StructureDefinition-walking-speed-observation.html
[WalkingSteadinessExample]: Observation-WalkingSteadinessExample.html
[WalkingSteadinessObservation]: StructureDefinition-walking-steadiness-observation.html
[WaterIntakeObservation]: StructureDefinition-water-intake-observation.html
[WeeklyMindfulnessSchedule]: Basic-WeeklyMindfulnessSchedule.html
[WeightExample]: Observation-WeightExample.html
[WeightObservation]: StructureDefinition-weight-observation.html
[WeightWithConditions]: Observation-WeightWithConditions.html


// ===== Conteúdo de: fsh-link-references.md =====

[DeviceActivityTracker]: Device-DeviceActivityTracker.html
[AdvancedVitalSignsContextCS]: CodeSystem-advanced-vital-signs-context-cs.html
[AdvancedVitalSignsContext]: StructureDefinition-advanced-vital-signs-context.html
[AdvancedVitalSignsContextVS]: ValueSet-advanced-vital-signs-context-vs.html
[AdvancedVitalSigns]: StructureDefinition-advanced-vital-signs.html
[AlertMessage]: StructureDefinition-alert-message.html
[AlertTiming]: StructureDefinition-alert-timing.html
[AllostaticLoad]: StructureDefinition-allostatic-load.html
[AssistanceLevelOutcomesValueSet]: ValueSet-assistance-level-outcomes.html
[AuditFormatExtension]: StructureDefinition-audit-format.html
[AuditFormatsCodeSystem]: CodeSystem-audit-formats.html
[AuditFormatsValueSet]: ValueSet-audit-formats.html
[AuditLevelExtension]: StructureDefinition-audit-level.html
[AuditLevelsCodeSystem]: CodeSystem-audit-levels.html
[AuditLevelsValueSet]: ValueSet-audit-levels.html
[AuditRetentionExtension]: StructureDefinition-audit-retention.html
[BalanceStatusCodeSystem]: CodeSystem-balance-status.html
[BalanceStatusValueSet]: ValueSet-balance-status.html
[BioimpedanceAnalyzer]: Device-BioimpedanceAnalyzer.html
[BloodPressureExample]: Observation-BloodPressureExample.html
[DeviceBloodPressureMonitor]: Device-DeviceBloodPressureMonitor.html
[BloodPressureObservation]: StructureDefinition-blood-pressure-observation.html
[BMIExample]: Observation-BMIExample.html
[BMIObservation]: StructureDefinition-bmi-observation.html
[BodyCompositionExample]: Observation-BodyCompositionExample.html
[BodyCompositionObservation]: StructureDefinition-body-composition-observation.html
[BodyLocationsVS]: ValueSet-body-locations-vs.html
[BodyMetricsObservation]: StructureDefinition-body-metrics-observation.html
[CalorieIntakeObservation]: StructureDefinition-calorie-intake-observation.html
[CervicalMucusCodeSystem]: CodeSystem-cervical-mucus-cs.html
[CervicalMucusValueSet]: ValueSet-cervical-mucus-valueset.html
[ChronicSymptomExample]: Observation-ChronicSymptomExample.html
[CircadianPhaseCS]: CodeSystem-circadian-phase-cs.html
[CircadianPhase]: StructureDefinition-circadian-phase.html
[CircadianPhaseVS]: ValueSet-circadian-phase-vs.html
[CompleteMindfulnessSession]: Observation-CompleteMindfulnessSession.html
[CompleteMindfulnessResponse]: QuestionnaireResponse-CompleteMindfulnessResponse.html
[MindfulnessCSVTransform]: StructureMap-MindfulnessCSVTransform.html
[DailyMindfulnessAlert]: Basic-DailyMindfulnessAlert.html
[DailyMindfulnessQuestionnaire]: Questionnaire-DailyMindfulnessQuestionnaire.html
[DailyNutritionQuestionnaire]: Questionnaire-DailyNutritionQuestionnaire.html
[NutritionQuestionnaireResponseExample]: QuestionnaireResponse-NutritionQuestionnaireResponseExample.html
[DataLocalization]: StructureDefinition-data-localization.html
[DefaultAuditConfig]: Basic-DefaultAuditConfig.html
[DefaultMindfulnessConfig]: Basic-DefaultMindfulnessConfig.html
[DurationUnitsVS]: ValueSet-duration-units-vs.html
[EndSessionMessage]: MessageDefinition-EndSessionMessage.html
[EndSessionOperation]: OperationDefinition-EndSessionOperation.html
[EnvironmentTypeValueSet]: ValueSet-environment-type.html
[EnvironmentalContext]: StructureDefinition-environmental-context.html
[EnvironmentalContextValueSet]: ValueSet-environmental-context.html
[EnvironmentalDeviceExample]: Device-EnvironmentalDeviceExample.html
[EnvironmentalObservation]: StructureDefinition-environmental-observation.html
[example]: Patient-example.html
[MindfulnessAuditExample]: Basic-MindfulnessAuditExample.html
[MindfulnessQuestionnaireExample]: Questionnaire-MindfulnessQuestionnaireExample.html
[MindfulnessObservationExample]: Observation-MindfulnessObservationExample.html
[SleepObservationExample1]: Observation-SleepObservationExample1.html
[PhysicalActivityExample1]: Observation-PhysicalActivityExample1.html
[ExampleReproductiveActivity]: CarePlan-ExampleReproductiveActivity.html
[ExampleSymptomSeverity]: Observation-ExampleSymptomSeverity.html
[ExposureConditionsCS]: CodeSystem-exposure-conditions-cs.html
[ExposureConditions]: StructureDefinition-exposure-conditions.html
[ExposureConditionsVS]: ValueSet-exposure-conditions-vs.html
[ExposureLocationCS]: CodeSystem-exposure-location-cs.html
[ExposureLocation]: StructureDefinition-exposure-location.html
[ExposureLocationVS]: ValueSet-exposure-location-vs.html
[FallRiskOutcomesValueSet]: ValueSet-fall-risk-outcomes.html
[FertilityObservation]: StructureDefinition-fertility-observation.html
[FertilityStatusCodeSystem]: CodeSystem-fertility-status-cs.html
[FertilityStatusValueSet]: ValueSet-fertility-status-valueset.html
[MindfulnessHealthKitTransform]: StructureMap-MindfulnessHealthKitTransform.html
[HeartRateExample]: Observation-HeartRateExample.html
[DeviceHeartRateMonitor]: Device-DeviceHeartRateMonitor.html
[HeartRateObservation]: StructureDefinition-heart-rate-observation.html
[HeightExample]: Observation-HeightExample.html
[HeightObservation]: StructureDefinition-height-observation.html
[HomeostasisIndex]: StructureDefinition-homeostasis-index.html
[JurisdictionApplicability]: StructureDefinition-jurisdiction-applicability.html
[LifestyleVitalSigns]: StructureDefinition-lifestyle-vital-signs.html
[MacronutrientsObservation]: StructureDefinition-macronutrients-observation.html
[MeasurementConditions]: StructureDefinition-measurement-conditions.html
[MeasurementConditionsVS]: ValueSet-measurement-conditions-vs.html
[MeasurementContext]: StructureDefinition-measurement-context.html
[MeasurementContextVitalSigns]: ValueSet-measurement-context-vital-signs.html
[MeasurementContextVS]: ValueSet-measurement-context-vs.html
[MeasurementDevice]: StructureDefinition-measurement-device-type.html
[MeasurementDeviceTypeVS]: ValueSet-measurement-device-type-vs.html
[MeasurementQualityCS]: CodeSystem-measurement-quality-cs.html
[MeasurementQuality]: StructureDefinition-measurement-quality.html
[MeasurementQualityVS]: ValueSet-measurement-quality-vs.html
[MindfulnessAlert]: StructureDefinition-mindfulness-alert.html
[MindfulnessAudit]: StructureDefinition-mindfulness-audit.html
[MindfulnessAuditConfig]: StructureDefinition-mindfulness-audit-config.html
[MindfulnessAuditFormat]: StructureDefinition-mindfulness-audit-format.html
[MindfulnessAuditLevel]: StructureDefinition-mindfulness-audit-level.html
[MindfulnessAuditRetention]: StructureDefinition-mindfulness-audit-retention.html
[MindfulnessConfiguration]: StructureDefinition-mindfulness-configuration.html
[MindfulnessDiagnosticMap]: ConceptMap-MindfulnessDiagnosticMap.html
[MindfulnessImportMap]: StructureDefinition-mindfulness-import-map.html
[MindfulnessMessageDefinition]: StructureDefinition-mindfulness-message-definition.html
[MindfulnessCapabilityStatement]: CapabilityStatement-MindfulnessCapabilityStatement.html
[MindfulnessNotificationEnabled]: StructureDefinition-mindfulness-notification-enabled.html
[MindfulnessOperation]: StructureDefinition-mindfulness-operation.html
[MindfulnessOutcomeCS]: CodeSystem-mindfulness-outcome-cs.html
[MindfulnessOutcomeVS]: ValueSet-mindfulness-outcome-vs.html
[MindfulnessProgressReport]: Measure-MindfulnessProgressReport.html
[MindfulnessQualifierCS]: CodeSystem-mindfulness-qualifier-cs.html
[MindfulnessQualifierVS]: ValueSet-mindfulness-qualifier-vs.html
[MindfulnessTypeCS]: CodeSystem-mindfulness-type-cs.html
[MindfulnessTypeVS]: ValueSet-mindfulness-type-vs.html
[MindfulnessPreferredGuide]: StructureDefinition-mindfulness-preferred-guide.html
[MindfulnessReminderTime]: StructureDefinition-mindfulness-reminder-time.html
[MindfulnessSchedule]: StructureDefinition-mindfulness-schedule.html
[MindfulnessScheduleTiming]: StructureDefinition-mindfulness-schedule-timing.html
[MindfulnessContext]: StructureDefinition-mindfulness-context.html
[MindfulnessSessionDuration]: StructureDefinition-mindfulness-session-duration.html
[MindfulnessObservation]: StructureDefinition-mindfulness-observation.html
[MindfulnessSettingCS]: CodeSystem-MindfulnessSettingCS.html
[MindfulnessTypeValueSet]: ValueSet-mindfulness-type.html
[MindfulnessAccessPolicy]: Consent-MindfulnessAccessPolicy.html
[MindfulnessSecurityDefinition]: Consent-MindfulnessSecurityDefinition.html
[MindfulnessType]: SearchParameter-MindfulnessType.html
[MobilityAlertLevelCS]: CodeSystem-mobility-alert-level-cs.html
[MobilityAlertLevel]: StructureDefinition-mobility-alert-level.html
[MobilityAlertLevelVS]: ValueSet-mobility-alert-level-vs.html
[MobilityDeclineOutcomesValueSet]: ValueSet-mobility-decline-outcomes.html
[MobilityProfile]: StructureDefinition-mobility-profile.html
[MobilityRiskAssessment]: StructureDefinition-mobility-risk-assessment.html
[MoodCodeSystem]: CodeSystem-mood.html
[MoodValueSet]: ValueSet-mood.html
[MultiJurisdictionalConsent]: StructureDefinition-multi-jurisdictional-consent.html
[NoiseExposureExample]: Observation-NoiseExposureExample.html
[NoiseExposureObservation]: StructureDefinition-noise-exposure-observation.html
[NutritionDataSourceCS]: CodeSystem-nutrition-data-source-cs.html
[NutritionDataSource]: StructureDefinition-nutrition-data-source.html
[NutritionDataSourceVS]: ValueSet-nutrition-data-source-vs.html
[NutritionIntakeObservation]: StructureDefinition-nutrition-intake-observation.html
[Org2RDoc]: Organization-Org2RDoc.html
[osa-practitioner-kyle-anydoc]: Practitioner-osa-practitioner-kyle-anydoc.html
[OvulationTestCodeSystem]: CodeSystem-ovulation-test-cs.html
[OvulationTestValueSet]: ValueSet-ovulation-test-valueset.html
[OxygenSaturationObservation]: StructureDefinition-oxygen-saturation-observation.html
[PatientExample]: Patient-PatientExample.html
[PatientMindfulness]: Patient-PatientMindfulness.html
[PhysicalActivityObservation]: StructureDefinition-physical-activity-observation.html
[PhysicalActivityTypeVS]: ValueSet-physical-activity-type-vs.html
[PhysiologicalStressIndex]: StructureDefinition-physiological-stress-index.html
[EnvironmentTypeCS]: CodeSystem-environment-type-cs.html
[EnvironmentTypeVS]: ValueSet-environment-type-vs.html
[PractitionerIdentifierCS]: CodeSystem-practitioner-identifier-cs.html
[PractitionerIdentifierVS]: ValueSet-practitioner-identifier-vs.html
[PractitionerExample]: Practitioner-PractitionerExample.html
[RecoveryEfficiency]: StructureDefinition-recovery-efficiency.html
[RegulatoryBasis]: StructureDefinition-regulatory-basis.html
[RegulatoryFrameworkCS]: CodeSystem-regulatory-framework-cs.html
[RegulatoryFrameworkVS]: ValueSet-regulatory-framework-vs.html
[ReproductiveActivityCS]: CodeSystem-reproductive-activity-cs.html
[ReproductiveActivityVS]: ValueSet-reproductive-activity-vs.html
[ReproductiveObservation]: StructureDefinition-reproductive-observation.html
[ReproductiveGoalVS]: ValueSet-reproductive-goal-vs.html
[ReproductiveHealthQuestionnaire]: Questionnaire-ReproductiveHealthQuestionnaire.html
[RiskLevelValueSet]: ValueSet-risk-level.html
[DeviceSleepMonitor]: Device-DeviceSleepMonitor.html
[SleepObservation]: StructureDefinition-sleep-observation.html
[SleepQuality]: StructureDefinition-sleep-quality.html
[SleepQualityExtendedVS]: ValueSet-sleep-quality-extended-vs.html
[SleepQualityVS]: ValueSet-sleep-quality-vs.html
[SmartScale]: Device-SmartScale.html
[SocialActivityCS]: CodeSystem-social-activity-cs.html
[SocialActivity]: StructureDefinition-social-activity.html
[SocialActivityVS]: ValueSet-social-activity-vs.html
[SocialContextCS]: CodeSystem-social-context-cs.html
[SocialContext]: StructureDefinition-social-context.html
[SocialContextVS]: ValueSet-social-context-vs.html
[SocialInteractionExample]: Observation-SocialInteractionExample.html
[SocialInteractionMediumCS]: CodeSystem-social-interaction-medium-cs.html
[SocialInteractionMediumVS]: ValueSet-social-interaction-medium-vs.html
[SocialInteractionProfile]: StructureDefinition-social-interaction.html
[SocialInteractionQualityCS]: CodeSystem-social-interaction-quality-cs.html
[SocialInteractionQualityVS]: ValueSet-social-interaction-quality-vs.html
[SocialInteractionTypeCS]: CodeSystem-social-interaction-type-cs.html
[SocialInteractionTypeVS]: ValueSet-social-interaction-type-vs.html
[SocialSupportCS]: CodeSystem-social-support-cs.html
[SocialSupport]: StructureDefinition-social-support.html
[SocialSupportVS]: ValueSet-social-support-vs.html
[StartSessionMessage]: MessageDefinition-StartSessionMessage.html
[StartSessionOperation]: OperationDefinition-StartSessionOperation.html
[StressChronicityCS]: CodeSystem-stress-chronicity-cs.html
[StressChronicityVS]: ValueSet-stress-chronicity-vs.html
[StressCopingCS]: CodeSystem-stress-coping-cs.html
[StressCoping]: StructureDefinition-stress-coping.html
[StressCopingVS]: ValueSet-stress-coping-vs.html
[StressImpactCS]: CodeSystem-stress-impact-cs.html
[StressImpactVS]: ValueSet-stress-impact-vs.html
[StressLevelExample]: Observation-StressLevelExample.html
[StressLevelProfile]: StructureDefinition-stress-level.html
[StressTriggersCS]: CodeSystem-stress-triggers-cs.html
[StressTriggers]: StructureDefinition-stress-triggers.html
[StressTriggersVS]: ValueSet-stress-triggers-vs.html
[SymptomQuestionnaire]: StructureDefinition-symptom-questionnaire.html
[SymptomFrequencyCS]: CodeSystem-symptom-frequency-cs.html
[SymptomFrequencyVS]: ValueSet-symptom-frequency-vs.html
[SymptomImpactCS]: CodeSystem-symptom-impact-cs.html
[SymptomImpactVS]: ValueSet-symptom-impact-vs.html
[SymptomProgressionVS]: ValueSet-symptom-progression-vs.html
[SymptomSeverityCS]: CodeSystem-symptom-severity-cs.html
[TimeOfDayVS]: ValueSet-time-of-day-vs.html
[UVExposureExample]: Observation-UVExposureExample.html
[UVExposureObservation]: StructureDefinition-uv-exposure-observation.html
[WalkingSpeedExample]: Observation-WalkingSpeedExample.html
[WalkingSpeedObservation]: StructureDefinition-walking-speed-observation.html
[WalkingSteadinessExample]: Observation-WalkingSteadinessExample.html
[WalkingSteadinessObservation]: StructureDefinition-walking-steadiness-observation.html
[WaterIntakeObservation]: StructureDefinition-water-intake-observation.html
[WeeklyMindfulnessSchedule]: Basic-WeeklyMindfulnessSchedule.html
[WeightExample]: Observation-WeightExample.html
[WeightObservation]: StructureDefinition-weight-observation.html
[WeightWithConditions]: Observation-WeightWithConditions.html

